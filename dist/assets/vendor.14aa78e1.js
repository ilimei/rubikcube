var Js={exports:{}},he={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Nc=Object.getOwnPropertySymbols,I0=Object.prototype.hasOwnProperty,N0=Object.prototype.propertyIsEnumerable;function U0(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function k0(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var i={},a=0;a<10;a++)i["_"+String.fromCharCode(a)]=a;var r=Object.getOwnPropertyNames(i).map(function(n){return i[n]});if(r.join("")!=="0123456789")return!1;var e={};return"abcdefghijklmnopqrst".split("").forEach(function(n){e[n]=n}),Object.keys(Object.assign({},e)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Uc=k0()?Object.assign:function(t,i){for(var a,r=U0(t),e,n=1;n<arguments.length;n++){a=Object(arguments[n]);for(var o in a)I0.call(a,o)&&(r[o]=a[o]);if(Nc){e=Nc(a);for(var s=0;s<e.length;s++)N0.call(a,e[s])&&(r[e[s]]=a[e[s]])}}return r};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var el=Uc,ri=60103,kc=60106;he.Fragment=60107;he.StrictMode=60108;he.Profiler=60114;var Vc=60109,Gc=60110,Hc=60112;he.Suspense=60113;var Wc=60115,jc=60116;if(typeof Symbol=="function"&&Symbol.for){var qt=Symbol.for;ri=qt("react.element"),kc=qt("react.portal"),he.Fragment=qt("react.fragment"),he.StrictMode=qt("react.strict_mode"),he.Profiler=qt("react.profiler"),Vc=qt("react.provider"),Gc=qt("react.context"),Hc=qt("react.forward_ref"),he.Suspense=qt("react.suspense"),Wc=qt("react.memo"),jc=qt("react.lazy")}var Xc=typeof Symbol=="function"&&Symbol.iterator;function V0(t){return t===null||typeof t!="object"?null:(t=Xc&&t[Xc]||t["@@iterator"],typeof t=="function"?t:null)}function qi(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Kc={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qc={};function ni(t,i,a){this.props=t,this.context=i,this.refs=qc,this.updater=a||Kc}ni.prototype.isReactComponent={};ni.prototype.setState=function(t,i){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error(qi(85));this.updater.enqueueSetState(this,t,i,"setState")};ni.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Qc(){}Qc.prototype=ni.prototype;function tl(t,i,a){this.props=t,this.context=i,this.refs=qc,this.updater=a||Kc}var rl=tl.prototype=new Qc;rl.constructor=tl;el(rl,ni.prototype);rl.isPureReactComponent=!0;var nl={current:null},Yc=Object.prototype.hasOwnProperty,$c={key:!0,ref:!0,__self:!0,__source:!0};function Zc(t,i,a){var r,e={},n=null,o=null;if(i!=null)for(r in i.ref!==void 0&&(o=i.ref),i.key!==void 0&&(n=""+i.key),i)Yc.call(i,r)&&!$c.hasOwnProperty(r)&&(e[r]=i[r]);var s=arguments.length-2;if(s===1)e.children=a;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];e.children=l}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)e[r]===void 0&&(e[r]=s[r]);return{$$typeof:ri,type:t,key:n,ref:o,props:e,_owner:nl.current}}function G0(t,i){return{$$typeof:ri,type:t.type,key:i,ref:t.ref,props:t.props,_owner:t._owner}}function il(t){return typeof t=="object"&&t!==null&&t.$$typeof===ri}function H0(t){var i={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(a){return i[a]})}var Jc=/\/+/g;function al(t,i){return typeof t=="object"&&t!==null&&t.key!=null?H0(""+t.key):i.toString(36)}function So(t,i,a,r,e){var n=typeof t;(n==="undefined"||n==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(n){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ri:case kc:o=!0}}if(o)return o=t,e=e(o),t=r===""?"."+al(o,0):r,Array.isArray(e)?(a="",t!=null&&(a=t.replace(Jc,"$&/")+"/"),So(e,i,a,"",function(u){return u})):e!=null&&(il(e)&&(e=G0(e,a+(!e.key||o&&o.key===e.key?"":(""+e.key).replace(Jc,"$&/")+"/")+t)),i.push(e)),1;if(o=0,r=r===""?".":r+":",Array.isArray(t))for(var s=0;s<t.length;s++){n=t[s];var l=r+al(n,s);o+=So(n,i,a,l,e)}else if(l=V0(t),typeof l=="function")for(t=l.call(t),s=0;!(n=t.next()).done;)n=n.value,l=r+al(n,s++),o+=So(n,i,a,l,e);else if(n==="object")throw i=""+t,Error(qi(31,i==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":i));return o}function Po(t,i,a){if(t==null)return t;var r=[],e=0;return So(t,r,"","",function(n){return i.call(a,n,e++)}),r}function W0(t){if(t._status===-1){var i=t._result;i=i(),t._status=0,t._result=i,i.then(function(a){t._status===0&&(a=a.default,t._status=1,t._result=a)},function(a){t._status===0&&(t._status=2,t._result=a)})}if(t._status===1)return t._result;throw t._result}var ef={current:null};function Pr(){var t=ef.current;if(t===null)throw Error(qi(321));return t}var j0={ReactCurrentDispatcher:ef,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:nl,IsSomeRendererActing:{current:!1},assign:el};he.Children={map:Po,forEach:function(t,i,a){Po(t,function(){i.apply(this,arguments)},a)},count:function(t){var i=0;return Po(t,function(){i++}),i},toArray:function(t){return Po(t,function(i){return i})||[]},only:function(t){if(!il(t))throw Error(qi(143));return t}};he.Component=ni;he.PureComponent=tl;he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j0;he.cloneElement=function(t,i,a){if(t==null)throw Error(qi(267,t));var r=el({},t.props),e=t.key,n=t.ref,o=t._owner;if(i!=null){if(i.ref!==void 0&&(n=i.ref,o=nl.current),i.key!==void 0&&(e=""+i.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(l in i)Yc.call(i,l)&&!$c.hasOwnProperty(l)&&(r[l]=i[l]===void 0&&s!==void 0?s[l]:i[l])}var l=arguments.length-2;if(l===1)r.children=a;else if(1<l){s=Array(l);for(var u=0;u<l;u++)s[u]=arguments[u+2];r.children=s}return{$$typeof:ri,type:t.type,key:e,ref:n,props:r,_owner:o}};he.createContext=function(t,i){return i===void 0&&(i=null),t={$$typeof:Gc,_calculateChangedBits:i,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider={$$typeof:Vc,_context:t},t.Consumer=t};he.createElement=Zc;he.createFactory=function(t){var i=Zc.bind(null,t);return i.type=t,i};he.createRef=function(){return{current:null}};he.forwardRef=function(t){return{$$typeof:Hc,render:t}};he.isValidElement=il;he.lazy=function(t){return{$$typeof:jc,_payload:{_status:-1,_result:t},_init:W0}};he.memo=function(t,i){return{$$typeof:Wc,type:t,compare:i===void 0?null:i}};he.useCallback=function(t,i){return Pr().useCallback(t,i)};he.useContext=function(t,i){return Pr().useContext(t,i)};he.useDebugValue=function(){};he.useEffect=function(t,i){return Pr().useEffect(t,i)};he.useImperativeHandle=function(t,i,a){return Pr().useImperativeHandle(t,i,a)};he.useLayoutEffect=function(t,i){return Pr().useLayoutEffect(t,i)};he.useMemo=function(t,i){return Pr().useMemo(t,i)};he.useReducer=function(t,i,a){return Pr().useReducer(t,i,a)};he.useRef=function(t){return Pr().useRef(t)};he.useState=function(t){return Pr().useState(t)};he.version="17.0.2";Js.exports=he;var Uw=Js.exports,tf={exports:{}},Lt={},rf={exports:{}},nf={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){var i,a,r,e;if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;t.unstable_now=function(){return n.now()}}else{var o=Date,s=o.now();t.unstable_now=function(){return o.now()-s}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var l=null,u=null,c=function(){if(l!==null)try{var B=t.unstable_now();l(!0,B),l=null}catch(V){throw setTimeout(c,0),V}};i=function(B){l!==null?setTimeout(i,0,B):(l=B,setTimeout(c,0))},a=function(B,V){u=setTimeout(B,V)},r=function(){clearTimeout(u)},t.unstable_shouldYield=function(){return!1},e=t.unstable_forceFrameRate=function(){}}else{var f=window.setTimeout,d=window.clearTimeout;if(typeof console!="undefined"){var h=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof h!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var _=!1,m=null,v=-1,p=5,g=0;t.unstable_shouldYield=function(){return t.unstable_now()>=g},e=function(){},t.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):p=0<B?Math.floor(1e3/B):5};var y=new MessageChannel,x=y.port2;y.port1.onmessage=function(){if(m!==null){var B=t.unstable_now();g=B+p;try{m(!0,B)?x.postMessage(null):(_=!1,m=null)}catch(V){throw x.postMessage(null),V}}else _=!1},i=function(B){m=B,_||(_=!0,x.postMessage(null))},a=function(B,V){v=f(function(){B(t.unstable_now())},V)},r=function(){d(v),v=-1}}function T(B,V){var j=B.length;B.push(V);e:for(;;){var re=j-1>>>1,se=B[re];if(se!==void 0&&0<M(se,V))B[re]=V,B[j]=se,j=re;else break e}}function w(B){return B=B[0],B===void 0?null:B}function S(B){var V=B[0];if(V!==void 0){var j=B.pop();if(j!==V){B[0]=j;e:for(var re=0,se=B.length;re<se;){var _e=2*(re+1)-1,de=B[_e],Ae=_e+1,Te=B[Ae];if(de!==void 0&&0>M(de,j))Te!==void 0&&0>M(Te,de)?(B[re]=Te,B[Ae]=j,re=Ae):(B[re]=de,B[_e]=j,re=_e);else if(Te!==void 0&&0>M(Te,j))B[re]=Te,B[Ae]=j,re=Ae;else break e}}return V}return null}function M(B,V){var j=B.sortIndex-V.sortIndex;return j!==0?j:B.id-V.id}var P=[],E=[],R=1,C=null,z=3,k=!1,D=!1,H=!1;function W(B){for(var V=w(E);V!==null;){if(V.callback===null)S(E);else if(V.startTime<=B)S(E),V.sortIndex=V.expirationTime,T(P,V);else break;V=w(E)}}function K(B){if(H=!1,W(B),!D)if(w(P)!==null)D=!0,i(F);else{var V=w(E);V!==null&&a(K,V.startTime-B)}}function F(B,V){D=!1,H&&(H=!1,r()),k=!0;var j=z;try{for(W(V),C=w(P);C!==null&&(!(C.expirationTime>V)||B&&!t.unstable_shouldYield());){var re=C.callback;if(typeof re=="function"){C.callback=null,z=C.priorityLevel;var se=re(C.expirationTime<=V);V=t.unstable_now(),typeof se=="function"?C.callback=se:C===w(P)&&S(P),W(V)}else S(P);C=w(P)}if(C!==null)var _e=!0;else{var de=w(E);de!==null&&a(K,de.startTime-V),_e=!1}return _e}finally{C=null,z=j,k=!1}}var te=e;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(B){B.callback=null},t.unstable_continueExecution=function(){D||k||(D=!0,i(F))},t.unstable_getCurrentPriorityLevel=function(){return z},t.unstable_getFirstCallbackNode=function(){return w(P)},t.unstable_next=function(B){switch(z){case 1:case 2:case 3:var V=3;break;default:V=z}var j=z;z=V;try{return B()}finally{z=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=te,t.unstable_runWithPriority=function(B,V){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var j=z;z=B;try{return V()}finally{z=j}},t.unstable_scheduleCallback=function(B,V,j){var re=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?re+j:re):j=re,B){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=j+se,B={id:R++,callback:V,priorityLevel:B,startTime:j,expirationTime:se,sortIndex:-1},j>re?(B.sortIndex=j,T(E,B),w(P)===null&&B===w(E)&&(H?r():H=!0,a(K,j-re))):(B.sortIndex=se,T(P,B),D||k||(D=!0,i(F))),B},t.unstable_wrapCallback=function(B){var V=z;return function(){var j=z;z=V;try{return B.apply(this,arguments)}finally{z=j}}}})(nf);rf.exports=nf;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ao=Js.exports,Se=Uc,Ue=rf.exports;function U(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!Ao)throw Error(U(227));var af=new Set,Qi={};function bn(t,i){ii(t,i),ii(t+"Capture",i)}function ii(t,i){for(Qi[t]=i,t=0;t<i.length;t++)af.add(i[t])}var Ar=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),X0=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,of=Object.prototype.hasOwnProperty,sf={},lf={};function K0(t){return of.call(lf,t)?!0:of.call(sf,t)?!1:X0.test(t)?lf[t]=!0:(sf[t]=!0,!1)}function q0(t,i,a,r){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return r?!1:a!==null?!a.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Q0(t,i,a,r){if(i===null||typeof i=="undefined"||q0(t,i,a,r))return!0;if(r)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function ft(t,i,a,r,e,n,o){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=r,this.attributeNamespace=e,this.mustUseProperty=a,this.propertyName=t,this.type=i,this.sanitizeURL=n,this.removeEmptyString=o}var Qe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Qe[t]=new ft(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var i=t[0];Qe[i]=new ft(i,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Qe[t]=new ft(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Qe[t]=new ft(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Qe[t]=new ft(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Qe[t]=new ft(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Qe[t]=new ft(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Qe[t]=new ft(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Qe[t]=new ft(t,5,!1,t.toLowerCase(),null,!1,!1)});var ol=/[\-:]([a-z])/g;function sl(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var i=t.replace(ol,sl);Qe[i]=new ft(i,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var i=t.replace(ol,sl);Qe[i]=new ft(i,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var i=t.replace(ol,sl);Qe[i]=new ft(i,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Qe[t]=new ft(t,1,!1,t.toLowerCase(),null,!1,!1)});Qe.xlinkHref=new ft("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Qe[t]=new ft(t,1,!1,t.toLowerCase(),null,!0,!0)});function ll(t,i,a,r){var e=Qe.hasOwnProperty(i)?Qe[i]:null,n=e!==null?e.type===0:r?!1:!(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N");n||(Q0(i,a,e,r)&&(a=null),r||e===null?K0(i)&&(a===null?t.removeAttribute(i):t.setAttribute(i,""+a)):e.mustUseProperty?t[e.propertyName]=a===null?e.type===3?!1:"":a:(i=e.attributeName,r=e.attributeNamespace,a===null?t.removeAttribute(i):(e=e.type,a=e===3||e===4&&a===!0?"":""+a,r?t.setAttributeNS(r,i,a):t.setAttribute(i,a))))}var Cn=Ao.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yi=60103,Rn=60106,Hr=60107,ul=60108,$i=60114,cl=60109,fl=60110,To=60112,Zi=60113,Mo=60120,Eo=60115,dl=60116,hl=60121,vl=60128,uf=60129,_l=60130,pl=60131;if(typeof Symbol=="function"&&Symbol.for){var ke=Symbol.for;Yi=ke("react.element"),Rn=ke("react.portal"),Hr=ke("react.fragment"),ul=ke("react.strict_mode"),$i=ke("react.profiler"),cl=ke("react.provider"),fl=ke("react.context"),To=ke("react.forward_ref"),Zi=ke("react.suspense"),Mo=ke("react.suspense_list"),Eo=ke("react.memo"),dl=ke("react.lazy"),hl=ke("react.block"),ke("react.scope"),vl=ke("react.opaque.id"),uf=ke("react.debug_trace_mode"),_l=ke("react.offscreen"),pl=ke("react.legacy_hidden")}var cf=typeof Symbol=="function"&&Symbol.iterator;function Ji(t){return t===null||typeof t!="object"?null:(t=cf&&t[cf]||t["@@iterator"],typeof t=="function"?t:null)}var gl;function ea(t){if(gl===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);gl=i&&i[1]||""}return`
`+gl+t}var ml=!1;function bo(t,i){if(!t||ml)return"";ml=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(l){var r=l}Reflect.construct(t,[],i)}else{try{i.call()}catch(l){r=l}t.call(i.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var e=l.stack.split(`
`),n=r.stack.split(`
`),o=e.length-1,s=n.length-1;1<=o&&0<=s&&e[o]!==n[s];)s--;for(;1<=o&&0<=s;o--,s--)if(e[o]!==n[s]){if(o!==1||s!==1)do if(o--,s--,0>s||e[o]!==n[s])return`
`+e[o].replace(" at new "," at ");while(1<=o&&0<=s);break}}}finally{ml=!1,Error.prepareStackTrace=a}return(t=t?t.displayName||t.name:"")?ea(t):""}function Y0(t){switch(t.tag){case 5:return ea(t.type);case 16:return ea("Lazy");case 13:return ea("Suspense");case 19:return ea("SuspenseList");case 0:case 2:case 15:return t=bo(t.type,!1),t;case 11:return t=bo(t.type.render,!1),t;case 22:return t=bo(t.type._render,!1),t;case 1:return t=bo(t.type,!0),t;default:return""}}function ai(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Hr:return"Fragment";case Rn:return"Portal";case $i:return"Profiler";case ul:return"StrictMode";case Zi:return"Suspense";case Mo:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case fl:return(t.displayName||"Context")+".Consumer";case cl:return(t._context.displayName||"Context")+".Provider";case To:var i=t.render;return i=i.displayName||i.name||"",t.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case Eo:return ai(t.type);case hl:return ai(t._render);case dl:i=t._payload,t=t._init;try{return ai(t(i))}catch{}}return null}function Wr(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function ff(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function $0(t){var i=ff(t)?"checked":"value",a=Object.getOwnPropertyDescriptor(t.constructor.prototype,i),r=""+t[i];if(!t.hasOwnProperty(i)&&typeof a!="undefined"&&typeof a.get=="function"&&typeof a.set=="function"){var e=a.get,n=a.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return e.call(this)},set:function(o){r=""+o,n.call(this,o)}}),Object.defineProperty(t,i,{enumerable:a.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function Co(t){t._valueTracker||(t._valueTracker=$0(t))}function df(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var a=i.getValue(),r="";return t&&(r=ff(t)?t.checked?"true":"false":t.value),t=r,t!==a?(i.setValue(t),!0):!1}function Ro(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch{return t.body}}function yl(t,i){var a=i.checked;return Se({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a!=null?a:t._wrapperState.initialChecked})}function hf(t,i){var a=i.defaultValue==null?"":i.defaultValue,r=i.checked!=null?i.checked:i.defaultChecked;a=Wr(i.value!=null?i.value:a),t._wrapperState={initialChecked:r,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function vf(t,i){i=i.checked,i!=null&&ll(t,"checked",i,!1)}function xl(t,i){vf(t,i);var a=Wr(i.value),r=i.type;if(a!=null)r==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+a):t.value!==""+a&&(t.value=""+a);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}i.hasOwnProperty("value")?wl(t,i.type,a):i.hasOwnProperty("defaultValue")&&wl(t,i.type,Wr(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(t.defaultChecked=!!i.defaultChecked)}function _f(t,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var r=i.type;if(!(r!=="submit"&&r!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+t._wrapperState.initialValue,a||i===t.value||(t.value=i),t.defaultValue=i}a=t.name,a!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,a!==""&&(t.name=a)}function wl(t,i,a){(i!=="number"||Ro(t.ownerDocument)!==t)&&(a==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+a&&(t.defaultValue=""+a))}function Z0(t){var i="";return Ao.Children.forEach(t,function(a){a!=null&&(i+=a)}),i}function Sl(t,i){return t=Se({children:void 0},i),(i=Z0(i.children))&&(t.children=i),t}function oi(t,i,a,r){if(t=t.options,i){i={};for(var e=0;e<a.length;e++)i["$"+a[e]]=!0;for(a=0;a<t.length;a++)e=i.hasOwnProperty("$"+t[a].value),t[a].selected!==e&&(t[a].selected=e),e&&r&&(t[a].defaultSelected=!0)}else{for(a=""+Wr(a),i=null,e=0;e<t.length;e++){if(t[e].value===a){t[e].selected=!0,r&&(t[e].defaultSelected=!0);return}i!==null||t[e].disabled||(i=t[e])}i!==null&&(i.selected=!0)}}function Pl(t,i){if(i.dangerouslySetInnerHTML!=null)throw Error(U(91));return Se({},i,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function pf(t,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(U(92));if(Array.isArray(a)){if(!(1>=a.length))throw Error(U(93));a=a[0]}i=a}i==null&&(i=""),a=i}t._wrapperState={initialValue:Wr(a)}}function gf(t,i){var a=Wr(i.value),r=Wr(i.defaultValue);a!=null&&(a=""+a,a!==t.value&&(t.value=a),i.defaultValue==null&&t.defaultValue!==a&&(t.defaultValue=a)),r!=null&&(t.defaultValue=""+r)}function mf(t){var i=t.textContent;i===t._wrapperState.initialValue&&i!==""&&i!==null&&(t.value=i)}var Al={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function yf(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Tl(t,i){return t==null||t==="http://www.w3.org/1999/xhtml"?yf(i):t==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var zo,xf=function(t){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(i,a,r,e){MSApp.execUnsafeLocalFunction(function(){return t(i,a,r,e)})}:t}(function(t,i){if(t.namespaceURI!==Al.svg||"innerHTML"in t)t.innerHTML=i;else{for(zo=zo||document.createElement("div"),zo.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=zo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;i.firstChild;)t.appendChild(i.firstChild)}});function ta(t,i){if(i){var a=t.firstChild;if(a&&a===t.lastChild&&a.nodeType===3){a.nodeValue=i;return}}t.textContent=i}var ra={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},J0=["Webkit","ms","Moz","O"];Object.keys(ra).forEach(function(t){J0.forEach(function(i){i=i+t.charAt(0).toUpperCase()+t.substring(1),ra[i]=ra[t]})});function wf(t,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||ra.hasOwnProperty(t)&&ra[t]?(""+i).trim():i+"px"}function Sf(t,i){t=t.style;for(var a in i)if(i.hasOwnProperty(a)){var r=a.indexOf("--")===0,e=wf(a,i[a],r);a==="float"&&(a="cssFloat"),r?t.setProperty(a,e):t[a]=e}}var eg=Se({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ml(t,i){if(i){if(eg[t]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(U(137,t));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(U(60));if(!(typeof i.dangerouslySetInnerHTML=="object"&&"__html"in i.dangerouslySetInnerHTML))throw Error(U(61))}if(i.style!=null&&typeof i.style!="object")throw Error(U(62))}}function El(t,i){if(t.indexOf("-")===-1)return typeof i.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function bl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Cl=null,si=null,li=null;function Pf(t){if(t=wa(t)){if(typeof Cl!="function")throw Error(U(280));var i=t.stateNode;i&&(i=Qo(i),Cl(t.stateNode,t.type,i))}}function Af(t){si?li?li.push(t):li=[t]:si=t}function Tf(){if(si){var t=si,i=li;if(li=si=null,Pf(t),i)for(t=0;t<i.length;t++)Pf(i[t])}}function Rl(t,i){return t(i)}function Mf(t,i,a,r,e){return t(i,a,r,e)}function zl(){}var Ef=Rl,zn=!1,Bl=!1;function Ll(){(si!==null||li!==null)&&(zl(),Tf())}function tg(t,i,a){if(Bl)return t(i,a);Bl=!0;try{return Ef(t,i,a)}finally{Bl=!1,Ll()}}function na(t,i){var a=t.stateNode;if(a===null)return null;var r=Qo(a);if(r===null)return null;a=r[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(a&&typeof a!="function")throw Error(U(231,i,typeof a));return a}var Ol=!1;if(Ar)try{var ia={};Object.defineProperty(ia,"passive",{get:function(){Ol=!0}}),window.addEventListener("test",ia,ia),window.removeEventListener("test",ia,ia)}catch{Ol=!1}function rg(t,i,a,r,e,n,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{i.apply(a,u)}catch(c){this.onError(c)}}var aa=!1,Bo=null,Lo=!1,Dl=null,ng={onError:function(t){aa=!0,Bo=t}};function ig(t,i,a,r,e,n,o,s,l){aa=!1,Bo=null,rg.apply(ng,arguments)}function ag(t,i,a,r,e,n,o,s,l){if(ig.apply(this,arguments),aa){if(aa){var u=Bo;aa=!1,Bo=null}else throw Error(U(198));Lo||(Lo=!0,Dl=u)}}function Bn(t){var i=t,a=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&1026)!=0&&(a=i.return),t=i.return;while(t)}return i.tag===3?a:null}function bf(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function Cf(t){if(Bn(t)!==t)throw Error(U(188))}function og(t){var i=t.alternate;if(!i){if(i=Bn(t),i===null)throw Error(U(188));return i!==t?null:t}for(var a=t,r=i;;){var e=a.return;if(e===null)break;var n=e.alternate;if(n===null){if(r=e.return,r!==null){a=r;continue}break}if(e.child===n.child){for(n=e.child;n;){if(n===a)return Cf(e),t;if(n===r)return Cf(e),i;n=n.sibling}throw Error(U(188))}if(a.return!==r.return)a=e,r=n;else{for(var o=!1,s=e.child;s;){if(s===a){o=!0,a=e,r=n;break}if(s===r){o=!0,r=e,a=n;break}s=s.sibling}if(!o){for(s=n.child;s;){if(s===a){o=!0,a=n,r=e;break}if(s===r){o=!0,r=n,a=e;break}s=s.sibling}if(!o)throw Error(U(189))}}if(a.alternate!==r)throw Error(U(190))}if(a.tag!==3)throw Error(U(188));return a.stateNode.current===a?t:i}function Rf(t){if(t=og(t),!t)return null;for(var i=t;;){if(i.tag===5||i.tag===6)return i;if(i.child)i.child.return=i,i=i.child;else{if(i===t)break;for(;!i.sibling;){if(!i.return||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}}return null}function zf(t,i){for(var a=t.alternate;i!==null;){if(i===t||i===a)return!0;i=i.return}return!1}var Bf,Fl,Lf,Of,Il=!1,lr=[],jr=null,Xr=null,Kr=null,oa=new Map,sa=new Map,la=[],Df="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nl(t,i,a,r,e){return{blockedOn:t,domEventName:i,eventSystemFlags:a|16,nativeEvent:e,targetContainers:[r]}}function Ff(t,i){switch(t){case"focusin":case"focusout":jr=null;break;case"dragenter":case"dragleave":Xr=null;break;case"mouseover":case"mouseout":Kr=null;break;case"pointerover":case"pointerout":oa.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":sa.delete(i.pointerId)}}function ua(t,i,a,r,e,n){return t===null||t.nativeEvent!==n?(t=Nl(i,a,r,e,n),i!==null&&(i=wa(i),i!==null&&Fl(i)),t):(t.eventSystemFlags|=r,i=t.targetContainers,e!==null&&i.indexOf(e)===-1&&i.push(e),t)}function sg(t,i,a,r,e){switch(i){case"focusin":return jr=ua(jr,t,i,a,r,e),!0;case"dragenter":return Xr=ua(Xr,t,i,a,r,e),!0;case"mouseover":return Kr=ua(Kr,t,i,a,r,e),!0;case"pointerover":var n=e.pointerId;return oa.set(n,ua(oa.get(n)||null,t,i,a,r,e)),!0;case"gotpointercapture":return n=e.pointerId,sa.set(n,ua(sa.get(n)||null,t,i,a,r,e)),!0}return!1}function lg(t){var i=Ln(t.target);if(i!==null){var a=Bn(i);if(a!==null){if(i=a.tag,i===13){if(i=bf(a),i!==null){t.blockedOn=i,Of(t.lanePriority,function(){Ue.unstable_runWithPriority(t.priority,function(){Lf(a)})});return}}else if(i===3&&a.stateNode.hydrate){t.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Oo(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var a=Wl(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(a!==null)return i=wa(a),i!==null&&Fl(i),t.blockedOn=a,!1;i.shift()}return!0}function If(t,i,a){Oo(t)&&a.delete(i)}function ug(){for(Il=!1;0<lr.length;){var t=lr[0];if(t.blockedOn!==null){t=wa(t.blockedOn),t!==null&&Bf(t);break}for(var i=t.targetContainers;0<i.length;){var a=Wl(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(a!==null){t.blockedOn=a;break}i.shift()}t.blockedOn===null&&lr.shift()}jr!==null&&Oo(jr)&&(jr=null),Xr!==null&&Oo(Xr)&&(Xr=null),Kr!==null&&Oo(Kr)&&(Kr=null),oa.forEach(If),sa.forEach(If)}function ca(t,i){t.blockedOn===i&&(t.blockedOn=null,Il||(Il=!0,Ue.unstable_scheduleCallback(Ue.unstable_NormalPriority,ug)))}function Nf(t){function i(e){return ca(e,t)}if(0<lr.length){ca(lr[0],t);for(var a=1;a<lr.length;a++){var r=lr[a];r.blockedOn===t&&(r.blockedOn=null)}}for(jr!==null&&ca(jr,t),Xr!==null&&ca(Xr,t),Kr!==null&&ca(Kr,t),oa.forEach(i),sa.forEach(i),a=0;a<la.length;a++)r=la[a],r.blockedOn===t&&(r.blockedOn=null);for(;0<la.length&&(a=la[0],a.blockedOn===null);)lg(a),a.blockedOn===null&&la.shift()}function Do(t,i){var a={};return a[t.toLowerCase()]=i.toLowerCase(),a["Webkit"+t]="webkit"+i,a["Moz"+t]="moz"+i,a}var ui={animationend:Do("Animation","AnimationEnd"),animationiteration:Do("Animation","AnimationIteration"),animationstart:Do("Animation","AnimationStart"),transitionend:Do("Transition","TransitionEnd")},Ul={},Uf={};Ar&&(Uf=document.createElement("div").style,"AnimationEvent"in window||(delete ui.animationend.animation,delete ui.animationiteration.animation,delete ui.animationstart.animation),"TransitionEvent"in window||delete ui.transitionend.transition);function Fo(t){if(Ul[t])return Ul[t];if(!ui[t])return t;var i=ui[t],a;for(a in i)if(i.hasOwnProperty(a)&&a in Uf)return Ul[t]=i[a];return t}var kf=Fo("animationend"),Vf=Fo("animationiteration"),Gf=Fo("animationstart"),Hf=Fo("transitionend"),Wf=new Map,kl=new Map,cg=["abort","abort",kf,"animationEnd",Vf,"animationIteration",Gf,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Hf,"transitionEnd","waiting","waiting"];function Vl(t,i){for(var a=0;a<t.length;a+=2){var r=t[a],e=t[a+1];e="on"+(e[0].toUpperCase()+e.slice(1)),kl.set(r,i),Wf.set(r,e),bn(e,[r])}}var fg=Ue.unstable_now;fg();var ye=8;function ci(t){if((1&t)!=0)return ye=15,1;if((2&t)!=0)return ye=14,2;if((4&t)!=0)return ye=13,4;var i=24&t;return i!==0?(ye=12,i):(t&32)!=0?(ye=11,32):(i=192&t,i!==0?(ye=10,i):(t&256)!=0?(ye=9,256):(i=3584&t,i!==0?(ye=8,i):(t&4096)!=0?(ye=7,4096):(i=4186112&t,i!==0?(ye=6,i):(i=62914560&t,i!==0?(ye=5,i):t&67108864?(ye=4,67108864):(t&134217728)!=0?(ye=3,134217728):(i=805306368&t,i!==0?(ye=2,i):(1073741824&t)!=0?(ye=1,1073741824):(ye=8,t))))))}function dg(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function hg(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(U(358,t))}}function fa(t,i){var a=t.pendingLanes;if(a===0)return ye=0;var r=0,e=0,n=t.expiredLanes,o=t.suspendedLanes,s=t.pingedLanes;if(n!==0)r=n,e=ye=15;else if(n=a&134217727,n!==0){var l=n&~o;l!==0?(r=ci(l),e=ye):(s&=n,s!==0&&(r=ci(s),e=ye))}else n=a&~o,n!==0?(r=ci(n),e=ye):s!==0&&(r=ci(s),e=ye);if(r===0)return 0;if(r=31-qr(r),r=a&((0>r?0:1<<r)<<1)-1,i!==0&&i!==r&&(i&o)==0){if(ci(i),e<=ye)return i;ye=e}if(i=t.entangledLanes,i!==0)for(t=t.entanglements,i&=r;0<i;)a=31-qr(i),e=1<<a,r|=t[a],i&=~e;return r}function jf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Io(t,i){switch(t){case 15:return 1;case 14:return 2;case 12:return t=fi(24&~i),t===0?Io(10,i):t;case 10:return t=fi(192&~i),t===0?Io(8,i):t;case 8:return t=fi(3584&~i),t===0&&(t=fi(4186112&~i),t===0&&(t=512)),t;case 2:return i=fi(805306368&~i),i===0&&(i=268435456),i}throw Error(U(358,t))}function fi(t){return t&-t}function Gl(t){for(var i=[],a=0;31>a;a++)i.push(t);return i}function No(t,i,a){t.pendingLanes|=i;var r=i-1;t.suspendedLanes&=r,t.pingedLanes&=r,t=t.eventTimes,i=31-qr(i),t[i]=a}var qr=Math.clz32?Math.clz32:pg,vg=Math.log,_g=Math.LN2;function pg(t){return t===0?32:31-(vg(t)/_g|0)|0}var gg=Ue.unstable_UserBlockingPriority,mg=Ue.unstable_runWithPriority,Uo=!0;function yg(t,i,a,r){zn||zl();var e=Hl,n=zn;zn=!0;try{Mf(e,t,i,a,r)}finally{(zn=n)||Ll()}}function xg(t,i,a,r){mg(gg,Hl.bind(null,t,i,a,r))}function Hl(t,i,a,r){if(Uo){var e;if((e=(i&4)==0)&&0<lr.length&&-1<Df.indexOf(t))t=Nl(null,t,i,a,r),lr.push(t);else{var n=Wl(t,i,a,r);if(n===null)e&&Ff(t,r);else{if(e){if(-1<Df.indexOf(t)){t=Nl(n,t,i,a,r),lr.push(t);return}if(sg(n,t,i,a,r))return;Ff(t,r)}wd(t,i,r,null,a)}}}}function Wl(t,i,a,r){var e=bl(r);if(e=Ln(e),e!==null){var n=Bn(e);if(n===null)e=null;else{var o=n.tag;if(o===13){if(e=bf(n),e!==null)return e;e=null}else if(o===3){if(n.stateNode.hydrate)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return wd(t,i,r,e,a),null}var Qr=null,jl=null,ko=null;function Xf(){if(ko)return ko;var t,i=jl,a=i.length,r,e="value"in Qr?Qr.value:Qr.textContent,n=e.length;for(t=0;t<a&&i[t]===e[t];t++);var o=a-t;for(r=1;r<=o&&i[a-r]===e[n-r];r++);return ko=e.slice(t,1<r?1-r:void 0)}function Vo(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function Go(){return!0}function Kf(){return!1}function bt(t){function i(a,r,e,n,o){this._reactName=a,this._targetInst=e,this.type=r,this.nativeEvent=n,this.target=o,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(a=t[s],this[s]=a?a(n):n[s]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?Go:Kf,this.isPropagationStopped=Kf,this}return Se(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Go)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Go)},persist:function(){},isPersistent:Go}),i}var di={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xl=bt(di),da=Se({},di,{view:0,detail:0}),wg=bt(da),Kl,ql,ha,Ho=Se({},da,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yl,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ha&&(ha&&t.type==="mousemove"?(Kl=t.screenX-ha.screenX,ql=t.screenY-ha.screenY):ql=Kl=0,ha=t),Kl)},movementY:function(t){return"movementY"in t?t.movementY:ql}}),qf=bt(Ho),Sg=Se({},Ho,{dataTransfer:0}),Pg=bt(Sg),Ag=Se({},da,{relatedTarget:0}),Ql=bt(Ag),Tg=Se({},di,{animationName:0,elapsedTime:0,pseudoElement:0}),Mg=bt(Tg),Eg=Se({},di,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),bg=bt(Eg),Cg=Se({},di,{data:0}),Qf=bt(Cg),Rg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lg(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=Bg[t])?!!i[t]:!1}function Yl(){return Lg}var Og=Se({},da,{key:function(t){if(t.key){var i=Rg[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=Vo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?zg[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yl,charCode:function(t){return t.type==="keypress"?Vo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Vo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Dg=bt(Og),Fg=Se({},Ho,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yf=bt(Fg),Ig=Se({},da,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yl}),Ng=bt(Ig),Ug=Se({},di,{propertyName:0,elapsedTime:0,pseudoElement:0}),kg=bt(Ug),Vg=Se({},Ho,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Gg=bt(Vg),Hg=[9,13,27,32],$l=Ar&&"CompositionEvent"in window,va=null;Ar&&"documentMode"in document&&(va=document.documentMode);var Wg=Ar&&"TextEvent"in window&&!va,$f=Ar&&(!$l||va&&8<va&&11>=va),Zf=String.fromCharCode(32),Jf=!1;function ed(t,i){switch(t){case"keyup":return Hg.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function td(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var hi=!1;function jg(t,i){switch(t){case"compositionend":return td(i);case"keypress":return i.which!==32?null:(Jf=!0,Zf);case"textInput":return t=i.data,t===Zf&&Jf?null:t;default:return null}}function Xg(t,i){if(hi)return t==="compositionend"||!$l&&ed(t,i)?(t=Xf(),ko=jl=Qr=null,hi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return $f&&i.locale!=="ko"?null:i.data;default:return null}}var Kg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rd(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!Kg[t.type]:i==="textarea"}function nd(t,i,a,r){Af(r),i=jo(i,"onChange"),0<i.length&&(a=new Xl("onChange","change",null,a,r),t.push({event:a,listeners:i}))}var _a=null,pa=null;function qg(t){pd(t,0)}function Wo(t){var i=mi(t);if(df(i))return t}function Qg(t,i){if(t==="change")return i}var id=!1;if(Ar){var Zl;if(Ar){var Jl="oninput"in document;if(!Jl){var ad=document.createElement("div");ad.setAttribute("oninput","return;"),Jl=typeof ad.oninput=="function"}Zl=Jl}else Zl=!1;id=Zl&&(!document.documentMode||9<document.documentMode)}function od(){_a&&(_a.detachEvent("onpropertychange",sd),pa=_a=null)}function sd(t){if(t.propertyName==="value"&&Wo(pa)){var i=[];if(nd(i,pa,t,bl(t)),t=qg,zn)t(i);else{zn=!0;try{Rl(t,i)}finally{zn=!1,Ll()}}}}function Yg(t,i,a){t==="focusin"?(od(),_a=i,pa=a,_a.attachEvent("onpropertychange",sd)):t==="focusout"&&od()}function $g(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Wo(pa)}function Zg(t,i){if(t==="click")return Wo(i)}function Jg(t,i){if(t==="input"||t==="change")return Wo(i)}function em(t,i){return t===i&&(t!==0||1/t==1/i)||t!==t&&i!==i}var Ot=typeof Object.is=="function"?Object.is:em,tm=Object.prototype.hasOwnProperty;function ga(t,i){if(Ot(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var a=Object.keys(t),r=Object.keys(i);if(a.length!==r.length)return!1;for(r=0;r<a.length;r++)if(!tm.call(i,a[r])||!Ot(t[a[r]],i[a[r]]))return!1;return!0}function ld(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ud(t,i){var a=ld(t);t=0;for(var r;a;){if(a.nodeType===3){if(r=t+a.textContent.length,t<=i&&r>=i)return{node:a,offset:i-t};t=r}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=ld(a)}}function cd(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?cd(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function fd(){for(var t=window,i=Ro();i instanceof t.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)t=i.contentWindow;else break;i=Ro(t.document)}return i}function eu(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}var rm=Ar&&"documentMode"in document&&11>=document.documentMode,vi=null,tu=null,ma=null,ru=!1;function dd(t,i,a){var r=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;ru||vi==null||vi!==Ro(r)||(r=vi,"selectionStart"in r&&eu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ma&&ga(ma,r)||(ma=r,r=jo(tu,"onSelect"),0<r.length&&(i=new Xl("onSelect","select",null,i,a),t.push({event:i,listeners:r}),i.target=vi)))}Vl("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Vl("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Vl(cg,2);for(var hd="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),nu=0;nu<hd.length;nu++)kl.set(hd[nu],0);ii("onMouseEnter",["mouseout","mouseover"]);ii("onMouseLeave",["mouseout","mouseover"]);ii("onPointerEnter",["pointerout","pointerover"]);ii("onPointerLeave",["pointerout","pointerover"]);bn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));bn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));bn("onBeforeInput",["compositionend","keypress","textInput","paste"]);bn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));bn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));bn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ya="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vd=new Set("cancel close invalid load scroll toggle".split(" ").concat(ya));function _d(t,i,a){var r=t.type||"unknown-event";t.currentTarget=a,ag(r,i,void 0,t),t.currentTarget=null}function pd(t,i){i=(i&4)!=0;for(var a=0;a<t.length;a++){var r=t[a],e=r.event;r=r.listeners;e:{var n=void 0;if(i)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==n&&e.isPropagationStopped())break e;_d(e,s,u),n=l}else for(o=0;o<r.length;o++){if(s=r[o],l=s.instance,u=s.currentTarget,s=s.listener,l!==n&&e.isPropagationStopped())break e;_d(e,s,u),n=l}}}if(Lo)throw t=Dl,Lo=!1,Dl=null,t}function xe(t,i){var a=Ed(i),r=t+"__bubble";a.has(r)||(xd(i,t,2,!1),a.add(r))}var gd="_reactListening"+Math.random().toString(36).slice(2);function md(t){t[gd]||(t[gd]=!0,af.forEach(function(i){vd.has(i)||yd(i,!1,t,null),yd(i,!0,t,null)}))}function yd(t,i,a,r){var e=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,n=a;if(t==="selectionchange"&&a.nodeType!==9&&(n=a.ownerDocument),r!==null&&!i&&vd.has(t)){if(t!=="scroll")return;e|=2,n=r}var o=Ed(n),s=t+"__"+(i?"capture":"bubble");o.has(s)||(i&&(e|=4),xd(n,t,e,i),o.add(s))}function xd(t,i,a,r){var e=kl.get(i);switch(e===void 0?2:e){case 0:e=yg;break;case 1:e=xg;break;default:e=Hl}a=e.bind(null,i,a,t),e=void 0,!Ol||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(e=!0),r?e!==void 0?t.addEventListener(i,a,{capture:!0,passive:e}):t.addEventListener(i,a,!0):e!==void 0?t.addEventListener(i,a,{passive:e}):t.addEventListener(i,a,!1)}function wd(t,i,a,r,e){var n=r;if((i&1)==0&&(i&2)==0&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var s=r.stateNode.containerInfo;if(s===e||s.nodeType===8&&s.parentNode===e)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===e||l.nodeType===8&&l.parentNode===e))return;o=o.return}for(;s!==null;){if(o=Ln(s),o===null)return;if(l=o.tag,l===5||l===6){r=n=o;continue e}s=s.parentNode}}r=r.return}tg(function(){var u=n,c=bl(a),f=[];e:{var d=Wf.get(t);if(d!==void 0){var h=Xl,_=t;switch(t){case"keypress":if(Vo(a)===0)break e;case"keydown":case"keyup":h=Dg;break;case"focusin":_="focus",h=Ql;break;case"focusout":_="blur",h=Ql;break;case"beforeblur":case"afterblur":h=Ql;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=qf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=Pg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Ng;break;case kf:case Vf:case Gf:h=Mg;break;case Hf:h=kg;break;case"scroll":h=wg;break;case"wheel":h=Gg;break;case"copy":case"cut":case"paste":h=bg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Yf}var m=(i&4)!=0,v=!m&&t==="scroll",p=m?d!==null?d+"Capture":null:d;m=[];for(var g=u,y;g!==null;){y=g;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,p!==null&&(x=na(g,p),x!=null&&m.push(xa(g,x,y)))),v)break;g=g.return}0<m.length&&(d=new h(d,_,null,a,c),f.push({event:d,listeners:m}))}}if((i&7)==0){e:{if(d=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",d&&(i&16)==0&&(_=a.relatedTarget||a.fromElement)&&(Ln(_)||_[gi]))break e;if((h||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,h?(_=a.relatedTarget||a.toElement,h=u,_=_?Ln(_):null,_!==null&&(v=Bn(_),_!==v||_.tag!==5&&_.tag!==6)&&(_=null)):(h=null,_=u),h!==_)){if(m=qf,x="onMouseLeave",p="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(m=Yf,x="onPointerLeave",p="onPointerEnter",g="pointer"),v=h==null?d:mi(h),y=_==null?d:mi(_),d=new m(x,g+"leave",h,a,c),d.target=v,d.relatedTarget=y,x=null,Ln(c)===u&&(m=new m(p,g+"enter",_,a,c),m.target=y,m.relatedTarget=v,x=m),v=x,h&&_)t:{for(m=h,p=_,g=0,y=m;y;y=_i(y))g++;for(y=0,x=p;x;x=_i(x))y++;for(;0<g-y;)m=_i(m),g--;for(;0<y-g;)p=_i(p),y--;for(;g--;){if(m===p||p!==null&&m===p.alternate)break t;m=_i(m),p=_i(p)}m=null}else m=null;h!==null&&Sd(f,d,h,m,!1),_!==null&&v!==null&&Sd(f,v,_,m,!0)}}e:{if(d=u?mi(u):window,h=d.nodeName&&d.nodeName.toLowerCase(),h==="select"||h==="input"&&d.type==="file")var T=Qg;else if(rd(d))if(id)T=Jg;else{T=$g;var w=Yg}else(h=d.nodeName)&&h.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(T=Zg);if(T&&(T=T(t,u))){nd(f,T,a,c);break e}w&&w(t,d,u),t==="focusout"&&(w=d._wrapperState)&&w.controlled&&d.type==="number"&&wl(d,"number",d.value)}switch(w=u?mi(u):window,t){case"focusin":(rd(w)||w.contentEditable==="true")&&(vi=w,tu=u,ma=null);break;case"focusout":ma=tu=vi=null;break;case"mousedown":ru=!0;break;case"contextmenu":case"mouseup":case"dragend":ru=!1,dd(f,a,c);break;case"selectionchange":if(rm)break;case"keydown":case"keyup":dd(f,a,c)}var S;if($l)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else hi?ed(t,a)&&(M="onCompositionEnd"):t==="keydown"&&a.keyCode===229&&(M="onCompositionStart");M&&($f&&a.locale!=="ko"&&(hi||M!=="onCompositionStart"?M==="onCompositionEnd"&&hi&&(S=Xf()):(Qr=c,jl="value"in Qr?Qr.value:Qr.textContent,hi=!0)),w=jo(u,M),0<w.length&&(M=new Qf(M,t,null,a,c),f.push({event:M,listeners:w}),S?M.data=S:(S=td(a),S!==null&&(M.data=S)))),(S=Wg?jg(t,a):Xg(t,a))&&(u=jo(u,"onBeforeInput"),0<u.length&&(c=new Qf("onBeforeInput","beforeinput",null,a,c),f.push({event:c,listeners:u}),c.data=S))}pd(f,i)})}function xa(t,i,a){return{instance:t,listener:i,currentTarget:a}}function jo(t,i){for(var a=i+"Capture",r=[];t!==null;){var e=t,n=e.stateNode;e.tag===5&&n!==null&&(e=n,n=na(t,a),n!=null&&r.unshift(xa(t,n,e)),n=na(t,i),n!=null&&r.push(xa(t,n,e))),t=t.return}return r}function _i(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Sd(t,i,a,r,e){for(var n=i._reactName,o=[];a!==null&&a!==r;){var s=a,l=s.alternate,u=s.stateNode;if(l!==null&&l===r)break;s.tag===5&&u!==null&&(s=u,e?(l=na(a,n),l!=null&&o.unshift(xa(a,l,s))):e||(l=na(a,n),l!=null&&o.push(xa(a,l,s)))),a=a.return}o.length!==0&&t.push({event:i,listeners:o})}function Xo(){}var iu=null,au=null;function Pd(t,i){switch(t){case"button":case"input":case"select":case"textarea":return!!i.autoFocus}return!1}function ou(t,i){return t==="textarea"||t==="option"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ad=typeof setTimeout=="function"?setTimeout:void 0,nm=typeof clearTimeout=="function"?clearTimeout:void 0;function su(t){t.nodeType===1?t.textContent="":t.nodeType===9&&(t=t.body,t!=null&&(t.textContent=""))}function pi(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break}return t}function Td(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var a=t.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return t;i--}else a==="/$"&&i++}t=t.previousSibling}return null}var lu=0;function im(t){return{$$typeof:vl,toString:t,valueOf:t}}var Ko=Math.random().toString(36).slice(2),Yr="__reactFiber$"+Ko,qo="__reactProps$"+Ko,gi="__reactContainer$"+Ko,Md="__reactEvents$"+Ko;function Ln(t){var i=t[Yr];if(i)return i;for(var a=t.parentNode;a;){if(i=a[gi]||a[Yr]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(t=Td(t);t!==null;){if(a=t[Yr])return a;t=Td(t)}return i}t=a,a=t.parentNode}return null}function wa(t){return t=t[Yr]||t[gi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function mi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(U(33))}function Qo(t){return t[qo]||null}function Ed(t){var i=t[Md];return i===void 0&&(i=t[Md]=new Set),i}var uu=[],yi=-1;function $r(t){return{current:t}}function we(t){0>yi||(t.current=uu[yi],uu[yi]=null,yi--)}function Ce(t,i){yi++,uu[yi]=t.current,t.current=i}var Zr={},rt=$r(Zr),mt=$r(!1),On=Zr;function xi(t,i){var a=t.type.contextTypes;if(!a)return Zr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===i)return r.__reactInternalMemoizedMaskedChildContext;var e={},n;for(n in a)e[n]=i[n];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=e),e}function yt(t){return t=t.childContextTypes,t!=null}function Yo(){we(mt),we(rt)}function bd(t,i,a){if(rt.current!==Zr)throw Error(U(168));Ce(rt,i),Ce(mt,a)}function Cd(t,i,a){var r=t.stateNode;if(t=i.childContextTypes,typeof r.getChildContext!="function")return a;r=r.getChildContext();for(var e in r)if(!(e in t))throw Error(U(108,ai(i)||"Unknown",e));return Se({},a,r)}function $o(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Zr,On=rt.current,Ce(rt,t),Ce(mt,mt.current),!0}function Rd(t,i,a){var r=t.stateNode;if(!r)throw Error(U(169));a?(t=Cd(t,i,On),r.__reactInternalMemoizedMergedChildContext=t,we(mt),we(rt),Ce(rt,t)):we(mt),Ce(mt,a)}var cu=null,Dn=null,am=Ue.unstable_runWithPriority,fu=Ue.unstable_scheduleCallback,du=Ue.unstable_cancelCallback,om=Ue.unstable_shouldYield,zd=Ue.unstable_requestPaint,hu=Ue.unstable_now,sm=Ue.unstable_getCurrentPriorityLevel,Zo=Ue.unstable_ImmediatePriority,Bd=Ue.unstable_UserBlockingPriority,Ld=Ue.unstable_NormalPriority,Od=Ue.unstable_LowPriority,Dd=Ue.unstable_IdlePriority,vu={},lm=zd!==void 0?zd:function(){},Tr=null,Jo=null,_u=!1,Fd=hu(),nt=1e4>Fd?hu:function(){return hu()-Fd};function wi(){switch(sm()){case Zo:return 99;case Bd:return 98;case Ld:return 97;case Od:return 96;case Dd:return 95;default:throw Error(U(332))}}function Id(t){switch(t){case 99:return Zo;case 98:return Bd;case 97:return Ld;case 96:return Od;case 95:return Dd;default:throw Error(U(332))}}function Fn(t,i){return t=Id(t),am(t,i)}function Sa(t,i,a){return t=Id(t),fu(t,i,a)}function ur(){if(Jo!==null){var t=Jo;Jo=null,du(t)}Nd()}function Nd(){if(!_u&&Tr!==null){_u=!0;var t=0;try{var i=Tr;Fn(99,function(){for(;t<i.length;t++){var a=i[t];do a=a(!0);while(a!==null)}}),Tr=null}catch(a){throw Tr!==null&&(Tr=Tr.slice(t+1)),fu(Zo,ur),a}finally{_u=!1}}}var um=Cn.ReactCurrentBatchConfig;function Qt(t,i){if(t&&t.defaultProps){i=Se({},i),t=t.defaultProps;for(var a in t)i[a]===void 0&&(i[a]=t[a]);return i}return i}var es=$r(null),ts=null,Si=null,rs=null;function pu(){rs=Si=ts=null}function gu(t){var i=es.current;we(es),t.type._context._currentValue=i}function Ud(t,i){for(;t!==null;){var a=t.alternate;if((t.childLanes&i)===i){if(a===null||(a.childLanes&i)===i)break;a.childLanes|=i}else t.childLanes|=i,a!==null&&(a.childLanes|=i);t=t.return}}function Pi(t,i){ts=t,rs=Si=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&i)!=0&&(Yt=!0),t.firstContext=null)}function Dt(t,i){if(rs!==t&&i!==!1&&i!==0)if((typeof i!="number"||i===1073741823)&&(rs=t,i=1073741823),i={context:t,observedBits:i,next:null},Si===null){if(ts===null)throw Error(U(308));Si=i,ts.dependencies={lanes:0,firstContext:i,responders:null}}else Si=Si.next=i;return t._currentValue}var Jr=!1;function mu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function kd(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function en(t,i){return{eventTime:t,lane:i,tag:0,payload:null,callback:null,next:null}}function tn(t,i){if(t=t.updateQueue,t!==null){t=t.shared;var a=t.pending;a===null?i.next=i:(i.next=a.next,a.next=i),t.pending=i}}function Vd(t,i){var a=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,a===r)){var e=null,n=null;if(a=a.firstBaseUpdate,a!==null){do{var o={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};n===null?e=n=o:n=n.next=o,a=a.next}while(a!==null);n===null?e=n=i:n=n.next=i}else e=n=i;a={baseState:r.baseState,firstBaseUpdate:e,lastBaseUpdate:n,shared:r.shared,effects:r.effects},t.updateQueue=a;return}t=a.lastBaseUpdate,t===null?a.firstBaseUpdate=i:t.next=i,a.lastBaseUpdate=i}function Pa(t,i,a,r){var e=t.updateQueue;Jr=!1;var n=e.firstBaseUpdate,o=e.lastBaseUpdate,s=e.shared.pending;if(s!==null){e.shared.pending=null;var l=s,u=l.next;l.next=null,o===null?n=u:o.next=u,o=l;var c=t.alternate;if(c!==null){c=c.updateQueue;var f=c.lastBaseUpdate;f!==o&&(f===null?c.firstBaseUpdate=u:f.next=u,c.lastBaseUpdate=l)}}if(n!==null){f=e.baseState,o=0,c=u=l=null;do{s=n.lane;var d=n.eventTime;if((r&s)===s){c!==null&&(c=c.next={eventTime:d,lane:0,tag:n.tag,payload:n.payload,callback:n.callback,next:null});e:{var h=t,_=n;switch(s=i,d=a,_.tag){case 1:if(h=_.payload,typeof h=="function"){f=h.call(d,f,s);break e}f=h;break e;case 3:h.flags=h.flags&-4097|64;case 0:if(h=_.payload,s=typeof h=="function"?h.call(d,f,s):h,s==null)break e;f=Se({},f,s);break e;case 2:Jr=!0}}n.callback!==null&&(t.flags|=32,s=e.effects,s===null?e.effects=[n]:s.push(n))}else d={eventTime:d,lane:s,tag:n.tag,payload:n.payload,callback:n.callback,next:null},c===null?(u=c=d,l=f):c=c.next=d,o|=s;if(n=n.next,n===null){if(s=e.shared.pending,s===null)break;n=s.next,s.next=null,e.lastBaseUpdate=s,e.shared.pending=null}}while(1);c===null&&(l=f),e.baseState=l,e.firstBaseUpdate=u,e.lastBaseUpdate=c,Da|=o,t.lanes=o,t.memoizedState=f}}function Gd(t,i,a){if(t=i.effects,i.effects=null,t!==null)for(i=0;i<t.length;i++){var r=t[i],e=r.callback;if(e!==null){if(r.callback=null,r=a,typeof e!="function")throw Error(U(191,e));e.call(r)}}}var Hd=new Ao.Component().refs;function ns(t,i,a,r){i=t.memoizedState,a=a(r,i),a=a==null?i:Se({},i,a),t.memoizedState=a,t.lanes===0&&(t.updateQueue.baseState=a)}var is={isMounted:function(t){return(t=t._reactInternals)?Bn(t)===t:!1},enqueueSetState:function(t,i,a){t=t._reactInternals;var r=Ct(),e=an(t),n=en(r,e);n.payload=i,a!=null&&(n.callback=a),tn(t,n),on(t,e,r)},enqueueReplaceState:function(t,i,a){t=t._reactInternals;var r=Ct(),e=an(t),n=en(r,e);n.tag=1,n.payload=i,a!=null&&(n.callback=a),tn(t,n),on(t,e,r)},enqueueForceUpdate:function(t,i){t=t._reactInternals;var a=Ct(),r=an(t),e=en(a,r);e.tag=2,i!=null&&(e.callback=i),tn(t,e),on(t,r,a)}};function Wd(t,i,a,r,e,n,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,n,o):i.prototype&&i.prototype.isPureReactComponent?!ga(a,r)||!ga(e,n):!0}function jd(t,i,a){var r=!1,e=Zr,n=i.contextType;return typeof n=="object"&&n!==null?n=Dt(n):(e=yt(i)?On:rt.current,r=i.contextTypes,n=(r=r!=null)?xi(t,e):Zr),i=new i(a,n),t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=is,t.stateNode=i,i._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),i}function Xd(t,i,a,r){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,r),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,r),i.state!==t&&is.enqueueReplaceState(i,i.state,null)}function yu(t,i,a,r){var e=t.stateNode;e.props=a,e.state=t.memoizedState,e.refs=Hd,mu(t);var n=i.contextType;typeof n=="object"&&n!==null?e.context=Dt(n):(n=yt(i)?On:rt.current,e.context=xi(t,n)),Pa(t,a,e,r),e.state=t.memoizedState,n=i.getDerivedStateFromProps,typeof n=="function"&&(ns(t,i,n,a),e.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof e.getSnapshotBeforeUpdate=="function"||typeof e.UNSAFE_componentWillMount!="function"&&typeof e.componentWillMount!="function"||(i=e.state,typeof e.componentWillMount=="function"&&e.componentWillMount(),typeof e.UNSAFE_componentWillMount=="function"&&e.UNSAFE_componentWillMount(),i!==e.state&&is.enqueueReplaceState(e,e.state,null),Pa(t,a,e,r),e.state=t.memoizedState),typeof e.componentDidMount=="function"&&(t.flags|=4)}var as=Array.isArray;function Aa(t,i,a){if(t=a.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(U(309));var r=a.stateNode}if(!r)throw Error(U(147,t));var e=""+t;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===e?i.ref:(i=function(n){var o=r.refs;o===Hd&&(o=r.refs={}),n===null?delete o[e]:o[e]=n},i._stringRef=e,i)}if(typeof t!="string")throw Error(U(284));if(!a._owner)throw Error(U(290,t))}return t}function os(t,i){if(t.type!=="textarea")throw Error(U(31,Object.prototype.toString.call(i)==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":i))}function Kd(t){function i(v,p){if(t){var g=v.lastEffect;g!==null?(g.nextEffect=p,v.lastEffect=p):v.firstEffect=v.lastEffect=p,p.nextEffect=null,p.flags=8}}function a(v,p){if(!t)return null;for(;p!==null;)i(v,p),p=p.sibling;return null}function r(v,p){for(v=new Map;p!==null;)p.key!==null?v.set(p.key,p):v.set(p.index,p),p=p.sibling;return v}function e(v,p){return v=un(v,p),v.index=0,v.sibling=null,v}function n(v,p,g){return v.index=g,t?(g=v.alternate,g!==null?(g=g.index,g<p?(v.flags=2,p):g):(v.flags=2,p)):p}function o(v){return t&&v.alternate===null&&(v.flags=2),v}function s(v,p,g,y){return p===null||p.tag!==6?(p=tc(g,v.mode,y),p.return=v,p):(p=e(p,g),p.return=v,p)}function l(v,p,g,y){return p!==null&&p.elementType===g.type?(y=e(p,g.props),y.ref=Aa(v,p,g),y.return=v,y):(y=As(g.type,g.key,g.props,null,v.mode,y),y.ref=Aa(v,p,g),y.return=v,y)}function u(v,p,g,y){return p===null||p.tag!==4||p.stateNode.containerInfo!==g.containerInfo||p.stateNode.implementation!==g.implementation?(p=rc(g,v.mode,y),p.return=v,p):(p=e(p,g.children||[]),p.return=v,p)}function c(v,p,g,y,x){return p===null||p.tag!==7?(p=zi(g,v.mode,y,x),p.return=v,p):(p=e(p,g),p.return=v,p)}function f(v,p,g){if(typeof p=="string"||typeof p=="number")return p=tc(""+p,v.mode,g),p.return=v,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Yi:return g=As(p.type,p.key,p.props,null,v.mode,g),g.ref=Aa(v,null,p),g.return=v,g;case Rn:return p=rc(p,v.mode,g),p.return=v,p}if(as(p)||Ji(p))return p=zi(p,v.mode,g,null),p.return=v,p;os(v,p)}return null}function d(v,p,g,y){var x=p!==null?p.key:null;if(typeof g=="string"||typeof g=="number")return x!==null?null:s(v,p,""+g,y);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Yi:return g.key===x?g.type===Hr?c(v,p,g.props.children,y,x):l(v,p,g,y):null;case Rn:return g.key===x?u(v,p,g,y):null}if(as(g)||Ji(g))return x!==null?null:c(v,p,g,y,null);os(v,g)}return null}function h(v,p,g,y,x){if(typeof y=="string"||typeof y=="number")return v=v.get(g)||null,s(p,v,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Yi:return v=v.get(y.key===null?g:y.key)||null,y.type===Hr?c(p,v,y.props.children,x,y.key):l(p,v,y,x);case Rn:return v=v.get(y.key===null?g:y.key)||null,u(p,v,y,x)}if(as(y)||Ji(y))return v=v.get(g)||null,c(p,v,y,x,null);os(p,y)}return null}function _(v,p,g,y){for(var x=null,T=null,w=p,S=p=0,M=null;w!==null&&S<g.length;S++){w.index>S?(M=w,w=null):M=w.sibling;var P=d(v,w,g[S],y);if(P===null){w===null&&(w=M);break}t&&w&&P.alternate===null&&i(v,w),p=n(P,p,S),T===null?x=P:T.sibling=P,T=P,w=M}if(S===g.length)return a(v,w),x;if(w===null){for(;S<g.length;S++)w=f(v,g[S],y),w!==null&&(p=n(w,p,S),T===null?x=w:T.sibling=w,T=w);return x}for(w=r(v,w);S<g.length;S++)M=h(w,v,S,g[S],y),M!==null&&(t&&M.alternate!==null&&w.delete(M.key===null?S:M.key),p=n(M,p,S),T===null?x=M:T.sibling=M,T=M);return t&&w.forEach(function(E){return i(v,E)}),x}function m(v,p,g,y){var x=Ji(g);if(typeof x!="function")throw Error(U(150));if(g=x.call(g),g==null)throw Error(U(151));for(var T=x=null,w=p,S=p=0,M=null,P=g.next();w!==null&&!P.done;S++,P=g.next()){w.index>S?(M=w,w=null):M=w.sibling;var E=d(v,w,P.value,y);if(E===null){w===null&&(w=M);break}t&&w&&E.alternate===null&&i(v,w),p=n(E,p,S),T===null?x=E:T.sibling=E,T=E,w=M}if(P.done)return a(v,w),x;if(w===null){for(;!P.done;S++,P=g.next())P=f(v,P.value,y),P!==null&&(p=n(P,p,S),T===null?x=P:T.sibling=P,T=P);return x}for(w=r(v,w);!P.done;S++,P=g.next())P=h(w,v,S,P.value,y),P!==null&&(t&&P.alternate!==null&&w.delete(P.key===null?S:P.key),p=n(P,p,S),T===null?x=P:T.sibling=P,T=P);return t&&w.forEach(function(R){return i(v,R)}),x}return function(v,p,g,y){var x=typeof g=="object"&&g!==null&&g.type===Hr&&g.key===null;x&&(g=g.props.children);var T=typeof g=="object"&&g!==null;if(T)switch(g.$$typeof){case Yi:e:{for(T=g.key,x=p;x!==null;){if(x.key===T){switch(x.tag){case 7:if(g.type===Hr){a(v,x.sibling),p=e(x,g.props.children),p.return=v,v=p;break e}break;default:if(x.elementType===g.type){a(v,x.sibling),p=e(x,g.props),p.ref=Aa(v,x,g),p.return=v,v=p;break e}}a(v,x);break}else i(v,x);x=x.sibling}g.type===Hr?(p=zi(g.props.children,v.mode,y,g.key),p.return=v,v=p):(y=As(g.type,g.key,g.props,null,v.mode,y),y.ref=Aa(v,p,g),y.return=v,v=y)}return o(v);case Rn:e:{for(x=g.key;p!==null;){if(p.key===x)if(p.tag===4&&p.stateNode.containerInfo===g.containerInfo&&p.stateNode.implementation===g.implementation){a(v,p.sibling),p=e(p,g.children||[]),p.return=v,v=p;break e}else{a(v,p);break}else i(v,p);p=p.sibling}p=rc(g,v.mode,y),p.return=v,v=p}return o(v)}if(typeof g=="string"||typeof g=="number")return g=""+g,p!==null&&p.tag===6?(a(v,p.sibling),p=e(p,g),p.return=v,v=p):(a(v,p),p=tc(g,v.mode,y),p.return=v,v=p),o(v);if(as(g))return _(v,p,g,y);if(Ji(g))return m(v,p,g,y);if(T&&os(v,g),typeof g=="undefined"&&!x)switch(v.tag){case 1:case 22:case 0:case 11:case 15:throw Error(U(152,ai(v.type)||"Component"))}return a(v,p)}}var ss=Kd(!0),qd=Kd(!1),Ta={},cr=$r(Ta),Ma=$r(Ta),Ea=$r(Ta);function In(t){if(t===Ta)throw Error(U(174));return t}function xu(t,i){switch(Ce(Ea,i),Ce(Ma,t),Ce(cr,Ta),t=i.nodeType,t){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Tl(null,"");break;default:t=t===8?i.parentNode:i,i=t.namespaceURI||null,t=t.tagName,i=Tl(i,t)}we(cr),Ce(cr,i)}function Ai(){we(cr),we(Ma),we(Ea)}function Qd(t){In(Ea.current);var i=In(cr.current),a=Tl(i,t.type);i!==a&&(Ce(Ma,t),Ce(cr,a))}function wu(t){Ma.current===t&&(we(cr),we(Ma))}var Re=$r(0);function ls(t){for(var i=t;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&64)!=0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Mr=null,rn=null,fr=!1;function Yd(t,i){var a=Nt(5,null,null,0);a.elementType="DELETED",a.type="DELETED",a.stateNode=i,a.return=t,a.flags=8,t.lastEffect!==null?(t.lastEffect.nextEffect=a,t.lastEffect=a):t.firstEffect=t.lastEffect=a}function $d(t,i){switch(t.tag){case 5:var a=t.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(t.stateNode=i,!0):!1;case 6:return i=t.pendingProps===""||i.nodeType!==3?null:i,i!==null?(t.stateNode=i,!0):!1;case 13:return!1;default:return!1}}function Su(t){if(fr){var i=rn;if(i){var a=i;if(!$d(t,i)){if(i=pi(a.nextSibling),!i||!$d(t,i)){t.flags=t.flags&-1025|2,fr=!1,Mr=t;return}Yd(Mr,a)}Mr=t,rn=pi(i.firstChild)}else t.flags=t.flags&-1025|2,fr=!1,Mr=t}}function Zd(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Mr=t}function us(t){if(t!==Mr)return!1;if(!fr)return Zd(t),fr=!0,!1;var i=t.type;if(t.tag!==5||i!=="head"&&i!=="body"&&!ou(i,t.memoizedProps))for(i=rn;i;)Yd(t,i),i=pi(i.nextSibling);if(Zd(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(U(317));e:{for(t=t.nextSibling,i=0;t;){if(t.nodeType===8){var a=t.data;if(a==="/$"){if(i===0){rn=pi(t.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}t=t.nextSibling}rn=null}}else rn=Mr?pi(t.stateNode.nextSibling):null;return!0}function Pu(){rn=Mr=null,fr=!1}var Ti=[];function Au(){for(var t=0;t<Ti.length;t++)Ti[t]._workInProgressVersionPrimary=null;Ti.length=0}var ba=Cn.ReactCurrentDispatcher,Ft=Cn.ReactCurrentBatchConfig,Ca=0,Le=null,it=null,Ye=null,cs=!1,Ra=!1;function xt(){throw Error(U(321))}function Tu(t,i){if(i===null)return!1;for(var a=0;a<i.length&&a<t.length;a++)if(!Ot(t[a],i[a]))return!1;return!0}function Mu(t,i,a,r,e,n){if(Ca=n,Le=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,ba.current=t===null||t.memoizedState===null?fm:dm,t=a(r,e),Ra){n=0;do{if(Ra=!1,!(25>n))throw Error(U(301));n+=1,Ye=it=null,i.updateQueue=null,ba.current=hm,t=a(r,e)}while(Ra)}if(ba.current=vs,i=it!==null&&it.next!==null,Ca=0,Ye=it=Le=null,cs=!1,i)throw Error(U(300));return t}function Nn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ye===null?Le.memoizedState=Ye=t:Ye=Ye.next=t,Ye}function Un(){if(it===null){var t=Le.alternate;t=t!==null?t.memoizedState:null}else t=it.next;var i=Ye===null?Le.memoizedState:Ye.next;if(i!==null)Ye=i,it=t;else{if(t===null)throw Error(U(310));it=t,t={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},Ye===null?Le.memoizedState=Ye=t:Ye=Ye.next=t}return Ye}function dr(t,i){return typeof i=="function"?i(t):i}function za(t){var i=Un(),a=i.queue;if(a===null)throw Error(U(311));a.lastRenderedReducer=t;var r=it,e=r.baseQueue,n=a.pending;if(n!==null){if(e!==null){var o=e.next;e.next=n.next,n.next=o}r.baseQueue=e=n,a.pending=null}if(e!==null){e=e.next,r=r.baseState;var s=o=n=null,l=e;do{var u=l.lane;if((Ca&u)===u)s!==null&&(s=s.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),r=l.eagerReducer===t?l.eagerState:t(r,l.action);else{var c={lane:u,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};s===null?(o=s=c,n=r):s=s.next=c,Le.lanes|=u,Da|=u}l=l.next}while(l!==null&&l!==e);s===null?n=r:s.next=o,Ot(r,i.memoizedState)||(Yt=!0),i.memoizedState=r,i.baseState=n,i.baseQueue=s,a.lastRenderedState=r}return[i.memoizedState,a.dispatch]}function Ba(t){var i=Un(),a=i.queue;if(a===null)throw Error(U(311));a.lastRenderedReducer=t;var r=a.dispatch,e=a.pending,n=i.memoizedState;if(e!==null){a.pending=null;var o=e=e.next;do n=t(n,o.action),o=o.next;while(o!==e);Ot(n,i.memoizedState)||(Yt=!0),i.memoizedState=n,i.baseQueue===null&&(i.baseState=n),a.lastRenderedState=n}return[n,r]}function Jd(t,i,a){var r=i._getVersion;r=r(i._source);var e=i._workInProgressVersionPrimary;if(e!==null?t=e===r:(t=t.mutableReadLanes,(t=(Ca&t)===t)&&(i._workInProgressVersionPrimary=r,Ti.push(i))),t)return a(i._source);throw Ti.push(i),Error(U(350))}function eh(t,i,a,r){var e=dt;if(e===null)throw Error(U(349));var n=i._getVersion,o=n(i._source),s=ba.current,l=s.useState(function(){return Jd(e,i,a)}),u=l[1],c=l[0];l=Ye;var f=t.memoizedState,d=f.refs,h=d.getSnapshot,_=f.source;f=f.subscribe;var m=Le;return t.memoizedState={refs:d,source:i,subscribe:r},s.useEffect(function(){d.getSnapshot=a,d.setSnapshot=u;var v=n(i._source);if(!Ot(o,v)){v=a(i._source),Ot(c,v)||(u(v),v=an(m),e.mutableReadLanes|=v&e.pendingLanes),v=e.mutableReadLanes,e.entangledLanes|=v;for(var p=e.entanglements,g=v;0<g;){var y=31-qr(g),x=1<<y;p[y]|=v,g&=~x}}},[a,i,r]),s.useEffect(function(){return r(i._source,function(){var v=d.getSnapshot,p=d.setSnapshot;try{p(v(i._source));var g=an(m);e.mutableReadLanes|=g&e.pendingLanes}catch(y){p(function(){throw y})}})},[i,r]),Ot(h,a)&&Ot(_,i)&&Ot(f,r)||(t={pending:null,dispatch:null,lastRenderedReducer:dr,lastRenderedState:c},t.dispatch=u=Ru.bind(null,Le,t),l.queue=t,l.baseQueue=null,c=Jd(e,i,a),l.memoizedState=l.baseState=c),c}function th(t,i,a){var r=Un();return eh(r,t,i,a)}function La(t){var i=Nn();return typeof t=="function"&&(t=t()),i.memoizedState=i.baseState=t,t=i.queue={pending:null,dispatch:null,lastRenderedReducer:dr,lastRenderedState:t},t=t.dispatch=Ru.bind(null,Le,t),[i.memoizedState,t]}function fs(t,i,a,r){return t={tag:t,create:i,destroy:a,deps:r,next:null},i=Le.updateQueue,i===null?(i={lastEffect:null},Le.updateQueue=i,i.lastEffect=t.next=t):(a=i.lastEffect,a===null?i.lastEffect=t.next=t:(r=a.next,a.next=t,t.next=r,i.lastEffect=t)),t}function rh(t){var i=Nn();return t={current:t},i.memoizedState=t}function ds(){return Un().memoizedState}function Eu(t,i,a,r){var e=Nn();Le.flags|=t,e.memoizedState=fs(1|i,a,void 0,r===void 0?null:r)}function bu(t,i,a,r){var e=Un();r=r===void 0?null:r;var n=void 0;if(it!==null){var o=it.memoizedState;if(n=o.destroy,r!==null&&Tu(r,o.deps)){fs(i,a,n,r);return}}Le.flags|=t,e.memoizedState=fs(1|i,a,n,r)}function nh(t,i){return Eu(516,4,t,i)}function hs(t,i){return bu(516,4,t,i)}function ih(t,i){return bu(4,2,t,i)}function ah(t,i){if(typeof i=="function")return t=t(),i(t),function(){i(null)};if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function oh(t,i,a){return a=a!=null?a.concat([t]):null,bu(4,2,ah.bind(null,i,t),a)}function Cu(){}function sh(t,i){var a=Un();i=i===void 0?null:i;var r=a.memoizedState;return r!==null&&i!==null&&Tu(i,r[1])?r[0]:(a.memoizedState=[t,i],t)}function lh(t,i){var a=Un();i=i===void 0?null:i;var r=a.memoizedState;return r!==null&&i!==null&&Tu(i,r[1])?r[0]:(t=t(),a.memoizedState=[t,i],t)}function cm(t,i){var a=wi();Fn(98>a?98:a,function(){t(!0)}),Fn(97<a?97:a,function(){var r=Ft.transition;Ft.transition=1;try{t(!1),i()}finally{Ft.transition=r}})}function Ru(t,i,a){var r=Ct(),e=an(t),n={lane:e,action:a,eagerReducer:null,eagerState:null,next:null},o=i.pending;if(o===null?n.next=n:(n.next=o.next,o.next=n),i.pending=n,o=t.alternate,t===Le||o!==null&&o===Le)Ra=cs=!0;else{if(t.lanes===0&&(o===null||o.lanes===0)&&(o=i.lastRenderedReducer,o!==null))try{var s=i.lastRenderedState,l=o(s,a);if(n.eagerReducer=o,n.eagerState=l,Ot(l,s))return}catch{}finally{}on(t,e,r)}}var vs={readContext:Dt,useCallback:xt,useContext:xt,useEffect:xt,useImperativeHandle:xt,useLayoutEffect:xt,useMemo:xt,useReducer:xt,useRef:xt,useState:xt,useDebugValue:xt,useDeferredValue:xt,useTransition:xt,useMutableSource:xt,useOpaqueIdentifier:xt,unstable_isNewReconciler:!1},fm={readContext:Dt,useCallback:function(t,i){return Nn().memoizedState=[t,i===void 0?null:i],t},useContext:Dt,useEffect:nh,useImperativeHandle:function(t,i,a){return a=a!=null?a.concat([t]):null,Eu(4,2,ah.bind(null,i,t),a)},useLayoutEffect:function(t,i){return Eu(4,2,t,i)},useMemo:function(t,i){var a=Nn();return i=i===void 0?null:i,t=t(),a.memoizedState=[t,i],t},useReducer:function(t,i,a){var r=Nn();return i=a!==void 0?a(i):i,r.memoizedState=r.baseState=i,t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},t=t.dispatch=Ru.bind(null,Le,t),[r.memoizedState,t]},useRef:rh,useState:La,useDebugValue:Cu,useDeferredValue:function(t){var i=La(t),a=i[0],r=i[1];return nh(function(){var e=Ft.transition;Ft.transition=1;try{r(t)}finally{Ft.transition=e}},[t]),a},useTransition:function(){var t=La(!1),i=t[0];return t=cm.bind(null,t[1]),rh(t),[t,i]},useMutableSource:function(t,i,a){var r=Nn();return r.memoizedState={refs:{getSnapshot:i,setSnapshot:null},source:t,subscribe:a},eh(r,t,i,a)},useOpaqueIdentifier:function(){if(fr){var t=!1,i=im(function(){throw t||(t=!0,a("r:"+(lu++).toString(36))),Error(U(355))}),a=La(i)[1];return(Le.mode&2)==0&&(Le.flags|=516,fs(5,function(){a("r:"+(lu++).toString(36))},void 0,null)),i}return i="r:"+(lu++).toString(36),La(i),i},unstable_isNewReconciler:!1},dm={readContext:Dt,useCallback:sh,useContext:Dt,useEffect:hs,useImperativeHandle:oh,useLayoutEffect:ih,useMemo:lh,useReducer:za,useRef:ds,useState:function(){return za(dr)},useDebugValue:Cu,useDeferredValue:function(t){var i=za(dr),a=i[0],r=i[1];return hs(function(){var e=Ft.transition;Ft.transition=1;try{r(t)}finally{Ft.transition=e}},[t]),a},useTransition:function(){var t=za(dr)[0];return[ds().current,t]},useMutableSource:th,useOpaqueIdentifier:function(){return za(dr)[0]},unstable_isNewReconciler:!1},hm={readContext:Dt,useCallback:sh,useContext:Dt,useEffect:hs,useImperativeHandle:oh,useLayoutEffect:ih,useMemo:lh,useReducer:Ba,useRef:ds,useState:function(){return Ba(dr)},useDebugValue:Cu,useDeferredValue:function(t){var i=Ba(dr),a=i[0],r=i[1];return hs(function(){var e=Ft.transition;Ft.transition=1;try{r(t)}finally{Ft.transition=e}},[t]),a},useTransition:function(){var t=Ba(dr)[0];return[ds().current,t]},useMutableSource:th,useOpaqueIdentifier:function(){return Ba(dr)[0]},unstable_isNewReconciler:!1},vm=Cn.ReactCurrentOwner,Yt=!1;function wt(t,i,a,r){i.child=t===null?qd(i,null,a,r):ss(i,t.child,a,r)}function uh(t,i,a,r,e){a=a.render;var n=i.ref;return Pi(i,e),r=Mu(t,i,a,r,n,e),t!==null&&!Yt?(i.updateQueue=t.updateQueue,i.flags&=-517,t.lanes&=~e,Er(t,i,e)):(i.flags|=1,wt(t,i,r,e),i.child)}function ch(t,i,a,r,e,n){if(t===null){var o=a.type;return typeof o=="function"&&!Ju(o)&&o.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=o,fh(t,i,o,r,e,n)):(t=As(a.type,null,r,i,i.mode,n),t.ref=i.ref,t.return=i,i.child=t)}return o=t.child,(e&n)==0&&(e=o.memoizedProps,a=a.compare,a=a!==null?a:ga,a(e,r)&&t.ref===i.ref)?Er(t,i,n):(i.flags|=1,t=un(o,r),t.ref=i.ref,t.return=i,i.child=t)}function fh(t,i,a,r,e,n){if(t!==null&&ga(t.memoizedProps,r)&&t.ref===i.ref)if(Yt=!1,(n&e)!=0)(t.flags&16384)!=0&&(Yt=!0);else return i.lanes=t.lanes,Er(t,i,n);return Bu(t,i,a,r,n)}function zu(t,i,a){var r=i.pendingProps,e=r.children,n=t!==null?t.memoizedState:null;if(r.mode==="hidden"||r.mode==="unstable-defer-without-hiding")if((i.mode&4)==0)i.memoizedState={baseLanes:0},Ps(i,a);else if((a&1073741824)!=0)i.memoizedState={baseLanes:0},Ps(i,n!==null?n.baseLanes:a);else return t=n!==null?n.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:t},Ps(i,t),null;else n!==null?(r=n.baseLanes|a,i.memoizedState=null):r=a,Ps(i,r);return wt(t,i,e,a),i.child}function dh(t,i){var a=i.ref;(t===null&&a!==null||t!==null&&t.ref!==a)&&(i.flags|=128)}function Bu(t,i,a,r,e){var n=yt(a)?On:rt.current;return n=xi(i,n),Pi(i,e),a=Mu(t,i,a,r,n,e),t!==null&&!Yt?(i.updateQueue=t.updateQueue,i.flags&=-517,t.lanes&=~e,Er(t,i,e)):(i.flags|=1,wt(t,i,a,e),i.child)}function hh(t,i,a,r,e){if(yt(a)){var n=!0;$o(i)}else n=!1;if(Pi(i,e),i.stateNode===null)t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2),jd(i,a,r),yu(i,a,r,e),r=!0;else if(t===null){var o=i.stateNode,s=i.memoizedProps;o.props=s;var l=o.context,u=a.contextType;typeof u=="object"&&u!==null?u=Dt(u):(u=yt(a)?On:rt.current,u=xi(i,u));var c=a.getDerivedStateFromProps,f=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==r||l!==u)&&Xd(i,o,r,u),Jr=!1;var d=i.memoizedState;o.state=d,Pa(i,r,o,e),l=i.memoizedState,s!==r||d!==l||mt.current||Jr?(typeof c=="function"&&(ns(i,a,c,r),l=i.memoizedState),(s=Jr||Wd(i,a,s,r,d,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(i.flags|=4)):(typeof o.componentDidMount=="function"&&(i.flags|=4),i.memoizedProps=r,i.memoizedState=l),o.props=r,o.state=l,o.context=u,r=s):(typeof o.componentDidMount=="function"&&(i.flags|=4),r=!1)}else{o=i.stateNode,kd(t,i),s=i.memoizedProps,u=i.type===i.elementType?s:Qt(i.type,s),o.props=u,f=i.pendingProps,d=o.context,l=a.contextType,typeof l=="object"&&l!==null?l=Dt(l):(l=yt(a)?On:rt.current,l=xi(i,l));var h=a.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==f||d!==l)&&Xd(i,o,r,l),Jr=!1,d=i.memoizedState,o.state=d,Pa(i,r,o,e);var _=i.memoizedState;s!==f||d!==_||mt.current||Jr?(typeof h=="function"&&(ns(i,a,h,r),_=i.memoizedState),(u=Jr||Wd(i,a,u,r,d,_,l))?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,_,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,_,l)),typeof o.componentDidUpdate=="function"&&(i.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(i.flags|=256)):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(i.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(i.flags|=256),i.memoizedProps=r,i.memoizedState=_),o.props=r,o.state=_,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(i.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(i.flags|=256),r=!1)}return Lu(t,i,a,r,n,e)}function Lu(t,i,a,r,e,n){dh(t,i);var o=(i.flags&64)!=0;if(!r&&!o)return e&&Rd(i,a,!1),Er(t,i,n);r=i.stateNode,vm.current=i;var s=o&&typeof a.getDerivedStateFromError!="function"?null:r.render();return i.flags|=1,t!==null&&o?(i.child=ss(i,t.child,null,n),i.child=ss(i,null,s,n)):wt(t,i,s,n),i.memoizedState=r.state,e&&Rd(i,a,!0),i.child}function vh(t){var i=t.stateNode;i.pendingContext?bd(t,i.pendingContext,i.pendingContext!==i.context):i.context&&bd(t,i.context,!1),xu(t,i.containerInfo)}var _s={dehydrated:null,retryLane:0};function _h(t,i,a){var r=i.pendingProps,e=Re.current,n=!1,o;return(o=(i.flags&64)!=0)||(o=t!==null&&t.memoizedState===null?!1:(e&2)!=0),o?(n=!0,i.flags&=-65):t!==null&&t.memoizedState===null||r.fallback===void 0||r.unstable_avoidThisFallback===!0||(e|=1),Ce(Re,e&1),t===null?(r.fallback!==void 0&&Su(i),t=r.children,e=r.fallback,n?(t=ph(i,t,e,a),i.child.memoizedState={baseLanes:a},i.memoizedState=_s,t):typeof r.unstable_expectedLoadTime=="number"?(t=ph(i,t,e,a),i.child.memoizedState={baseLanes:a},i.memoizedState=_s,i.lanes=33554432,t):(a=ec({mode:"visible",children:t},i.mode,a,null),a.return=i,i.child=a)):t.memoizedState!==null?n?(r=mh(t,i,r.children,r.fallback,a),n=i.child,e=t.child.memoizedState,n.memoizedState=e===null?{baseLanes:a}:{baseLanes:e.baseLanes|a},n.childLanes=t.childLanes&~a,i.memoizedState=_s,r):(a=gh(t,i,r.children,a),i.memoizedState=null,a):n?(r=mh(t,i,r.children,r.fallback,a),n=i.child,e=t.child.memoizedState,n.memoizedState=e===null?{baseLanes:a}:{baseLanes:e.baseLanes|a},n.childLanes=t.childLanes&~a,i.memoizedState=_s,r):(a=gh(t,i,r.children,a),i.memoizedState=null,a)}function ph(t,i,a,r){var e=t.mode,n=t.child;return i={mode:"hidden",children:i},(e&2)==0&&n!==null?(n.childLanes=0,n.pendingProps=i):n=ec(i,e,0,null),a=zi(a,e,r,null),n.return=t,a.return=t,n.sibling=a,t.child=n,a}function gh(t,i,a,r){var e=t.child;return t=e.sibling,a=un(e,{mode:"visible",children:a}),(i.mode&2)==0&&(a.lanes=r),a.return=i,a.sibling=null,t!==null&&(t.nextEffect=null,t.flags=8,i.firstEffect=i.lastEffect=t),i.child=a}function mh(t,i,a,r,e){var n=i.mode,o=t.child;t=o.sibling;var s={mode:"hidden",children:a};return(n&2)==0&&i.child!==o?(a=i.child,a.childLanes=0,a.pendingProps=s,o=a.lastEffect,o!==null?(i.firstEffect=a.firstEffect,i.lastEffect=o,o.nextEffect=null):i.firstEffect=i.lastEffect=null):a=un(o,s),t!==null?r=un(t,r):(r=zi(r,n,e,null),r.flags|=2),r.return=i,a.return=i,a.sibling=r,i.child=a,r}function yh(t,i){t.lanes|=i;var a=t.alternate;a!==null&&(a.lanes|=i),Ud(t.return,i)}function Ou(t,i,a,r,e,n){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:r,tail:a,tailMode:e,lastEffect:n}:(o.isBackwards=i,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=a,o.tailMode=e,o.lastEffect=n)}function xh(t,i,a){var r=i.pendingProps,e=r.revealOrder,n=r.tail;if(wt(t,i,r.children,a),r=Re.current,(r&2)!=0)r=r&1|2,i.flags|=64;else{if(t!==null&&(t.flags&64)!=0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&yh(t,a);else if(t.tag===19)yh(t,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ce(Re,r),(i.mode&2)==0)i.memoizedState=null;else switch(e){case"forwards":for(a=i.child,e=null;a!==null;)t=a.alternate,t!==null&&ls(t)===null&&(e=a),a=a.sibling;a=e,a===null?(e=i.child,i.child=null):(e=a.sibling,a.sibling=null),Ou(i,!1,e,a,n,i.lastEffect);break;case"backwards":for(a=null,e=i.child,i.child=null;e!==null;){if(t=e.alternate,t!==null&&ls(t)===null){i.child=e;break}t=e.sibling,e.sibling=a,a=e,e=t}Ou(i,!0,a,null,n,i.lastEffect);break;case"together":Ou(i,!1,null,null,void 0,i.lastEffect);break;default:i.memoizedState=null}return i.child}function Er(t,i,a){if(t!==null&&(i.dependencies=t.dependencies),Da|=i.lanes,(a&i.childLanes)!=0){if(t!==null&&i.child!==t.child)throw Error(U(153));if(i.child!==null){for(t=i.child,a=un(t,t.pendingProps),i.child=a,a.return=i;t.sibling!==null;)t=t.sibling,a=a.sibling=un(t,t.pendingProps),a.return=i;a.sibling=null}return i.child}return null}var wh,Du,Sh,Ph;wh=function(t,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)t.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Du=function(){};Sh=function(t,i,a,r){var e=t.memoizedProps;if(e!==r){t=i.stateNode,In(cr.current);var n=null;switch(a){case"input":e=yl(t,e),r=yl(t,r),n=[];break;case"option":e=Sl(t,e),r=Sl(t,r),n=[];break;case"select":e=Se({},e,{value:void 0}),r=Se({},r,{value:void 0}),n=[];break;case"textarea":e=Pl(t,e),r=Pl(t,r),n=[];break;default:typeof e.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Xo)}Ml(a,r);var o;a=null;for(u in e)if(!r.hasOwnProperty(u)&&e.hasOwnProperty(u)&&e[u]!=null)if(u==="style"){var s=e[u];for(o in s)s.hasOwnProperty(o)&&(a||(a={}),a[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Qi.hasOwnProperty(u)?n||(n=[]):(n=n||[]).push(u,null));for(u in r){var l=r[u];if(s=e!=null?e[u]:void 0,r.hasOwnProperty(u)&&l!==s&&(l!=null||s!=null))if(u==="style")if(s){for(o in s)!s.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(a||(a={}),a[o]="");for(o in l)l.hasOwnProperty(o)&&s[o]!==l[o]&&(a||(a={}),a[o]=l[o])}else a||(n||(n=[]),n.push(u,a)),a=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(n=n||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Qi.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&xe("scroll",t),n||s===l||(n=[])):typeof l=="object"&&l!==null&&l.$$typeof===vl?l.toString():(n=n||[]).push(u,l))}a&&(n=n||[]).push("style",a);var u=n;(i.updateQueue=u)&&(i.flags|=4)}};Ph=function(t,i,a,r){a!==r&&(i.flags|=4)};function Oa(t,i){if(!fr)switch(t.tailMode){case"hidden":i=t.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?t.tail=null:a.sibling=null;break;case"collapsed":a=t.tail;for(var r=null;a!==null;)a.alternate!==null&&(r=a),a=a.sibling;r===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function _m(t,i,a){var r=i.pendingProps;switch(i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return yt(i.type)&&Yo(),null;case 3:return Ai(),we(mt),we(rt),Au(),r=i.stateNode,r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(us(i)?i.flags|=4:r.hydrate||(i.flags|=256)),Du(i),null;case 5:wu(i);var e=In(Ea.current);if(a=i.type,t!==null&&i.stateNode!=null)Sh(t,i,a,r,e),t.ref!==i.ref&&(i.flags|=128);else{if(!r){if(i.stateNode===null)throw Error(U(166));return null}if(t=In(cr.current),us(i)){r=i.stateNode,a=i.type;var n=i.memoizedProps;switch(r[Yr]=i,r[qo]=n,a){case"dialog":xe("cancel",r),xe("close",r);break;case"iframe":case"object":case"embed":xe("load",r);break;case"video":case"audio":for(t=0;t<ya.length;t++)xe(ya[t],r);break;case"source":xe("error",r);break;case"img":case"image":case"link":xe("error",r),xe("load",r);break;case"details":xe("toggle",r);break;case"input":hf(r,n),xe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!n.multiple},xe("invalid",r);break;case"textarea":pf(r,n),xe("invalid",r)}Ml(a,n),t=null;for(var o in n)n.hasOwnProperty(o)&&(e=n[o],o==="children"?typeof e=="string"?r.textContent!==e&&(t=["children",e]):typeof e=="number"&&r.textContent!==""+e&&(t=["children",""+e]):Qi.hasOwnProperty(o)&&e!=null&&o==="onScroll"&&xe("scroll",r));switch(a){case"input":Co(r),_f(r,n,!0);break;case"textarea":Co(r),mf(r);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(r.onclick=Xo)}r=t,i.updateQueue=r,r!==null&&(i.flags|=4)}else{switch(o=e.nodeType===9?e:e.ownerDocument,t===Al.html&&(t=yf(a)),t===Al.html?a==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(a,{is:r.is}):(t=o.createElement(a),a==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,a),t[Yr]=i,t[qo]=r,wh(t,i,!1,!1),i.stateNode=t,o=El(a,r),a){case"dialog":xe("cancel",t),xe("close",t),e=r;break;case"iframe":case"object":case"embed":xe("load",t),e=r;break;case"video":case"audio":for(e=0;e<ya.length;e++)xe(ya[e],t);e=r;break;case"source":xe("error",t),e=r;break;case"img":case"image":case"link":xe("error",t),xe("load",t),e=r;break;case"details":xe("toggle",t),e=r;break;case"input":hf(t,r),e=yl(t,r),xe("invalid",t);break;case"option":e=Sl(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},e=Se({},r,{value:void 0}),xe("invalid",t);break;case"textarea":pf(t,r),e=Pl(t,r),xe("invalid",t);break;default:e=r}Ml(a,e);var s=e;for(n in s)if(s.hasOwnProperty(n)){var l=s[n];n==="style"?Sf(t,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&xf(t,l)):n==="children"?typeof l=="string"?(a!=="textarea"||l!=="")&&ta(t,l):typeof l=="number"&&ta(t,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(Qi.hasOwnProperty(n)?l!=null&&n==="onScroll"&&xe("scroll",t):l!=null&&ll(t,n,l,o))}switch(a){case"input":Co(t),_f(t,r,!1);break;case"textarea":Co(t),mf(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Wr(r.value));break;case"select":t.multiple=!!r.multiple,n=r.value,n!=null?oi(t,!!r.multiple,n,!1):r.defaultValue!=null&&oi(t,!!r.multiple,r.defaultValue,!0);break;default:typeof e.onClick=="function"&&(t.onclick=Xo)}Pd(a,r)&&(i.flags|=4)}i.ref!==null&&(i.flags|=128)}return null;case 6:if(t&&i.stateNode!=null)Ph(t,i,t.memoizedProps,r);else{if(typeof r!="string"&&i.stateNode===null)throw Error(U(166));a=In(Ea.current),In(cr.current),us(i)?(r=i.stateNode,a=i.memoizedProps,r[Yr]=i,r.nodeValue!==a&&(i.flags|=4)):(r=(a.nodeType===9?a:a.ownerDocument).createTextNode(r),r[Yr]=i,i.stateNode=r)}return null;case 13:return we(Re),r=i.memoizedState,(i.flags&64)!=0?(i.lanes=a,i):(r=r!==null,a=!1,t===null?i.memoizedProps.fallback!==void 0&&us(i):a=t.memoizedState!==null,r&&!a&&(i.mode&2)!=0&&(t===null&&i.memoizedProps.unstable_avoidThisFallback!==!0||(Re.current&1)!=0?$e===0&&($e=3):(($e===0||$e===3)&&($e=4),dt===null||(Da&134217727)==0&&(Ei&134217727)==0||Ci(dt,at))),(r||a)&&(i.flags|=4),null);case 4:return Ai(),Du(i),t===null&&md(i.stateNode.containerInfo),null;case 10:return gu(i),null;case 17:return yt(i.type)&&Yo(),null;case 19:if(we(Re),r=i.memoizedState,r===null)return null;if(n=(i.flags&64)!=0,o=r.rendering,o===null)if(n)Oa(r,!1);else{if($e!==0||t!==null&&(t.flags&64)!=0)for(t=i.child;t!==null;){if(o=ls(t),o!==null){for(i.flags|=64,Oa(r,!1),n=o.updateQueue,n!==null&&(i.updateQueue=n,i.flags|=4),r.lastEffect===null&&(i.firstEffect=null),i.lastEffect=r.lastEffect,r=a,a=i.child;a!==null;)n=a,t=r,n.flags&=2,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null,o=n.alternate,o===null?(n.childLanes=0,n.lanes=t,n.child=null,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,t=o.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),a=a.sibling;return Ce(Re,Re.current&1|2),i.child}t=t.sibling}r.tail!==null&&nt()>Xu&&(i.flags|=64,n=!0,Oa(r,!1),i.lanes=33554432)}else{if(!n)if(t=ls(o),t!==null){if(i.flags|=64,n=!0,a=t.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),Oa(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!fr)return i=i.lastEffect=r.lastEffect,i!==null&&(i.nextEffect=null),null}else 2*nt()-r.renderingStartTime>Xu&&a!==1073741824&&(i.flags|=64,n=!0,Oa(r,!1),i.lanes=33554432);r.isBackwards?(o.sibling=i.child,i.child=o):(a=r.last,a!==null?a.sibling=o:i.child=o,r.last=o)}return r.tail!==null?(a=r.tail,r.rendering=a,r.tail=a.sibling,r.lastEffect=i.lastEffect,r.renderingStartTime=nt(),a.sibling=null,i=Re.current,Ce(Re,n?i&1|2:i&1),a):null;case 23:case 24:return Zu(),t!==null&&t.memoizedState!==null!=(i.memoizedState!==null)&&r.mode!=="unstable-defer-without-hiding"&&(i.flags|=4),null}throw Error(U(156,i.tag))}function pm(t){switch(t.tag){case 1:yt(t.type)&&Yo();var i=t.flags;return i&4096?(t.flags=i&-4097|64,t):null;case 3:if(Ai(),we(mt),we(rt),Au(),i=t.flags,(i&64)!=0)throw Error(U(285));return t.flags=i&-4097|64,t;case 5:return wu(t),null;case 13:return we(Re),i=t.flags,i&4096?(t.flags=i&-4097|64,t):null;case 19:return we(Re),null;case 4:return Ai(),null;case 10:return gu(t),null;case 23:case 24:return Zu(),null;default:return null}}function Fu(t,i){try{var a="",r=i;do a+=Y0(r),r=r.return;while(r);var e=a}catch(n){e=`
Error generating stack: `+n.message+`
`+n.stack}return{value:t,source:i,stack:e}}function Iu(t,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var gm=typeof WeakMap=="function"?WeakMap:Map;function Ah(t,i,a){a=en(-1,a),a.tag=3,a.payload={element:null};var r=i.value;return a.callback=function(){ms||(ms=!0,Ku=r),Iu(t,i)},a}function Th(t,i,a){a=en(-1,a),a.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var e=i.value;a.payload=function(){return Iu(t,i),r(e)}}var n=t.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(a.callback=function(){typeof r!="function"&&(hr===null?hr=new Set([this]):hr.add(this),Iu(t,i));var o=i.stack;this.componentDidCatch(i.value,{componentStack:o!==null?o:""})}),a}var mm=typeof WeakSet=="function"?WeakSet:Set;function Mh(t){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(a){ln(t,a)}else i.current=null}function ym(t,i){switch(i.tag){case 0:case 11:case 15:case 22:return;case 1:if(i.flags&256&&t!==null){var a=t.memoizedProps,r=t.memoizedState;t=i.stateNode,i=t.getSnapshotBeforeUpdate(i.elementType===i.type?a:Qt(i.type,a),r),t.__reactInternalSnapshotBeforeUpdate=i}return;case 3:i.flags&256&&su(i.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(U(163))}function xm(t,i,a){switch(a.tag){case 0:case 11:case 15:case 22:if(i=a.updateQueue,i=i!==null?i.lastEffect:null,i!==null){t=i=i.next;do{if((t.tag&3)==3){var r=t.create;t.destroy=r()}t=t.next}while(t!==i)}if(i=a.updateQueue,i=i!==null?i.lastEffect:null,i!==null){t=i=i.next;do{var e=t;r=e.next,e=e.tag,(e&4)!=0&&(e&1)!=0&&(Vh(a,t),bm(a,t)),t=r}while(t!==i)}return;case 1:t=a.stateNode,a.flags&4&&(i===null?t.componentDidMount():(r=a.elementType===a.type?i.memoizedProps:Qt(a.type,i.memoizedProps),t.componentDidUpdate(r,i.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),i=a.updateQueue,i!==null&&Gd(a,i,t);return;case 3:if(i=a.updateQueue,i!==null){if(t=null,a.child!==null)switch(a.child.tag){case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}Gd(a,i,t)}return;case 5:t=a.stateNode,i===null&&a.flags&4&&Pd(a.type,a.memoizedProps)&&t.focus();return;case 6:return;case 4:return;case 12:return;case 13:a.memoizedState===null&&(a=a.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&Nf(a))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(U(163))}function Eh(t,i){for(var a=t;;){if(a.tag===5){var r=a.stateNode;if(i)r=r.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{r=a.stateNode;var e=a.memoizedProps.style;e=e!=null&&e.hasOwnProperty("display")?e.display:null,r.style.display=wf("display",e)}}else if(a.tag===6)a.stateNode.nodeValue=i?"":a.memoizedProps;else if((a.tag!==23&&a.tag!==24||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}}function bh(t,i){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(cu,i)}catch{}switch(i.tag){case 0:case 11:case 14:case 15:case 22:if(t=i.updateQueue,t!==null&&(t=t.lastEffect,t!==null)){var a=t=t.next;do{var r=a,e=r.destroy;if(r=r.tag,e!==void 0)if((r&4)!=0)Vh(i,a);else{r=i;try{e()}catch(n){ln(r,n)}}a=a.next}while(a!==t)}break;case 1:if(Mh(i),t=i.stateNode,typeof t.componentWillUnmount=="function")try{t.props=i.memoizedProps,t.state=i.memoizedState,t.componentWillUnmount()}catch(n){ln(i,n)}break;case 5:Mh(i);break;case 4:Bh(t,i)}}function Ch(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function Rh(t){return t.tag===5||t.tag===3||t.tag===4}function zh(t){e:{for(var i=t.return;i!==null;){if(Rh(i))break e;i=i.return}throw Error(U(160))}var a=i;switch(i=a.stateNode,a.tag){case 5:var r=!1;break;case 3:i=i.containerInfo,r=!0;break;case 4:i=i.containerInfo,r=!0;break;default:throw Error(U(161))}a.flags&16&&(ta(i,""),a.flags&=-17);e:t:for(a=t;;){for(;a.sibling===null;){if(a.return===null||Rh(a.return)){a=null;break e}a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2)){a=a.stateNode;break e}}r?Nu(t,a,i):Uu(t,a,i)}function Nu(t,i,a){var r=t.tag,e=r===5||r===6;if(e)t=e?t.stateNode:t.stateNode.instance,i?a.nodeType===8?a.parentNode.insertBefore(t,i):a.insertBefore(t,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(t,a)):(i=a,i.appendChild(t)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=Xo));else if(r!==4&&(t=t.child,t!==null))for(Nu(t,i,a),t=t.sibling;t!==null;)Nu(t,i,a),t=t.sibling}function Uu(t,i,a){var r=t.tag,e=r===5||r===6;if(e)t=e?t.stateNode:t.stateNode.instance,i?a.insertBefore(t,i):a.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Uu(t,i,a),t=t.sibling;t!==null;)Uu(t,i,a),t=t.sibling}function Bh(t,i){for(var a=i,r=!1,e,n;;){if(!r){r=a.return;e:for(;;){if(r===null)throw Error(U(160));switch(e=r.stateNode,r.tag){case 5:n=!1;break e;case 3:e=e.containerInfo,n=!0;break e;case 4:e=e.containerInfo,n=!0;break e}r=r.return}r=!0}if(a.tag===5||a.tag===6){e:for(var o=t,s=a,l=s;;)if(bh(o,l),l.child!==null&&l.tag!==4)l.child.return=l,l=l.child;else{if(l===s)break e;for(;l.sibling===null;){if(l.return===null||l.return===s)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}n?(o=e,s=a.stateNode,o.nodeType===8?o.parentNode.removeChild(s):o.removeChild(s)):e.removeChild(a.stateNode)}else if(a.tag===4){if(a.child!==null){e=a.stateNode.containerInfo,n=!0,a.child.return=a,a=a.child;continue}}else if(bh(t,a),a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return,a.tag===4&&(r=!1)}a.sibling.return=a.return,a=a.sibling}}function ku(t,i){switch(i.tag){case 0:case 11:case 14:case 15:case 22:var a=i.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var r=a=a.next;do(r.tag&3)==3&&(t=r.destroy,r.destroy=void 0,t!==void 0&&t()),r=r.next;while(r!==a)}return;case 1:return;case 5:if(a=i.stateNode,a!=null){r=i.memoizedProps;var e=t!==null?t.memoizedProps:r;t=i.type;var n=i.updateQueue;if(i.updateQueue=null,n!==null){for(a[qo]=r,t==="input"&&r.type==="radio"&&r.name!=null&&vf(a,r),El(t,e),i=El(t,r),e=0;e<n.length;e+=2){var o=n[e],s=n[e+1];o==="style"?Sf(a,s):o==="dangerouslySetInnerHTML"?xf(a,s):o==="children"?ta(a,s):ll(a,o,s,i)}switch(t){case"input":xl(a,r);break;case"textarea":gf(a,r);break;case"select":t=a._wrapperState.wasMultiple,a._wrapperState.wasMultiple=!!r.multiple,n=r.value,n!=null?oi(a,!!r.multiple,n,!1):t!==!!r.multiple&&(r.defaultValue!=null?oi(a,!!r.multiple,r.defaultValue,!0):oi(a,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(i.stateNode===null)throw Error(U(162));i.stateNode.nodeValue=i.memoizedProps;return;case 3:a=i.stateNode,a.hydrate&&(a.hydrate=!1,Nf(a.containerInfo));return;case 12:return;case 13:i.memoizedState!==null&&(ju=nt(),Eh(i.child,!0)),Lh(i);return;case 19:Lh(i);return;case 17:return;case 23:case 24:Eh(i,i.memoizedState!==null);return}throw Error(U(163))}function Lh(t){var i=t.updateQueue;if(i!==null){t.updateQueue=null;var a=t.stateNode;a===null&&(a=t.stateNode=new mm),i.forEach(function(r){var e=zm.bind(null,t,r);a.has(r)||(a.add(r),r.then(e,e))})}}function wm(t,i){return t!==null&&(t=t.memoizedState,t===null||t.dehydrated!==null)?(i=i.memoizedState,i!==null&&i.dehydrated===null):!1}var Sm=Math.ceil,ps=Cn.ReactCurrentDispatcher,Vu=Cn.ReactCurrentOwner,ne=0,dt=null,Ne=null,at=0,kn=0,Gu=$r(0),$e=0,gs=null,Mi=0,Da=0,Ei=0,Hu=0,Wu=null,ju=0,Xu=1/0;function bi(){Xu=nt()+500}var q=null,ms=!1,Ku=null,hr=null,nn=!1,Fa=null,Ia=90,qu=[],Qu=[],br=null,Na=0,Yu=null,ys=-1,Cr=0,xs=0,Ua=null,ws=!1;function Ct(){return(ne&48)!=0?nt():ys!==-1?ys:ys=nt()}function an(t){if(t=t.mode,(t&2)==0)return 1;if((t&4)==0)return wi()===99?1:2;if(Cr===0&&(Cr=Mi),um.transition!==0){xs!==0&&(xs=Wu!==null?Wu.pendingLanes:0),t=Cr;var i=4186112&~xs;return i&=-i,i===0&&(t=4186112&~t,i=t&-t,i===0&&(i=8192)),i}return t=wi(),(ne&4)!=0&&t===98?t=Io(12,Cr):(t=dg(t),t=Io(t,Cr)),t}function on(t,i,a){if(50<Na)throw Na=0,Yu=null,Error(U(185));if(t=Ss(t,i),t===null)return null;No(t,i,a),t===dt&&(Ei|=i,$e===4&&Ci(t,at));var r=wi();i===1?(ne&8)!=0&&(ne&48)==0?$u(t):(It(t,a),ne===0&&(bi(),ur())):((ne&4)==0||r!==98&&r!==99||(br===null?br=new Set([t]):br.add(t)),It(t,a)),Wu=t}function Ss(t,i){t.lanes|=i;var a=t.alternate;for(a!==null&&(a.lanes|=i),a=t,t=t.return;t!==null;)t.childLanes|=i,a=t.alternate,a!==null&&(a.childLanes|=i),a=t,t=t.return;return a.tag===3?a.stateNode:null}function It(t,i){for(var a=t.callbackNode,r=t.suspendedLanes,e=t.pingedLanes,n=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-qr(o),l=1<<s,u=n[s];if(u===-1){if((l&r)==0||(l&e)!=0){u=i,ci(l);var c=ye;n[s]=10<=c?u+250:6<=c?u+5e3:-1}}else u<=i&&(t.expiredLanes|=l);o&=~l}if(r=fa(t,t===dt?at:0),i=ye,r===0)a!==null&&(a!==vu&&du(a),t.callbackNode=null,t.callbackPriority=0);else{if(a!==null){if(t.callbackPriority===i)return;a!==vu&&du(a)}i===15?(a=$u.bind(null,t),Tr===null?(Tr=[a],Jo=fu(Zo,Nd)):Tr.push(a),a=vu):i===14?a=Sa(99,$u.bind(null,t)):(a=hg(i),a=Sa(a,Oh.bind(null,t))),t.callbackPriority=i,t.callbackNode=a}}function Oh(t){if(ys=-1,xs=Cr=0,(ne&48)!=0)throw Error(U(327));var i=t.callbackNode;if(sn()&&t.callbackNode!==i)return null;var a=fa(t,t===dt?at:0);if(a===0)return null;var r=a,e=ne;ne|=16;var n=Nh();(dt!==t||at!==r)&&(bi(),Ri(t,r));do try{Tm();break}catch(s){Ih(t,s)}while(1);if(pu(),ps.current=n,ne=e,Ne!==null?r=0:(dt=null,at=0,r=$e),(Mi&Ei)!=0)Ri(t,0);else if(r!==0){if(r===2&&(ne|=64,t.hydrate&&(t.hydrate=!1,su(t.containerInfo)),a=jf(t),a!==0&&(r=ka(t,a))),r===1)throw i=gs,Ri(t,0),Ci(t,a),It(t,nt()),i;switch(t.finishedWork=t.current.alternate,t.finishedLanes=a,r){case 0:case 1:throw Error(U(345));case 2:Vn(t);break;case 3:if(Ci(t,a),(a&62914560)===a&&(r=ju+500-nt(),10<r)){if(fa(t,0)!==0)break;if(e=t.suspendedLanes,(e&a)!==a){Ct(),t.pingedLanes|=t.suspendedLanes&e;break}t.timeoutHandle=Ad(Vn.bind(null,t),r);break}Vn(t);break;case 4:if(Ci(t,a),(a&4186112)===a)break;for(r=t.eventTimes,e=-1;0<a;){var o=31-qr(a);n=1<<o,o=r[o],o>e&&(e=o),a&=~n}if(a=e,a=nt()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*Sm(a/1960))-a,10<a){t.timeoutHandle=Ad(Vn.bind(null,t),a);break}Vn(t);break;case 5:Vn(t);break;default:throw Error(U(329))}}return It(t,nt()),t.callbackNode===i?Oh.bind(null,t):null}function Ci(t,i){for(i&=~Hu,i&=~Ei,t.suspendedLanes|=i,t.pingedLanes&=~i,t=t.expirationTimes;0<i;){var a=31-qr(i),r=1<<a;t[a]=-1,i&=~r}}function $u(t){if((ne&48)!=0)throw Error(U(327));if(sn(),t===dt&&(t.expiredLanes&at)!=0){var i=at,a=ka(t,i);(Mi&Ei)!=0&&(i=fa(t,i),a=ka(t,i))}else i=fa(t,0),a=ka(t,i);if(t.tag!==0&&a===2&&(ne|=64,t.hydrate&&(t.hydrate=!1,su(t.containerInfo)),i=jf(t),i!==0&&(a=ka(t,i))),a===1)throw a=gs,Ri(t,0),Ci(t,i),It(t,nt()),a;return t.finishedWork=t.current.alternate,t.finishedLanes=i,Vn(t),It(t,nt()),null}function Pm(){if(br!==null){var t=br;br=null,t.forEach(function(i){i.expiredLanes|=24&i.pendingLanes,It(i,nt())})}ur()}function Dh(t,i){var a=ne;ne|=1;try{return t(i)}finally{ne=a,ne===0&&(bi(),ur())}}function Fh(t,i){var a=ne;ne&=-2,ne|=8;try{return t(i)}finally{ne=a,ne===0&&(bi(),ur())}}function Ps(t,i){Ce(Gu,kn),kn|=i,Mi|=i}function Zu(){kn=Gu.current,we(Gu)}function Ri(t,i){t.finishedWork=null,t.finishedLanes=0;var a=t.timeoutHandle;if(a!==-1&&(t.timeoutHandle=-1,nm(a)),Ne!==null)for(a=Ne.return;a!==null;){var r=a;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&Yo();break;case 3:Ai(),we(mt),we(rt),Au();break;case 5:wu(r);break;case 4:Ai();break;case 13:we(Re);break;case 19:we(Re);break;case 10:gu(r);break;case 23:case 24:Zu()}a=a.return}dt=t,Ne=un(t.current,null),at=kn=Mi=i,$e=0,gs=null,Hu=Ei=Da=0}function Ih(t,i){do{var a=Ne;try{if(pu(),ba.current=vs,cs){for(var r=Le.memoizedState;r!==null;){var e=r.queue;e!==null&&(e.pending=null),r=r.next}cs=!1}if(Ca=0,Ye=it=Le=null,Ra=!1,Vu.current=null,a===null||a.return===null){$e=1,gs=i,Ne=null;break}e:{var n=t,o=a.return,s=a,l=i;if(i=at,s.flags|=2048,s.firstEffect=s.lastEffect=null,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l;if((s.mode&2)==0){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var f=(Re.current&1)!=0,d=o;do{var h;if(h=d.tag===13){var _=d.memoizedState;if(_!==null)h=_.dehydrated!==null;else{var m=d.memoizedProps;h=m.fallback===void 0?!1:m.unstable_avoidThisFallback!==!0?!0:!f}}if(h){var v=d.updateQueue;if(v===null){var p=new Set;p.add(u),d.updateQueue=p}else v.add(u);if((d.mode&2)==0){if(d.flags|=64,s.flags|=16384,s.flags&=-2981,s.tag===1)if(s.alternate===null)s.tag=17;else{var g=en(-1,1);g.tag=2,tn(s,g)}s.lanes|=1;break e}l=void 0,s=i;var y=n.pingCache;if(y===null?(y=n.pingCache=new gm,l=new Set,y.set(u,l)):(l=y.get(u),l===void 0&&(l=new Set,y.set(u,l))),!l.has(s)){l.add(s);var x=Rm.bind(null,n,u,s);u.then(x,x)}d.flags|=4096,d.lanes=i;break e}d=d.return}while(d!==null);l=Error((ai(s.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}$e!==5&&($e=2),l=Fu(l,s),d=o;do{switch(d.tag){case 3:n=l,d.flags|=4096,i&=-i,d.lanes|=i;var T=Ah(d,n,i);Vd(d,T);break e;case 1:n=l;var w=d.type,S=d.stateNode;if((d.flags&64)==0&&(typeof w.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(hr===null||!hr.has(S)))){d.flags|=4096,i&=-i,d.lanes|=i;var M=Th(d,n,i);Vd(d,M);break e}}d=d.return}while(d!==null)}kh(a)}catch(P){i=P,Ne===a&&a!==null&&(Ne=a=a.return);continue}break}while(1)}function Nh(){var t=ps.current;return ps.current=vs,t===null?vs:t}function ka(t,i){var a=ne;ne|=16;var r=Nh();dt===t&&at===i||Ri(t,i);do try{Am();break}catch(e){Ih(t,e)}while(1);if(pu(),ne=a,ps.current=r,Ne!==null)throw Error(U(261));return dt=null,at=0,$e}function Am(){for(;Ne!==null;)Uh(Ne)}function Tm(){for(;Ne!==null&&!om();)Uh(Ne)}function Uh(t){var i=Hh(t.alternate,t,kn);t.memoizedProps=t.pendingProps,i===null?kh(t):Ne=i,Vu.current=null}function kh(t){var i=t;do{var a=i.alternate;if(t=i.return,(i.flags&2048)==0){if(a=_m(a,i,kn),a!==null){Ne=a;return}if(a=i,a.tag!==24&&a.tag!==23||a.memoizedState===null||(kn&1073741824)!=0||(a.mode&4)==0){for(var r=0,e=a.child;e!==null;)r|=e.lanes|e.childLanes,e=e.sibling;a.childLanes=r}t!==null&&(t.flags&2048)==0&&(t.firstEffect===null&&(t.firstEffect=i.firstEffect),i.lastEffect!==null&&(t.lastEffect!==null&&(t.lastEffect.nextEffect=i.firstEffect),t.lastEffect=i.lastEffect),1<i.flags&&(t.lastEffect!==null?t.lastEffect.nextEffect=i:t.firstEffect=i,t.lastEffect=i))}else{if(a=pm(i),a!==null){a.flags&=2047,Ne=a;return}t!==null&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(i=i.sibling,i!==null){Ne=i;return}Ne=i=t}while(i!==null);$e===0&&($e=5)}function Vn(t){var i=wi();return Fn(99,Mm.bind(null,t,i)),null}function Mm(t,i){do sn();while(Fa!==null);if((ne&48)!=0)throw Error(U(327));var a=t.finishedWork;if(a===null)return null;if(t.finishedWork=null,t.finishedLanes=0,a===t.current)throw Error(U(177));t.callbackNode=null;var r=a.lanes|a.childLanes,e=r,n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;for(var o=t.eventTimes,s=t.expirationTimes;0<n;){var l=31-qr(n),u=1<<l;e[l]=0,o[l]=-1,s[l]=-1,n&=~u}if(br!==null&&(r&24)==0&&br.has(t)&&br.delete(t),t===dt&&(Ne=dt=null,at=0),1<a.flags?a.lastEffect!==null?(a.lastEffect.nextEffect=a,r=a.firstEffect):r=a:r=a.firstEffect,r!==null){if(e=ne,ne|=32,Vu.current=null,iu=Uo,o=fd(),eu(o)){if("selectionStart"in o)s={start:o.selectionStart,end:o.selectionEnd};else e:if(s=(s=o.ownerDocument)&&s.defaultView||window,(u=s.getSelection&&s.getSelection())&&u.rangeCount!==0){s=u.anchorNode,n=u.anchorOffset,l=u.focusNode,u=u.focusOffset;try{s.nodeType,l.nodeType}catch{s=null;break e}var c=0,f=-1,d=-1,h=0,_=0,m=o,v=null;t:for(;;){for(var p;m!==s||n!==0&&m.nodeType!==3||(f=c+n),m!==l||u!==0&&m.nodeType!==3||(d=c+u),m.nodeType===3&&(c+=m.nodeValue.length),(p=m.firstChild)!==null;)v=m,m=p;for(;;){if(m===o)break t;if(v===s&&++h===n&&(f=c),v===l&&++_===u&&(d=c),(p=m.nextSibling)!==null)break;m=v,v=m.parentNode}m=p}s=f===-1||d===-1?null:{start:f,end:d}}else s=null;s=s||{start:0,end:0}}else s=null;au={focusedElem:o,selectionRange:s},Uo=!1,Ua=null,ws=!1,q=r;do try{Em()}catch(P){if(q===null)throw Error(U(330));ln(q,P),q=q.nextEffect}while(q!==null);Ua=null,q=r;do try{for(o=t;q!==null;){var g=q.flags;if(g&16&&ta(q.stateNode,""),g&128){var y=q.alternate;if(y!==null){var x=y.ref;x!==null&&(typeof x=="function"?x(null):x.current=null)}}switch(g&1038){case 2:zh(q),q.flags&=-3;break;case 6:zh(q),q.flags&=-3,ku(q.alternate,q);break;case 1024:q.flags&=-1025;break;case 1028:q.flags&=-1025,ku(q.alternate,q);break;case 4:ku(q.alternate,q);break;case 8:s=q,Bh(o,s);var T=s.alternate;Ch(s),T!==null&&Ch(T)}q=q.nextEffect}}catch(P){if(q===null)throw Error(U(330));ln(q,P),q=q.nextEffect}while(q!==null);if(x=au,y=fd(),g=x.focusedElem,o=x.selectionRange,y!==g&&g&&g.ownerDocument&&cd(g.ownerDocument.documentElement,g)){for(o!==null&&eu(g)&&(y=o.start,x=o.end,x===void 0&&(x=y),"selectionStart"in g?(g.selectionStart=y,g.selectionEnd=Math.min(x,g.value.length)):(x=(y=g.ownerDocument||document)&&y.defaultView||window,x.getSelection&&(x=x.getSelection(),s=g.textContent.length,T=Math.min(o.start,s),o=o.end===void 0?T:Math.min(o.end,s),!x.extend&&T>o&&(s=o,o=T,T=s),s=ud(g,T),n=ud(g,o),s&&n&&(x.rangeCount!==1||x.anchorNode!==s.node||x.anchorOffset!==s.offset||x.focusNode!==n.node||x.focusOffset!==n.offset)&&(y=y.createRange(),y.setStart(s.node,s.offset),x.removeAllRanges(),T>o?(x.addRange(y),x.extend(n.node,n.offset)):(y.setEnd(n.node,n.offset),x.addRange(y)))))),y=[],x=g;x=x.parentNode;)x.nodeType===1&&y.push({element:x,left:x.scrollLeft,top:x.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<y.length;g++)x=y[g],x.element.scrollLeft=x.left,x.element.scrollTop=x.top}Uo=!!iu,au=iu=null,t.current=a,q=r;do try{for(g=t;q!==null;){var w=q.flags;if(w&36&&xm(g,q.alternate,q),w&128){y=void 0;var S=q.ref;if(S!==null){var M=q.stateNode;switch(q.tag){case 5:y=M;break;default:y=M}typeof S=="function"?S(y):S.current=y}}q=q.nextEffect}}catch(P){if(q===null)throw Error(U(330));ln(q,P),q=q.nextEffect}while(q!==null);q=null,lm(),ne=e}else t.current=a;if(nn)nn=!1,Fa=t,Ia=i;else for(q=r;q!==null;)i=q.nextEffect,q.nextEffect=null,q.flags&8&&(w=q,w.sibling=null,w.stateNode=null),q=i;if(r=t.pendingLanes,r===0&&(hr=null),r===1?t===Yu?Na++:(Na=0,Yu=t):Na=0,a=a.stateNode,Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(cu,a,void 0,(a.current.flags&64)==64)}catch{}if(It(t,nt()),ms)throw ms=!1,t=Ku,Ku=null,t;return(ne&8)!=0||ur(),null}function Em(){for(;q!==null;){var t=q.alternate;ws||Ua===null||((q.flags&8)!=0?zf(q,Ua)&&(ws=!0):q.tag===13&&wm(t,q)&&zf(q,Ua)&&(ws=!0));var i=q.flags;(i&256)!=0&&ym(t,q),(i&512)==0||nn||(nn=!0,Sa(97,function(){return sn(),null})),q=q.nextEffect}}function sn(){if(Ia!==90){var t=97<Ia?97:Ia;return Ia=90,Fn(t,Cm)}return!1}function bm(t,i){qu.push(i,t),nn||(nn=!0,Sa(97,function(){return sn(),null}))}function Vh(t,i){Qu.push(i,t),nn||(nn=!0,Sa(97,function(){return sn(),null}))}function Cm(){if(Fa===null)return!1;var t=Fa;if(Fa=null,(ne&48)!=0)throw Error(U(331));var i=ne;ne|=32;var a=Qu;Qu=[];for(var r=0;r<a.length;r+=2){var e=a[r],n=a[r+1],o=e.destroy;if(e.destroy=void 0,typeof o=="function")try{o()}catch(l){if(n===null)throw Error(U(330));ln(n,l)}}for(a=qu,qu=[],r=0;r<a.length;r+=2){e=a[r],n=a[r+1];try{var s=e.create;e.destroy=s()}catch(l){if(n===null)throw Error(U(330));ln(n,l)}}for(s=t.current.firstEffect;s!==null;)t=s.nextEffect,s.nextEffect=null,s.flags&8&&(s.sibling=null,s.stateNode=null),s=t;return ne=i,ur(),!0}function Gh(t,i,a){i=Fu(a,i),i=Ah(t,i,1),tn(t,i),i=Ct(),t=Ss(t,1),t!==null&&(No(t,1,i),It(t,i))}function ln(t,i){if(t.tag===3)Gh(t,t,i);else for(var a=t.return;a!==null;){if(a.tag===3){Gh(a,t,i);break}else if(a.tag===1){var r=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(hr===null||!hr.has(r))){t=Fu(i,t);var e=Th(a,t,1);if(tn(a,e),e=Ct(),a=Ss(a,1),a!==null)No(a,1,e),It(a,e);else if(typeof r.componentDidCatch=="function"&&(hr===null||!hr.has(r)))try{r.componentDidCatch(i,t)}catch{}break}}a=a.return}}function Rm(t,i,a){var r=t.pingCache;r!==null&&r.delete(i),i=Ct(),t.pingedLanes|=t.suspendedLanes&a,dt===t&&(at&a)===a&&($e===4||$e===3&&(at&62914560)===at&&500>nt()-ju?Ri(t,0):Hu|=a),It(t,i)}function zm(t,i){var a=t.stateNode;a!==null&&a.delete(i),i=0,i===0&&(i=t.mode,(i&2)==0?i=1:(i&4)==0?i=wi()===99?1:2:(Cr===0&&(Cr=Mi),i=fi(62914560&~Cr),i===0&&(i=4194304))),a=Ct(),t=Ss(t,i),t!==null&&(No(t,i,a),It(t,a))}var Hh;Hh=function(t,i,a){var r=i.lanes;if(t!==null)if(t.memoizedProps!==i.pendingProps||mt.current)Yt=!0;else if((a&r)!=0)Yt=(t.flags&16384)!=0;else{switch(Yt=!1,i.tag){case 3:vh(i),Pu();break;case 5:Qd(i);break;case 1:yt(i.type)&&$o(i);break;case 4:xu(i,i.stateNode.containerInfo);break;case 10:r=i.memoizedProps.value;var e=i.type._context;Ce(es,e._currentValue),e._currentValue=r;break;case 13:if(i.memoizedState!==null)return(a&i.child.childLanes)!=0?_h(t,i,a):(Ce(Re,Re.current&1),i=Er(t,i,a),i!==null?i.sibling:null);Ce(Re,Re.current&1);break;case 19:if(r=(a&i.childLanes)!=0,(t.flags&64)!=0){if(r)return xh(t,i,a);i.flags|=64}if(e=i.memoizedState,e!==null&&(e.rendering=null,e.tail=null,e.lastEffect=null),Ce(Re,Re.current),r)break;return null;case 23:case 24:return i.lanes=0,zu(t,i,a)}return Er(t,i,a)}else Yt=!1;switch(i.lanes=0,i.tag){case 2:if(r=i.type,t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2),t=i.pendingProps,e=xi(i,rt.current),Pi(i,a),e=Mu(null,i,r,t,e,a),i.flags|=1,typeof e=="object"&&e!==null&&typeof e.render=="function"&&e.$$typeof===void 0){if(i.tag=1,i.memoizedState=null,i.updateQueue=null,yt(r)){var n=!0;$o(i)}else n=!1;i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,mu(i);var o=r.getDerivedStateFromProps;typeof o=="function"&&ns(i,r,o,t),e.updater=is,i.stateNode=e,e._reactInternals=i,yu(i,r,t,a),i=Lu(null,i,r,!0,n,a)}else i.tag=0,wt(null,i,e,a),i=i.child;return i;case 16:e=i.elementType;e:{switch(t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2),t=i.pendingProps,n=e._init,e=n(e._payload),i.type=e,n=i.tag=Lm(e),t=Qt(e,t),n){case 0:i=Bu(null,i,e,t,a);break e;case 1:i=hh(null,i,e,t,a);break e;case 11:i=uh(null,i,e,t,a);break e;case 14:i=ch(null,i,e,Qt(e.type,t),r,a);break e}throw Error(U(306,e,""))}return i;case 0:return r=i.type,e=i.pendingProps,e=i.elementType===r?e:Qt(r,e),Bu(t,i,r,e,a);case 1:return r=i.type,e=i.pendingProps,e=i.elementType===r?e:Qt(r,e),hh(t,i,r,e,a);case 3:if(vh(i),r=i.updateQueue,t===null||r===null)throw Error(U(282));if(r=i.pendingProps,e=i.memoizedState,e=e!==null?e.element:null,kd(t,i),Pa(i,r,null,a),r=i.memoizedState.element,r===e)Pu(),i=Er(t,i,a);else{if(e=i.stateNode,(n=e.hydrate)&&(rn=pi(i.stateNode.containerInfo.firstChild),Mr=i,n=fr=!0),n){if(t=e.mutableSourceEagerHydrationData,t!=null)for(e=0;e<t.length;e+=2)n=t[e],n._workInProgressVersionPrimary=t[e+1],Ti.push(n);for(a=qd(i,null,r,a),i.child=a;a;)a.flags=a.flags&-3|1024,a=a.sibling}else wt(t,i,r,a),Pu();i=i.child}return i;case 5:return Qd(i),t===null&&Su(i),r=i.type,e=i.pendingProps,n=t!==null?t.memoizedProps:null,o=e.children,ou(r,e)?o=null:n!==null&&ou(r,n)&&(i.flags|=16),dh(t,i),wt(t,i,o,a),i.child;case 6:return t===null&&Su(i),null;case 13:return _h(t,i,a);case 4:return xu(i,i.stateNode.containerInfo),r=i.pendingProps,t===null?i.child=ss(i,null,r,a):wt(t,i,r,a),i.child;case 11:return r=i.type,e=i.pendingProps,e=i.elementType===r?e:Qt(r,e),uh(t,i,r,e,a);case 7:return wt(t,i,i.pendingProps,a),i.child;case 8:return wt(t,i,i.pendingProps.children,a),i.child;case 12:return wt(t,i,i.pendingProps.children,a),i.child;case 10:e:{r=i.type._context,e=i.pendingProps,o=i.memoizedProps,n=e.value;var s=i.type._context;if(Ce(es,s._currentValue),s._currentValue=n,o!==null)if(s=o.value,n=Ot(s,n)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(s,n):1073741823)|0,n===0){if(o.children===e.children&&!mt.current){i=Er(t,i,a);break e}}else for(s=i.child,s!==null&&(s.return=i);s!==null;){var l=s.dependencies;if(l!==null){o=s.child;for(var u=l.firstContext;u!==null;){if(u.context===r&&(u.observedBits&n)!=0){s.tag===1&&(u=en(-1,a&-a),u.tag=2,tn(s,u)),s.lanes|=a,u=s.alternate,u!==null&&(u.lanes|=a),Ud(s.return,a),l.lanes|=a;break}u=u.next}}else o=s.tag===10&&s.type===i.type?null:s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===i){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}wt(t,i,e.children,a),i=i.child}return i;case 9:return e=i.type,n=i.pendingProps,r=n.children,Pi(i,a),e=Dt(e,n.unstable_observedBits),r=r(e),i.flags|=1,wt(t,i,r,a),i.child;case 14:return e=i.type,n=Qt(e,i.pendingProps),n=Qt(e.type,n),ch(t,i,e,n,r,a);case 15:return fh(t,i,i.type,i.pendingProps,r,a);case 17:return r=i.type,e=i.pendingProps,e=i.elementType===r?e:Qt(r,e),t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2),i.tag=1,yt(r)?(t=!0,$o(i)):t=!1,Pi(i,a),jd(i,r,e),yu(i,r,e,a),Lu(null,i,r,!0,t,a);case 19:return xh(t,i,a);case 23:return zu(t,i,a);case 24:return zu(t,i,a)}throw Error(U(156,i.tag))};function Bm(t,i,a,r){this.tag=t,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Nt(t,i,a,r){return new Bm(t,i,a,r)}function Ju(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Lm(t){if(typeof t=="function")return Ju(t)?1:0;if(t!=null){if(t=t.$$typeof,t===To)return 11;if(t===Eo)return 14}return 2}function un(t,i){var a=t.alternate;return a===null?(a=Nt(t.tag,i,t.key,t.mode),a.elementType=t.elementType,a.type=t.type,a.stateNode=t.stateNode,a.alternate=t,t.alternate=a):(a.pendingProps=i,a.type=t.type,a.flags=0,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null),a.childLanes=t.childLanes,a.lanes=t.lanes,a.child=t.child,a.memoizedProps=t.memoizedProps,a.memoizedState=t.memoizedState,a.updateQueue=t.updateQueue,i=t.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=t.sibling,a.index=t.index,a.ref=t.ref,a}function As(t,i,a,r,e,n){var o=2;if(r=t,typeof t=="function")Ju(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Hr:return zi(a.children,e,n,i);case uf:o=8,e|=16;break;case ul:o=8,e|=1;break;case $i:return t=Nt(12,a,i,e|8),t.elementType=$i,t.type=$i,t.lanes=n,t;case Zi:return t=Nt(13,a,i,e),t.type=Zi,t.elementType=Zi,t.lanes=n,t;case Mo:return t=Nt(19,a,i,e),t.elementType=Mo,t.lanes=n,t;case _l:return ec(a,e,n,i);case pl:return t=Nt(24,a,i,e),t.elementType=pl,t.lanes=n,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case cl:o=10;break e;case fl:o=9;break e;case To:o=11;break e;case Eo:o=14;break e;case dl:o=16,r=null;break e;case hl:o=22;break e}throw Error(U(130,t==null?t:typeof t,""))}return i=Nt(o,a,i,e),i.elementType=t,i.type=r,i.lanes=n,i}function zi(t,i,a,r){return t=Nt(7,t,r,i),t.lanes=a,t}function ec(t,i,a,r){return t=Nt(23,t,r,i),t.elementType=_l,t.lanes=a,t}function tc(t,i,a){return t=Nt(6,t,null,i),t.lanes=a,t}function rc(t,i,a){return i=Nt(4,t.children!==null?t.children:[],t.key,i),i.lanes=a,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}function Om(t,i,a){this.tag=i,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=a,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Gl(0),this.expirationTimes=Gl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gl(0),this.mutableSourceEagerHydrationData=null}function Dm(t,i,a){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rn,key:r==null?null:""+r,children:t,containerInfo:i,implementation:a}}function Ts(t,i,a,r){var e=i.current,n=Ct(),o=an(e);e:if(a){a=a._reactInternals;t:{if(Bn(a)!==a||a.tag!==1)throw Error(U(170));var s=a;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(yt(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}s=s.return}while(s!==null);throw Error(U(171))}if(a.tag===1){var l=a.type;if(yt(l)){a=Cd(a,l,s);break e}}a=s}else a=Zr;return i.context===null?i.context=a:i.pendingContext=a,i=en(n,o),i.payload={element:t},r=r===void 0?null:r,r!==null&&(i.callback=r),tn(e,i),on(e,o,n),o}function nc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Wh(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var a=t.retryLane;t.retryLane=a!==0&&a<i?a:i}}function ic(t,i){Wh(t,i),(t=t.alternate)&&Wh(t,i)}function Fm(){return null}function ac(t,i,a){var r=a!=null&&a.hydrationOptions!=null&&a.hydrationOptions.mutableSources||null;if(a=new Om(t,i,a!=null&&a.hydrate===!0),i=Nt(3,null,null,i===2?7:i===1?3:0),a.current=i,i.stateNode=a,mu(i),t[gi]=a.current,md(t.nodeType===8?t.parentNode:t),r)for(t=0;t<r.length;t++){i=r[t];var e=i._getVersion;e=e(i._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[i,e]:a.mutableSourceEagerHydrationData.push(i,e)}this._internalRoot=a}ac.prototype.render=function(t){Ts(t,this._internalRoot,null,null)};ac.prototype.unmount=function(){var t=this._internalRoot,i=t.containerInfo;Ts(null,t,null,function(){i[gi]=null})};function Va(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Im(t,i){if(i||(i=t?t.nodeType===9?t.documentElement:t.firstChild:null,i=!(!i||i.nodeType!==1||!i.hasAttribute("data-reactroot"))),!i)for(var a;a=t.lastChild;)t.removeChild(a);return new ac(t,0,i?{hydrate:!0}:void 0)}function Ms(t,i,a,r,e){var n=a._reactRootContainer;if(n){var o=n._internalRoot;if(typeof e=="function"){var s=e;e=function(){var u=nc(o);s.call(u)}}Ts(i,o,t,e)}else{if(n=a._reactRootContainer=Im(a,r),o=n._internalRoot,typeof e=="function"){var l=e;e=function(){var u=nc(o);l.call(u)}}Fh(function(){Ts(i,o,t,e)})}return nc(o)}Bf=function(t){if(t.tag===13){var i=Ct();on(t,4,i),ic(t,4)}};Fl=function(t){if(t.tag===13){var i=Ct();on(t,67108864,i),ic(t,67108864)}};Lf=function(t){if(t.tag===13){var i=Ct(),a=an(t);on(t,a,i),ic(t,a)}};Of=function(t,i){return i()};Cl=function(t,i,a){switch(i){case"input":if(xl(t,a),i=a.name,a.type==="radio"&&i!=null){for(a=t;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var r=a[i];if(r!==t&&r.form===t.form){var e=Qo(r);if(!e)throw Error(U(90));df(r),xl(r,e)}}}break;case"textarea":gf(t,a);break;case"select":i=a.value,i!=null&&oi(t,!!a.multiple,i,!1)}};Rl=Dh;Mf=function(t,i,a,r,e){var n=ne;ne|=4;try{return Fn(98,t.bind(null,i,a,r,e))}finally{ne=n,ne===0&&(bi(),ur())}};zl=function(){(ne&49)==0&&(Pm(),sn())};Ef=function(t,i){var a=ne;ne|=2;try{return t(i)}finally{ne=a,ne===0&&(bi(),ur())}};function jh(t,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Va(i))throw Error(U(200));return Dm(t,i,null,a)}var Nm={Events:[wa,mi,Qo,Af,Tf,sn,{current:!1}]},Ga={findFiberByHostInstance:Ln,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},Um={bundleType:Ga.bundleType,version:Ga.version,rendererPackageName:Ga.rendererPackageName,rendererConfig:Ga.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Cn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Rf(t),t===null?null:t.stateNode},findFiberByHostInstance:Ga.findFiberByHostInstance||Fm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Es=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Es.isDisabled&&Es.supportsFiber)try{cu=Es.inject(Um),Dn=Es}catch{}}Lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nm;Lt.createPortal=jh;Lt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(U(188)):Error(U(268,Object.keys(t)));return t=Rf(i),t=t===null?null:t.stateNode,t};Lt.flushSync=function(t,i){var a=ne;if((a&48)!=0)return t(i);ne|=1;try{if(t)return Fn(99,t.bind(null,i))}finally{ne=a,ur()}};Lt.hydrate=function(t,i,a){if(!Va(i))throw Error(U(200));return Ms(null,t,i,!0,a)};Lt.render=function(t,i,a){if(!Va(i))throw Error(U(200));return Ms(null,t,i,!1,a)};Lt.unmountComponentAtNode=function(t){if(!Va(t))throw Error(U(40));return t._reactRootContainer?(Fh(function(){Ms(null,null,t,!1,function(){t._reactRootContainer=null,t[gi]=null})}),!0):!1};Lt.unstable_batchedUpdates=Dh;Lt.unstable_createPortal=function(t,i){return jh(t,i,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Lt.unstable_renderSubtreeIntoContainer=function(t,i,a,r){if(!Va(a))throw Error(U(200));if(t==null||t._reactInternals===void 0)throw Error(U(38));return Ms(t,i,a,!1,r)};Lt.version="17.0.2";function Xh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Xh)}catch(t){console.error(t)}}Xh(),tf.exports=Lt;var kw=tf.exports,Rr;(function(t){t[t.Disjoint=0]="Disjoint",t[t.Contains=1]="Contains",t[t.Intersects=2]="Intersects"})(Rr||(Rr={}));var ht;(function(t){t[t.Back=0]="Back",t[t.Front=1]="Front",t[t.Intersecting=2]="Intersecting"})(ht||(ht={}));var O=function(){function t(){}return t.clamp=function(a,r,e){return Math.max(r,Math.min(e,a))},t.equals=function(a,r){return Math.abs(a-r)<=t.zeroTolerance},t.isPowerOf2=function(a){return(a&a-1)==0},t.radianToDegree=function(a){return a*t.radToDegreeFactor},t.degreeToRadian=function(a){return a*t.degreeToRadFactor},t}();O.zeroTolerance=1e-6;O.radToDegreeFactor=180/Math.PI;O.degreeToRadFactor=Math.PI/180;var A=function(){t.add=function(r,e,n){n.x=r.x+e.x,n.y=r.y+e.y,n.z=r.z+e.z},t.subtract=function(r,e,n){n.x=r.x-e.x,n.y=r.y-e.y,n.z=r.z-e.z},t.multiply=function(r,e,n){n.x=r.x*e.x,n.y=r.y*e.y,n.z=r.z*e.z},t.divide=function(r,e,n){n.x=r.x/e.x,n.y=r.y/e.y,n.z=r.z/e.z},t.dot=function(r,e){return r.x*e.x+r.y*e.y+r.z*e.z},t.cross=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=e.x,c=e.y,f=e.z;n.x=s*f-l*c,n.y=l*u-o*f,n.z=o*c-s*u},t.distance=function(r,e){var n=e.x-r.x,o=e.y-r.y,s=e.z-r.z;return Math.sqrt(n*n+o*o+s*s)},t.distanceSquared=function(r,e){var n=e.x-r.x,o=e.y-r.y,s=e.z-r.z;return n*n+o*o+s*s},t.equals=function(r,e){return O.equals(r.x,e.x)&&O.equals(r.y,e.y)&&O.equals(r.z,e.z)},t.lerp=function(r,e,n,o){var s=r.x,l=r.y,u=r.z;o.x=s+(e.x-s)*n,o.y=l+(e.y-l)*n,o.z=u+(e.z-u)*n},t.max=function(r,e,n){n.x=Math.max(r.x,e.x),n.y=Math.max(r.y,e.y),n.z=Math.max(r.z,e.z)},t.min=function(r,e,n){n.x=Math.min(r.x,e.x),n.y=Math.min(r.y,e.y),n.z=Math.min(r.z,e.z)},t.negate=function(r,e){e.x=-r.x,e.y=-r.y,e.z=-r.z},t.normalize=function(r,e){var n=r.x,o=r.y,s=r.z,l=Math.sqrt(n*n+o*o+s*s);l>0&&(l=1/l,e.x=n*l,e.y=o*l,e.z=s*l)},t.scale=function(r,e,n){n.x=r.x*e,n.y=r.y*e,n.z=r.z*e},t.transformNormal=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=e.elements;n.x=o*u[0]+s*u[4]+l*u[8],n.y=o*u[1]+s*u[5]+l*u[9],n.z=o*u[2]+s*u[6]+l*u[10]},t.transformToVec3=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=e.elements;n.x=o*u[0]+s*u[4]+l*u[8]+u[12],n.y=o*u[1]+s*u[5]+l*u[9]+u[13],n.z=o*u[2]+s*u[6]+l*u[10]+u[14]},t.transformToVec4=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=e.elements;n.x=o*u[0]+s*u[4]+l*u[8]+u[12],n.y=o*u[1]+s*u[5]+l*u[9]+u[13],n.z=o*u[2]+s*u[6]+l*u[10]+u[14],n.w=o*u[3]+s*u[7]+l*u[11]+u[15]},t.transformCoordinate=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=e.elements,c=o*u[3]+s*u[7]+l*u[11]+u[15];c=1/c,n.x=(o*u[0]+s*u[4]+l*u[8]+u[12])*c,n.y=(o*u[1]+s*u[5]+l*u[9]+u[13])*c,n.z=(o*u[2]+s*u[6]+l*u[10]+u[14])*c},t.transformByQuat=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=e.x,c=e.y,f=e.z,d=e.w,h=d*o+c*l-f*s,_=d*s+f*o-u*l,m=d*l+u*s-c*o,v=-u*o-c*s-f*l;n.x=h*d-v*u-_*f+m*c,n.y=_*d-v*c-m*u+h*f,n.z=m*d-v*f-h*c+_*u};function t(a,r,e){a===void 0&&(a=0),r===void 0&&(r=0),e===void 0&&(e=0),this.x=void 0,this.y=void 0,this.z=void 0,this.x=a,this.y=r,this.z=e}var i=t.prototype;return i.setValue=function(r,e,n){return this.x=r,this.y=e,this.z=n,this},i.setValueByArray=function(r,e){return e===void 0&&(e=0),this.x=r[e],this.y=r[e+1],this.z=r[e+2],this},i.add=function(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this},i.subtract=function(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this},i.multiply=function(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this},i.divide=function(r){return this.x/=r.x,this.y/=r.y,this.z/=r.z,this},i.length=function(){var r=this.x,e=this.y,n=this.z;return Math.sqrt(r*r+e*e+n*n)},i.lengthSquared=function(){var r=this.x,e=this.y,n=this.z;return r*r+e*e+n*n},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.normalize=function(){return t.normalize(this,this),this},i.scale=function(r){return this.x*=r,this.y*=r,this.z*=r,this},i.toArray=function(r,e){e===void 0&&(e=0),r[e]=this.x,r[e+1]=this.y,r[e+2]=this.z},i.clone=function(){return new t(this.x,this.y,this.z)},i.cloneTo=function(r){return r.x=this.x,r.y=this.y,r.z=this.z,r},i.transformNormal=function(r){return t.transformNormal(this,r,this),this},i.transformToVec3=function(r){return t.transformToVec3(this,r,this),this},i.transformCoordinate=function(r){return t.transformCoordinate(this,r,this),this},i.transformByQuat=function(r){return t.transformByQuat(this,r,this),this},t}();A._zero=new A(0,0,0);A._one=new A(1,1,1);var Kh=function(){t.fromPoints=function(r,e){if(!r||r.length===0)throw new Error("points must be array and length must > 0");var n=r.length,o=t._tempVec30;o.x=o.y=o.z=0;for(var s=0;s<n;++s)A.add(r[s],o,o);A.scale(o,1/n,e.center);for(var l=0,u=0;u<n;++u){var c=A.distanceSquared(o,r[u]);c>l&&(l=c)}e.radius=Math.sqrt(l)},t.fromBox=function(r,e){var n=e.center,o=r.min,s=r.max;n.x=(o.x+s.x)*.5,n.y=(o.y+s.y)*.5,n.z=(o.z+s.z)*.5,e.radius=A.distance(n,s)};function t(a,r){a===void 0&&(a=null),r===void 0&&(r=0),this.center=new A,this.radius=0,a&&a.cloneTo(this.center),this.radius=r}var i=t.prototype;return i.clone=function(){return new t(this.center,this.radius)},i.cloneTo=function(r){return this.center.cloneTo(r.center),r.radius=this.radius,r},t}();Kh._tempVec30=new A;var $t=function(){t.fromCenterAndExtent=function(r,e,n){A.subtract(r,e,n.min),A.add(r,e,n.max)},t.fromPoints=function(r,e){if(!r||r.length===0)throw new Error("points must be array and length must > 0");var n=e.min,o=e.max;n.x=n.y=n.z=Number.MAX_VALUE,o.x=o.y=o.z=-Number.MAX_VALUE;for(var s=0,l=r.length;s<l;++s){var u=r[s];A.min(n,u,n),A.max(o,u,o)}},t.fromSphere=function(r,e){var n=r.center,o=r.radius,s=e.min,l=e.max;s.x=n.x-o,s.y=n.y-o,s.z=n.z-o,l.x=n.x+o,l.y=n.y+o,l.z=n.z+o},t.transform=function(r,e,n){var o=t._tempVec30,s=t._tempVec31;r.getCenter(o),r.getExtent(s),A.transformCoordinate(o,e,o);var l=s.x,u=s.y,c=s.z,f=e.elements;s.x=Math.abs(l*f[0])+Math.abs(u*f[4])+Math.abs(c*f[8]),s.y=Math.abs(l*f[1])+Math.abs(u*f[5])+Math.abs(c*f[9]),s.z=Math.abs(l*f[2])+Math.abs(u*f[6])+Math.abs(c*f[10]),A.subtract(o,s,n.min),A.add(o,s,n.max)},t.merge=function(r,e,n){return A.min(r.min,e.min,n.min),A.max(r.max,e.max,n.max),n};function t(a,r){a===void 0&&(a=null),r===void 0&&(r=null),this.min=new A,this.max=new A,a&&a.cloneTo(this.min),r&&r.cloneTo(this.max)}var i=t.prototype;return i.clone=function(){return new t(this.min,this.max)},i.cloneTo=function(r){return this.min.cloneTo(r.min),this.max.cloneTo(r.max),r},i.getCenter=function(r){return A.add(this.min,this.max,r),A.scale(r,.5,r),r},i.getExtent=function(r){return A.subtract(this.max,this.min,r),A.scale(r,.5,r),r},i.getCorners=function(r){r===void 0&&(r=[]);var e=this.min,n=this.max,o=e.x,s=e.y,l=e.z,u=n.x,c=n.y,f=n.z,d=r.length;if(d<8)for(var h=0,_=8-d;h<_;++h)r[d+h]=new A;return r[0].setValue(o,c,f),r[1].setValue(u,c,f),r[2].setValue(u,s,f),r[3].setValue(o,s,f),r[4].setValue(o,c,l),r[5].setValue(u,c,l),r[6].setValue(u,s,l),r[7].setValue(o,s,l),r},i.transform=function(r){return t.transform(this,r,this),this},t}();$t._tempVec30=new A;$t._tempVec31=new A;var Gn=function(){function t(){}return t.distancePlaneAndPoint=function(a,r){return A.dot(a.normal,r)+a.distance},t.intersectsPlaneAndPoint=function(a,r){var e=t.distancePlaneAndPoint(a,r);return e>0?ht.Front:e<0?ht.Back:ht.Intersecting},t.intersectsPlaneAndBox=function(a,r){var e=r.min,n=r.max,o=a.normal,s=t._tempVec30,l=t._tempVec31;return o.x>=0?(s.x=n.x,l.x=e.x):(s.x=e.x,l.x=n.x),o.y>=0?(s.y=n.y,l.y=e.y):(s.y=e.y,l.y=n.y),o.z>=0?(s.z=n.z,l.z=e.z):(s.z=e.z,l.z=n.z),t.distancePlaneAndPoint(a,s)<0?ht.Back:t.distancePlaneAndPoint(a,l)>0?ht.Front:ht.Intersecting},t.intersectsPlaneAndSphere=function(a,r){var e=r.center,n=r.radius,o=t.distancePlaneAndPoint(a,e);return o>n?ht.Front:o<-n?ht.Back:ht.Intersecting},t.intersectsRayAndPlane=function(a,r){var e=r.normal,n=O.zeroTolerance,o=A.dot(e,a.direction);if(Math.abs(o)<n)return-1;var s=A.dot(e,a.origin),l=(-r.distance-s)/o;if(l<0){if(l<-n)return-1;l=0}return l},t.intersectsRayAndBox=function(a,r){var e=O.zeroTolerance,n=a.origin,o=a.direction,s=r.min,l=r.max,u=o.x,c=o.y,f=o.z,d=n.x,h=n.y,_=n.z,m=0,v=Number.MAX_VALUE;if(Math.abs(u)<e){if(d<s.x||d>l.x)return-1}else{var p=1/u,g=(s.x-d)*p,y=(l.x-d)*p;if(g>y){var x=g;g=y,y=x}if(m=Math.max(g,m),v=Math.min(y,v),m>v)return-1}if(Math.abs(c)<e){if(h<s.y||h>l.y)return-1}else{var T=1/c,w=(s.y-h)*T,S=(l.y-h)*T;if(w>S){var M=w;w=S,S=M}if(m=Math.max(w,m),v=Math.min(S,v),m>v)return-1}if(Math.abs(f)<e){if(_<s.z||_>l.z)return-1}else{var P=1/f,E=(s.z-_)*P,R=(l.z-_)*P;if(E>R){var C=E;E=R,R=C}if(m=Math.max(E,m),v=Math.min(R,v),m>v)return-1}return m},t.intersectsRayAndSphere=function(a,r){var e=a.origin,n=a.direction,o=r.center,s=r.radius,l=t._tempVec30;A.subtract(e,o,l);var u=A.dot(l,n),c=A.dot(l,l)-s*s;if(u>0&&c>0)return-1;var f=u*u-c;if(f<0)return-1;var d=-u-Math.sqrt(f);return d<0&&(d=0),d},t.intersectsFrustumAndBox=function(a,r){for(var e=r.min,n=r.max,o=t._tempVec30,s=0;s<6;++s){var l=a.getPlane(s),u=l.normal;if(o.x=u.x>=0?e.x:n.x,o.y=u.y>=0?e.y:n.y,o.z=u.z>=0?e.z:n.z,A.dot(l.normal,o)>-l.distance)return!1}return!0},t.frustumContainsBox=function(a,r){for(var e=r.min,n=r.max,o=t._tempVec30,s=t._tempVec31,l=Rr.Contains,u=0;u<6;++u){var c=a.getPlane(u),f=c.normal;if(f.x>=0?(o.x=n.x,s.x=e.x):(o.x=e.x,s.x=n.x),f.y>=0?(o.y=n.y,s.y=e.y):(o.y=e.y,s.y=n.y),f.z>=0?(o.z=n.z,s.z=e.z):(o.z=e.z,s.z=n.z),t.intersectsPlaneAndPoint(c,s)===ht.Front)return Rr.Disjoint;t.intersectsPlaneAndPoint(c,o)===ht.Front&&(l=Rr.Intersects)}return l},t.frustumContainsSphere=function(a,r){for(var e=Rr.Contains,n=0;n<6;++n){var o=a.getPlane(n),s=t.intersectsPlaneAndSphere(o,r);if(s===ht.Front)return Rr.Disjoint;if(s===ht.Intersecting){e=Rr.Intersects;break}}return e},t}();Gn._tempVec30=new A;Gn._tempVec31=new A;var Hn=function(){t.normalize=function(r,e){var n=r.normal,o=1/n.length(),s=e.normal;s.x=n.x*o,s.y=n.y*o,s.z=n.z*o,e.distance=r.distance*o},t.fromPoints=function(r,e,n,o){var s=r.x,l=r.y,u=r.z,c=e.x-s,f=e.y-l,d=e.z-u,h=n.x-s,_=n.y-l,m=n.z-u,v=f*m-d*_,p=d*h-c*m,g=c*_-f*h,y=1/Math.sqrt(v*v+p*p+g*g),x=v*y,T=p*y,w=g*y,S=o.normal;S.x=x,S.y=T,S.z=w,o.distance=-(x*s+T*l+w*u)};function t(a,r){a===void 0&&(a=null),r===void 0&&(r=0),this.normal=new A,this.distance=0,a&&a.cloneTo(this.normal),this.distance=r}var i=t.prototype;return i.normalize=function(){return t.normalize(this,this),this},i.clone=function(){var r=new t;return this.cloneTo(r),r},i.cloneTo=function(r){return this.normal.cloneTo(r.normal),r.distance=this.distance,r},t}(),km=function(){function t(a){a===void 0&&(a=null),this.near=void 0,this.far=void 0,this.left=void 0,this.right=void 0,this.top=void 0,this.bottom=void 0,this.near=new Hn,this.far=new Hn,this.left=new Hn,this.right=new Hn,this.top=new Hn,this.bottom=new Hn,a&&this.calculateFromMatrix(a)}var i=t.prototype;return i.clone=function(){var r=new t;return this.cloneTo(r),r},i.cloneTo=function(r){return this.near.cloneTo(r.near),this.far.cloneTo(r.far),this.left.cloneTo(r.left),this.right.cloneTo(r.right),this.top.cloneTo(r.top),this.bottom.cloneTo(r.bottom),r},i.getPlane=function(r){switch(r){case 0:return this.near;case 1:return this.far;case 2:return this.left;case 3:return this.right;case 4:return this.top;case 5:return this.bottom;default:return null}},i.calculateFromMatrix=function(r){var e=r.elements,n=e[0],o=e[1],s=e[2],l=e[3],u=e[4],c=e[5],f=e[6],d=e[7],h=e[8],_=e[9],m=e[10],v=e[11],p=e[12],g=e[13],y=e[14],x=e[15],T=this.near.normal;T.x=-l-s,T.y=-d-f,T.z=-v-m,this.near.distance=-x-y,this.near.normalize();var w=this.far.normal;w.x=s-l,w.y=f-d,w.z=m-v,this.far.distance=y-x,this.far.normalize();var S=this.left.normal;S.x=-l-n,S.y=-d-u,S.z=-v-h,this.left.distance=-x-p,this.left.normalize();var M=this.right.normal;M.x=n-l,M.y=u-d,M.z=h-v,this.right.distance=p-x,this.right.normalize();var P=this.top.normal;P.x=o-l,P.y=c-d,P.z=_-v,this.top.distance=g-x,this.top.normalize();var E=this.bottom.normal;E.x=-l-o,E.y=-d-c,E.z=-v-_,this.bottom.distance=-x-g,this.bottom.normalize()},i.intersectsBox=function(r){return Gn.intersectsFrustumAndBox(this,r)},i.intersectsSphere=function(r){return Gn.frustumContainsSphere(this,r)!==Rr.Disjoint},t}(),Bi=function(){t.add=function(r,e,n){var o=r.elements,s=e.elements,l=n.elements;l[0]=o[0]+s[0],l[1]=o[1]+s[1],l[2]=o[2]+s[2],l[3]=o[3]+s[3],l[4]=o[4]+s[4],l[5]=o[5]+s[5],l[6]=o[6]+s[6],l[7]=o[7]+s[7],l[8]=o[8]+s[8]},t.subtract=function(r,e,n){var o=r.elements,s=e.elements,l=n.elements;l[0]=o[0]-s[0],l[1]=o[1]-s[1],l[2]=o[2]-s[2],l[3]=o[3]-s[3],l[4]=o[4]-s[4],l[5]=o[5]-s[5],l[6]=o[6]-s[6],l[7]=o[7]-s[7],l[8]=o[8]-s[8]},t.multiply=function(r,e,n){var o=r.elements,s=e.elements,l=n.elements,u=o[0],c=o[1],f=o[2],d=o[3],h=o[4],_=o[5],m=o[6],v=o[7],p=o[8],g=s[0],y=s[1],x=s[2],T=s[3],w=s[4],S=s[5],M=s[6],P=s[7],E=s[8];l[0]=u*g+d*y+m*x,l[1]=c*g+h*y+v*x,l[2]=f*g+_*y+p*x,l[3]=u*T+d*w+m*S,l[4]=c*T+h*w+v*S,l[5]=f*T+_*w+p*S,l[6]=u*M+d*P+m*E,l[7]=c*M+h*P+v*E,l[8]=f*M+_*P+p*E},t.equals=function(r,e){var n=r.elements,o=e.elements;return O.equals(n[0],o[0])&&O.equals(n[1],o[1])&&O.equals(n[2],o[2])&&O.equals(n[3],o[3])&&O.equals(n[4],o[4])&&O.equals(n[5],o[5])&&O.equals(n[6],o[6])&&O.equals(n[7],o[7])&&O.equals(n[8],o[8])},t.lerp=function(r,e,n,o){var s=r.elements,l=e.elements,u=o.elements,c=1-n;u[0]=s[0]*c+l[0]*n,u[1]=s[1]*c+l[1]*n,u[2]=s[2]*c+l[2]*n,u[3]=s[3]*c+l[3]*n,u[4]=s[4]*c+l[4]*n,u[5]=s[5]*c+l[5]*n,u[6]=s[6]*c+l[6]*n,u[7]=s[7]*c+l[7]*n,u[8]=s[8]*c+l[8]*n},t.rotationQuaternion=function(r,e){var n=e.elements,o=r.x,s=r.y,l=r.z,u=r.w,c=o+o,f=s+s,d=l+l,h=o*c,_=s*c,m=s*f,v=l*c,p=l*f,g=l*d,y=u*c,x=u*f,T=u*d;n[0]=1-m-g,n[3]=_-T,n[6]=v+x,n[1]=_+T,n[4]=1-h-g,n[7]=p-y,n[2]=v-x,n[5]=p+y,n[8]=1-h-m},t.scaling=function(r,e){var n=e.elements;n[0]=r.x,n[1]=0,n[2]=0,n[3]=0,n[4]=r.y,n[5]=0,n[6]=0,n[7]=0,n[8]=1},t.translation=function(r,e){var n=e.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=r.x,n[7]=r.y,n[8]=1},t.invert=function(r,e){var n=r.elements,o=e.elements,s=n[0],l=n[1],u=n[2],c=n[3],f=n[4],d=n[5],h=n[6],_=n[7],m=n[8],v=m*f-d*_,p=-m*c+d*h,g=_*c-f*h,y=s*v+l*p+u*g;!y||(y=1/y,o[0]=v*y,o[1]=(-m*l+u*_)*y,o[2]=(d*l-u*f)*y,o[3]=p*y,o[4]=(m*s-u*h)*y,o[5]=(-d*s+u*c)*y,o[6]=g*y,o[7]=(-_*s+l*h)*y,o[8]=(f*s-l*c)*y)},t.normalMatrix=function(r,e){var n=r.elements,o=e.elements,s=n[0],l=n[1],u=n[2],c=n[3],f=n[4],d=n[5],h=n[6],_=n[7],m=n[8],v=n[9],p=n[10],g=n[11],y=n[12],x=n[13],T=n[14],w=n[15],S=s*d-l*f,M=s*h-u*f,P=s*_-c*f,E=l*h-u*d,R=l*_-c*d,C=u*_-c*h,z=m*x-v*y,k=m*T-p*y,D=m*w-g*y,H=v*T-p*x,W=v*w-g*x,K=p*w-g*T,F=S*K-M*W+P*H+E*D-R*k+C*z;if(!F)return null;F=1/F,o[0]=(d*K-h*W+_*H)*F,o[1]=(h*D-f*K-_*k)*F,o[2]=(f*W-d*D+_*z)*F,o[3]=(u*W-l*K-c*H)*F,o[4]=(s*K-u*D+c*k)*F,o[5]=(l*D-s*W-c*z)*F,o[6]=(x*C-T*R+w*E)*F,o[7]=(T*P-y*C-w*M)*F,o[8]=(y*R-x*P+w*S)*F},t.rotate=function(r,e,n){var o=r.elements,s=n.elements,l=Math.sin(e),u=Math.cos(e),c=o[0],f=o[1],d=o[2],h=o[3],_=o[4],m=o[5],v=o[6],p=o[7],g=o[8];s[0]=u*c+l*h,s[1]=u*f+l*_,s[2]=u*d+l*m,s[3]=u*h-l*c,s[4]=u*_-l*f,s[5]=u*m-l*d,s[6]=v,s[7]=p,s[8]=g},t.scale=function(r,e,n){var o=e.x,s=e.y,l=r.elements,u=n.elements;u[0]=o*l[0],u[1]=o*l[1],u[2]=o*l[2],u[3]=s*l[3],u[4]=s*l[4],u[5]=s*l[5],u[6]=l[6],u[7]=l[7],u[8]=l[8]},t.translate=function(r,e,n){var o=e.x,s=e.y,l=r.elements,u=n.elements,c=l[0],f=l[1],d=l[2],h=l[3],_=l[4],m=l[5],v=l[6],p=l[7],g=l[8];u[0]=c,u[1]=f,u[2]=d,u[3]=h,u[4]=_,u[5]=m,u[6]=o*c+s*h+v,u[7]=o*f+s*_+p,u[8]=o*d+s*m+g},t.transpose=function(r,e){var n=r.elements,o=e.elements;if(e===r){var s=n[1],l=n[2],u=n[5];o[1]=n[3],o[2]=n[6],o[3]=s,o[5]=n[7],o[6]=l,o[7]=u}else o[0]=n[0],o[1]=n[3],o[2]=n[6],o[3]=n[1],o[4]=n[4],o[5]=n[7],o[6]=n[2],o[7]=n[5],o[8]=n[8]};function t(a,r,e,n,o,s,l,u,c){a===void 0&&(a=1),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=1),s===void 0&&(s=0),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=1),this.elements=new Float32Array(9);var f=this.elements;f[0]=a,f[1]=r,f[2]=e,f[3]=n,f[4]=o,f[5]=s,f[6]=l,f[7]=u,f[8]=c}var i=t.prototype;return i.setValue=function(r,e,n,o,s,l,u,c,f){var d=this.elements;return d[0]=r,d[1]=e,d[2]=n,d[3]=o,d[4]=s,d[5]=l,d[6]=u,d[7]=c,d[8]=f,this},i.setValueByArray=function(r,e){e===void 0&&(e=0);for(var n=this.elements,o=0;o<12;o++)n[o]=r[o+e];return this},i.setValueByMatrix=function(r){var e=r.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],this},i.toArray=function(r,e){e===void 0&&(e=0);var n=this.elements;r[e]=n[0],r[e+1]=n[1],r[e+2]=n[2],r[e+3]=n[3],r[e+4]=n[4],r[e+5]=n[5],r[e+6]=n[6],r[e+7]=n[7],r[e+8]=n[8]},i.clone=function(){var r=this.elements,e=new t(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8]);return e},i.cloneTo=function(r){var e=this.elements,n=r.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],r},i.add=function(r){return t.add(this,r,this),this},i.subtract=function(r){return t.subtract(this,r,this),this},i.multiply=function(r){return t.multiply(this,r,this),this},i.determinant=function(){var r=this.elements,e=r[0],n=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],d=r[8],h=d*l-u*f,_=-d*s+u*c,m=f*s-l*c;return e*h+n*_+o*m},i.identity=function(){var r=this.elements;return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,this},i.invert=function(){return t.invert(this,this),this},i.rotate=function(r){return t.rotate(this,r,this),this},i.scale=function(r){return t.scale(this,r,this),this},i.translate=function(r){return t.translate(this,r,this),this},i.transpose=function(){return t.transpose(this,this),this},t}(),pe=function(){t.add=function(r,e,n){n.x=r.x+e.x,n.y=r.y+e.y,n.z=r.z+e.z,n.w=r.w+e.w},t.multiply=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=r.w,c=e.x,f=e.y,d=e.z,h=e.w;n.x=o*h+u*c+s*d-l*f,n.y=s*h+u*f+l*c-o*d,n.z=l*h+u*d+o*f-s*c,n.w=u*h-o*c-s*f-l*d},t.conjugate=function(r,e){e.x=-r.x,e.y=-r.y,e.z=-r.z,e.w=r.w},t.dot=function(r,e){return r.x*e.x+r.y*e.y+r.z*e.z+r.w*e.w},t.equals=function(r,e){return O.equals(r.x,e.x)&&O.equals(r.y,e.y)&&O.equals(r.z,e.z)&&O.equals(r.w,e.w)},t.rotationAxisAngle=function(r,e,n){var o=t._tempVector3;A.normalize(r,o),e*=.5;var s=Math.sin(e);n.x=o.x*s,n.y=o.y*s,n.z=o.z*s,n.w=Math.cos(e)},t.rotationEuler=function(r,e,n,o){t.rotationYawPitchRoll(e,r,n,o)},t.rotationYawPitchRoll=function(r,e,n,o){var s=n*.5,l=e*.5,u=r*.5,c=Math.sin(s),f=Math.cos(s),d=Math.sin(l),h=Math.cos(l),_=Math.sin(u),m=Math.cos(u),v=m*h,p=_*d;o.x=m*d*f+_*h*c,o.y=_*h*f-m*d*c,o.z=v*c-p*f,o.w=v*f+p*c},t.rotationMatrix3x3=function(r,e){var n=r.elements,o=n[0],s=n[1],l=n[2],u=n[3],c=n[4],f=n[5],d=n[6],h=n[7],_=n[8],m=o+c+_,v,p;m>0?(v=Math.sqrt(m+1),e.w=v*.5,v=.5/v,e.x=(f-h)*v,e.y=(d-l)*v,e.z=(s-u)*v):o>=c&&o>=_?(v=Math.sqrt(1+o-c-_),p=.5/v,e.x=.5*v,e.y=(s+u)*p,e.z=(l+d)*p,e.w=(f-h)*p):c>_?(v=Math.sqrt(1+c-o-_),p=.5/v,e.x=(u+s)*p,e.y=.5*v,e.z=(h+f)*p,e.w=(d-l)*p):(v=Math.sqrt(1+_-o-c),p=.5/v,e.x=(l+d)*p,e.y=(f+h)*p,e.z=.5*v,e.w=(s-u)*p)},t.invert=function(r,e){var n=r.x,o=r.y,s=r.z,l=r.w,u=n*n+o*o+s*s+l*l;if(u>O.zeroTolerance){var c=1/u;e.x=-n*c,e.y=-o*c,e.z=-s*c,e.w=l*c}},t.lerp=function(r,e,n,o){var s=1-n;t.dot(r,e)>=0?(o.x=r.x*s+e.x*n,o.y=r.y*s+e.y*n,o.z=r.z*s+e.z*n,o.w=r.w*s+e.w*n):(o.x=r.x*s-e.x*n,o.y=r.y*s-e.y*n,o.z=r.z*s-e.z*n,o.w=r.w*s-e.w*n),o.normalize()},t.slerp=function(r,e,n,o){var s=r.x,l=r.y,u=r.z,c=r.w,f=e.x,d=e.y,h=e.z,_=e.w,m,v,p=s*f+l*d+u*h+c*_;if(p<0&&(p=-p,f=-f,d=-d,h=-h,_=-_),1-p>O.zeroTolerance){var g=Math.acos(p),y=Math.sin(g);m=Math.sin((1-n)*g)/y,v=Math.sin(n*g)/y}else m=1-n,v=n;o.x=m*s+v*f,o.y=m*l+v*d,o.z=m*u+v*h,o.w=m*c+v*_},t.normalize=function(r,e){var n=r.x,o=r.y,s=r.z,l=r.w,u=Math.sqrt(n*n+o*o+s*s+l*l);u>O.zeroTolerance&&(u=1/u,e.x=n*u,e.y=o*u,e.z=s*u,e.w=l*u)},t.rotationX=function(r,e){r*=.5;var n=Math.sin(r),o=Math.cos(r);e.x=n,e.y=0,e.z=0,e.w=o},t.rotationY=function(r,e){r*=.5;var n=Math.sin(r),o=Math.cos(r);e.x=0,e.y=n,e.z=0,e.w=o},t.rotationZ=function(r,e){r*=.5;var n=Math.sin(r),o=Math.cos(r);e.x=0,e.y=0,e.z=n,e.w=o},t.rotateX=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=r.w;e*=.5;var c=Math.sin(e),f=Math.cos(e);n.x=o*f+u*c,n.y=s*f+l*c,n.z=l*f-s*c,n.w=u*f-o*c},t.rotateY=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=r.w;e*=.5;var c=Math.sin(e),f=Math.cos(e);n.x=o*f-l*c,n.y=s*f+u*c,n.z=l*f+o*c,n.w=u*f-s*c},t.rotateZ=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=r.w;e*=.5;var c=Math.sin(e),f=Math.cos(e);n.x=o*f+s*c,n.y=s*f-o*c,n.z=l*f+u*c,n.w=u*f-l*c},t.scale=function(r,e,n){n.x=r.x*e,n.y=r.y*e,n.z=r.z*e,n.w=r.w*e};function t(a,r,e,n){a===void 0&&(a=0),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=1),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=a,this.y=r,this.z=e,this.w=n}var i=t.prototype;return i.setValue=function(r,e,n,o){return this.x=r,this.y=e,this.z=n,this.w=o,this},i.setValueByArray=function(r,e){return e===void 0&&(e=0),this.x=r[e],this.y=r[e+1],this.z=r[e+2],this.w=r[e+3],this},i.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},i.getAxisAngle=function(r){var e=this.x,n=this.y,o=this.z,s=e*e+n*n+o*o;if(s<O.zeroTolerance)return r.x=1,r.y=0,r.z=0,0;var l=1/s;return r.x=this.x*l,r.y=this.y*l,r.z=this.z*l,Math.acos(this.w)*2},i.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},i.length=function(){var r=this.x,e=this.y,n=this.z,o=this.w;return Math.sqrt(r*r+e*e+n*n+o*o)},i.lengthSquared=function(){var r=this.x,e=this.y,n=this.z,o=this.w;return r*r+e*e+n*n+o*o},i.normalize=function(){return t.normalize(this,this),this},i.toEuler=function(r){this.toYawPitchRoll(r);var e=r.x;return r.x=r.y,r.y=e,r},i.toYawPitchRoll=function(r){var e=this.x,n=this.y,o=this.z,s=this.w,l=e*e,u=n*n,c=o*o,f=e*n,d=o*s,h=o*e,_=n*s,m=n*o,v=e*s;return r.y=Math.asin(2*(v-m)),Math.cos(r.y)>O.zeroTolerance?(r.z=Math.atan2(2*(f+d),1-2*(c+l)),r.x=Math.atan2(2*(h+_),1-2*(u+l))):(r.z=Math.atan2(-2*(f-d),1-2*(u+c)),r.x=0),r},i.toArray=function(r,e){e===void 0&&(e=0),r[e]=this.x,r[e+1]=this.y,r[e+2]=this.z,r[e+3]=this.w},i.clone=function(){return new t(this.x,this.y,this.z,this.w)},i.cloneTo=function(r){return r.x=this.x,r.y=this.y,r.z=this.z,r.w=this.w,r},i.rotateX=function(r){return t.rotateX(this,r,this),this},i.rotateY=function(r){return t.rotateY(this,r,this),this},i.rotateZ=function(r){return t.rotateZ(this,r,this),this},i.rotationAxisAngle=function(r,e){return t.rotationAxisAngle(r,e,this),this},i.multiply=function(r){return t.multiply(this,r,this),this},i.invert=function(){return t.invert(this,this),this},i.dot=function(r){return t.dot(this,r)},i.lerp=function(r,e){return t.lerp(this,r,e,this),this},i.rotateAxisAngle=function(r,e){return t._tempQuat1.rotationAxisAngle(r,e),this.multiply(t._tempQuat1),this},t}();pe._tempVector3=new A;pe._tempQuat1=new pe;var Z=function(){t.multiply=function(r,e,n){var o=r.elements,s=e.elements,l=n.elements,u=o[0],c=o[1],f=o[2],d=o[3],h=o[4],_=o[5],m=o[6],v=o[7],p=o[8],g=o[9],y=o[10],x=o[11],T=o[12],w=o[13],S=o[14],M=o[15],P=s[0],E=s[1],R=s[2],C=s[3],z=s[4],k=s[5],D=s[6],H=s[7],W=s[8],K=s[9],F=s[10],te=s[11],B=s[12],V=s[13],j=s[14],re=s[15];l[0]=u*P+h*E+p*R+T*C,l[1]=c*P+_*E+g*R+w*C,l[2]=f*P+m*E+y*R+S*C,l[3]=d*P+v*E+x*R+M*C,l[4]=u*z+h*k+p*D+T*H,l[5]=c*z+_*k+g*D+w*H,l[6]=f*z+m*k+y*D+S*H,l[7]=d*z+v*k+x*D+M*H,l[8]=u*W+h*K+p*F+T*te,l[9]=c*W+_*K+g*F+w*te,l[10]=f*W+m*K+y*F+S*te,l[11]=d*W+v*K+x*F+M*te,l[12]=u*B+h*V+p*j+T*re,l[13]=c*B+_*V+g*j+w*re,l[14]=f*B+m*V+y*j+S*re,l[15]=d*B+v*V+x*j+M*re},t.equals=function(r,e){var n=r.elements,o=e.elements;return O.equals(n[0],o[0])&&O.equals(n[1],o[1])&&O.equals(n[2],o[2])&&O.equals(n[3],o[3])&&O.equals(n[4],o[4])&&O.equals(n[5],o[5])&&O.equals(n[6],o[6])&&O.equals(n[7],o[7])&&O.equals(n[8],o[8])&&O.equals(n[9],o[9])&&O.equals(n[10],o[10])&&O.equals(n[11],o[11])&&O.equals(n[12],o[12])&&O.equals(n[13],o[13])&&O.equals(n[14],o[14])&&O.equals(n[15],o[15])},t.lerp=function(r,e,n,o){var s=r.elements,l=e.elements,u=o.elements,c=1-n;u[0]=s[0]*c+l[0]*n,u[1]=s[1]*c+l[1]*n,u[2]=s[2]*c+l[2]*n,u[3]=s[3]*c+l[3]*n,u[4]=s[4]*c+l[4]*n,u[5]=s[5]*c+l[5]*n,u[6]=s[6]*c+l[6]*n,u[7]=s[7]*c+l[7]*n,u[8]=s[8]*c+l[8]*n,u[9]=s[9]*c+l[9]*n,u[10]=s[10]*c+l[10]*n,u[11]=s[11]*c+l[11]*n,u[12]=s[12]*c+l[12]*n,u[13]=s[13]*c+l[13]*n,u[14]=s[14]*c+l[14]*n,u[15]=s[15]*c+l[15]*n},t.rotationQuaternion=function(r,e){var n=e.elements,o=r.x,s=r.y,l=r.z,u=r.w,c=o+o,f=s+s,d=l+l,h=o*c,_=s*c,m=s*f,v=l*c,p=l*f,g=l*d,y=u*c,x=u*f,T=u*d;n[0]=1-m-g,n[1]=_+T,n[2]=v-x,n[3]=0,n[4]=_-T,n[5]=1-h-g,n[6]=p+y,n[7]=0,n[8]=v+x,n[9]=p-y,n[10]=1-h-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},t.rotationAxisAngle=function(r,e,n){var o=n.elements,s=r.x,l=r.y,u=r.z,c=Math.sqrt(s*s+l*l+u*u),f,d,h;Math.abs(c)<O.zeroTolerance||(c=1/c,s*=c,l*=c,u*=c,f=Math.sin(e),d=Math.cos(e),h=1-d,o[0]=s*s*h+d,o[1]=l*s*h+u*f,o[2]=u*s*h-l*f,o[3]=0,o[4]=s*l*h-u*f,o[5]=l*l*h+d,o[6]=u*l*h+s*f,o[7]=0,o[8]=s*u*h+l*f,o[9]=l*u*h-s*f,o[10]=u*u*h+d,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1)},t.rotationTranslation=function(r,e,n){t.rotationQuaternion(r,n);var o=n.elements;o[12]=e.x,o[13]=e.y,o[14]=e.z},t.affineTransformation=function(r,e,n,o){var s=o.elements,l=e.x,u=e.y,c=e.z,f=e.w,d=l+l,h=u+u,_=c+c,m=l*d,v=l*h,p=l*_,g=u*h,y=u*_,x=c*_,T=f*d,w=f*h,S=f*_,M=r.x,P=r.y,E=r.z;s[0]=(1-(g+x))*M,s[1]=(v+S)*M,s[2]=(p-w)*M,s[3]=0,s[4]=(v-S)*P,s[5]=(1-(m+x))*P,s[6]=(y+T)*P,s[7]=0,s[8]=(p+w)*E,s[9]=(y-T)*E,s[10]=(1-(m+g))*E,s[11]=0,s[12]=n.x,s[13]=n.y,s[14]=n.z,s[15]=1},t.scaling=function(r,e){var n=e.elements;n[0]=r.x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r.y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r.z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},t.translation=function(r,e){var n=e.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r.x,n[13]=r.y,n[14]=r.z,n[15]=1},t.invert=function(r,e){var n=r.elements,o=e.elements,s=n[0],l=n[1],u=n[2],c=n[3],f=n[4],d=n[5],h=n[6],_=n[7],m=n[8],v=n[9],p=n[10],g=n[11],y=n[12],x=n[13],T=n[14],w=n[15],S=s*d-l*f,M=s*h-u*f,P=s*_-c*f,E=l*h-u*d,R=l*_-c*d,C=u*_-c*h,z=m*x-v*y,k=m*T-p*y,D=m*w-g*y,H=v*T-p*x,W=v*w-g*x,K=p*w-g*T,F=S*K-M*W+P*H+E*D-R*k+C*z;if(!F)return null;F=1/F,o[0]=(d*K-h*W+_*H)*F,o[1]=(u*W-l*K-c*H)*F,o[2]=(x*C-T*R+w*E)*F,o[3]=(p*R-v*C-g*E)*F,o[4]=(h*D-f*K-_*k)*F,o[5]=(s*K-u*D+c*k)*F,o[6]=(T*P-y*C-w*M)*F,o[7]=(m*C-p*P+g*M)*F,o[8]=(f*W-d*D+_*z)*F,o[9]=(l*D-s*W-c*z)*F,o[10]=(y*R-x*P+w*S)*F,o[11]=(v*P-m*R-g*S)*F,o[12]=(d*k-f*H-h*z)*F,o[13]=(s*H-l*k+u*z)*F,o[14]=(x*M-y*E-T*S)*F,o[15]=(m*E-v*M+p*S)*F},t.lookAt=function(r,e,n,o){var s=o.elements,l=t._tempVec30,u=t._tempVec31,c=t._tempVec32;A.subtract(r,e,c),c.normalize(),A.cross(n,c,l),l.normalize(),A.cross(c,l,u),s[0]=l.x,s[1]=u.x,s[2]=c.x,s[3]=0,s[4]=l.y,s[5]=u.y,s[6]=c.y,s[7]=0,s[8]=l.z,s[9]=u.z,s[10]=c.z,s[11]=0,s[12]=-A.dot(l,r),s[13]=-A.dot(u,r),s[14]=-A.dot(c,r),s[15]=1},t.ortho=function(r,e,n,o,s,l,u){var c=u.elements,f=1/(r-e),d=1/(n-o),h=1/(s-l);c[0]=-2*f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*d,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*h,c[11]=0,c[12]=(r+e)*f,c[13]=(o+n)*d,c[14]=(l+s)*h,c[15]=1},t.perspective=function(r,e,n,o,s){var l=s.elements,u=1/Math.tan(r/2),c=1/(n-o);l[0]=u/e,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=u,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=(o+n)*c,l[11]=-1,l[12]=0,l[13]=0,l[14]=2*o*n*c,l[15]=0},t.rotateAxisAngle=function(r,e,n,o){var s=e.x,l=e.y,u=e.z,c=Math.sqrt(s*s+l*l+u*u);if(!(Math.abs(c)<O.zeroTolerance)){var f=r.elements,d=o.elements,h,_,m;c=1/c,s*=c,l*=c,u*=c,h=Math.sin(n),_=Math.cos(n),m=1-_;var v=f[0],p=f[1],g=f[2],y=f[3],x=f[4],T=f[5],w=f[6],S=f[7],M=f[8],P=f[9],E=f[10],R=f[11],C=s*s*m+_,z=l*s*m+u*h,k=u*s*m-l*h,D=s*l*m-u*h,H=l*l*m+_,W=u*l*m+s*h,K=s*u*m+l*h,F=l*u*m-s*h,te=u*u*m+_;d[0]=v*C+x*z+M*k,d[1]=p*C+T*z+P*k,d[2]=g*C+w*z+E*k,d[3]=y*C+S*z+R*k,d[4]=v*D+x*H+M*W,d[5]=p*D+T*H+P*W,d[6]=g*D+w*H+E*W,d[7]=y*D+S*H+R*W,d[8]=v*K+x*F+M*te,d[9]=p*K+T*F+P*te,d[10]=g*K+w*F+E*te,d[11]=y*K+S*F+R*te,r!==o&&(d[12]=f[12],d[13]=f[13],d[14]=f[14],d[15]=f[15])}},t.scale=function(r,e,n){var o=r.elements,s=n.elements,l=e.x,u=e.y,c=e.z;s[0]=o[0]*l,s[1]=o[1]*l,s[2]=o[2]*l,s[3]=o[3]*l,s[4]=o[4]*u,s[5]=o[5]*u,s[6]=o[6]*u,s[7]=o[7]*u,s[8]=o[8]*c,s[9]=o[9]*c,s[10]=o[10]*c,s[11]=o[11]*c,s[12]=o[12],s[13]=o[13],s[14]=o[14],s[15]=o[15]},t.translate=function(r,e,n){var o=r.elements,s=n.elements,l=e.x,u=e.y,c=e.z;if(r===n)s[12]=o[0]*l+o[4]*u+o[8]*c+o[12],s[13]=o[1]*l+o[5]*u+o[9]*c+o[13],s[14]=o[2]*l+o[6]*u+o[10]*c+o[14],s[15]=o[3]*l+o[7]*u+o[11]*c+o[15];else{var f=o[0],d=o[1],h=o[2],_=o[3],m=o[4],v=o[5],p=o[6],g=o[7],y=o[8],x=o[9],T=o[10],w=o[11];s[0]=f,s[1]=d,s[2]=h,s[3]=_,s[4]=m,s[5]=v,s[6]=p,s[7]=g,s[8]=y,s[9]=x,s[10]=T,s[11]=w,s[12]=f*l+m*u+y*c+o[12],s[13]=d*l+v*u+x*c+o[13],s[14]=h*l+p*u+T*c+o[14],s[15]=_*l+g*u+w*c+o[15]}},t.transpose=function(r,e){var n=r.elements,o=e.elements;if(e===r){var s=n[1],l=n[2],u=n[3],c=n[6],f=n[7],d=n[11];o[1]=n[4],o[2]=n[8],o[3]=n[12],o[4]=s,o[6]=n[9],o[7]=n[13],o[8]=l,o[9]=c,o[11]=n[14],o[12]=u,o[13]=f,o[14]=d}else o[0]=n[0],o[1]=n[4],o[2]=n[8],o[3]=n[12],o[4]=n[1],o[5]=n[5],o[6]=n[9],o[7]=n[13],o[8]=n[2],o[9]=n[6],o[10]=n[10],o[11]=n[14],o[12]=n[3],o[13]=n[7],o[14]=n[11],o[15]=n[15]};function t(a,r,e,n,o,s,l,u,c,f,d,h,_,m,v,p){a===void 0&&(a=1),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=1),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=0),f===void 0&&(f=0),d===void 0&&(d=1),h===void 0&&(h=0),_===void 0&&(_=0),m===void 0&&(m=0),v===void 0&&(v=0),p===void 0&&(p=1),this.elements=new Float32Array(16);var g=this.elements;g[0]=a,g[1]=r,g[2]=e,g[3]=n,g[4]=o,g[5]=s,g[6]=l,g[7]=u,g[8]=c,g[9]=f,g[10]=d,g[11]=h,g[12]=_,g[13]=m,g[14]=v,g[15]=p}var i=t.prototype;return i.setValue=function(r,e,n,o,s,l,u,c,f,d,h,_,m,v,p,g){var y=this.elements;return y[0]=r,y[1]=e,y[2]=n,y[3]=o,y[4]=s,y[5]=l,y[6]=u,y[7]=c,y[8]=f,y[9]=d,y[10]=h,y[11]=_,y[12]=m,y[13]=v,y[14]=p,y[15]=g,this},i.setValueByArray=function(r,e){e===void 0&&(e=0);for(var n=this.elements,o=0;o<16;o++)n[o]=r[o+e];return this},i.toArray=function(r,e){e===void 0&&(e=0);var n=this.elements;r[e]=n[0],r[e+1]=n[1],r[e+2]=n[2],r[e+3]=n[3],r[e+4]=n[4],r[e+5]=n[5],r[e+6]=n[6],r[e+7]=n[7],r[e+8]=n[8],r[e+9]=n[9],r[e+10]=n[10],r[e+11]=n[11],r[e+12]=n[12],r[e+13]=n[13],r[e+14]=n[14],r[e+15]=n[15]},i.clone=function(){var r=this.elements,e=new t(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]);return e},i.cloneTo=function(r){var e=this.elements,n=r.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],r},i.multiply=function(r){return t.multiply(this,r,this),this},i.determinant=function(){var r=this.elements,e=r[0],n=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],d=r[8],h=r[9],_=r[10],m=r[11],v=r[12],p=r[13],g=r[14],y=r[15],x=e*u-n*l,T=e*c-o*l,w=e*f-s*l,S=n*c-o*u,M=n*f-s*u,P=o*f-s*c,E=d*p-h*v,R=d*g-_*v,C=d*y-m*v,z=h*g-_*p,k=h*y-m*p,D=_*y-m*g;return x*D-T*k+w*z+S*C-M*R+P*E},i.decompose=function(r,e,n){var o=t._tempMat30,s=this.elements,l=o.elements,u=s[0],c=s[1],f=s[2],d=s[3],h=s[4],_=s[5],m=s[6],v=s[7],p=s[8],g=s[9],y=s[10],x=s[11];r.x=s[12],r.y=s[13],r.z=s[14];var T=Math.sign(u*c*f*d)<0?-1:1,w=Math.sign(h*_*m*v)<0?-1:1,S=Math.sign(p*g*y*x)<0?-1:1,M=T*Math.sqrt(u*u+c*c+f*f),P=w*Math.sqrt(h*h+_*_+m*m),E=S*Math.sqrt(p*p+g*g+y*y);if(n.x=M,n.y=P,n.z=E,Math.abs(M)<O.zeroTolerance||Math.abs(P)<O.zeroTolerance||Math.abs(E)<O.zeroTolerance)return e.identity(),!1;var R=1/M,C=1/P,z=1/E;return l[0]=u*R,l[1]=c*R,l[2]=f*R,l[3]=h*C,l[4]=_*C,l[5]=m*C,l[6]=p*z,l[7]=g*z,l[8]=y*z,pe.rotationMatrix3x3(o,e),!0},i.getRotation=function(r){var e=this.elements,n=e[0]+e[5]+e[10];if(n>O.zeroTolerance){var o=Math.sqrt(n+1)*2;r.w=.25*o,r.x=(e[6]-e[9])/o,r.y=(e[8]-e[2])/o,r.z=(e[1]-e[4])/o}else if(e[0]>e[5]&&e[0]>e[10]){var s=Math.sqrt(1+e[0]-e[5]-e[10])*2;r.w=(e[6]-e[9])/s,r.x=.25*s,r.y=(e[1]+e[4])/s,r.z=(e[8]+e[2])/s}else if(e[5]>e[10]){var l=Math.sqrt(1+e[5]-e[0]-e[10])*2;r.w=(e[8]-e[2])/l,r.x=(e[1]+e[4])/l,r.y=.25*l,r.z=(e[6]+e[9])/l}else{var u=Math.sqrt(1+e[10]-e[0]-e[5])*2;r.w=(e[1]-e[4])/u,r.x=(e[8]+e[2])/u,r.y=(e[6]+e[9])/u,r.z=.25*u}return r},i.getScaling=function(r){var e=this.elements,n=e[0],o=e[1],s=e[2],l=e[4],u=e[5],c=e[6],f=e[8],d=e[9],h=e[10];return r.x=Math.sqrt(n*n+o*o+s*s),r.y=Math.sqrt(l*l+u*u+c*c),r.z=Math.sqrt(f*f+d*d+h*h),r},i.getTranslation=function(r){var e=this.elements;return r.x=e[12],r.y=e[13],r.z=e[14],r},i.identity=function(){var r=this.elements;return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},i.invert=function(){return t.invert(this,this),this},i.rotateAxisAngle=function(r,e){return t.rotateAxisAngle(this,r,e,this),this},i.scale=function(r){return t.scale(this,r,this),this},i.translate=function(r){return t.translate(this,r,this),this},i.transpose=function(){return t.transpose(this,this),this},t}();Z._tempVec30=new A;Z._tempVec31=new A;Z._tempVec32=new A;Z._tempMat30=new Bi;Z._identity=new Z(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);var Vm=function(){function t(a,r){a===void 0&&(a=null),r===void 0&&(r=null),this.origin=new A,this.direction=new A,a&&a.cloneTo(this.origin),r&&r.cloneTo(this.direction)}var i=t.prototype;return i.intersectPlane=function(r){return Gn.intersectsRayAndPlane(this,r)},i.intersectSphere=function(r){return Gn.intersectsRayAndSphere(this,r)},i.intersectBox=function(r){return Gn.intersectsRayAndBox(this,r)},i.getPoint=function(r,e){return A.scale(this.direction,r,e),e.add(this.origin)},t}(),G=function(){t.add=function(r,e,n){n.x=r.x+e.x,n.y=r.y+e.y},t.subtract=function(r,e,n){n.x=r.x-e.x,n.y=r.y-e.y},t.multiply=function(r,e,n){n.x=r.x*e.x,n.y=r.y*e.y},t.divide=function(r,e,n){n.x=r.x/e.x,n.y=r.y/e.y},t.dot=function(r,e){return r.x*e.x+r.y*e.y},t.distance=function(r,e){var n=e.x-r.x,o=e.y-r.y;return Math.sqrt(n*n+o*o)},t.distanceSquared=function(r,e){var n=e.x-r.x,o=e.y-r.y;return n*n+o*o},t.equals=function(r,e){return O.equals(r.x,e.x)&&O.equals(r.y,e.y)},t.lerp=function(r,e,n,o){var s=r.x,l=r.y;o.x=s+(e.x-s)*n,o.y=l+(e.y-l)*n},t.max=function(r,e,n){n.x=Math.max(r.x,e.x),n.y=Math.max(r.y,e.y)},t.min=function(r,e,n){n.x=Math.min(r.x,e.x),n.y=Math.min(r.y,e.y)},t.negate=function(r,e){e.x=-r.x,e.y=-r.y},t.normalize=function(r,e){var n=r.x,o=r.y,s=Math.sqrt(n*n+o*o);s>O.zeroTolerance&&(s=1/s,e.x=n*s,e.y=o*s)},t.scale=function(r,e,n){n.x=r.x*e,n.y=r.y*e};function t(a,r){a===void 0&&(a=0),r===void 0&&(r=0),this.x=void 0,this.y=void 0,this.x=a,this.y=r}var i=t.prototype;return i.setValue=function(r,e){return this.x=r,this.y=e,this},i.setValueByArray=function(r,e){return e===void 0&&(e=0),this.x=r[e],this.y=r[e+1],this},i.add=function(r){return this.x+=r.x,this.y+=r.y,this},i.subtract=function(r){return this.x-=r.x,this.y-=r.y,this},i.multiply=function(r){return this.x*=r.x,this.y*=r.y,this},i.divide=function(r){return this.x/=r.x,this.y/=r.y,this},i.length=function(){var r=this.x,e=this.y;return Math.sqrt(r*r+e*e)},i.lengthSquared=function(){var r=this.x,e=this.y;return r*r+e*e},i.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.normalize=function(){return t.normalize(this,this),this},i.scale=function(r){return this.x*=r,this.y*=r,this},i.toArray=function(r,e){e===void 0&&(e=0),r[e]=this.x,r[e+1]=this.y},i.clone=function(){return new t(this.x,this.y)},i.cloneTo=function(r){return r.x=this.x,r.y=this.y,r},t}();G._zero=new G(0,0);G._one=new G(1,1);var Ee=function(){t.add=function(r,e,n){n.x=r.x+e.x,n.y=r.y+e.y,n.z=r.z+e.z,n.w=r.w+e.w},t.subtract=function(r,e,n){n.x=r.x-e.x,n.y=r.y-e.y,n.z=r.z-e.z,n.w=r.w-e.w},t.multiply=function(r,e,n){n.x=r.x*e.x,n.y=r.y*e.y,n.z=r.z*e.z,n.w=r.w*e.w},t.divide=function(r,e,n){n.x=r.x/e.x,n.y=r.y/e.y,n.z=r.z/e.z,n.w=r.w/e.w},t.dot=function(r,e){return r.x*e.x+r.y*e.y+r.z*e.z+r.w*e.w},t.distance=function(r,e){var n=e.x-r.x,o=e.y-r.y,s=e.z-r.z,l=e.w-r.w;return Math.sqrt(n*n+o*o+s*s+l*l)},t.distanceSquared=function(r,e){var n=e.x-r.x,o=e.y-r.y,s=e.z-r.z,l=e.w-r.w;return n*n+o*o+s*s+l*l},t.equals=function(r,e){return O.equals(r.x,e.x)&&O.equals(r.y,e.y)&&O.equals(r.z,e.z)&&O.equals(r.w,e.w)},t.lerp=function(r,e,n,o){var s=r.x,l=r.y,u=r.z,c=r.w;o.x=s+(e.x-s)*n,o.y=l+(e.y-l)*n,o.z=u+(e.z-u)*n,o.w=c+(e.w-c)*n},t.max=function(r,e,n){n.x=Math.max(r.x,e.x),n.y=Math.max(r.y,e.y),n.z=Math.max(r.z,e.z),n.w=Math.max(r.w,e.w)},t.min=function(r,e,n){n.x=Math.min(r.x,e.x),n.y=Math.min(r.y,e.y),n.z=Math.min(r.z,e.z),n.w=Math.min(r.w,e.w)},t.negate=function(r,e){e.x=-r.x,e.y=-r.y,e.z=-r.z,e.w=-r.w},t.normalize=function(r,e){var n=r.x,o=r.y,s=r.z,l=r.w,u=Math.sqrt(n*n+o*o+s*s+l*l);u>O.zeroTolerance&&(u=1/u,e.x=n*u,e.y=o*u,e.z=s*u,e.w=l*u)},t.scale=function(r,e,n){n.x=r.x*e,n.y=r.y*e,n.z=r.z*e,n.w=r.w*e},t.transform=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=r.w,c=e.elements;n.x=o*c[0]+s*c[4]+l*c[8]+u*c[12],n.y=o*c[1]+s*c[5]+l*c[9]+u*c[13],n.z=o*c[2]+s*c[6]+l*c[10]+u*c[14],n.w=o*c[3]+s*c[7]+l*c[11]+u*c[15]},t.transformByQuat=function(r,e,n){var o=r.x,s=r.y,l=r.z,u=r.w,c=e.x,f=e.y,d=e.z,h=e.w,_=h*o+f*l-d*s,m=h*s+d*o-c*l,v=h*l+c*s-f*o,p=-c*o-f*s-d*l;n.x=_*h-p*c-m*d+v*f,n.y=m*h-p*f-v*c+_*d,n.z=v*h-p*d-_*f+m*c,n.w=u};function t(a,r,e,n){a===void 0&&(a=0),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=a,this.y=r,this.z=e,this.w=n}var i=t.prototype;return i.setValue=function(r,e,n,o){return this.x=r,this.y=e,this.z=n,this.w=o,this},i.setValueByArray=function(r,e){return e===void 0&&(e=0),this.x=r[e],this.y=r[e+1],this.z=r[e+2],this.w=r[e+3],this},i.add=function(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this},i.subtract=function(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this.w-=r.w,this},i.multiply=function(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this.w*=r.w,this},i.divide=function(r){return this.x/=r.x,this.y/=r.y,this.z/=r.z,this.w/=r.w,this},i.length=function(){var r=this.x,e=this.y,n=this.z,o=this.w;return Math.sqrt(r*r+e*e+n*n+o*o)},i.lengthSquared=function(){var r=this.x,e=this.y,n=this.z,o=this.w;return r*r+e*e+n*n+o*o},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},i.normalize=function(){return t.normalize(this,this),this},i.scale=function(r){return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this},i.toArray=function(r,e){e===void 0&&(e=0),r[e]=this.x,r[e+1]=this.y,r[e+2]=this.z,r[e+3]=this.w},i.clone=function(){var r=new t(this.x,this.y,this.z,this.w);return r},i.cloneTo=function(r){return r.x=this.x,r.y=this.y,r.z=this.z,r.w=this.w,r},t}();Ee._zero=new Ee(0,0,0,0);Ee._one=new Ee(1,1,1,1);var ge=function(){t.gammaToLinearSpace=function(r){return r<=0?0:r<=.04045?r/12.92:r<1?Math.pow((r+.055)/1.055,2.4):Math.pow(r,2.4)},t.linearToGammaSpace=function(r){return r<=0?0:r<.0031308?12.92*r:r<1?1.055*Math.pow(r,.41666)-.055:Math.pow(r,.41666)},t.equals=function(r,e){return O.equals(r.r,e.r)&&O.equals(r.g,e.g)&&O.equals(r.b,e.b)&&O.equals(r.a,e.a)},t.add=function(r,e,n){return n.r=r.r+e.r,n.g=r.g+e.g,n.b=r.b+e.b,n.a=r.a+e.a,n},t.scale=function(r,e,n){return n.r=r.r*e,n.g=r.g*e,n.b=r.b*e,n.a=r.a*e,n};function t(a,r,e,n){a===void 0&&(a=1),r===void 0&&(r=1),e===void 0&&(e=1),n===void 0&&(n=1),this.r=void 0,this.g=void 0,this.b=void 0,this.a=void 0,this.r=a,this.g=r,this.b=e,this.a=n}var i=t.prototype;return i.setValue=function(r,e,n,o){return this.r=r,this.g=e,this.b=n,this.a=o,this},i.add=function(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this.a+=r.a,this},i.scale=function(r){return this.r*=r,this.g*=r,this.b*=r,this.a*=r,this},i.clone=function(){var r=new t(this.r,this.g,this.b,this.a);return r},i.cloneTo=function(r){return r.r=this.r,r.g=this.g,r.b=this.b,r.a=this.a,r},i.toLinear=function(r){return r.r=t.gammaToLinearSpace(this.r),r.g=t.gammaToLinearSpace(this.g),r.b=t.gammaToLinearSpace(this.b),r},i.toGamma=function(r){return r.r=t.linearToGammaSpace(this.r),r.g=t.linearToGammaSpace(this.g),r.b=t.linearToGammaSpace(this.b),r},t}(),oc=function(){function t(a,r,e,n){a===void 0&&(a=0),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.x=a,this.y=r,this.width=e,this.height=n}var i=t.prototype;return i.setValue=function(r,e,n,o){return this.x=r,this.y=e,this.width=n,this.height=o,this},i.clone=function(){return new t(this.x,this.y,this.width,this.height)},i.cloneTo=function(r){return r.x=this.x,r.y=this.y,r.width=this.width,r.height=this.height,r},t}(),Gm=function(){function t(){this.coefficients=new Float32Array(27)}var i=t.prototype;return i.addLight=function(r,e,n){e.scale(n);var o=this.coefficients,s=r.x,l=r.y,u=r.z,c=e.r,f=e.g,d=e.b,h=.282095,_=-.488603*l,m=.488603*u,v=-.488603*s,p=1.092548*(s*l),g=-1.092548*(l*u),y=.315392*(3*u*u-1),x=-1.092548*(s*u),T=.546274*(s*s-l*l);o[0]+=c*h,o[1]+=f*h,o[2]+=d*h,o[3]+=c*_,o[4]+=f*_,o[5]+=d*_,o[6]+=c*m,o[7]+=f*m,o[8]+=d*m,o[9]+=c*v,o[10]+=f*v,o[11]+=d*v,o[12]+=c*p,o[13]+=f*p,o[14]+=d*p,o[15]+=c*g,o[16]+=f*g,o[17]+=d*g,o[18]+=c*y,o[19]+=f*y,o[20]+=d*y,o[21]+=c*x,o[22]+=f*x,o[23]+=d*x,o[24]+=c*T,o[25]+=f*T,o[26]+=d*T},i.evaluate=function(r,e){var n=this.coefficients,o=r.x,s=r.y,l=r.z,u=.886227,c=-1.023327*s,f=1.023327*l,d=-1.023327*o,h=.858086*s*o,_=-.858086*s*l,m=.247708*(3*l*l-1),v=-.858086*l*o,p=.429042*(o*o-s*s),g=n[0]*u,y=n[1]*u,x=n[2]*u;return g+=n[3]*c+n[6]*f+n[9]*d,y+=n[4]*c+n[7]*f+n[10]*d,x+=n[5]*c+n[8]*f+n[11]*d,g+=n[12]*h+n[15]*_+n[18]*m+n[21]*v+n[24]*p,y+=n[13]*h+n[16]*_+n[19]*m+n[22]*v+n[25]*p,x+=n[14]*h+n[17]*_+n[20]*m+n[23]*v+n[26]*p,e.setValue(g,y,x,1),e},i.scale=function(r){var e=this.coefficients;e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=r,e[5]*=r,e[6]*=r,e[7]*=r,e[8]*=r,e[9]*=r,e[10]*=r,e[11]*=r,e[12]*=r,e[13]*=r,e[14]*=r,e[15]*=r,e[16]*=r,e[17]*=r,e[18]*=r,e[19]*=r,e[20]*=r,e[21]*=r,e[22]*=r,e[23]*=r,e[24]*=r,e[25]*=r,e[26]*=r},i.setValueByArray=function(r,e){e===void 0&&(e=0);var n=this.coefficients;n[0]=r[e],n[1]=r[1+e],n[2]=r[2+e],n[3]=r[3+e],n[4]=r[4+e],n[5]=r[5+e],n[6]=r[6+e],n[7]=r[7+e],n[8]=r[8+e],n[9]=r[9+e],n[10]=r[10+e],n[11]=r[11+e],n[12]=r[12+e],n[13]=r[13+e],n[14]=r[14+e],n[15]=r[15+e],n[16]=r[16+e],n[17]=r[17+e],n[18]=r[18+e],n[19]=r[19+e],n[20]=r[20+e],n[21]=r[21+e],n[22]=r[22+e],n[23]=r[23+e],n[24]=r[24+e],n[25]=r[25+e],n[26]=r[26+e]},i.toArray=function(r,e){e===void 0&&(e=0);var n=this.coefficients;r[0+e]=n[0],r[1+e]=n[1],r[2+e]=n[2],r[3+e]=n[3],r[4+e]=n[4],r[5+e]=n[5],r[6+e]=n[6],r[7+e]=n[7],r[8+e]=n[8],r[9+e]=n[9],r[10+e]=n[10],r[11+e]=n[11],r[12+e]=n[12],r[13+e]=n[13],r[14+e]=n[14],r[15+e]=n[15],r[16+e]=n[16],r[17+e]=n[17],r[18+e]=n[18],r[19+e]=n[19],r[20+e]=n[20],r[21+e]=n[21],r[22+e]=n[22],r[23+e]=n[23],r[24+e]=n[24],r[25+e]=n[25],r[26+e]=n[26]},i.clone=function(){var r=new t;return this.cloneTo(r),r},i.cloneTo=function(r){this.toArray(r.coefficients)},t}();function qh(t,i){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);i&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function Qh(t){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?qh(Object(a),!0).forEach(function(r){Hm(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):qh(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Yh(t,i){for(var a=0;a<i.length;a++){var r=i[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $(t,i,a){return i&&Yh(t.prototype,i),a&&Yh(t,a),t}function Hm(t,i,a){return i in t?Object.defineProperty(t,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[i]=a,t}function Ha(){return Ha=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},Ha.apply(this,arguments)}function Y(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,Wa(t,i)}function sc(t){return sc=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},sc(t)}function Wa(t,i){return Wa=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},Wa(t,i)}function Wm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function bs(t,i,a){return Wm()?bs=Reflect.construct:bs=function(e,n,o){var s=[null];s.push.apply(s,n);var l=Function.bind.apply(e,s),u=new l;return o&&Wa(u,o.prototype),u},bs.apply(null,arguments)}function jm(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function lc(t){var i=typeof Map=="function"?new Map:void 0;return lc=function(r){if(r===null||!jm(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(r))return i.get(r);i.set(r,e)}function e(){return bs(r,arguments,sc(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Wa(e,r)},lc(t)}function L(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xm(t,i){if(!!t){if(typeof t=="string")return $h(t,i);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return $h(t,i)}}function $h(t,i){(i==null||i>t.length)&&(i=t.length);for(var a=0,r=new Array(i);a<i;a++)r[a]=t[a];return r}function Km(t,i){var a=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(a)return(a=a.call(t)).next.bind(a);if(Array.isArray(t)||(a=Xm(t))||i&&t&&typeof t.length=="number"){a&&(t=a);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I(t,i,a,r){!a||Object.defineProperty(t,i,{enumerable:a.enumerable,configurable:a.configurable,writable:a.writable,value:a.initializer?a.initializer.call(r):void 0})}function N(t,i,a,r,e){var n={};return Object.keys(r).forEach(function(o){n[o]=r[o]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(o,s){return s(t,i,o)||o},n),e&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(e):void 0,n.initializer=void 0),n.initializer===void 0&&(Object.defineProperty(t,i,n),n=null),n}var Li;(function(t){t[t.Success=0]="Success",t[t.Pending=1]="Pending",t[t.Failed=2]="Failed"})(Li||(Li={}));var Ut=function(t){Y(a,t),a.all=function(e){return new a(function(n,o,s){if(!Array.isArray(e))return n([e]);var l=0,u=e.length,c=new Array(u);e.forEach(function(f,d){Promise.resolve(f).then(function(h){c[d]=h,l+=1,s(l/u),l==u&&n(c)}).catch(function(h){return o(h)})})})};var i=a.prototype;i.onProgress=function(e){return this._listeners.add(e),this},i.cancel=function(){return this._status!==Li.Pending?this:(this._reject("Promise Canceled"),this)};function a(r){var e,n,o=function(l){if(!(l<=e._progress)){e._progress=l;for(var u=Km(e._listeners),c;!(c=u()).done;){var f=c.value;f(l)}}};return e=t.call(this,function(s,l){n=function(c){Promise.resolve().then(function(){e._status=Li.Failed,l(c)})},r(function(u){Promise.resolve().then(function(){o(1),e._status=Li.Success,s(u)})},n,function(u){Promise.resolve().then(function(){o(u)})})})||this,e._status=void 0,e._progress=void 0,e._reject=void 0,e._listeners=void 0,e._reject=n,e._listeners=new Set,e._progress=0,e._status=Li.Pending,e}return $(a,[{key:"status",get:function(){return this._status}},{key:"progress",get:function(){return this._progress}}]),a}(lc(Promise));function qm(t,i){var a=t.indexOf(i);if(a<0)return!1;var r=t.length-1;if(a!==r){var e=t[r];t[a]=e}return t.length--,!0}function ja(t){return Object.keys(t).map(function(i){return t[i]})}var Cs=function(){t._addLoader=function(r,e,n){this._loaders[r]=e;for(var o=0,s=n.length;o<s;o++)this._extTypeMapping[n[o]]=r},t._getTypeByUrl=function(r){var e=r.split("?")[0];return this._extTypeMapping[e.substring(e.lastIndexOf(".")+1)]};function t(a){this.engine=a,this.retryCount=1,this.retryInterval=0,this.timeout=2e4,this._assetPool=Object.create(null),this._assetUrlPool=Object.create(null),this._refObjectPool=Object.create(null),this._loadingPromises={}}var i=t.prototype;return i.load=function(r){var e=this;if(!Array.isArray(r))return this._loadSingleItem(r);var n=r.map(function(o){return e._loadSingleItem(o)});return Ut.all(n)},i.cancelNotLoaded=function(r){var e=this;if(!r)ja(this._loadingPromises).forEach(function(o){o.cancel()});else if(typeof r=="string"){var n;(n=this._loadingPromises[r])===null||n===void 0||n.cancel()}else r.forEach(function(o){var s;(s=e._loadingPromises[o])===null||s===void 0||s.cancel()})},i.gc=function(){for(var r=ja(this._refObjectPool),e=0,n=r.length;e<n;e++)r[e].isGCIgnored||r[e].destroy()},i.getAssetPath=function(r){return this._assetPool[r]},i._addAsset=function(r,e){this._assetPool[e.instanceId]=r,this._assetUrlPool[r]=e},i._deleteAsset=function(r){var e=r.instanceId,n=this._assetPool[e];n&&(delete this._assetPool[e],delete this._assetUrlPool[n])},i._addRefObject=function(r,e){this._refObjectPool[r]=e},i._deleteRefObject=function(r){delete this._refObjectPool[r]},i._assignDefaultOptions=function(r){var e,n,o,s,l;if(r.type=(e=r.type)!=null?e:t._getTypeByUrl(r.url),r.type===void 0)throw"asset type should be specified: "+r.url;return r.retryCount=(n=r.retryCount)!=null?n:this.retryCount,r.timeout=(o=r.timeout)!=null?o:this.timeout,r.retryInterval=(s=r.retryInterval)!=null?s:this.retryInterval,r.url=(l=r.url)!=null?l:r.urls.join(","),r},i._loadSingleItem=function(r){var e=this,n=this._assignDefaultOptions(typeof r=="string"?{url:r}:r),o=n.url;if(this._assetUrlPool[o])return new Ut(function(u){u(e._assetUrlPool[o])});if(this._loadingPromises[o])return this._loadingPromises[n.url];var s=t._loaders[n.type],l=s.load(n,this);return this._loadingPromises[o]=l,l.then(function(u){s.useCache&&e._addAsset(o,u),delete e._loadingPromises[o]}).catch(function(){}),l},t}();Cs._loaders={};Cs._extTypeMapping={};function cn(t,i,a){return a===void 0&&(a=!0),function(r){var e=new r(a);Cs._addLoader(t,e,i)}}var Zh=function(){function t(a,r,e,n){r===void 0&&(r=null),e===void 0&&(e={}),n===void 0&&(n=!0),this.data=void 0,this._timeStamp=void 0,this._target=void 0,this._currentTarget=void 0,this._bubbles=void 0,this._propagationStopped=void 0,this._type=void 0,this._timeStamp=new Date().getTime(),this._target=r,this.data=e,this._currentTarget=null,this._bubbles=n,this._propagationStopped=!1,this._type=a}var i=t.prototype;return i.stopPropagation=function(){this._propagationStopped=!0},$(t,[{key:"propagationStopped",get:function(){return this._propagationStopped}},{key:"target",get:function(){return this._target},set:function(r){this._target=r}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"currentTarget",get:function(){return this._currentTarget},set:function(r){this._currentTarget=r}},{key:"bubbles",get:function(){return this._bubbles}},{key:"type",get:function(){return this._type}}]),t}(),zr;(function(t){t[t.Ignore=0]="Ignore",t[t.Assignment=1]="Assignment",t[t.Shallow=2]="Shallow",t[t.Deep=3]="Deep"})(zr||(zr={}));function J(t,i){Zt.registerCloneMode(t,i,zr.Ignore)}function kt(t,i){Zt.registerCloneMode(t,i,zr.Assignment)}function Qm(t,i){Zt.registerCloneMode(t,i,zr.Shallow)}function ze(t,i){Zt.registerCloneMode(t,i,zr.Deep)}var Zt=function(){function t(){}return t.registerCloneMode=function(a,r,e){var n=t._subCloneModeMap.get(a.constructor);n||(n=Object.create(null),t._subCloneModeMap.set(a.constructor,n)),n[r]=e},t.getCloneMode=function(a){var r=t._cloneModeMap.get(a);if(!r){r=Object.create(null),t._cloneModeMap.set(a,r);for(var e=t._objectType,n=t._subCloneModeMap;a!==e;){var o=n.get(a);o&&Ha(r,o),a=Object.getPrototypeOf(a)}}return r},t.deepCloneObject=function(a,r){var e=a.constructor;switch(e){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:r.set(a);break;case Array:for(var n=0,o=a.length;n<o;n++)t._deepCloneObjectItem(a,r,n);break;default:var s=a;if(s.clone&&s.cloneTo)s.cloneTo(r);else for(var l=Object.keys(a),u=0,c=l.length;u<c;u++)t._deepCloneObjectItem(a,r,l[u])}},t._deepCloneObjectItem=function(a,r,e){var n=a[e];if(n instanceof Object){var o=n.constructor;switch(o){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:var s=n,l=r[e];l==null?r[e]=s.slice():l.set(s);break;case Array:var u=n,c=r[e];c==null?r[e]=new Array(u.length):c.length=u.length,t.deepCloneObject(u,c);break;default:if(n.clone&&n.cloneTo){var f=n,d=r[e];d?f.cloneTo(d):r[e]=f.clone()}else{var h=r[e];h==null&&(r[e]=h=new n.constructor),t.deepCloneObject(n,h);break}}}else r[e]=n},t}();Zt._subCloneModeMap=new Map;Zt._cloneModeMap=new Map;Zt._objectType=Object.getPrototypeOf(Object);var Rs,Jh,ev,tv,rv,Br=(Rs=(rv=tv=function(){function t(i){I(this,"instanceId",Jh,this),I(this,"_engine",ev,this),this._engine=i}return $(t,[{key:"engine",get:function(){return this._engine}}]),t}(),tv._instanceIdCounter=0,rv),Jh=N(Rs.prototype,"instanceId",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return++Br._instanceIdCounter}}),ev=N(Rs.prototype,"_engine",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rs),uc,nv,iv=(uc=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,I(r,"_evts",nv,L(r)),r._evtCount=0,r}var a=i.prototype;return a.hasEvent=function(e){return this._evts[e]!=null},a.eventNames=function(){return this._evtCount===0?[]:Object.keys(this._evts)},a.listenerCount=function(e){var n=this._evts[e];return n?n.fn?1:n.length:0},a.dispatch=function(e,n){if(!this._evts[e])return!1;var o=this._evts[e];if(o.fn)o.once&&this.removeEventListener(e,o.fn),o.fn(n);else for(var s=o.length,l=0;l<s;l++)o[l].once&&this.removeEventListener(e,o[l].fn),o[l].fn(n);return!0},a.on=function(e,n){return this.addEventListener(e,n)},a.once=function(e,n){return this.addEventListener(e,n,!0)},a.addEventListener=function(e,n,o){var s={fn:n,once:o},l=this._evts;return l[e]?l[e].fn?l[e]=[l[e],s]:l[e].push(s):(l[e]=s,this._evtCount++),this},a.off=function(e,n){if(!this._evts[e])return this;if(!n)return this._clearEvent(e),this;var o=this._evts[e];if(o.fn&&o.fn===n)this._clearEvent(e);else{var s=o.indexOf(n);if(s>-1){var l=o[o.length-1];o[s]=l,o.length--,o.length===1&&(this._evts[e]=o[0])}}return this},a.removeEventListener=function(e,n){return this.off(e,n)},a.removeAllEventListeners=function(e){e?this._evts[e]&&this._clearEvent(e):(this._evts=Object.create(null),this._evtCount=0)},a.trigger=function(e){this.dispatch(e.type,e.data)},a._clearEvent=function(e){--this._evtCount==0?this._evts=Object.create(null):delete this._evts[e]},i}(Br),nv=N(uc.prototype,"_evts",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Object.create(null)}}),uc),fn=function(i){},Ym=console.log.bind(console),$m=console.info.bind(console),Zm=console.warn.bind(console),Jm=console.error.bind(console),Vt={debug:fn,info:fn,warn:fn,error:fn,isEnabled:!1,enable:function(){this.debug=Ym,this.info=$m,this.warn=Zm,this.error=Jm,this.isEnabled=!0},disable:function(){this.debug=fn,this.info=fn,this.warn=fn,this.error=fn,this.isEnabled=!1}},e1=function(){function t(){this._clock=void 0,this._timeScale=void 0,this._deltaTime=void 0,this._startTime=void 0,this._lastTickTime=void 0,this._clock=performance||Date,this._timeScale=1,this._deltaTime=1e-4;var a=this._clock.now();this._startTime=a,this._lastTickTime=a}var i=t.prototype;return i.reset=function(){this._lastTickTime=this._clock.now()},i.tick=function(){var r=this.nowTime;this._deltaTime=(r-this._lastTickTime)*this._timeScale,this._lastTickTime=r},$(t,[{key:"nowTime",get:function(){return this._clock.now()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"timeScale",get:function(){return this._timeScale},set:function(r){this._timeScale=r}},{key:"unscaledDeltaTime",get:function(){return this._deltaTime/this._timeScale}},{key:"timeSinceStartup",get:function(){return this.nowTime-this._startTime}}]),t}(),Oe;(function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.FLOAT_ARRAY=35677]="FLOAT_ARRAY",t[t.FLOAT_VEC2_ARRAY=1e5]="FLOAT_VEC2_ARRAY",t[t.FLOAT_VEC3_ARRAY=100001]="FLOAT_VEC3_ARRAY",t[t.FLOAT_VEC4_ARRAY=100002]="FLOAT_VEC4_ARRAY",t[t.INT_ARRAY=100003]="INT_ARRAY",t[t.INT_VEC2_ARRAY=100004]="INT_VEC2_ARRAY",t[t.INT_VEC3_ARRAY=100005]="INT_VEC3_ARRAY",t[t.INT_VEC4_ARRAY=100006]="INT_VEC4_ARRAY",t[t.FLOAT_MAT2_ARRAY=100007]="FLOAT_MAT2_ARRAY",t[t.FLOAT_MAT3_ARRAY=100008]="FLOAT_MAT3_ARRAY",t[t.FLOAT_MAT4_ARRAY=100009]="FLOAT_MAT4_ARRAY",t[t.SAMPLER_2D_ARRAY=100010]="SAMPLER_2D_ARRAY",t[t.SAMPLER_CUBE_ARRAY=100011]="SAMPLER_CUBE_ARRAY",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT"})(Oe||(Oe={}));var X;(function(t){t.shaderVertexID="shaderVertexID",t.standardDerivatives="OES_standard_derivatives",t.shaderTextureLod="EXT_shader_texture_lod",t.elementIndexUint="OES_element_index_uint",t.depthTexture="WEBGL_depth_texture",t.drawBuffers="WEBGL_draw_buffers",t.vertexArrayObject="OES_vertex_array_object",t.instancedArrays="ANGLE_instanced_arrays",t.multipleSample="multipleSampleOnlySupportedInWebGL2",t.textureFloat="OES_texture_float",t.textureFloatLinear="OES_texture_float_linear",t.textureHalfFloat="OES_texture_half_float",t.textureHalfFloatLinear="OES_texture_half_float_linear",t.WEBGL_colorBufferFloat="WEBGL_color_buffer_float",t.colorBufferFloat="EXT_color_buffer_float",t.colorBufferHalfFloat="EXT_color_buffer_half_float",t.textureFilterAnisotropic="EXT_texture_filter_anisotropic",t.blendMinMax="EXT_blend_minmax",t.astc="WEBGL_compressed_texture_astc",t.astc_webkit="WEBKIT_WEBGL_compressed_texture_astc",t.etc="WEBGL_compressed_texture_etc",t.etc_webkit="WEBKIT_WEBGL_compressed_texture_etc",t.etc1="WEBGL_compressed_texture_etc1",t.etc1_webkit="WEBKIT_WEBGL_compressed_texture_etc1",t.pvrtc="WEBGL_compressed_texture_pvrtc",t.pvrtc_webkit="WEBKIT_WEBGL_compressed_texture_pvrtc",t.s3tc="WEBGL_compressed_texture_s3tc",t.s3tc_webkit="WEBKIT_WEBGL_compressed_texture_s3tc"})(X||(X={}));var dn=function(){function t(a){a===void 0&&(a=0),this._elements=void 0,this.length=0,this._elements=new Array(a)}var i=t.prototype;return i.add=function(r){this.length===this._elements.length?this._elements.push(r):this._elements[this.length]=r,this.length++},i.delete=function(r){var e=this._elements.indexOf(r);this.deleteByIndex(e)},i.get=function(r){if(r>=this.length)throw"Index is out of range.";return this._elements[r]},i.deleteByIndex=function(r){var e=this._elements,n=null,o=this.length-1;return r!==o&&(n=e[o],e[r]=n),this.length--,n},i.garbageCollection=function(){this._elements.length=this.length},t}(),vr=function(){function t(){this._mask=[],this._length=0}t.unionCollection=function(r,e,n){var o=n._mask,s,l,u,c;r._length<e._length?(s=r._length,l=e._length,u=r._mask,c=e._mask):(s=e._length,l=r._length,u=e._mask,c=r._mask);var f=0;for(o.length<l&&(o.length=l);f<s;f++)o[f]=u[f]|c[f];for(;f<l;f++)o[f]=c[f];n._length=l};var i=t.prototype;return i.enable=function(r){var e=r._index,n=e+1,o=this._mask,s=this._length;if(s<n){for(o.length<n&&(o.length=n);s<e;s++)o[s]=0;o[e]=r._value,this._length=n}else o[e]|=r._value},i.disable=function(r){var e=r._index,n=this._mask,o=this._length-1;if(!(e>o)){var s=n[e]&~r._value;e==o&&s===0?this._length--:n[e]=s}},i.unionCollection=function(r){var e=r._mask,n=r._length,o=this._mask,s=this._length;if(s<n){o.length<n&&(o.length=n);for(var l=0;l<s;l++)o[l]|=e[l];for(;l<n;l++)o[l]=e[l];this._length=n}else for(var u=0;u<n;u++)o[u]|=e[u]},i.complementaryCollection=function(r){for(var e=r._mask,n=this._mask,o=this._length-1,s=Math.min(r._length-1,o);s>=0;s--){var l=n[s]&~e[s];s==o&&l===0?(o--,this._length--):n[s]=l}},i.intersectionCollection=function(r){for(var e=r._mask,n=this._mask,o=this._length-1;o>=0;o--){var s=n[o]&e[o];s==0&&o==this._length-1?this._length--:n[o]=s}},i.isEnable=function(r){var e=r._index;return e>=this._length?!1:(this._mask[e]&r._value)!=0},i.clear=function(){this._length=0},t}(),cc=function(){function t(){this._onStartScripts=new dn,this._onUpdateScripts=new dn,this._onLateUpdateScripts=new dn,this._destroyComponents=[],this._onUpdateAnimations=new dn,this._renderers=new dn,this._onUpdateRenderers=new dn,this._componentsContainerPool=[]}var i=t.prototype;return i.addRenderer=function(r){r._rendererIndex=this._renderers.length,this._renderers.add(r)},i.removeRenderer=function(r){var e=this._renderers.deleteByIndex(r._rendererIndex);e&&(e._rendererIndex=r._rendererIndex),r._rendererIndex=-1},i.addOnStartScript=function(r){r._onStartIndex=this._onStartScripts.length,this._onStartScripts.add(r)},i.removeOnStartScript=function(r){var e=this._onStartScripts.deleteByIndex(r._onStartIndex);e&&(e._onStartIndex=r._onStartIndex),r._onStartIndex=-1},i.addOnUpdateScript=function(r){r._onUpdateIndex=this._onUpdateScripts.length,this._onUpdateScripts.add(r)},i.removeOnUpdateScript=function(r){var e=this._onUpdateScripts.deleteByIndex(r._onUpdateIndex);e&&(e._onUpdateIndex=r._onUpdateIndex),r._onUpdateIndex=-1},i.addOnLateUpdateScript=function(r){r._onLateUpdateIndex=this._onLateUpdateScripts.length,this._onLateUpdateScripts.add(r)},i.removeOnLateUpdateScript=function(r){var e=this._onLateUpdateScripts.deleteByIndex(r._onLateUpdateIndex);e&&(e._onLateUpdateIndex=r._onLateUpdateIndex),r._onLateUpdateIndex=-1},i.addOnUpdateAnimations=function(r){r._onUpdateIndex=this._onUpdateAnimations.length,this._onUpdateAnimations.add(r)},i.removeOnUpdateAnimations=function(r){var e=this._onUpdateAnimations.deleteByIndex(r._onUpdateIndex);e&&(e._onUpdateIndex=r._onUpdateIndex),r._onUpdateIndex=-1},i.addOnUpdateRenderers=function(r){r._onUpdateIndex=this._onUpdateRenderers.length,this._onUpdateRenderers.add(r)},i.removeOnUpdateRenderers=function(r){var e=this._onUpdateRenderers.deleteByIndex(r._onUpdateIndex);e&&(e._onUpdateIndex=r._onUpdateIndex),r._onUpdateIndex=-1},i.addDestroyComponent=function(r){this._destroyComponents.push(r)},i.callScriptOnStart=function(){var r=this._onStartScripts;if(r.length>0){for(var e=r._elements,n=0;n<r.length;n++){var o=e[n];o._started=!0,o._onStartIndex=-1,o.onStart()}r.length=0}},i.callScriptOnUpdate=function(r){for(var e=this._onUpdateScripts._elements,n=this._onUpdateScripts.length-1;n>=0;--n){var o=e[n];o._started&&o.onUpdate(r)}},i.callScriptOnLateUpdate=function(r){for(var e=this._onLateUpdateScripts._elements,n=this._onLateUpdateScripts.length-1;n>=0;--n){var o=e[n];o._started&&o.onLateUpdate(r)}},i.callAnimationUpdate=function(r){for(var e=this._onUpdateAnimations._elements,n=this._onUpdateAnimations.length-1;n>=0;--n)e[n].update(r)},i.callRendererOnUpdate=function(r){for(var e=this._onUpdateRenderers._elements,n=this._onUpdateRenderers.length-1;n>=0;--n)e[n].update(r)},i.callRender=function(r){for(var e=r._camera,n=this._renderers._elements,o=this._renderers.length-1;o>=0;--o){var s=n[o];if(!!(e.cullingMask&s._entity.layer)&&!(e.enableFrustumCulling&&(s.isCulled=!e._frustum.intersectsBox(s.bounds),s.isCulled))){var l=e.entity.transform,u=l.worldPosition,c=s.bounds.getCenter(t._tempVector0);if(e.isOrthographic){var f=l.getWorldForward(t._tempVector1);A.subtract(c,u,c),s._distanceForSort=A.dot(c,f)}else s._distanceForSort=A.distanceSquared(c,u);s._updateShaderData(r),s._render(e),vr.unionCollection(e._globalShaderMacro,s.shaderData._macroCollection,s._globalShaderMacro)}}},i.callComponentDestroy=function(){var r=this._destroyComponents,e=r.length;if(e>0){for(var n=e-1;n>=0;--n)r[n].onDestroy();r.length=0}},i.callCameraOnBeginRender=function(r){for(var e=r.entity._components,n=e.length-1;n>=0;--n){var o=e[n];o.onBeginRender&&o.onBeginRender(r)}},i.callCameraOnEndRender=function(r){for(var e=r.entity._components,n=e.length-1;n>=0;--n){var o=e[n];o.onBeginRender&&o.onEndRender(r)}},i.getActiveChangedTempList=function(){return this._componentsContainerPool.length?this._componentsContainerPool.pop():[]},i.putActiveChangedTempList=function(r){r.length=0,this._componentsContainerPool.push(r)},t}();cc._tempVector0=new A;cc._tempVector1=new A;var t1=function(){function t(){}return t.cloneComponent=function(a,r){for(var e=Zt.getCloneMode(a.constructor),n=Object.keys(a),o=0,s=n.length;o<s;o++){var l=n[o],u=e[l];switch(u){case void 0:case zr.Assignment:r[l]=a[l];break;case zr.Shallow:var c=a[l];if(c instanceof Object){var f=r[l];f==null&&(f=r[l]=c.constructor()),Ha(f,c)}else r[l]=c;break;case zr.Deep:var d=a[l];if(d instanceof Object){var h=r[l];h==null&&(h=r[l]=d.constructor()),Zt.deepCloneObject(d,h)}else r[l]=d;break}}a._cloneTo&&a._cloneTo(r)},t}(),Xa=function(){t.register=function(a,r){this._addDependency(a,r,this._dependenciesMap),this._addDependency(r,a,this._invDependenciesMap)},t._addCheck=function(a,r){var e=t._dependenciesMap.get(r);if(e){for(var n=0,o=e.length;n<o;n++)if(!a.getComponent(e[n]))throw"you should add "+e[n]+" before adding "+r}},t._removeCheck=function(a,r){var e=t._invDependenciesMap.get(r);if(e){for(var n=0,o=e.length;n<o;n++)if(a.getComponent(e[n]))throw"you should remove "+e[n]+" before adding "+r}},t._addDependency=function(a,r,e){var n=e.get(a);n||(n=[],e.set(a,n)),n.indexOf(r)===-1&&n.push(r)};function t(){}return t}();Xa._dependenciesMap=new Map;Xa._invDependenciesMap=new Map;function r1(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return function(r){i.forEach(function(e){return Xa.register(r,e)})}}var Gt;(function(t){t[t.Layer0=1]="Layer0",t[t.Layer1=2]="Layer1",t[t.Layer2=4]="Layer2",t[t.Layer3=8]="Layer3",t[t.Layer4=16]="Layer4",t[t.Layer5=32]="Layer5",t[t.Layer6=64]="Layer6",t[t.Layer7=128]="Layer7",t[t.Layer8=256]="Layer8",t[t.Layer9=512]="Layer9",t[t.Layer10=1024]="Layer10",t[t.Layer11=2048]="Layer11",t[t.Layer12=4096]="Layer12",t[t.Layer13=8192]="Layer13",t[t.Layer14=16384]="Layer14",t[t.Layer15=32768]="Layer15",t[t.Layer16=65536]="Layer16",t[t.Layer17=131072]="Layer17",t[t.Layer18=262144]="Layer18",t[t.Layer19=524288]="Layer19",t[t.Layer20=1048576]="Layer20",t[t.Layer21=2097152]="Layer21",t[t.Layer22=4194304]="Layer22",t[t.Layer23=8388608]="Layer23",t[t.Layer24=16777216]="Layer24",t[t.Layer25=33554432]="Layer25",t[t.Layer26=67108864]="Layer26",t[t.Layer27=134217728]="Layer27",t[t.Layer28=268435456]="Layer28",t[t.Layer29=536870912]="Layer29",t[t.Layer30=1073741824]="Layer30",t[t.Layer31=2147483648]="Layer31",t[t.Everything=4294967295]="Everything",t[t.Nothing=0]="Nothing"})(Gt||(Gt={}));var Oi,av,ov,sv,lv,Jt=(Oi=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r.engine)||this,I(e,"_entity",av,L(e)),I(e,"_destroyed",ov,L(e)),I(e,"_enabled",sv,L(e)),I(e,"_awoken",lv,L(e)),e._entity=r,e}var a=i.prototype;return a.destroy=function(){this._destroyed||(this._entity._removeComponent(this),this._entity.isActiveInHierarchy&&(this._enabled&&this._onDisable(),this._onInActive()),this._destroyed=!0,this._onDestroy())},a._onAwake=function(){},a._onEnable=function(){},a._onDisable=function(){},a._onDestroy=function(){},a._onActive=function(){},a._onInActive=function(){},a._setActive=function(e){e?(this._awoken||(this._awoken=!0,this._onAwake()),this._entity._isActiveInHierarchy&&(this._onActive(),this._enabled&&this._onEnable())):(this._enabled&&this._onDisable(),this._onInActive())},$(i,[{key:"enabled",get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,e?this._entity.isActiveInHierarchy&&this._onEnable():this._entity.isActiveInHierarchy&&this._onDisable())}},{key:"destroyed",get:function(){return this._destroyed}},{key:"entity",get:function(){return this._entity}},{key:"scene",get:function(){return this._entity.scene}}]),i}(Br),av=N(Oi.prototype,"_entity",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov=N(Oi.prototype,"_destroyed",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sv=N(Oi.prototype,"_enabled",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lv=N(Oi.prototype,"_awoken",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Oi),n1=function(){function t(a){a===void 0&&(a=[]),this._flags=a,this.flag=!0,this._flags.push(this)}var i=t.prototype;return i.destroy=function(){var r=this._flags;qm(r,this),this._flags=null},t}(),zs=function(){function t(){this._updateFlags=[]}var i=t.prototype;return i.register=function(){return new n1(this._updateFlags)},i.distribute=function(){for(var r=this._updateFlags,e=r.length-1;e>=0;e--)r[e].flag=!0},t}(),vt,uv,cv,fv,dv,hv,vv,_v,pv,gv,mv,yv,xv,wv,_r,Sv,pr=(vt=(Sv=_r=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,I(r,"_position",uv,L(r)),I(r,"_rotation",cv,L(r)),I(r,"_rotationQuaternion",fv,L(r)),I(r,"_scale",dv,L(r)),I(r,"_worldPosition",hv,L(r)),I(r,"_worldRotation",vv,L(r)),I(r,"_worldRotationQuaternion",_v,L(r)),I(r,"_lossyWorldScale",pv,L(r)),I(r,"_localMatrix",gv,L(r)),I(r,"_worldMatrix",mv,L(r)),I(r,"_updateFlagManager",yv,L(r)),I(r,"_isParentDirty",xv,L(r)),I(r,"_parentTransformCache",wv,L(r)),r._dirtyFlag=ae.WmWpWeWqWs,r}var a=i.prototype;return a.setPosition=function(e,n,o){this._position.setValue(e,n,o),this.position=this._position},a.setRotation=function(e,n,o){this._rotation.setValue(e,n,o),this.rotation=this._rotation},a.setRotationQuaternion=function(e,n,o,s){this._rotationQuaternion.setValue(e,n,o,s),this.rotationQuaternion=this._rotationQuaternion},a.setScale=function(e,n,o){this._scale.setValue(e,n,o),this.scale=this._scale},a.setWorldPosition=function(e,n,o){this._worldPosition.setValue(e,n,o),this.worldPosition=this._worldPosition},a.setWorldRotation=function(e,n,o){this._worldRotation.setValue(e,n,o),this.worldRotation=this._worldRotation},a.setWorldRotationQuaternion=function(e,n,o,s){this._worldRotationQuaternion.setValue(e,n,o,s),this.worldRotationQuaternion=this._worldRotationQuaternion},a.getWorldForward=function(e){var n=this.worldMatrix.elements;return e.setValue(-n[8],-n[9],-n[10]),e.normalize()},a.getWorldRight=function(e){var n=this.worldMatrix.elements;return e.setValue(n[0],n[1],n[2]),e.normalize()},a.getWorldUp=function(e){var n=this.worldMatrix.elements;return e.setValue(n[4],n[5],n[6]),e.normalize()},a.translate=function(e,n,o,s){if(typeof e=="number"){var l=i._tempVec3;l.setValue(e,n,o),this._translate(l,s)}else this._translate(e,n)},a.rotate=function(e,n,o,s){typeof e=="number"?this._rotateXYZ(e,n,o,s):this._rotateXYZ(e.x,e.y,e.z,n)},a.rotateByAxis=function(e,n,o){o===void 0&&(o=!0);var s=n*O.degreeToRadFactor;pe.rotationAxisAngle(e,s,i._tempQuat0),this._rotateByQuat(i._tempQuat0,o)},a.lookAt=function(e,n){var o,s=this.worldPosition,l=O.zeroTolerance;if(!(Math.abs(s.x-e.x)<l&&Math.abs(s.y-e.y)<l&&Math.abs(s.z-e.z)<l)){var u=i._tempMat43,c=this._worldRotationQuaternion;n=(o=n)!=null?o:i._tempVec3.setValue(0,1,0),Z.lookAt(s,e,n,u),u.getRotation(c).invert(),this.worldRotationQuaternion=c}},a.registerWorldChangeFlag=function(){return this._updateFlagManager.register()},a._parentChange=function(){this._isParentDirty=!0,this._updateAllWorldFlag()},a._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(ae.WmWp)){this._worldAssociatedChange(ae.WmWp);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionFlag()}}},a._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(ae.WmWeWq)){this._worldAssociatedChange(ae.WmWeWq);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndRotationFlag()}}},a._updateWorldPositionAndRotationFlag=function(){if(!this._isContainDirtyFlags(ae.WmWpWeWq)){this._worldAssociatedChange(ae.WmWpWeWq);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndRotationFlag()}}},a._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(ae.WmWs)){this._worldAssociatedChange(ae.WmWs);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndScaleFlag()}}},a._updateWorldPositionAndScaleFlag=function(){if(!this._isContainDirtyFlags(ae.WmWpWs)){this._worldAssociatedChange(ae.WmWpWs);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndScaleFlag()}}},a._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(ae.WmWpWeWqWs)){this._worldAssociatedChange(ae.WmWpWeWqWs);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateAllWorldFlag()}}},a._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;for(var e=null,n=this._entity.parent;n;){var o=n.transform;if(o){e=o;break}else n=n.parent}return this._parentTransformCache=e,this._isParentDirty=!1,e},a._getScaleMatrix=function(){var e=i._tempQuat0,n=i._tempMat30,o=i._tempMat31,s=i._tempMat32;return o.setValueByMatrix(this.worldMatrix),pe.invert(this.worldRotationQuaternion,e),Bi.rotationQuaternion(e,n),Bi.multiply(n,o,s),s},a._isContainDirtyFlags=function(e){return(this._dirtyFlag&e)===e},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},a._worldAssociatedChange=function(e){this._dirtyFlag|=e,this._updateFlagManager.distribute()},a._rotateByQuat=function(e,n){n?(pe.multiply(this.rotationQuaternion,e,this._rotationQuaternion),this.rotationQuaternion=this._rotationQuaternion):(pe.multiply(this.worldRotationQuaternion,e,this._worldRotationQuaternion),this.worldRotationQuaternion=this._worldRotationQuaternion)},a._translate=function(e,n){n===void 0&&(n=!0),n?this.position=this._position.add(e):this.worldPosition=this._worldPosition.add(e)},a._rotateXYZ=function(e,n,o,s){s===void 0&&(s=!0);var l=O.degreeToRadFactor,u=i._tempQuat0;pe.rotationEuler(e*l,n*l,o*l,u),this._rotateByQuat(u,s)},$(i,[{key:"position",get:function(){return this._position},set:function(e){this._position!==e&&e.cloneTo(this._position),this._setDirtyFlagTrue(ae.LocalMatrix),this._updateWorldPositionFlag()}},{key:"worldPosition",get:function(){return this._isContainDirtyFlag(ae.WorldPosition)&&(this._getParentTransform()?this.worldMatrix.getTranslation(this._worldPosition):this._position.cloneTo(this._worldPosition),this._setDirtyFlagFalse(ae.WorldPosition)),this._worldPosition},set:function(e){this._worldPosition!==e&&e.cloneTo(this._worldPosition);var n=this._getParentTransform();n?(Z.invert(n.worldMatrix,i._tempMat41),A.transformCoordinate(e,i._tempMat41,this._position)):e.cloneTo(this._position),this.position=this._position,this._setDirtyFlagFalse(ae.WorldPosition)}},{key:"rotation",get:function(){return this._isContainDirtyFlag(ae.LocalEuler)&&(this._rotationQuaternion.toEuler(this._rotation),this._rotation.scale(O.radToDegreeFactor),this._setDirtyFlagFalse(ae.LocalEuler)),this._rotation},set:function(e){this._rotation!==e&&e.cloneTo(this._rotation),this._setDirtyFlagTrue(ae.LocalMatrix|ae.LocalQuat),this._setDirtyFlagFalse(ae.LocalEuler),this._updateWorldRotationFlag()}},{key:"worldRotation",get:function(){return this._isContainDirtyFlag(ae.WorldEuler)&&(this.worldRotationQuaternion.toEuler(this._worldRotation),this._worldRotation.scale(O.radToDegreeFactor),this._setDirtyFlagFalse(ae.WorldEuler)),this._worldRotation},set:function(e){this._worldRotation!==e&&e.cloneTo(this._worldRotation),pe.rotationEuler(O.degreeToRadian(e.x),O.degreeToRadian(e.y),O.degreeToRadian(e.z),this._worldRotationQuaternion),this.worldRotationQuaternion=this._worldRotationQuaternion,this._setDirtyFlagFalse(ae.WorldEuler)}},{key:"rotationQuaternion",get:function(){return this._isContainDirtyFlag(ae.LocalQuat)&&(pe.rotationEuler(O.degreeToRadian(this._rotation.x),O.degreeToRadian(this._rotation.y),O.degreeToRadian(this._rotation.z),this._rotationQuaternion),this._setDirtyFlagFalse(ae.LocalQuat)),this._rotationQuaternion},set:function(e){this._rotationQuaternion!==e&&e.cloneTo(this._rotationQuaternion),this._setDirtyFlagTrue(ae.LocalMatrix|ae.LocalEuler),this._setDirtyFlagFalse(ae.LocalQuat),this._updateWorldRotationFlag()}},{key:"worldRotationQuaternion",get:function(){if(this._isContainDirtyFlag(ae.WorldQuat)){var e=this._getParentTransform();e!=null?pe.multiply(e.worldRotationQuaternion,this.rotationQuaternion,this._worldRotationQuaternion):this.rotationQuaternion.cloneTo(this._worldRotationQuaternion),this._setDirtyFlagFalse(ae.WorldQuat)}return this._worldRotationQuaternion},set:function(e){this._worldRotationQuaternion!==e&&e.cloneTo(this._worldRotationQuaternion);var n=this._getParentTransform();n?(pe.invert(n.worldRotationQuaternion,i._tempQuat0),pe.multiply(e,i._tempQuat0,this._rotationQuaternion)):e.cloneTo(this._rotationQuaternion),this.rotationQuaternion=this._rotationQuaternion,this._setDirtyFlagFalse(ae.WorldQuat)}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&e.cloneTo(this._scale),this._setDirtyFlagTrue(ae.LocalMatrix),this._updateWorldScaleFlag()}},{key:"lossyWorldScale",get:function(){if(this._isContainDirtyFlag(ae.WorldScale)){if(this._getParentTransform()){var e=this._getScaleMatrix(),n=e.elements;this._lossyWorldScale.setValue(n[0],n[4],n[8])}else this._scale.cloneTo(this._lossyWorldScale);this._setDirtyFlagFalse(ae.WorldScale)}return this._lossyWorldScale}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(ae.LocalMatrix)&&(Z.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(ae.LocalMatrix)),this._localMatrix},set:function(e){this._localMatrix!==e&&e.cloneTo(this._localMatrix),this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._setDirtyFlagTrue(ae.LocalEuler),this._setDirtyFlagFalse(ae.LocalMatrix),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(ae.WorldMatrix)){var e=this._getParentTransform();e?Z.multiply(e.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._setDirtyFlagFalse(ae.WorldMatrix)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&e.cloneTo(this._worldMatrix);var n=this._getParentTransform();n?(Z.invert(n.worldMatrix,i._tempMat42),Z.multiply(e,i._tempMat42,this._localMatrix)):e.cloneTo(this._localMatrix),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(ae.WorldMatrix)}}]),i}(Jt),_r._tempQuat0=new pe,_r._tempVec3=new A,_r._tempMat30=new Bi,_r._tempMat31=new Bi,_r._tempMat32=new Bi,_r._tempMat40=new Z,_r._tempMat41=new Z,_r._tempMat42=new Z,_r._tempMat43=new Z,Sv),uv=N(vt.prototype,"_position",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new A}}),cv=N(vt.prototype,"_rotation",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new A}}),fv=N(vt.prototype,"_rotationQuaternion",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),dv=N(vt.prototype,"_scale",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new A(1,1,1)}}),hv=N(vt.prototype,"_worldPosition",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new A}}),vv=N(vt.prototype,"_worldRotation",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new A}}),_v=N(vt.prototype,"_worldRotationQuaternion",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),pv=N(vt.prototype,"_lossyWorldScale",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new A(1,1,1)}}),gv=N(vt.prototype,"_localMatrix",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),mv=N(vt.prototype,"_worldMatrix",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),yv=N(vt.prototype,"_updateFlagManager",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zs}}),xv=N(vt.prototype,"_isParentDirty",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),wv=N(vt.prototype,"_parentTransformCache",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vt),ae;(function(t){t[t.LocalEuler=1]="LocalEuler",t[t.LocalQuat=2]="LocalQuat",t[t.WorldPosition=4]="WorldPosition",t[t.WorldEuler=8]="WorldEuler",t[t.WorldQuat=16]="WorldQuat",t[t.WorldScale=32]="WorldScale",t[t.LocalMatrix=64]="LocalMatrix",t[t.WorldMatrix=128]="WorldMatrix",t[t.WmWp=132]="WmWp",t[t.WmWeWq=152]="WmWeWq",t[t.WmWpWeWq=156]="WmWpWeWq",t[t.WmWs=160]="WmWs",t[t.WmWpWs=164]="WmWpWs",t[t.WmWpWeWqWs=188]="WmWpWeWqWs"})(ae||(ae={}));var Lr=function(t){Y(i,t),i._findChildByName=function(e,n){for(var o=e._children,s=o.length-1;s>=0;s--){var l=o[s];if(l.name===n)return l}return null},i._traverseSetOwnerScene=function(e,n){e._scene=n;for(var o=e._children,s=e.childCount-1;s>=0;s--)this._traverseSetOwnerScene(o[s],n)};function i(r,e){var n;return n=t.call(this,r)||this,n.name=void 0,n.layer=Gt.Layer0,n.transform=void 0,n._isActiveInHierarchy=!1,n._components=[],n._scripts=new dn,n._children=[],n._scene=void 0,n._isRoot=!1,n._isActive=!0,n._parent=null,n._activeChangedComponents=void 0,n._invModelMatrix=new Z,n._inverseWorldMatFlag=void 0,n.name=e,n.transform=n.addComponent(pr),n._inverseWorldMatFlag=n.transform.registerWorldChangeFlag(),n}var a=i.prototype;return a.addComponent=function(e){Xa._addCheck(this,e);var n=new e(this);return this._components.push(n),this._isActiveInHierarchy&&n._setActive(!0),n},a.getComponent=function(e){for(var n=this._components.length-1;n>=0;n--){var o=this._components[n];if(o instanceof e)return o}},a.getComponents=function(e,n){n.length=0;for(var o=this._components.length-1;o>=0;o--){var s=this._components[o];s instanceof e&&n.push(s)}return n},a.getComponentsIncludeChildren=function(e,n){return n.length=0,this._getComponentsInChildren(e,n),n},a.addChild=function(e){e.parent=this},a.removeChild=function(e){e.parent=null},a.getChild=function(e){return this._children[e]},a.findByName=function(e){var n=this._children,o=i._findChildByName(this,e);if(o)return o;for(var s=n.length-1;s>=0;s--){var l=n[s],u=l.findByName(e);if(u)return u}return null},a.findByPath=function(e){for(var n=e.split("/"),o=this,s=0,l=n.length;s<l;++s){var u=n[s];if(u&&(o=i._findChildByName(o,u),!o))return null}return o},a.createChild=function(e){var n=new i(this.engine,e);return n.layer=this.layer,n.parent=this,n},a.clearChildren=function(){for(var e=this._children,n=e.length-1;n>=0;n--){var o=e[n];o._parent=null,o._isActiveInHierarchy&&o._processInActive(),i._traverseSetOwnerScene(o,null)}e.length=0},a.clone=function(){var e=new i(this._engine,this.name);e._isActive=this._isActive,e.transform.localMatrix=this.transform.localMatrix;for(var n=this._children,o=0,s=this._children.length;o<s;o++){var l=n[o];e.addChild(l.clone())}for(var u=this._components,c=0,f=u.length;c<f;c++){var d=u[c];if(!(d instanceof pr)){var h=e.addComponent(d.constructor);t1.cloneComponent(d,h)}}return e},a.destroy=function(){for(var e=this._components,n=e.length-1;n>=0;n--)e[n].destroy();this._components.length=0;for(var o=this._children,s=o.length-1;s>=0;s--)o[s].destroy();if(this._children.length=0,this._parent!=null){var l=this._parent._children;l.splice(l.indexOf(this),1)}this._parent=null},a._removeComponent=function(e){Xa._removeCheck(this,e.constructor);var n=this._components;n.splice(n.indexOf(e),1)},a._addScript=function(e){e._entityCacheIndex=this._scripts.length,this._scripts.add(e)},a._removeScript=function(e){var n=this._scripts.deleteByIndex(e._entityCacheIndex);n&&(n._entityCacheIndex=e._entityCacheIndex),e._entityCacheIndex=-1},a._removeFromParent=function(){var e=this._parent;if(e!=null){var n=e._children;n.splice(n.indexOf(this),1),this._parent=null}return e},a._processActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!0)},a._processInActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setInActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!1)},a._getComponentsInChildren=function(e,n){for(var o=this._components.length-1;o>=0;o--){var s=this._components[o];s instanceof e&&n.push(s)}for(var l=this._children.length-1;l>=0;l--)this._children[l]._getComponentsInChildren(e,n)},a._setActiveComponents=function(e){for(var n=this._activeChangedComponents,o=0,s=n.length;o<s;++o)n[o]._setActive(e);this._engine._componentsManager.putActiveChangedTempList(n),this._activeChangedComponents=null},a._setActiveInHierarchy=function(e){this._isActiveInHierarchy=!0;for(var n=this._components,o=n.length-1;o>=0;o--)e.push(n[o]);for(var s=this._children,l=s.length-1;l>=0;l--){var u=s[l];u.isActive&&u._setActiveInHierarchy(e)}},a._setInActiveInHierarchy=function(e){this._isActiveInHierarchy=!1;for(var n=this._components,o=n.length-1;o>=0;o--)e.push(n[o]);for(var s=this._children,l=s.length-1;l>=0;l--){var u=s[l];u.isActive&&u._setInActiveInHierarchy(e)}},a._setTransformDirty=function(){if(this.transform)this.transform._parentChange();else for(var e=0,n=this._children.length;e<n;e++)this._children[e]._setTransformDirty()},a.getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&(Z.invert(this.transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},$(i,[{key:"isActive",get:function(){return this._isActive},set:function(e){if(e!==this._isActive)if(this._isActive=e,e){var n=this._parent;(n!=null&&n._isActiveInHierarchy||this._isRoot&&this._scene._isActiveInEngine)&&this._processActive()}else this._isActiveInHierarchy&&this._processInActive()}},{key:"isActiveInHierarchy",get:function(){return this._isActiveInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){if(e!==this._parent){var n=this._removeFromParent(),o=this._parent=e;if(o){o._children.push(this);var s=o._scene;this._scene!==s&&i._traverseSetOwnerScene(this,s),o._isActiveInHierarchy?!this._isActiveInHierarchy&&this._isActive&&this._processActive():this._isActiveInHierarchy&&this._processInActive()}else this._isActiveInHierarchy&&this._processInActive(),n&&i._traverseSetOwnerScene(this,null);this._setTransformDirty()}}},{key:"children",get:function(){return this._children}},{key:"childCount",get:function(){return this._children.length}},{key:"scene",get:function(){return this._scene}},{key:"position",get:function(){return this.transform.position},set:function(e){this.transform.position=e}},{key:"worldPosition",get:function(){return this.transform.worldPosition},set:function(e){this.transform.worldPosition=e}},{key:"rotation",get:function(){return this.transform.rotationQuaternion},set:function(e){this.transform.rotationQuaternion=e}},{key:"scale",get:function(){return this.transform.scale},set:function(e){this.transform.scale=e}}]),i}(Br),Pv=function(){function t(){this._features=[],this._objects=[]}var i=t.prototype;return i.registerFeature=function(r){for(var e=this._features,n=0,o=e.length;n<o;n++)if(e[n]===r)return;e.push(r);for(var s=this._objects,l=0,u=s.length;l<u;l++)s[l].features.push(new r)},i.addObject=function(r){r.features=[];for(var e=0,n=this._features.length;e<n;e++){var o;r.features.push(new this._features[e]((o=r.engine)!=null?o:r))}this._objects.push(r)},i.callFeatureMethod=function(r,e,n){for(var o=r.features,s=o.length,l=0;l<s;l++){var u=o[l];u[e]&&u[e].apply(u,n)}},i.findFeature=function(r,e){for(var n=r.features,o=n.length,s=0;s<o;s++){var l=n[s];if(l.constructor===e)return l}},t}(),Ze;(function(t){t[t.Opaque=1e3]="Opaque",t[t.AlphaTest=2e3]="AlphaTest",t[t.Transparent=3e3]="Transparent"})(Ze||(Ze={}));var Di=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,e.isGCIgnored=!1,e._refCount=0,e._destroyed=!1,r.resourceManager._addRefObject(e.instanceId,L(e)),e}var a=i.prototype;return a.destroy=function(e){if(e===void 0&&(e=!1),this._destroyed)return!0;if(!e&&this._refCount!==0)return!1;var n=this._engine.resourceManager;n&&(n._deleteAsset(this),n._deleteRefObject(this.instanceId));var o=this._getRefCount();return o>0&&this._addRefCount(-o),this._engine=null,this._onDestroy(),this._destroyed=!0,!0},a._getRefCount=function(){return this._refCount},a._addRefCount=function(e){this._refCount+=e},a._addToResourceManager=function(e){this._engine.resourceManager._addAsset(e,this)},$(i,[{key:"refCount",get:function(){return this._refCount}},{key:"destroyed",get:function(){return this._destroyed}}]),i}(Br),er;(function(t){t[t.Scene=0]="Scene",t[t.Camera=1]="Camera",t[t.Renderer=2]="Renderer",t[t.Material=3]="Material"})(er||(er={}));var tr=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.name=void 0,r._platformTexture=void 0,r._mipmap=void 0,r._width=void 0,r._height=void 0,r._mipmapCount=void 0,r._wrapModeU=void 0,r._wrapModeV=void 0,r._filterMode=void 0,r._anisoLevel=1,r}var a=i.prototype;return a.generateMipmaps=function(){!this._mipmap||this._platformTexture.generateMipmaps()},a._onDestroy=function(){this._platformTexture.destroy(),this._platformTexture=null},a._getMaxMiplevel=function(e){return Math.floor(Math.log2(e))},a._getMipmapCount=function(){return this._mipmap?Math.floor(Math.log2(Math.max(this._width,this._height)))+1:1},$(i,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){e!==this._wrapModeU&&(this._wrapModeU=e,this._platformTexture.wrapModeU=e)}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){e!==this._wrapModeV&&(this._wrapModeV=e,this._platformTexture.wrapModeV=e)}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,this._platformTexture.filterMode=e)}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){var n=this._engine._hardwareRenderer.capability.maxAnisoLevel;e>n&&(e=n),e<1&&(e=1),e!==this._anisoLevel&&(this._anisoLevel=e,this._platformTexture.anisoLevel=e)}}]),i}(Di),i1=`#define GLSLIFY 1
#define PI 3.14159265359
#define LOG2 1.442695
#define saturate( a ) clamp( a, 0.0, 1.0 )
#define whiteCompliment(a) ( 1.0 - saturate( a ) )
`,a1=`#define GLSLIFY 1
attribute vec3 POSITION;
#ifdef O3_HAS_UV
attribute vec2 TEXCOORD_0;
#endif
#ifdef O3_HAS_SKIN
attribute vec4 JOINTS_0;attribute vec4 WEIGHTS_0;
#ifdef O3_USE_JOINT_TEXTURE
uniform sampler2D u_jointSampler;uniform float u_jointCount;mat4 getJointMatrix(sampler2D smp,float index){float base=index/u_jointCount;float hf=0.5/u_jointCount;float v=base+hf;vec4 m0=texture2D(smp,vec2(0.125,v));vec4 m1=texture2D(smp,vec2(0.375,v));vec4 m2=texture2D(smp,vec2(0.625,v));vec4 m3=texture2D(smp,vec2(0.875,v));return mat4(m0,m1,m2,m3);}
#else
uniform mat4 u_jointMatrix[O3_JOINTS_NUM];
#endif
#endif
#ifdef O3_HAS_VERTEXCOLOR
attribute vec4 COLOR_0;
#endif
uniform mat4 u_localMat;uniform mat4 u_modelMat;uniform mat4 u_viewMat;uniform mat4 u_projMat;uniform mat4 u_MVMat;uniform mat4 u_MVPMat;uniform mat4 u_normalMat;uniform vec3 u_cameraPos;uniform vec4 u_tilingOffset;
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
attribute vec3 NORMAL;
#endif
#ifdef O3_HAS_TANGENT
attribute vec4 TANGENT;
#endif
#endif
`,o1=`#define GLSLIFY 1
uniform O3_VERTEX_PRECISION mat4 u_localMat;uniform O3_VERTEX_PRECISION mat4 u_modelMat;uniform O3_VERTEX_PRECISION mat4 u_viewMat;uniform O3_VERTEX_PRECISION mat4 u_projMat;uniform O3_VERTEX_PRECISION mat4 u_MVMat;uniform O3_VERTEX_PRECISION mat4 u_MVPMat;uniform O3_VERTEX_PRECISION mat4 u_normalMat;uniform O3_VERTEX_PRECISION vec3 u_cameraPos;`,s1=`#define GLSLIFY 1
#ifdef O3_HAS_VERTEXCOLOR
varying vec4 v_color;
#endif
`,l1=`#define GLSLIFY 1
#ifdef O3_HAS_NORMAL
#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE )
varying mat3 v_TBN;
#else
varying vec3 v_normal;
#endif
#endif
`,u1=`#define GLSLIFY 1
varying vec2 v_uv;`,c1=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
varying vec3 v_pos;
#endif
`,f1=`#define GLSLIFY 1
#ifdef O3_GENERATE_SHADOW_MAP
uniform mat4 u_viewMatFromLight;uniform mat4 u_projMatFromLight;
#endif
#ifdef O3_SHADOW_MAP_COUNT
uniform mat4 u_viewMatFromLight[O3_SHADOW_MAP_COUNT];uniform mat4 u_projMatFromLight[O3_SHADOW_MAP_COUNT];varying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];
#endif
`,d1=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
varying vec3 v_fogDepth;uniform O3_VERTEX_PRECISION vec3 u_fogColor;
#ifdef O3_FOG_EXP2
uniform O3_VERTEX_PRECISION float u_fogDensity;
#else
uniform O3_VERTEX_PRECISION float u_fogNear;uniform O3_VERTEX_PRECISION float u_fogFar;
#endif
#endif
`,h1=`#define GLSLIFY 1
#ifdef O3_HAS_NORMAL
vec3 normal=vec3(NORMAL);
#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE )
vec4 tangent=vec4(TANGENT);
#endif
#endif
`,v1=`#define GLSLIFY 1
vec4 position=vec4(POSITION,1.0);`,_1=`#define GLSLIFY 1
#ifndef O3_GENERATE_SHADOW_MAP
gl_Position=u_MVPMat*position;
#endif
`,p1=`#define GLSLIFY 1
#ifdef O3_HAS_VERTEXCOLOR
v_color=COLOR_0;
#endif
`,g1=`#define GLSLIFY 1
#ifdef O3_HAS_NORMAL
#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE )
vec3 normalW=normalize(mat3(u_normalMat)*normal.xyz);vec3 tangentW=normalize(mat3(u_normalMat)*tangent.xyz);vec3 bitangentW=cross(normalW,tangentW)*tangent.w;v_TBN=mat3(tangentW,bitangentW,normalW);
#else
v_normal=normalize(mat3(u_normalMat)*normal);
#endif
#endif
`,m1=`#define GLSLIFY 1
#ifdef O3_HAS_SKIN
#ifdef O3_USE_JOINT_TEXTURE
mat4 skinMatrix=WEIGHTS_0.x*getJointMatrix(u_jointSampler,JOINTS_0.x)+WEIGHTS_0.y*getJointMatrix(u_jointSampler,JOINTS_0.y)+WEIGHTS_0.z*getJointMatrix(u_jointSampler,JOINTS_0.z)+WEIGHTS_0.w*getJointMatrix(u_jointSampler,JOINTS_0.w);
#else
mat4 skinMatrix=WEIGHTS_0.x*u_jointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*u_jointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*u_jointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*u_jointMatrix[int(JOINTS_0.w)];
#endif
position=skinMatrix*position;
#if defined(O3_HAS_NORMAL) && !defined(OMIT_NORMAL)
normal=vec4(skinMatrix*vec4(normal,0.0)).xyz;
#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE )
tangent.xyz=vec4(skinMatrix*vec4(tangent.xyz,0.0)).xyz;
#endif
#endif
#endif
`,y1=`#define GLSLIFY 1
#ifdef OASIS_BLENDSHAPE
#ifndef OASIS_BLENDSHAPE_TEXTURE
attribute vec3 POSITION_BS0;attribute vec3 POSITION_BS1;attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;
#ifdef OASIS_BLENDSHAPE_NORMAL
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 NORMAL_BS2;attribute vec3 NORMAL_BS3;
#endif
#ifdef OASIS_BLENDSHAPE_TANGENT
attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;attribute vec3 TANGENT_BS2;attribute vec3 TANGENT_BS3;
#endif
#endif
uniform float u_blendShapeWeights[4];
#endif
`,x1=`#define GLSLIFY 1
#ifdef OASIS_BLENDSHAPE
#ifdef OASIS_BLENDSHAPE_TEXTURE
#else
position.xyz+=POSITION_BS0*u_blendShapeWeights[0];position.xyz+=POSITION_BS1*u_blendShapeWeights[1];position.xyz+=POSITION_BS2*u_blendShapeWeights[2];position.xyz+=POSITION_BS3*u_blendShapeWeights[3];
#if defined( O3_HAS_NORMAL ) && defined( OASIS_BLENDSHAPE_NORMAL )
normal.xyz+=NORMAL_BS0*u_blendShapeWeights[0];normal.xyz+=NORMAL_BS1*u_blendShapeWeights[1];normal.xyz+=NORMAL_BS2*u_blendShapeWeights[2];normal.xyz+=NORMAL_BS3*u_blendShapeWeights[3];
#endif
#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE ) && defined(OASIS_BLENDSHAPE_TANGENT)
tangent.xyz+=TANGENT_BS0*u_blendShapeWeights[0];tangent.xyz+=TANGENT_BS1*u_blendShapeWeights[1];tangent.xyz+=TANGENT_BS2*u_blendShapeWeights[2];tangent.xyz+=TANGENT_BS3*u_blendShapeWeights[3];
#endif
#endif
#endif
`,w1=`#define GLSLIFY 1
#ifdef O3_HAS_UV
v_uv=TEXCOORD_0;
#else
v_uv=vec2(0.,0.);
#endif
#ifdef O3_NEED_TILINGOFFSET
v_uv=v_uv*u_tilingOffset.xy+u_tilingOffset.zw;
#endif
`,S1=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
vec4 temp_pos=u_modelMat*position;v_pos=temp_pos.xyz/temp_pos.w;
#endif
`,P1=`#define GLSLIFY 1
#ifdef O3_GENERATE_SHADOW_MAP
gl_Position=u_projMatFromLight*u_viewMatFromLight*u_modelMat*position;
#endif
#ifdef O3_SHADOW_MAP_COUNT
for(int i=0;i<O3_SHADOW_MAP_COUNT;i++){v_PositionFromLight[i]=u_projMatFromLight[i]*u_viewMatFromLight[i]*u_modelMat*vec4(POSITION,1.0);}
#endif
`,A1=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
v_fogDepth=(u_MVMat*position).xyz;
#endif
`,T1=`#define GLSLIFY 1
#ifdef O3_DIRECT_LIGHT_COUNT
struct DirectLight{vec3 color;vec3 direction;};uniform vec3 u_directLightColor[O3_DIRECT_LIGHT_COUNT];uniform vec3 u_directLightDirection[O3_DIRECT_LIGHT_COUNT];
#endif
`,M1=`#define GLSLIFY 1
#ifdef O3_POINT_LIGHT_COUNT
struct PointLight{vec3 color;vec3 position;float distance;};uniform vec3 u_pointLightColor[O3_POINT_LIGHT_COUNT];uniform vec3 u_pointLightPosition[O3_POINT_LIGHT_COUNT];uniform float u_pointLightDistance[O3_POINT_LIGHT_COUNT];
#endif
`,E1=`#define GLSLIFY 1
#ifdef O3_SPOT_LIGHT_COUNT
struct SpotLight{vec3 color;vec3 position;vec3 direction;float distance;float angleCos;float penumbraCos;};uniform vec3 u_spotLightColor[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightPosition[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightDirection[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightDistance[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightAngleCos[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightPenumbraCos[O3_SPOT_LIGHT_COUNT];
#endif
`,b1=`#define GLSLIFY 1
uniform vec4 u_emissiveColor;uniform vec4 u_diffuseColor;uniform vec4 u_specularColor;uniform float u_shininess;uniform float u_normalIntensity;uniform float u_alphaCutoff;
#ifdef O3_EMISSIVE_TEXTURE
uniform sampler2D u_emissiveTexture;
#endif
#ifdef O3_DIFFUSE_TEXTURE
uniform sampler2D u_diffuseTexture;
#endif
#ifdef O3_SPECULAR_TEXTURE
uniform sampler2D u_specularTexture;
#endif
#ifdef O3_NORMAL_TEXTURE
uniform sampler2D u_normalTexture;
#endif
`,C1=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
float fogDepth=length(v_fogDepth);
#ifdef O3_FOG_EXP2
float fogFactor=whiteCompliment(exp2(-u_fogDensity*u_fogDensity*fogDepth*fogDepth*LOG2));
#else
float fogFactor=smoothstep(u_fogNear,u_fogFar,fogDepth);
#endif
gl_FragColor.rgb=mix(gl_FragColor.rgb,u_fogColor,fogFactor);
#endif
`,R1=`#define GLSLIFY 1
vec4 ambient=vec4(0.0);vec4 emission=u_emissiveColor;vec4 diffuse=u_diffuseColor;vec4 specular=u_specularColor;
#ifdef O3_EMISSIVE_TEXTURE
emission*=texture2D(u_emissiveTexture,v_uv);
#endif
#ifdef O3_DIFFUSE_TEXTURE
diffuse*=texture2D(u_diffuseTexture,v_uv);
#endif
#ifdef O3_HAS_VERTEXCOLOR
diffuse*=v_color;
#endif
#ifdef O3_SPECULAR_TEXTURE
specular*=texture2D(u_specularTexture,v_uv);
#endif
ambient=vec4(u_envMapLight.diffuse*u_envMapLight.diffuseIntensity,1.0)*diffuse;`,z1=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
vec3 V=normalize(u_cameraPos-v_pos);
#endif
`,B1=`#define GLSLIFY 1
vec3 N=getNormal();vec3 lightDiffuse=vec3(0.0,0.0,0.0);vec3 lightSpecular=vec3(0.0,0.0,0.0);
#ifdef O3_DIRECT_LIGHT_COUNT
DirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];directionalLight.direction=u_directLightDirection[i];float d=max(dot(N,-directionalLight.direction),0.0);lightDiffuse+=directionalLight.color*d;vec3 halfDir=normalize(V-directionalLight.direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess);lightSpecular+=directionalLight.color*s;}
#endif
#ifdef O3_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];vec3 direction=v_pos-pointLight.position;float dist=length(direction);direction/=dist;float decay=clamp(1.0-pow(dist/pointLight.distance,4.0),0.0,1.0);float d=max(dot(N,-direction),0.0)*decay;lightDiffuse+=pointLight.color*d;vec3 halfDir=normalize(V-direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decay;lightSpecular+=pointLight.color*s;}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];vec3 direction=spotLight.position-v_pos;float lightDistance=length(direction);direction/=lightDistance;float angleCos=dot(direction,-spotLight.direction);float decay=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayTotal=decay*spotEffect;float d=max(dot(N,direction),0.0)*decayTotal;lightDiffuse+=spotLight.color*d;vec3 halfDir=normalize(V+direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decayTotal;lightSpecular+=spotLight.color*s;}
#endif
diffuse*=vec4(lightDiffuse,1.0);specular*=vec4(lightSpecular,1.0);
#ifdef ALPHA_CUTOFF
if(diffuse.a<u_alphaCutoff){discard;}
#endif
`,L1=`#define GLSLIFY 1
vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}float mod289(float x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod7(vec4 x){return x-floor(x*(1.0/7.0))*7.0;}vec3 mod7(vec3 x){return x-floor(x*(1.0/7.0))*7.0;}vec4 permute(vec4 x){return mod289((34.0*x+1.0)*x);}vec3 permute(vec3 x){return mod289((34.0*x+1.0)*x);}float permute(float x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float taylorInvSqrt(float r){return 1.79284291400159-0.85373472095314*r;}vec4 fade(vec4 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec3 fade(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec2 fade(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}
#define K 0.142857142857
#define Ko 0.428571428571
#define K2 0.020408163265306
#define Kd2 0.0714285714285
#define Kz 0.166666666667
#define Kzo 0.416666666667
#define jitter 1.0
#define jitter1 0.8
`,O1=`#define GLSLIFY 1
vec2 cellular(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec3 oi=vec3(-1.0,0.0,1.0);vec3 of=vec3(-0.5,0.5,1.5);vec3 px=permute(Pi.x+oi);vec3 p=permute(px.x+Pi.y+oi);vec3 ox=fract(p*K)-Ko;vec3 oy=mod7(floor(p*K))*K-Ko;vec3 dx=Pf.x+0.5+jitter*ox;vec3 dy=Pf.y-of+jitter*oy;vec3 d1=dx*dx+dy*dy;p=permute(px.y+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-0.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d2=dx*dx+dy*dy;p=permute(px.z+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-1.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d3=dx*dx+dy*dy;vec3 d1a=min(d1,d2);d2=max(d1,d2);d2=min(d2,d3);d1=min(d1a,d2);d2=max(d1a,d2);d1.xy=(d1.x<d1.y)? d1.xy : d1.yx;d1.xz=(d1.x<d1.z)? d1.xz : d1.zx;d1.yz=min(d1.yz,d2.yz);d1.y=min(d1.y,d1.z);d1.y=min(d1.y,d2.x);return sqrt(d1.xy);}`,D1=`#define GLSLIFY 1
vec2 cellular2x2(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec4 Pfx=Pf.x+vec4(-0.5,-1.5,-0.5,-1.5);vec4 Pfy=Pf.y+vec4(-0.5,-0.5,-1.5,-1.5);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 ox=mod7(p)*K+Kd2;vec4 oy=mod7(floor(p*K))*K+Kd2;vec4 dx=Pfx+jitter1*ox;vec4 dy=Pfy+jitter1*oy;vec4 d=dx*dx+dy*dy;d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.y=min(d.y,d.z);d.y=min(d.y,d.w);return sqrt(d.xy);}`,F1=`#define GLSLIFY 1
vec2 cellular2x2x2(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P);vec4 Pfx=Pf.x+vec4(0.0,-1.0,0.0,-1.0);vec4 Pfy=Pf.y+vec4(0.0,0.0,-1.0,-1.0);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 p1=permute(p+Pi.z);vec4 p2=permute(p+Pi.z+vec4(1.0));vec4 ox1=fract(p1*K)-Ko;vec4 oy1=mod7(floor(p1*K))*K-Ko;vec4 oz1=floor(p1*K2)*Kz-Kzo;vec4 ox2=fract(p2*K)-Ko;vec4 oy2=mod7(floor(p2*K))*K-Ko;vec4 oz2=floor(p2*K2)*Kz-Kzo;vec4 dx1=Pfx+jitter1*ox1;vec4 dy1=Pfy+jitter1*oy1;vec4 dz1=Pf.z+jitter1*oz1;vec4 dx2=Pfx+jitter1*ox2;vec4 dy2=Pfy+jitter1*oy2;vec4 dz2=Pf.z-1.0+jitter1*oz2;vec4 d1=dx1*dx1+dy1*dy1+dz1*dz1;vec4 d2=dx2*dx2+dy2*dy2+dz2*dz2;vec4 d=min(d1,d2);d2=max(d1,d2);d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.yzw=min(d.yzw,d2.yzw);d.y=min(d.y,d.z);d.y=min(d.y,d.w);d.y=min(d.y,d2.x);return sqrt(d.xy);}`,I1=`#define GLSLIFY 1
vec2 cellular(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P)-0.5;vec3 Pfx=Pf.x+vec3(1.0,0.0,-1.0);vec3 Pfy=Pf.y+vec3(1.0,0.0,-1.0);vec3 Pfz=Pf.z+vec3(1.0,0.0,-1.0);vec3 p=permute(Pi.x+vec3(-1.0,0.0,1.0));vec3 p1=permute(p+Pi.y-1.0);vec3 p2=permute(p+Pi.y);vec3 p3=permute(p+Pi.y+1.0);vec3 p11=permute(p1+Pi.z-1.0);vec3 p12=permute(p1+Pi.z);vec3 p13=permute(p1+Pi.z+1.0);vec3 p21=permute(p2+Pi.z-1.0);vec3 p22=permute(p2+Pi.z);vec3 p23=permute(p2+Pi.z+1.0);vec3 p31=permute(p3+Pi.z-1.0);vec3 p32=permute(p3+Pi.z);vec3 p33=permute(p3+Pi.z+1.0);vec3 ox11=fract(p11*K)-Ko;vec3 oy11=mod7(floor(p11*K))*K-Ko;vec3 oz11=floor(p11*K2)*Kz-Kzo;vec3 ox12=fract(p12*K)-Ko;vec3 oy12=mod7(floor(p12*K))*K-Ko;vec3 oz12=floor(p12*K2)*Kz-Kzo;vec3 ox13=fract(p13*K)-Ko;vec3 oy13=mod7(floor(p13*K))*K-Ko;vec3 oz13=floor(p13*K2)*Kz-Kzo;vec3 ox21=fract(p21*K)-Ko;vec3 oy21=mod7(floor(p21*K))*K-Ko;vec3 oz21=floor(p21*K2)*Kz-Kzo;vec3 ox22=fract(p22*K)-Ko;vec3 oy22=mod7(floor(p22*K))*K-Ko;vec3 oz22=floor(p22*K2)*Kz-Kzo;vec3 ox23=fract(p23*K)-Ko;vec3 oy23=mod7(floor(p23*K))*K-Ko;vec3 oz23=floor(p23*K2)*Kz-Kzo;vec3 ox31=fract(p31*K)-Ko;vec3 oy31=mod7(floor(p31*K))*K-Ko;vec3 oz31=floor(p31*K2)*Kz-Kzo;vec3 ox32=fract(p32*K)-Ko;vec3 oy32=mod7(floor(p32*K))*K-Ko;vec3 oz32=floor(p32*K2)*Kz-Kzo;vec3 ox33=fract(p33*K)-Ko;vec3 oy33=mod7(floor(p33*K))*K-Ko;vec3 oz33=floor(p33*K2)*Kz-Kzo;vec3 dx11=Pfx+jitter*ox11;vec3 dy11=Pfy.x+jitter*oy11;vec3 dz11=Pfz.x+jitter*oz11;vec3 dx12=Pfx+jitter*ox12;vec3 dy12=Pfy.x+jitter*oy12;vec3 dz12=Pfz.y+jitter*oz12;vec3 dx13=Pfx+jitter*ox13;vec3 dy13=Pfy.x+jitter*oy13;vec3 dz13=Pfz.z+jitter*oz13;vec3 dx21=Pfx+jitter*ox21;vec3 dy21=Pfy.y+jitter*oy21;vec3 dz21=Pfz.x+jitter*oz21;vec3 dx22=Pfx+jitter*ox22;vec3 dy22=Pfy.y+jitter*oy22;vec3 dz22=Pfz.y+jitter*oz22;vec3 dx23=Pfx+jitter*ox23;vec3 dy23=Pfy.y+jitter*oy23;vec3 dz23=Pfz.z+jitter*oz23;vec3 dx31=Pfx+jitter*ox31;vec3 dy31=Pfy.z+jitter*oy31;vec3 dz31=Pfz.x+jitter*oz31;vec3 dx32=Pfx+jitter*ox32;vec3 dy32=Pfy.z+jitter*oy32;vec3 dz32=Pfz.y+jitter*oz32;vec3 dx33=Pfx+jitter*ox33;vec3 dy33=Pfy.z+jitter*oy33;vec3 dz33=Pfz.z+jitter*oz33;vec3 d11=dx11*dx11+dy11*dy11+dz11*dz11;vec3 d12=dx12*dx12+dy12*dy12+dz12*dz12;vec3 d13=dx13*dx13+dy13*dy13+dz13*dz13;vec3 d21=dx21*dx21+dy21*dy21+dz21*dz21;vec3 d22=dx22*dx22+dy22*dy22+dz22*dz22;vec3 d23=dx23*dx23+dy23*dy23+dz23*dz23;vec3 d31=dx31*dx31+dy31*dy31+dz31*dz31;vec3 d32=dx32*dx32+dy32*dy32+dz32*dz32;vec3 d33=dx33*dx33+dy33*dy33+dz33*dz33;vec3 d1a=min(d11,d12);d12=max(d11,d12);d11=min(d1a,d13);d13=max(d1a,d13);d12=min(d12,d13);vec3 d2a=min(d21,d22);d22=max(d21,d22);d21=min(d2a,d23);d23=max(d2a,d23);d22=min(d22,d23);vec3 d3a=min(d31,d32);d32=max(d31,d32);d31=min(d3a,d33);d33=max(d3a,d33);d32=min(d32,d33);vec3 da=min(d11,d21);d21=max(d11,d21);d11=min(da,d31);d31=max(da,d31);d11.xy=(d11.x<d11.y)? d11.xy : d11.yx;d11.xz=(d11.x<d11.z)? d11.xz : d11.zx;d12=min(d12,d21);d12=min(d12,d22);d12=min(d12,d31);d12=min(d12,d32);d11.yz=min(d11.yz,d12.xy);d11.y=min(d11.y,d12.z);d11.y=min(d11.y,d11.z);return sqrt(d11.xy);}`,N1=`#define GLSLIFY 1
#include <noise_cellular_2D>
#include <noise_cellular_3D>
#include <noise_cellular_2x2>
#include <noise_cellular_2x2x2>
`,U1=`#define GLSLIFY 1
float perlin(vec2 P){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}float perlin(vec2 P,vec2 rep){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod(Pi,rep.xyxy);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}`,k1=`#define GLSLIFY 1
float perlin(vec3 P){vec3 Pi0=floor(P);vec3 Pi1=Pi0+vec3(1.0);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}float perlin(vec3 P,vec3 rep){vec3 Pi0=mod(floor(P),rep);vec3 Pi1=mod(Pi0+vec3(1.0),rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}`,V1=`#define GLSLIFY 1
float perlin(vec4 P){vec4 Pi0=floor(P);vec4 Pi1=Pi0+1.0;Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}float perlin(vec4 P,vec4 rep){vec4 Pi0=mod(floor(P),rep);vec4 Pi1=mod(Pi0+1.0,rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}`,G1=`#define GLSLIFY 1
#include <noise_perlin_2D>
#include <noise_perlin_3D>
#include <noise_perlin_4D>
`,H1=`#define GLSLIFY 1
vec2 rgrad2(vec2 p,float rot){float u=permute(permute(p.x)+p.y)*0.0243902439+rot;u=fract(u)*6.28318530718;return vec2(cos(u),sin(u));}vec3 psrdnoise(vec2 pos,vec2 per,float rot){pos.y+=0.01;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 psdnoise(vec2 pos,vec2 per){return psrdnoise(pos,per,0.0);}float psrnoise(vec2 pos,vec2 per,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float psnoise(vec2 pos,vec2 per){return psrnoise(pos,per,0.0);}vec3 srdnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 sdnoise(vec2 pos){return srdnoise(pos,0.0);}float srnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float snoise(vec2 pos){return srnoise(pos,0.0);}`,W1=`#define GLSLIFY 1
float simplex(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}`,j1=`#define GLSLIFY 1
float simplex(vec3 v,out vec3 gradient){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);vec4 m2=m*m;vec4 m4=m2*m2;vec4 pdotx=vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3));vec4 temp=m2*m*pdotx;gradient=-8.0*(temp.x*x0+temp.y*x1+temp.z*x2+temp.w*x3);gradient+=m4.x*p0+m4.y*p1+m4.z*p2+m4.w*p3;gradient*=42.0;return 42.0*dot(m4,pdotx);}`,X1=`#define GLSLIFY 1
float simplex(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`,K1=`#define GLSLIFY 1
vec4 grad4(float j,vec4 ip){const vec4 ones=vec4(1.0,1.0,1.0,-1.0);vec4 p,s;p.xyz=floor(fract(vec3(j)*ip.xyz)*7.0)*ip.z-1.0;p.w=1.5-dot(abs(p.xyz),ones.xyz);s=vec4(lessThan(p,vec4(0.0)));p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;return p;}
#define F4 0.309016994374947451
float simplex(vec4 v){const vec4 C=vec4(0.138196601125011,0.276393202250021,0.414589803375032,-0.447213595499958);vec4 i=floor(v+dot(v,vec4(F4)));vec4 x0=v-i+dot(i,C.xxxx);vec4 i0;vec3 isX=step(x0.yzw,x0.xxx);vec3 isYZ=step(x0.zww,x0.yyz);i0.x=isX.x+isX.y+isX.z;i0.yzw=1.0-isX;i0.y+=isYZ.x+isYZ.y;i0.zw+=1.0-isYZ.xy;i0.z+=isYZ.z;i0.w+=1.0-isYZ.z;vec4 i3=clamp(i0,0.0,1.0);vec4 i2=clamp(i0-1.0,0.0,1.0);vec4 i1=clamp(i0-2.0,0.0,1.0);vec4 x1=x0-i1+C.xxxx;vec4 x2=x0-i2+C.yyyy;vec4 x3=x0-i3+C.zzzz;vec4 x4=x0+C.wwww;i=mod289(i);float j0=permute(permute(permute(permute(i.w)+i.z)+i.y)+i.x);vec4 j1=permute(permute(permute(permute(i.w+vec4(i1.w,i2.w,i3.w,1.0))+i.z+vec4(i1.z,i2.z,i3.z,1.0))+i.y+vec4(i1.y,i2.y,i3.y,1.0))+i.x+vec4(i1.x,i2.x,i3.x,1.0));vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);vec4 p0=grad4(j0,ip);vec4 p1=grad4(j1.x,ip);vec4 p2=grad4(j1.y,ip);vec4 p3=grad4(j1.z,ip);vec4 p4=grad4(j1.w,ip);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;p4*=taylorInvSqrt(dot(p4,p4));vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);m0=m0*m0;m1=m1*m1;return 49.0*(dot(m0*m0,vec3(dot(p0,x0),dot(p1,x1),dot(p2,x2)))+dot(m1*m1,vec2(dot(p3,x3),dot(p4,x4))));}`,q1=`#define GLSLIFY 1
#include <noise_simplex_2D>
#include <noise_simplex_3D>
#include <noise_simplex_3D_grad>
#include <noise_simplex_4D>
`,Q1=`#define GLSLIFY 1
#ifdef GAMMA
float gamma=2.2;gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(1.0/gamma));
#endif
`,Y1=`#define GLSLIFY 1
#ifndef EPSILON
#define EPSILON 1e-6
#endif
#ifndef RECIPROCAL_PI
#define RECIPROCAL_PI 0.31830988618
#endif
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
#define RE_Direct RE_Direct_Physical
#define RE_IndirectDiffuse RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular RE_IndirectSpecular_Physical
#define Material_BlinnShininessExponent( material ) GGXRoughnessToBlinnExponent( material.specularRoughness )
`,$1=`#define GLSLIFY 1
vec4 SRGBtoLINEAR(vec4 srgbIn){
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut=pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess=step(vec3(0.04045),srgbIn.xyz);vec3 linOut=mix(srgbIn.xyz/vec3(12.92),pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)),bLess);
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}float pow2(const in float x){return x*x;}vec3 inverseTransformDirection(in vec3 dir,in mat4 matrix){return normalize((vec4(dir,0.0)*matrix).xyz);}vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor){return RECIPROCAL_PI*diffuseColor;}float GGXRoughnessToBlinnExponent(const in float ggxRoughness){return(2.0/pow2(ggxRoughness+0.0001)-2.0);}float computeSpecularOcclusion(const in float dotNV,const in float ambientOcclusion,const in float roughness){return saturate(pow(dotNV+ambientOcclusion,exp2(-16.0*roughness-1.0))-1.0+ambientOcclusion);}`,Z1=`#define GLSLIFY 1
struct EnvMapLight{vec3 diffuse;float mipMapLevel;float diffuseIntensity;float specularIntensity;mat4 transformMatrix;};uniform EnvMapLight u_envMapLight;
#ifdef O3_USE_SH
uniform vec3 u_env_sh[9];
#endif
#ifdef O3_USE_SPECULAR_ENV
uniform samplerCube u_env_specularSampler;
#endif
`,J1=`#define GLSLIFY 1
uniform float u_alphaCutoff;uniform vec4 u_baseColor;uniform float u_metal;uniform float u_roughness;uniform vec3 u_specularColor;uniform float u_glossinessFactor;uniform vec3 u_emissiveColor;uniform float u_normalIntensity;uniform float u_occlusionStrength;`,ey=`#define GLSLIFY 1
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_baseColorSampler;
#endif
#ifdef O3_NORMAL_TEXTURE
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_metallicRoughnessSampler;
#endif
#ifdef HAS_SPECULARGLOSSINESSMAP
uniform sampler2D u_specularGlossinessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_occlusionSampler;
#endif
`,ty=`#define GLSLIFY 1
struct IncidentLight{vec3 color;vec3 direction;};struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct GeometricContext{vec3 position;vec3 normal;vec3 viewDir;};struct PhysicalMaterial{vec3 diffuseColor;float specularRoughness;vec3 specularColor;};`,ry=`#define GLSLIFY 1
vec3 F_Schlick(const in vec3 specularColor,const in float dotLH){float fresnel=exp2((-5.55473*dotLH-6.98316)*dotLH);return(1.0-specularColor)*fresnel+specularColor;}float G_GGX_SmithCorrelated(const in float alpha,const in float dotNL,const in float dotNV){float a2=pow2(alpha);float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));return 0.5/max(gv+gl,EPSILON);}float D_GGX(const in float alpha,const in float dotNH){float a2=pow2(alpha);float denom=pow2(dotNH)*(a2-1.0)+1.0;return RECIPROCAL_PI*a2/pow2(denom);}vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight,const in GeometricContext geometry,const in vec3 specularColor,const in float roughness){float alpha=pow2(roughness);vec3 halfDir=normalize(incidentLight.direction+geometry.viewDir);float dotNL=saturate(dot(geometry.normal,incidentLight.direction));float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float dotNH=saturate(dot(geometry.normal,halfDir));float dotLH=saturate(dot(incidentLight.direction,halfDir));vec3 F=F_Schlick(specularColor,dotLH);float G=G_GGX_SmithCorrelated(alpha,dotNL,dotNV);float D=D_GGX(alpha,dotNH);return F*(G*D);}`,ny=`#define GLSLIFY 1
void RE_Direct_Physical(const in IncidentLight directLight,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){float dotNL=saturate(dot(geometry.normal,directLight.direction));vec3 irradiance=dotNL*directLight.color;
#ifndef PHYSICALLY_CORRECT_LIGHTS
irradiance*=PI;
#endif
reflectedLight.directSpecular+=irradiance*BRDF_Specular_GGX(directLight,geometry,material.specularColor,material.specularRoughness);reflectedLight.directDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}
#ifdef O3_DIRECT_LIGHT_COUNT
void getDirectionalDirectLightIrradiance(const in DirectLight directionalLight,const in GeometricContext geometry,out IncidentLight directLight){directLight.color=directionalLight.color;directLight.direction=-directionalLight.direction;}
#endif
#ifdef O3_POINT_LIGHT_COUNT
void getPointDirectLightIrradiance(const in PointLight pointLight,const in GeometricContext geometry,out IncidentLight directLight){vec3 lVector=pointLight.position-geometry.position;directLight.direction=normalize(lVector);float lightDistance=length(lVector);directLight.color=pointLight.color;directLight.color*=clamp(1.0-pow(lightDistance/pointLight.distance,4.0),0.0,1.0);}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
void getSpotDirectLightIrradiance(const in SpotLight spotLight,const in GeometricContext geometry,out IncidentLight directLight){vec3 lVector=spotLight.position-geometry.position;directLight.direction=normalize(lVector);float lightDistance=length(lVector);float angleCos=dot(directLight.direction,-spotLight.direction);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayEffect=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);directLight.color=spotLight.color;directLight.color*=spotEffect*decayEffect;}
#endif
`,iy=`#define GLSLIFY 1
vec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry,const in vec3 specularColor,const in float roughness){float dotNV=saturate(dot(geometry.normal,geometry.viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}float getSpecularMIPLevel(const in float blinnShininessExponent,const in int maxMIPLevel){float maxMIPLevelScalar=float(maxMIPLevel);float desiredMIPLevel=maxMIPLevelScalar+0.79248-0.5*log2(pow2(blinnShininessExponent)+1.0);return clamp(desiredMIPLevel,0.0,maxMIPLevelScalar);}vec3 getLightProbeIndirectRadiance(const in GeometricContext geometry,const in float blinnShininessExponent,const in int maxMIPLevel){
#ifndef O3_USE_SPECULAR_ENV
return vec3(0.0);
#else
vec3 reflectVec=reflect(-geometry.viewDir,geometry.normal);float specularMIPLevel=getSpecularMIPLevel(blinnShininessExponent,maxMIPLevel);
#ifdef HAS_TEX_LOD
vec4 envMapColor=textureCubeLodEXT(u_env_specularSampler,reflectVec,specularMIPLevel);
#else
vec4 envMapColor=textureCube(u_env_specularSampler,reflectVec,specularMIPLevel);
#endif
envMapColor.rgb=SRGBtoLINEAR(envMapColor*u_envMapLight.specularIntensity).rgb;return envMapColor.rgb;
#endif
}void RE_IndirectSpecular_Physical(const in vec3 radiance,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float dotNL=dotNV;reflectedLight.indirectSpecular+=radiance*BRDF_Specular_GGX_Environment(geometry,material.specularColor,material.specularRoughness);}`,ay=`#define GLSLIFY 1
void RE_IndirectDiffuse_Physical(const in vec3 irradiance,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}vec3 getLightProbeIrradiance(vec3 sh[9],vec3 normal){vec3 result=sh[0]+sh[1]*(normal.y)+sh[2]*(normal.z)+sh[3]*(normal.x)+sh[4]*(normal.y*normal.x)+sh[5]*(normal.y*normal.z)+sh[6]*(3.0*normal.z*normal.z-1.0)+sh[7]*(normal.z*normal.x)+sh[8]*(normal.x*normal.x-normal.y*normal.y);return max(result,vec3(0.0));}`,oy=`#define GLSLIFY 1
vec3 normal=getNormal();vec4 diffuseColor=u_baseColor;vec3 totalEmissiveRadiance=u_emissiveColor;float metalnessFactor=u_metal;float roughnessFactor=u_roughness;vec3 specularFactor=u_specularColor;float glossinessFactor=u_glossinessFactor;ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));PhysicalMaterial material;GeometricContext geometry;IncidentLight directLight;
#ifdef HAS_BASECOLORMAP
vec4 baseMapColor=texture2D(u_baseColorSampler,v_uv);baseMapColor=SRGBtoLINEAR(baseMapColor);diffuseColor*=baseMapColor;
#endif
#ifdef O3_HAS_VERTEXCOLOR
diffuseColor*=v_color;
#endif
#ifdef ALPHA_CUTOFF
if(diffuseColor.a<u_alphaCutoff){discard;}
#endif
#ifdef HAS_METALROUGHNESSMAP
vec4 metalRoughMapColor=texture2D(u_metallicRoughnessSampler,v_uv);roughnessFactor*=metalRoughMapColor.g;metalnessFactor*=metalRoughMapColor.b;
#endif
#ifdef HAS_SPECULARGLOSSINESSMAP
vec4 specularGlossinessColor=texture2D(u_specularGlossinessSampler,v_uv);specularFactor*=specularGlossinessColor.rgb;glossinessFactor*=specularGlossinessColor.a;
#endif
#ifdef IS_METALLIC_WORKFLOW
material.diffuseColor=diffuseColor.rgb*(1.0-metalnessFactor);material.specularRoughness=clamp(roughnessFactor,0.04,1.0);material.specularColor=mix(vec3(MAXIMUM_SPECULAR_COEFFICIENT),diffuseColor.rgb,metalnessFactor);
#else
float specularStrength=max(max(specularFactor.r,specularFactor.g),specularFactor.b);material.diffuseColor=diffuseColor.rgb*(1.0-specularStrength);material.specularRoughness=clamp(1.0-glossinessFactor,0.04,1.0);material.specularColor=specularFactor;
#endif
geometry.position=v_pos;geometry.normal=normal;geometry.viewDir=normalize(u_cameraPos-v_pos);`,sy=`#define GLSLIFY 1
#if defined( O3_DIRECT_LIGHT_COUNT ) && defined( RE_Direct )
DirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];directionalLight.direction=u_directLightDirection[i];getDirectionalDirectLightIrradiance(directionalLight,geometry,directLight);RE_Direct(directLight,geometry,material,reflectedLight);}
#endif
#if defined( O3_POINT_LIGHT_COUNT ) && defined( RE_Direct )
PointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];getPointDirectLightIrradiance(pointLight,geometry,directLight);RE_Direct(directLight,geometry,material,reflectedLight);}
#endif
#if defined( O3_SPOT_LIGHT_COUNT ) && defined( RE_Direct )
SpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];getSpotDirectLightIrradiance(spotLight,geometry,directLight);RE_Direct(directLight,geometry,material,reflectedLight);}
#endif
`,ly=`#define GLSLIFY 1
#ifdef O3_USE_SH
vec3 irradiance=getLightProbeIrradiance(u_env_sh,normal)*u_envMapLight.diffuseIntensity;
#else
vec3 irradiance=u_envMapLight.diffuse*u_envMapLight.diffuseIntensity;
#endif
#ifndef PHYSICALLY_CORRECT_LIGHTS
irradiance*=PI;
#endif
RE_IndirectDiffuse_Physical(irradiance,geometry,material,reflectedLight);`,uy=`#define GLSLIFY 1
#if defined( RE_IndirectSpecular )
vec3 radiance=vec3(0.0);
#endif
#if defined( RE_IndirectSpecular )
radiance+=getLightProbeIndirectRadiance(geometry,Material_BlinnShininessExponent(material),int(u_envMapLight.mipMapLevel));
#endif
#if defined( RE_IndirectSpecular )
RE_IndirectSpecular(radiance,geometry,material,reflectedLight);
#endif
`,cy=`#define GLSLIFY 1
#ifdef HAS_OCCLUSIONMAP
float ambientOcclusion=(texture2D(u_occlusionSampler,v_uv).r-1.0)*u_occlusionStrength+1.0;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(O3_USE_SPECULAR_ENV)
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.specularRoughness);
#endif
#endif
#ifdef HAS_EMISSIVEMAP
vec4 emissiveMapColor=texture2D(u_emissiveSampler,v_uv);emissiveMapColor=SRGBtoLINEAR(emissiveMapColor);totalEmissiveRadiance*=emissiveMapColor.rgb;
#endif
vec3 outgoingLight=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+totalEmissiveRadiance;gl_FragColor=vec4(outgoingLight,diffuseColor.a);`,fy={pbr_common_frag_define:Y1,pbr_util_frag_define:$1,pbr_envmap_light_frag_define:Z1,pbr_base_frag_define:J1,pbr_texture_frag_define:ey,pbr_runtime_frag_define:ty,pbr_brdf_cook_torrance_frag_define:ry,pbr_direct_irradiance_frag_define:ny,pbr_ibl_specular_frag_define:iy,pbr_ibl_diffuse_frag_define:ay,pbr_begin_frag:oy,pbr_direct_irradiance_frag:sy,pbr_ibl_diffuse_frag:ly,pbr_ibl_specular_frag:uy,pbr_end_frag:cy},dy=`#define GLSLIFY 1
vec3 getNormal(){
#ifdef O3_NORMAL_TEXTURE
#ifndef O3_HAS_TANGENT
#ifdef HAS_DERIVATIVES
vec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 tex_dx=dFdx(vec3(v_uv,0.0));vec3 tex_dy=dFdy(vec3(v_uv,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);
#ifdef O3_HAS_NORMAL
vec3 ng=normalize(v_normal);
#else
vec3 ng=normalize(cross(pos_dx,pos_dy));
#endif
t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));mat3 tbn=mat3(t,b,ng);
#else
#ifdef O3_HAS_NORMAL
vec3 ng=normalize(v_normal);
#else
vec3 ng=vec3(0.0,0.0,1.0);
#endif
mat3 tbn=mat3(vec3(0.0),vec3(0.0),ng);
#endif
#else
mat3 tbn=v_TBN;
#endif
vec3 n=texture2D(u_normalTexture,v_uv).rgb;n=normalize(tbn*((2.0*n-1.0)*vec3(u_normalIntensity,u_normalIntensity,1.0)));
#else
#ifdef O3_HAS_NORMAL
vec3 n=normalize(v_normal);
#elif defined(HAS_DERIVATIVES)
vec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 n=normalize(cross(pos_dx,pos_dy));
#else
vec3 n=vec3(0.0,0.0,1.0);
#endif
#endif
n*=float(gl_FrontFacing)*2.0-1.0;return n;}`,hy=Qh(Qh({common:i1,common_vert:a1,common_frag:o1,color_share:s1,normal_share:l1,uv_share:u1,worldpos_share:c1,shadow_share:f1,fog_share:d1,begin_normal_vert:h1,begin_position_vert:v1,position_vert:_1,color_vert:p1,normal_vert:g1,skinning_vert:m1,blendShape_input:y1,blendShape_vert:x1,uv_vert:w1,worldpos_vert:S1,shadow_vert:P1,fog_vert:A1,direct_light_frag:T1,point_light_frag:M1,spot_light_frag:E1,mobile_material_frag:b1,fog_frag:C1,begin_mobile_frag:R1,begin_viewdir_frag:z1,mobile_blinnphong_frag:B1,noise_common:L1,noise_cellular_2D:O1,noise_cellular_2x2:D1,noise_cellular_2x2x2:F1,noise_cellular_3D:I1,noise_cellular:N1,noise_perlin_2D:U1,noise_perlin_3D:k1,noise_perlin_4D:V1,noise_perlin:G1,noise_psrd_2D:H1,noise_simplex_2D:W1,noise_simplex_3D_grad:j1,noise_simplex_3D:X1,noise_simplex_4D:K1,noise_simplex:q1,gamma_frag:Q1},fy),{},{normal_get:dy}),Fi=function(){function t(){}return t.parseCustomMacros=function(a){return a.map(function(r){return"#define "+r+`
`}).join("")},t.parseIncludes=function(a){var r=/^[ \t]*#include +<([\w\d.]+)>/gm;function e(n,o){var s=hy[o];return s===void 0?(Vt.error('Shader slice "'+n.trim()+'" not founded.'),""):t.parseIncludes(s)}return a.replace(r,e)},t.parseExtension=function(a){return a.map(function(r){return"#extension "+r+` : enable
`}).join("")},t.convertTo300=function(a,r){if(a=a.replace(/\battribute\b/g,"in"),a=a.replace(/\bvarying\b/g,r?"in":"out"),a=a.replace(/\btexture(2D|Cube)\b/g,"texture"),a=a.replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod"),r){var e=/\bgl_FragData\[.+?\]/g.test(a);if(e){a=a.replace(/\bgl_FragColor\b/g,"gl_FragData[0]");var n=a.match(/\bgl_FragData\[.+?\]/g);a=this._replaceMRTShader(a,n)}else a=a.replace(/void\s+?main\s*\(/g,`out vec4 glFragColor;
void main(`),a=a.replace(/\bgl_FragColor\b/g,"glFragColor")}return a},t._replaceMRTShader=function(a,r){for(var e="",n=new Set,o=0;o<r.length;o++){var s=r[o].match(/\bgl_FragData\[(.+?)\]/);n.add(s[1])}return n.forEach(function(l){e+="layout(location="+l+") out vec4 fragOutColor"+l+`;
`}),e+="void main(",a=a.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1"),a=a.replace(/void\s+?main\s*\(/g,e),a},t}(),vy=function(i,a,r){this.name=void 0,this._index=void 0,this._value=void 0,this.name=i,this._index=a,this._value=r},_y=function(){function t(a){this.name=void 0,this.propertyId=void 0,this.location=void 0,this.applyFunc=void 0,this.cacheValue=void 0,this.textureIndex=void 0,this.textureDefault=void 0,this._rhi=void 0,this._gl=void 0;var r=a._hardwareRenderer;this._rhi=r,this._gl=r.gl}var i=t.prototype;return i.upload1f=function(r,e){this.cacheValue!==e&&(this._gl.uniform1f(r.location,e),this.cacheValue=e)},i.upload1fv=function(r,e){this._gl.uniform1fv(r.location,e)},i.upload2f=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g)&&(this._gl.uniform2f(r.location,e.r,e.g),n.x=e.r,n.y=e.g):(n.x!==e.x||n.y!==e.y)&&(this._gl.uniform2f(r.location,e.x,e.y),n.x=e.x,n.y=e.y)},i.upload2fv=function(r,e){this._gl.uniform2fv(r.location,e)},i.upload3f=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b)&&(this._gl.uniform3f(r.location,e.r,e.g,e.b),n.x=e.r,n.y=e.g,n.z=e.b):(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(this._gl.uniform3f(r.location,e.x,e.y,e.z),n.x=e.x,n.y=e.y,n.z=e.z)},i.upload3fv=function(r,e){this._gl.uniform3fv(r.location,e)},i.upload4f=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b||n.w!==e.a)&&(this._gl.uniform4f(r.location,e.r,e.g,e.b,e.a),n.x=e.r,n.y=e.g,n.z=e.b,n.w=e.a):(n.x!==e.x||n.y!==e.y||n.z!==e.z||n.w!==e.w)&&(this._gl.uniform4f(r.location,e.x,e.y,e.z,e.w),n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w)},i.upload4fv=function(r,e){this._gl.uniform4fv(r.location,e)},i.upload1i=function(r,e){this.cacheValue!==e&&(this._gl.uniform1i(r.location,e),this.cacheValue=e)},i.upload1iv=function(r,e){this._gl.uniform1iv(r.location,e)},i.upload2i=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g)&&(this._gl.uniform2i(r.location,e.r,e.g),n.x=e.r,n.y=e.g):(n.x!==e.x||n.y!==e.y)&&(this._gl.uniform2i(r.location,e.x,e.y),n.x=e.x,n.y=e.y)},i.upload2iv=function(r,e){this._gl.uniform2iv(r.location,e)},i.upload3i=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b)&&(this._gl.uniform3i(r.location,e.r,e.g,e.b),n.x=e.r,n.y=e.g,n.z=e.b):(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(this._gl.uniform3i(r.location,e.x,e.y,e.z),n.x=e.x,n.y=e.y,n.z=e.z)},i.upload3iv=function(r,e){this._gl.uniform3iv(r.location,e)},i.upload4i=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b||n.w!==e.a)&&(this._gl.uniform4i(r.location,e.r,e.g,e.b,e.a),n.x=e.r,n.y=e.g,n.z=e.b,n.w=e.a):(n.x!==e.x||n.y!==e.y||n.z!==e.z||n.w!==e.w)&&(this._gl.uniform4i(r.location,e.x,e.y,e.z,e.w),n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w)},i.upload4iv=function(r,e){this._gl.uniform4iv(r.location,e)},i.uploadMat4=function(r,e){this._gl.uniformMatrix4fv(r.location,!1,e.elements)},i.uploadMat4v=function(r,e){this._gl.uniformMatrix4fv(r.location,!1,e)},i.uploadTexture=function(r,e){var n=this._rhi;n.activeTexture(r.textureIndex),n.bindTexture(e._platformTexture)},i.uploadTextureArray=function(r,e){for(var n=this._rhi,o=r.textureIndex,s=0;s<e.length;s++){var l=e[s];n.activeTexture(o[s]),n.bindTexture(l._platformTexture)}},t}(),Ka=function(){this.constUniforms=[],this.textureUniforms=[]},Av=function(){t._addLineNum=function(r){var e=r.split(`
`),n=(e.length+1).toString().length+6,o;return e.map(function(s,l){if(o="0:"+(l+1),o.length>=n)return o.substring(0,n)+s;for(var u=0;u<n-o.length;u++)o+=" ";return o+s}).join(`
`)};function t(a,r,e){this.id=void 0,this.sceneUniformBlock=new Ka,this.cameraUniformBlock=new Ka,this.rendererUniformBlock=new Ka,this.materialUniformBlock=new Ka,this.otherUniformBlock=new Ka,this._uploadRenderCount=-1,this._uploadCamera=void 0,this._uploadRenderer=void 0,this._uploadMaterial=void 0,this.attributeLocation=Object.create(null),this._isValid=void 0,this._engine=void 0,this._gl=void 0,this._vertexShader=void 0,this._fragmentShader=void 0,this._glProgram=void 0,this._activeTextureUint=0,this._engine=a,this._gl=a._hardwareRenderer.gl,this._glProgram=this._createProgram(r,e),this._glProgram?(this._isValid=!0,this._recordLocation()):this._isValid=!1,this.id=t._counter++}var i=t.prototype;return i.uploadAll=function(r,e){this.uploadUniforms(r,e),this.uploadTextures(r,e)},i.uploadUniforms=function(r,e){for(var n=e._properties,o=r.constUniforms,s=0,l=o.length;s<l;s++){var u=o[s],c=n[u.propertyId];c!=null&&u.applyFunc(u,c)}},i.uploadTextures=function(r,e){var n=e._properties,o=r.textureUniforms;if(o)for(var s=0,l=o.length;s<l;s++){var u=o[s],c=n[u.propertyId];c?u.applyFunc(u,c):u.applyFunc(u,u.textureDefault)}},i.uploadUngroupTextures=function(){var r=this.otherUniformBlock.textureUniforms;if(r)for(var e=0,n=r.length;e<n;e++){var o=r[e];o.applyFunc(o,o.textureDefault)}},i.groupingOtherUniformBlock=function(){var r=this.otherUniformBlock,e=r.constUniforms,n=r.textureUniforms;e.length>0&&this._groupingSubOtherUniforms(e,!1),n.length>0&&this._groupingSubOtherUniforms(n,!0)},i.bind=function(){var r=this._engine._hardwareRenderer;return r._currentBind!==this?(this._gl.useProgram(this._glProgram),r._currentBind=this,!0):!1},i.destroy=function(){var r=this._gl;this._vertexShader&&r.deleteShader(this._vertexShader),this._fragmentShader&&r.deleteShader(this._fragmentShader),this._glProgram&&r.deleteProgram(this._glProgram)},i._groupingSubOtherUniforms=function(r,e){for(var n=r.length-1;n>=0;n--){var o=r[n],s=b._getShaderPropertyGroup(o.name);s!==void 0&&(r.splice(r.indexOf(o),1),this._groupingUniform(o,s,e))}},i._groupingUniform=function(r,e,n){switch(e){case er.Scene:n?this.sceneUniformBlock.textureUniforms.push(r):this.sceneUniformBlock.constUniforms.push(r);break;case er.Camera:n?this.cameraUniformBlock.textureUniforms.push(r):this.cameraUniformBlock.constUniforms.push(r);break;case er.Renderer:n?this.rendererUniformBlock.textureUniforms.push(r):this.rendererUniformBlock.constUniforms.push(r);break;case er.Material:n?this.materialUniformBlock.textureUniforms.push(r):this.materialUniformBlock.constUniforms.push(r);break;default:n?this.otherUniformBlock.textureUniforms.push(r):this.otherUniformBlock.constUniforms.push(r)}},i._createProgram=function(r,e){var n=this._gl,o=this._createShader(n.VERTEX_SHADER,r);if(!o)return null;var s=this._createShader(n.FRAGMENT_SHADER,e);if(!s)return null;var l=n.createProgram();return n.attachShader(l,o),n.attachShader(l,s),n.linkProgram(l),n.validateProgram(l),n.isContextLost()?(n.deleteShader(o),n.deleteShader(s),null):(this._vertexShader=o,this._fragmentShader=s,l)},i._createShader=function(r,e){var n=this._gl,o=n.createShader(r);return o?(n.shaderSource(o,e),n.compileShader(o),n.isContextLost()?(n.deleteShader(o),null):o):null},i._recordLocation=function(){var r=this,e=this._gl,n=this._glProgram,o=this._getUniformInfos(),s=this._getAttributeInfos();o.forEach(function(l){var u=l.name,c=l.size,f=l.type,d=new _y(r._engine),h=!1,_=!1;u.indexOf("[0]")>0&&(u=u.substr(0,u.length-3),h=!0);var m=b._getShaderPropertyGroup(u),v=e.getUniformLocation(n,u);switch(d.name=u,d.propertyId=b.getPropertyByName(u)._uniqueId,d.location=v,f){case e.FLOAT:h?d.applyFunc=d.upload1fv:(d.applyFunc=d.upload1f,d.cacheValue=0);break;case e.FLOAT_VEC2:h?d.applyFunc=d.upload2fv:(d.applyFunc=d.upload2f,d.cacheValue=new G(0,0));break;case e.FLOAT_VEC3:h?d.applyFunc=d.upload3fv:(d.applyFunc=d.upload3f,d.cacheValue=new A(0,0,0));break;case e.FLOAT_VEC4:h?d.applyFunc=d.upload4fv:(d.applyFunc=d.upload4f,d.cacheValue=new Ee(0,0,0,0));break;case e.BOOL:case e.INT:h?d.applyFunc=d.upload1iv:(d.applyFunc=d.upload1i,d.cacheValue=0);break;case e.BOOL_VEC2:case e.INT_VEC2:h?d.applyFunc=d.upload2iv:(d.applyFunc=d.upload2i,d.cacheValue=new G(0,0));break;case e.BOOL_VEC3:case e.INT_VEC3:d.applyFunc=h?d.upload3iv:d.upload3i,d.cacheValue=new A(0,0,0);break;case e.BOOL_VEC4:case e.INT_VEC4:h?d.applyFunc=d.upload4iv:(d.applyFunc=d.upload4i,d.cacheValue=new Ee(0,0,0));break;case e.FLOAT_MAT4:d.applyFunc=h?d.uploadMat4v:d.uploadMat4;break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:var p=f===e.SAMPLER_2D?r._engine._whiteTexture2D:r._engine._whiteTextureCube;if(_=!0,h){for(var g=new Array(c),y=new Int32Array(c),x=new Array(c),T=0;T<c;T++)g[T]=p,y[T]=r._activeTextureUint,x[T]=e.TEXTURE0+r._activeTextureUint++;d.textureDefault=g,d.textureIndex=x,d.applyFunc=d.uploadTextureArray,r.bind(),e.uniform1iv(v,y),d.uploadTextureArray(d,g)}else{var w=e.TEXTURE0+r._activeTextureUint;d.textureDefault=p,d.textureIndex=w,d.applyFunc=d.uploadTexture,r.bind(),e.uniform1i(v,r._activeTextureUint++),d.uploadTexture(d,p)}break}r._groupingUniform(d,m,_)}),s.forEach(function(l){var u=l.name;r.attributeLocation[u]=e.getAttribLocation(n,u)})},i._getUniformInfos=function(){for(var r=this._gl,e=this._glProgram,n=[],o=r.getProgramParameter(e,r.ACTIVE_UNIFORMS),s=0;s<o;++s){var l=r.getActiveUniform(e,s);n[s]=l}return n},i._getAttributeInfos=function(){for(var r=this._gl,e=this._glProgram,n=[],o=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES),s=0;s<o;++s){var l=r.getActiveAttrib(e,s);n[s]=l}return n},$(t,[{key:"isValid",get:function(){return this._isValid}}]),t}();Av._counter=0;var Tv=function t(i){this._uniqueId=void 0,this._group=void 0,this.name=void 0,this.name=i,this._uniqueId=t._propertyNameCounter++};Tv._propertyNameCounter=0;var b=function(){t.create=function(r,e,n){var o=t._shaderMap;if(o[r])throw'Shader named "'+r+'" already exists.';return o[r]=new t(r,e,n)},t.find=function(r){return t._shaderMap[r]},t.getMacroByName=function(r){var e=t._macroMap[r];if(!e){var n=t._macroMaskMap,o=t._macroCounter,s=Math.floor(o/32),l=o%32;e=new vy(r,s,1<<l),t._macroMap[r]=e,s==n.length&&(n.length++,n[s]=new Array(32)),n[s][l]=r,t._macroCounter++}return e},t.getPropertyByName=function(r){var e=t._propertyNameMap;if(e[r]!=null)return e[r];var n=new Tv(r);return e[r]=n,n},t._getShaderPropertyGroup=function(r){var e=t._propertyNameMap[r];return e==null?void 0:e._group},t._getNamesByMacros=function(r,e){var n=t._macroMaskMap,o=r._mask;e.length=0;for(var s=0,l=r._length;s<l;s++)for(var u=n[s],c=o[s],f=c<0?32:Math.floor(Math.log2(c))+1,d=0;d<f;d++)c&1<<d&&e.push(u[d])};function t(a,r,e){this.name=void 0,this._shaderId=0,this._vertexSource=void 0,this._fragmentSource=void 0,this._shaderId=t._shaderCounter++,this.name=a,this._vertexSource=r,this._fragmentSource=e}var i=t.prototype;return i.compileVariant=function(r,e){var n=t._compileMacros;n.clear();for(var o=0,s=e.length;o<s;o++)n.enable(t.getMacroByName(e[o]));return this._getShaderProgram(r,n).isValid},i._getShaderProgram=function(r,e){var n=r._getShaderProgramPool(this),o=n.get(e);if(o)return o;var s=r._hardwareRenderer.isWebGL2,l=[];t._getNamesByMacros(e,l);var u=Fi.parseCustomMacros(l),c=s?"#version 300 es":"#version 100",f=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      precision highp int;
      #define O3_VERTEX_PRECISION highp
      #define O3_FRAGMENT_PRECISION highp
    #else
      precision mediump float;
      precision mediump int;
      #define O3_VERTEX_PRECISION mediump
      #define O3_FRAGMENT_PRECISION mediump
    #endif
    `;r._hardwareRenderer.canIUse(X.shaderTextureLod)&&(f+=`#define HAS_TEX_LOD
`),r._hardwareRenderer.canIUse(X.standardDerivatives)&&(f+=`#define HAS_DERIVATIVES
`);var d=Fi.parseIncludes(" "+c+`
        `+f+`
        `+u+`
        `+this._vertexSource),h=Fi.parseIncludes(" "+c+`
        `+(s?"":Fi.parseExtension(t._shaderExtension))+`
        `+f+`
        `+u+`
      `+this._fragmentSource);return s&&(d=Fi.convertTo300(d),h=Fi.convertTo300(h,!0)),o=new Av(r,d,h),n.cache(o),o},t}();b._compileMacros=new vr;b._shaderCounter=0;b._shaderMap=Object.create(null);b._propertyNameMap=Object.create(null);b._macroMaskMap=[];b._macroCounter=0;b._macroMap=Object.create(null);b._shaderExtension=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers"];var Bs=function(){function t(a){this._group=void 0,this._properties=Object.create(null),this._macroCollection=new vr,this._variableMacros=Object.create(null),this._refCount=0,this._group=a}var i=t.prototype;return i.getFloat=function(r){return this._getData(r)},i.setFloat=function(r,e){this._setData(r,e)},i.getInt=function(r){return this._getData(r)},i.setInt=function(r,e){this._setData(r,e)},i.getFloatArray=function(r){return this._getData(r)},i.setFloatArray=function(r,e){this._setData(r,e)},i.getIntArray=function(r){return this._getData(r)},i.setIntArray=function(r,e){this._setData(r,e)},i.getVector2=function(r){return this._getData(r)},i.setVector2=function(r,e){this._setData(r,e)},i.getVector3=function(r){return this._getData(r)},i.setVector3=function(r,e){this._setData(r,e)},i.getVector4=function(r){return this._getData(r)},i.setVector4=function(r,e){this._setData(r,e)},i.getMatrix=function(r){return this._getData(r)},i.setMatrix=function(r,e){this._setData(r,e)},i.getColor=function(r){return this._getData(r)},i.setColor=function(r,e){this._setData(r,e)},i.getTexture=function(r){return this._getData(r)},i.setTexture=function(r,e){if(this._getRefCount()>0){var n=this._getData(r);n&&n._addRefCount(-1),e&&e._addRefCount(1)}this._setData(r,e)},i.getTextureArray=function(r){return this._getData(r)},i.setTextureArray=function(r,e){if(this._getRefCount()>0){var n=this._getData(r);if(n)for(var o=0,s=n.length;o<s;o++)n[o]._addRefCount(-1);if(e)for(var l=0,u=e.length;l<u;l++)e[l]._addRefCount(1)}this._setData(r,e)},i.enableMacro=function(r,e){e===void 0&&(e=null),e?this._enableVariableMacro(r,e):(typeof r=="string"&&(r=b.getMacroByName(r)),this._macroCollection.enable(r))},i.disableMacro=function(r){if(typeof r=="string"){var e=this._variableMacros[r];e?this._disableVariableMacro(r,e):(r=b.getMacroByName(r),this._macroCollection.disable(r))}else this._macroCollection.disable(r)},i.clone=function(){var r=new t(this._group);return this.cloneTo(r),r},i.cloneTo=function(r){Zt.deepCloneObject(this._macroCollection,r._macroCollection),Ha(r._variableMacros,this._variableMacros);for(var e=this._properties,n=r._properties,o=Object.keys(e),s=0,l=o.length;s<l;s++){var u=o[s],c=e[u];if(c!=null)if(typeof c=="number")n[u]=c;else if(c instanceof tr)n[u]=c;else if(c instanceof Array||c instanceof Float32Array||c instanceof Int32Array)n[u]=c.slice();else{var f=n[u];f?c.cloneTo(f):n[u]=c.clone()}else n[u]=c}},i._getData=function(r){return typeof r=="string"&&(r=b.getPropertyByName(r)),this._properties[r._uniqueId]},i._setData=function(r,e){if(typeof r=="string"&&(r=b.getPropertyByName(r)),r._group!==this._group)if(r._group===void 0)r._group=this._group;else throw"Shader property "+r.name+" has been used as "+er[r._group]+" property.";this._properties[r._uniqueId]=e},i._getRefCount=function(){return this._refCount},i._addRefCount=function(r){this._refCount+=r;var e=this._properties;for(var n in e){var o=e[n];o&&o instanceof tr&&o._addRefCount(r)}},i._enableVariableMacro=function(r,e){var n=this._variableMacros,o=n[r];if(o!==e){o&&this._disableVariableMacro(r,o);var s=b.getMacroByName(r+" "+e);this._macroCollection.enable(s),n[r]=e}},i._disableVariableMacro=function(r,e){var n=b.getMacroByName(r+" "+e);this._macroCollection.disable(n),delete this._variableMacros[r]},t}(),oe;(function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.SourceColor=2]="SourceColor",t[t.OneMinusSourceColor=3]="OneMinusSourceColor",t[t.DestinationColor=4]="DestinationColor",t[t.OneMinusDestinationColor=5]="OneMinusDestinationColor",t[t.SourceAlpha=6]="SourceAlpha",t[t.OneMinusSourceAlpha=7]="OneMinusSourceAlpha",t[t.DestinationAlpha=8]="DestinationAlpha",t[t.OneMinusDestinationAlpha=9]="OneMinusDestinationAlpha",t[t.SourceAlphaSaturate=10]="SourceAlphaSaturate",t[t.BlendColor=11]="BlendColor",t[t.OneMinusBlendColor=12]="OneMinusBlendColor"})(oe||(oe={}));var Ht;(function(t){t[t.Add=0]="Add",t[t.Subtract=1]="Subtract",t[t.ReverseSubtract=2]="ReverseSubtract",t[t.Min=3]="Min",t[t.Max=4]="Max"})(Ht||(Ht={}));var gr;(function(t){t[t.None=0]="None",t[t.Red=1]="Red",t[t.Green=2]="Green",t[t.Blue=4]="Blue",t[t.Alpha=8]="Alpha",t[t.All=15]="All"})(gr||(gr={}));var py=function(){this.enabled=!1,this.colorBlendOperation=Ht.Add,this.alphaBlendOperation=Ht.Add,this.sourceColorBlendFactor=oe.One,this.sourceAlphaBlendFactor=oe.One,this.destinationColorBlendFactor=oe.Zero,this.destinationAlphaBlendFactor=oe.Zero,this.colorWriteMask=gr.All},gy=function(){function t(){this.targetBlendState=new py,this.blendColor=new ge(0,0,0,0),this.alphaToCoverage=!1}t._getGLBlendFactor=function(r){switch(r){case oe.Zero:return WebGLRenderingContext.ZERO;case oe.One:return WebGLRenderingContext.ONE;case oe.SourceColor:return WebGLRenderingContext.SRC_COLOR;case oe.OneMinusSourceColor:return WebGLRenderingContext.ONE_MINUS_SRC_COLOR;case oe.DestinationColor:return WebGLRenderingContext.DST_COLOR;case oe.OneMinusDestinationColor:return WebGLRenderingContext.ONE_MINUS_DST_COLOR;case oe.SourceAlpha:return WebGLRenderingContext.SRC_ALPHA;case oe.OneMinusSourceAlpha:return WebGLRenderingContext.ONE_MINUS_SRC_ALPHA;case oe.DestinationAlpha:return WebGLRenderingContext.DST_ALPHA;case oe.OneMinusDestinationAlpha:return WebGLRenderingContext.ONE_MINUS_DST_ALPHA;case oe.SourceAlphaSaturate:return WebGLRenderingContext.SRC_ALPHA_SATURATE;case oe.BlendColor:return WebGLRenderingContext.CONSTANT_COLOR;case oe.OneMinusBlendColor:return WebGLRenderingContext.ONE_MINUS_CONSTANT_COLOR}},t._getGLBlendOperation=function(r,e){var n=e.gl;switch(r){case Ht.Add:return n.FUNC_ADD;case Ht.Subtract:return n.FUNC_SUBTRACT;case Ht.ReverseSubtract:return n.FUNC_REVERSE_SUBTRACT;case Ht.Min:if(!e.canIUse(X.blendMinMax))throw new Error("BlendOperation.Min is not supported in this context");return n.MIN;case Ht.Max:if(!e.canIUse(X.blendMinMax))throw new Error("BlendOperation.Max is not supported in this context");return n.MAX}};var i=t.prototype;return i._apply=function(r,e){this._platformApply(r,e.blendState)},i._platformApply=function(r,e){var n=r.gl,o=e.targetBlendState,s=this.targetBlendState,l=s.enabled,u=s.colorBlendOperation,c=s.alphaBlendOperation,f=s.sourceColorBlendFactor,d=s.destinationColorBlendFactor,h=s.sourceAlphaBlendFactor,_=s.destinationAlphaBlendFactor,m=s.colorWriteMask;if(l!==o.enabled&&(l?n.enable(n.BLEND):n.disable(n.BLEND),o.enabled=l),l){(f!==o.sourceColorBlendFactor||d!==o.destinationColorBlendFactor||h!==o.sourceAlphaBlendFactor||_!==o.destinationAlphaBlendFactor)&&(n.blendFuncSeparate(t._getGLBlendFactor(f),t._getGLBlendFactor(d),t._getGLBlendFactor(h),t._getGLBlendFactor(_)),o.sourceColorBlendFactor=f,o.destinationColorBlendFactor=d,o.sourceAlphaBlendFactor=h,o.destinationAlphaBlendFactor=_),(u!==o.colorBlendOperation||c!==o.alphaBlendOperation)&&(n.blendEquationSeparate(t._getGLBlendOperation(u,r),t._getGLBlendOperation(c,r)),o.colorBlendOperation=u,o.alphaBlendOperation=c);var v=this.blendColor;ge.equals(e.blendColor,v)||(n.blendColor(v.r,v.g,v.b,v.a),v.cloneTo(e.blendColor))}m!==o.colorWriteMask&&(n.colorMask((m&gr.Red)!=0,(m&gr.Green)!=0,(m&gr.Blue)!=0,(m&gr.Alpha)!=0),o.colorWriteMask=m);var p=this.alphaToCoverage;p!==e.alphaToCoverage&&(p?n.enable(n.SAMPLE_ALPHA_TO_COVERAGE):n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),e.alphaToCoverage=p)},t}(),me;(function(t){t[t.Never=0]="Never",t[t.Less=1]="Less",t[t.Equal=2]="Equal",t[t.LessEqual=3]="LessEqual",t[t.Greater=4]="Greater",t[t.NotEqual=5]="NotEqual",t[t.GreaterEqual=6]="GreaterEqual",t[t.Always=7]="Always"})(me||(me={}));var my=function(){function t(){this.enabled=!0,this.writeEnabled=!0,this.compareFunction=me.Less}t._getGLCompareFunction=function(r){switch(r){case me.Never:return WebGLRenderingContext.NEVER;case me.Less:return WebGLRenderingContext.LESS;case me.Equal:return WebGLRenderingContext.EQUAL;case me.LessEqual:return WebGLRenderingContext.LEQUAL;case me.Greater:return WebGLRenderingContext.GREATER;case me.NotEqual:return WebGLRenderingContext.NOTEQUAL;case me.GreaterEqual:return WebGLRenderingContext.GEQUAL;case me.Always:return WebGLRenderingContext.ALWAYS}};var i=t.prototype;return i._apply=function(r,e){this._platformApply(r,e.depthState)},i._platformApply=function(r,e){var n=r.gl,o=this.enabled,s=this.compareFunction,l=this.writeEnabled;o!=e.enabled&&(o?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),e.enabled=o),o&&(s!=e.compareFunction&&(n.depthFunc(t._getGLCompareFunction(s)),e.compareFunction=s),l!=e.writeEnabled&&(n.depthMask(l),e.writeEnabled=l))},t}(),Wt;(function(t){t[t.Off=0]="Off",t[t.Front=1]="Front",t[t.Back=2]="Back"})(Wt||(Wt={}));var yy=function(){function t(){this.cullMode=Wt.Back,this.depthBias=0,this.slopeScaledDepthBias=0,this._cullFaceEnable=!0}var i=t.prototype;return i._apply=function(r,e){this._platformApply(r,e.rasterState)},i._platformApply=function(r,e){var n=r.gl,o=this.cullMode,s=this.depthBias,l=this.slopeScaledDepthBias,u=o!==Wt.Off;u!==e._cullFaceEnable&&(u?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),e._cullFaceEnable=u),u&&o!==e.cullMode&&(o==Wt.Back?n.cullFace(n.BACK):n.cullFace(n.FRONT),e.cullMode=o),(s!==e.depthBias||l!==e.slopeScaledDepthBias)&&(s!==0||l!==0?(n.enable(n.POLYGON_OFFSET_FILL),n.polygonOffset(l,s)):n.disable(n.POLYGON_OFFSET_FILL),e.depthBias=s,e.slopeScaledDepthBias=l)},t}(),Ve;(function(t){t[t.Keep=0]="Keep",t[t.Zero=1]="Zero",t[t.Replace=2]="Replace",t[t.IncrementSaturate=3]="IncrementSaturate",t[t.DecrementSaturate=4]="DecrementSaturate",t[t.Invert=5]="Invert",t[t.IncrementWrap=6]="IncrementWrap",t[t.DecrementWrap=7]="DecrementWrap"})(Ve||(Ve={}));var xy=function(){function t(){this.enabled=!1,this.referenceValue=0,this.mask=255,this.writeMask=255,this.compareFunctionFront=me.Always,this.compareFunctionBack=me.Always,this.passOperationFront=Ve.Keep,this.passOperationBack=Ve.Keep,this.failOperationFront=Ve.Keep,this.failOperationBack=Ve.Keep,this.zFailOperationFront=Ve.Keep,this.zFailOperationBack=Ve.Keep}t._getGLCompareFunction=function(r){switch(r){case me.Never:return WebGLRenderingContext.NEVER;case me.Less:return WebGLRenderingContext.LESS;case me.Equal:return WebGLRenderingContext.EQUAL;case me.LessEqual:return WebGLRenderingContext.LEQUAL;case me.Greater:return WebGLRenderingContext.GREATER;case me.NotEqual:return WebGLRenderingContext.NOTEQUAL;case me.GreaterEqual:return WebGLRenderingContext.GEQUAL;case me.Always:return WebGLRenderingContext.ALWAYS}},t._getGLStencilOperation=function(r){switch(r){case Ve.Keep:return WebGLRenderingContext.KEEP;case Ve.Zero:return WebGLRenderingContext.ZERO;case Ve.Replace:return WebGLRenderingContext.REPLACE;case Ve.IncrementSaturate:return WebGLRenderingContext.INCR;case Ve.DecrementSaturate:return WebGLRenderingContext.DECR;case Ve.Invert:return WebGLRenderingContext.INVERT;case Ve.IncrementWrap:return WebGLRenderingContext.INCR_WRAP;case Ve.DecrementWrap:return WebGLRenderingContext.DECR_WRAP}};var i=t.prototype;return i._apply=function(r,e){this._platformApply(r,e.stencilState)},i._platformApply=function(r,e){var n=r.gl,o=this.enabled,s=this.referenceValue,l=this.mask,u=this.compareFunctionFront,c=this.compareFunctionBack,f=this.failOperationFront,d=this.zFailOperationFront,h=this.passOperationFront,_=this.failOperationBack,m=this.zFailOperationBack,v=this.passOperationBack,p=this.writeMask;if(o!=e.enabled&&(o?n.enable(n.STENCIL_TEST):n.disable(WebGLRenderingContext.STENCIL_TEST),e.enabled=o),o){var g=s!==e.referenceValue||l!==e.mask;(g||u!==e.compareFunctionFront)&&(n.stencilFuncSeparate(n.FRONT,t._getGLCompareFunction(u),s,l),e.compareFunctionFront=u),(g||c!==e.compareFunctionBack)&&(n.stencilFuncSeparate(n.BACK,t._getGLCompareFunction(c),s,l),e.compareFunctionBack=this.compareFunctionBack),g&&(e.referenceValue=this.referenceValue,e.mask=this.mask),(f!==e.failOperationFront||d!==e.zFailOperationFront||h!==e.passOperationFront)&&(n.stencilOpSeparate(n.FRONT,t._getGLStencilOperation(f),t._getGLStencilOperation(d),t._getGLStencilOperation(h)),e.failOperationFront=f,e.zFailOperationFront=d,e.passOperationFront=h),(_!==e.failOperationBack||m!==e.zFailOperationBack||v!==e.passOperationBack)&&(n.stencilOpSeparate(n.BACK,t._getGLStencilOperation(_),t._getGLStencilOperation(m),t._getGLStencilOperation(v)),e.failOperationBack=_,e.zFailOperationBack=m,e.passOperationBack=v),p!==e.writeMask&&(n.stencilMask(p),e.writeMask=p)}},t}(),Mv=function(){function t(){this.blendState=new gy,this.depthState=new my,this.stencilState=new xy,this.rasterState=new yy}var i=t.prototype;return i._apply=function(r){var e=r._hardwareRenderer,n=r._lastRenderState;this.blendState._apply(e,n),this.depthState._apply(e,n),this.stencilState._apply(e,n),this.rasterState._apply(e,n)},t}(),hn=function(t){Y(i,t);function i(r,e){var n;return n=t.call(this,r)||this,n.name=void 0,n.shader=void 0,n.renderQueueType=Ze.Opaque,n.shaderData=new Bs(er.Material),n.renderState=new Mv,n.shader=e,n}var a=i.prototype;return a.clone=function(){var e=new i(this._engine,this.shader);return this.cloneTo(e),e},a.cloneTo=function(e){e.shader=this.shader,e.renderQueueType=this.renderQueueType,this.shaderData.cloneTo(e.shaderData),Zt.deepCloneObject(this.renderState,e.renderState)},a._addRefCount=function(e){t.prototype._addRefCount.call(this,e),this.shaderData._addRefCount(e)},a._preRender=function(e){},a._onDestroy=function(){},i}(Di),Ii=function(){function t(a){this._elementPoolIndex=0,this._elementPool=[],this._type=void 0,this._type=a}var i=t.prototype;return i.getFromPool=function(){var r=this._elementPoolIndex,e=this._elementPool;if(this._elementPoolIndex++,e.length===r){var n=new this._type;return e.push(n),n}else return e[r]},i.resetPool=function(){this._elementPoolIndex=0},t}(),wy=function(){function t(){this._camera=void 0,this._viewProjectMatrix=new Z}var i=t.prototype;return i._setContext=function(r){this._camera=r,Z.multiply(r.projectionMatrix,r.viewMatrix,this._viewProjectMatrix)},t}(),Sy=function(){function t(){this.component=void 0,this.mesh=void 0,this.subMesh=void 0,this.material=void 0}var i=t.prototype;return i.setValue=function(r,e,n,o){this.component=r,this.mesh=e,this.subMesh=n,this.material=o},t}(),Py=function(){function t(){this.component=void 0,this.positions=void 0,this.uv=void 0,this.triangles=void 0,this.color=void 0,this.material=void 0,this.camera=void 0}var i=t.prototype;return i.setValue=function(r,e,n,o,s,l,u){this.component=r,this.positions=e,this.uv=n,this.triangles=o,this.color=s,this.material=l,this.camera=u},t}(),Ay=function(){function t(){this.component=void 0,this.positions=void 0,this.uv=void 0,this.triangles=void 0,this.material=void 0,this.isAdd=!0,this.camera=void 0}var i=t.prototype;return i.setValue=function(r,e,n,o,s){this.component=r,this.positions=e,this.uv=n,this.triangles=o,this.material=s},t}(),vn;(function(t){t[t.None=0]="None",t[t.VisibleInsideMask=1]="VisibleInsideMask",t[t.VisibleOutsideMask=2]="VisibleOutsideMask"})(vn||(vn={}));var Ge,Ev,bv,Cv,Rv,zv,Bv,Lv,Ov,Dv,Fv,Iv,Nv,Uv,kv,Vv,Gv,Wn,Hv,fc=(Ge=(Hv=Wn=function(t){Y(i,t);function i(r){var e;e=t.call(this,r)||this,I(e,"shaderData",Ev,L(e)),I(e,"isCulled",bv,L(e)),I(e,"_distanceForSort",Cv,L(e)),I(e,"_onUpdateIndex",Rv,L(e)),I(e,"_rendererIndex",zv,L(e)),I(e,"_globalShaderMacro",Bv,L(e)),I(e,"_renderSortId",Lv,L(e)),I(e,"_overrideUpdate",Ov,L(e)),I(e,"_materials",Dv,L(e)),I(e,"_transformChangeFlag",Fv,L(e)),I(e,"_bounds",Iv,L(e)),I(e,"_mvMatrix",Nv,L(e)),I(e,"_mvpMatrix",Uv,L(e)),I(e,"_mvInvMatrix",kv,L(e)),I(e,"_normalMatrix",Vv,L(e)),I(e,"_materialsInstanced",Gv,L(e));var n=i.prototype;return e._overrideUpdate=e.update!==n.update,e._transformChangeFlag=e.entity.transform.registerWorldChangeFlag(),e.shaderData._addRefCount(1),e}var a=i.prototype;return a.getInstanceMaterial=function(e){e===void 0&&(e=0);var n=this._materials;if(n.length>e){var o=n[e];if(o)return this._materialsInstanced[e]?o:this._createInstanceMaterial(o,e)}return null},a.getMaterial=function(e){return e===void 0&&(e=0),this._materials[e]||null},a.setMaterial=function(e,n){n===void 0&&(n=null);var o;typeof e=="number"?o=e:(o=0,n=e);var s=this._materials;o>=s.length&&(s.length=o+1);var l=this._materialsInstanced,u=s[o];u!==n&&(s[o]=n,o<l.length&&(l[o]=!1),u&&u._addRefCount(-1),n&&n._addRefCount(1))},a.getInstanceMaterials=function(){for(var e=this._materials,n=this._materialsInstanced,o=0,s=e.length;o<s;o++)n[o]||this._createInstanceMaterial(this._materials[o],o);return e},a.getMaterials=function(){return this._materials},a.setMaterials=function(e){for(var n=e.length,o=this._materials,s=this._materialsInstanced,l=n,u=o.length;l<u;l++){var c=o[l];c&&c._addRefCount(-1)}o.length!==n&&(o.length=n),s.length!==0&&(s.length=0);for(var f=0;f<n;f++){var d=o[f],h=e[f];d!==h&&(o[f]=h,d&&d._addRefCount(-1),h&&h._addRefCount(1))}},a.update=function(e){},a._updateShaderData=function(e){var n=this.shaderData,o=this.entity.transform.worldMatrix,s=this._mvMatrix,l=this._mvpMatrix,u=this._mvInvMatrix,c=this._normalMatrix;Z.multiply(e._camera.viewMatrix,o,s),Z.multiply(e._viewProjectMatrix,o,l),Z.invert(s,u),Z.invert(o,c),c.transpose(),n.setMatrix(i._localMatrixProperty,this.entity.transform.localMatrix),n.setMatrix(i._worldMatrixProperty,o),n.setMatrix(i._mvMatrixProperty,s),n.setMatrix(i._mvpMatrixProperty,l),n.setMatrix(i._mvInvMatrixProperty,u),n.setMatrix(i._normalMatrixProperty,c)},a._onEnable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.addOnUpdateRenderers(this),e.addRenderer(this)},a._onDisable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.removeOnUpdateRenderers(this),e.removeRenderer(this)},a._onDestroy=function(){var e=this._transformChangeFlag;e&&(e.destroy(),this._transformChangeFlag=null),this.shaderData._addRefCount(-1);for(var n=0,o=this._materials.length;n<o;n++)this._materials[n]._addRefCount(-1)},a._updateBounds=function(e){},a._createInstanceMaterial=function(e,n){var o=e.clone();return o.name=o.name+"(Instance)",e._addRefCount(-1),o._addRefCount(1),this._materialsInstanced[n]=!0,this._materials[n]=o,o},$(i,[{key:"materialCount",get:function(){return this._materials.length},set:function(e){var n=this._materials,o=this._materialsInstanced;n.length!==e&&(n.length=e),o.length>e&&(o.length=e)}},{key:"bounds",get:function(){var e=this._transformChangeFlag;return e.flag&&(this._updateBounds(this._bounds),e.flag=!1),this._bounds}}]),i}(Jt),Wn._localMatrixProperty=b.getPropertyByName("u_localMat"),Wn._worldMatrixProperty=b.getPropertyByName("u_modelMat"),Wn._mvMatrixProperty=b.getPropertyByName("u_MVMat"),Wn._mvpMatrixProperty=b.getPropertyByName("u_MVPMat"),Wn._mvInvMatrixProperty=b.getPropertyByName("u_MVInvMat"),Wn._normalMatrixProperty=b.getPropertyByName("u_normalMat"),Hv),Ev=N(Ge.prototype,"shaderData",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Bs(er.Renderer)}}),bv=N(Ge.prototype,"isCulled",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Cv=N(Ge.prototype,"_distanceForSort",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rv=N(Ge.prototype,"_onUpdateIndex",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),zv=N(Ge.prototype,"_rendererIndex",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Bv=N(Ge.prototype,"_globalShaderMacro",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new vr}}),Lv=N(Ge.prototype,"_renderSortId",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ov=N(Ge.prototype,"_overrideUpdate",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Dv=N(Ge.prototype,"_materials",[Qm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fv=N(Ge.prototype,"_transformChangeFlag",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=N(Ge.prototype,"_bounds",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $t(new A,new A)}}),Nv=N(Ge.prototype,"_mvMatrix",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),Uv=N(Ge.prototype,"_mvpMatrix",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),kv=N(Ge.prototype,"_mvInvMatrix",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),Vv=N(Ge.prototype,"_normalMatrix",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),Gv=N(Ge.prototype,"_materialsInstanced",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ge),Ls;(function(t){t[t.Layer0=1]="Layer0",t[t.Layer1=2]="Layer1",t[t.Layer2=4]="Layer2",t[t.Layer3=8]="Layer3",t[t.Layer4=16]="Layer4",t[t.Layer5=32]="Layer5",t[t.Layer6=64]="Layer6",t[t.Layer7=128]="Layer7",t[t.Layer8=256]="Layer8",t[t.Layer9=512]="Layer9",t[t.Layer10=1024]="Layer10",t[t.Layer11=2048]="Layer11",t[t.Layer12=4096]="Layer12",t[t.Layer13=8192]="Layer13",t[t.Layer14=16384]="Layer14",t[t.Layer15=32768]="Layer15",t[t.Layer16=65536]="Layer16",t[t.Layer17=131072]="Layer17",t[t.Layer18=262144]="Layer18",t[t.Layer19=524288]="Layer19",t[t.Layer20=1048576]="Layer20",t[t.Layer21=2097152]="Layer21",t[t.Layer22=4194304]="Layer22",t[t.Layer23=8388608]="Layer23",t[t.Layer24=16777216]="Layer24",t[t.Layer25=33554432]="Layer25",t[t.Layer26=67108864]="Layer26",t[t.Layer27=134217728]="Layer27",t[t.Layer28=268435456]="Layer28",t[t.Layer29=536870912]="Layer29",t[t.Layer30=1073741824]="Layer30",t[t.Layer31=2147483648]="Layer31",t[t.Everything=4294967295]="Everything"})(Ls||(Ls={}));var _n,Wv,jv,Xv,Kv,qv,Qv,Os,Yv,dc=(_n=(Yv=Os=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,e._maskElement=void 0,I(e,"_positions",Wv,L(e)),I(e,"_isSpriteDirty",jv,L(e)),I(e,"_worldMatrixDirtyFlag",Xv,L(e)),I(e,"_sprite",Kv,L(e)),I(e,"_alphaCutoff",qv,L(e)),I(e,"influenceLayers",Qv,L(e)),e._worldMatrixDirtyFlag=r.transform.registerWorldChangeFlag(),e.setMaterial(e._engine._spriteMaskDefaultMaterial),e.shaderData.setFloat(i._alphaCutoffProperty,e._alphaCutoff),e}var a=i.prototype;return a._onDestroy=function(){this._worldMatrixDirtyFlag.destroy(),t.prototype._onDestroy.call(this)},a._render=function(e){var n=this.sprite;if(!n)return null;var o=n.texture;if(!o)return null;var s=this._positions,l=this.entity.transform,u=n._updateMeshData();if(this._worldMatrixDirtyFlag.flag||u||this._isSpriteDirty){for(var c=n._positions,f=i._tempVec3,d=l.worldMatrix,h=0,_=s.length;h<_;h++){var m=c[h];f.setValue(m.x,m.y,0),A.transformToVec3(f,d,s[h])}this._isSpriteDirty=!1,this._worldMatrixDirtyFlag.flag=!1}this.shaderData.setTexture(i._textureProperty,o);var v=this._engine._spriteMaskElementPool,p=v.getFromPool();p.setValue(this,s,n._uv,n._triangles,this.getMaterial()),p.camera=e,e._renderPipeline._allSpriteMasks.add(this),this._maskElement=p},$(i,[{key:"sprite",get:function(){return this._sprite},set:function(e){this._sprite!==e&&(this._sprite=e,this._isSpriteDirty=!0)}},{key:"alphaCutoff",get:function(){return this._alphaCutoff},set:function(e){this._alphaCutoff!==e&&(this._alphaCutoff=e,this.shaderData.setFloat(i._alphaCutoffProperty,e))}}]),i}(fc),Os._textureProperty=b.getPropertyByName("u_maskTexture"),Os._alphaCutoffProperty=b.getPropertyByName("u_maskAlphaCutoff"),Os._tempVec3=new A,Yv),Wv=N(_n.prototype,"_positions",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new A,new A,new A,new A]}}),jv=N(_n.prototype,"_isSpriteDirty",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xv=N(_n.prototype,"_worldMatrixDirtyFlag",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv=N(_n.prototype,"_sprite",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qv=N(_n.prototype,"_alphaCutoff",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Qv=N(_n.prototype,"influenceLayers",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ls.Everything}}),_n),Q;(function(t){t[t.Float=0]="Float",t[t.Vector2=1]="Vector2",t[t.Vector3=2]="Vector3",t[t.Vector4=3]="Vector4",t[t.Byte4=4]="Byte4",t[t.UByte4=5]="UByte4",t[t.NormalizedByte4=6]="NormalizedByte4",t[t.NormalizedUByte4=7]="NormalizedUByte4",t[t.Short2=8]="Short2",t[t.UShort2=9]="UShort2",t[t.NormalizedShort2=10]="NormalizedShort2",t[t.NormalizedUShort2=11]="NormalizedUShort2",t[t.Short4=12]="Short4",t[t.UShort4=13]="UShort4",t[t.NormalizedShort4=14]="NormalizedShort4",t[t.NormalizedUShort4=15]="NormalizedUShort4"})(Q||(Q={}));var jt;(function(t){t[t.Static=0]="Static",t[t.Dynamic=1]="Dynamic",t[t.Stream=2]="Stream"})(jt||(jt={}));var Je;(function(t){t[t.UInt8=0]="UInt8",t[t.UInt16=1]="UInt16",t[t.UInt32=2]="UInt32"})(Je||(Je={}));var Ds=function(){function t(){}return t._getGLBufferUsage=function(a,r){switch(r){case jt.Static:return a.STATIC_DRAW;case jt.Dynamic:return a.DYNAMIC_DRAW;case jt.Stream:return a.STREAM_DRAW}},t._getGLIndexType=function(a){switch(a){case Je.UInt8:return Oe.UNSIGNED_BYTE;case Je.UInt16:return Oe.UNSIGNED_SHORT;case Je.UInt32:return Oe.UNSIGNED_INT}},t._getGLIndexByteCount=function(a){switch(a){case Je.UInt8:return 1;case Je.UInt16:return 2;case Je.UInt32:return 4}},t._getElementInfo=function(a){var r,e,n=!1;switch(a){case Q.Float:r=1,e=Oe.FLOAT;break;case Q.Vector2:r=2,e=Oe.FLOAT;break;case Q.Vector3:r=3,e=Oe.FLOAT;break;case Q.Vector4:r=4,e=Oe.FLOAT;break;case Q.Byte4:r=4,e=Oe.BYTE;break;case Q.UByte4:r=4,e=Oe.UNSIGNED_BYTE;break;case Q.NormalizedByte4:r=4,e=Oe.BYTE,n=!0;break;case Q.NormalizedUByte4:r=4,e=Oe.UNSIGNED_BYTE,n=!0;break;case Q.Short2:r=2,e=Oe.SHORT;break;case Q.UShort2:r=2,e=Oe.UNSIGNED_SHORT;break;case Q.NormalizedShort2:r=2,e=Oe.SHORT,n=!0;break;case Q.NormalizedUShort2:r=2,e=Oe.UNSIGNED_SHORT,n=!0;break;case Q.Short4:r=4,e=Oe.SHORT;break;case Q.UShort4:r=4,e=Oe.UNSIGNED_SHORT;break;case Q.NormalizedShort4:r=4,e=Oe.SHORT,n=!0;break;case Q.NormalizedUShort4:r=4,e=Oe.UNSIGNED_SHORT,n=!0;break}return{size:r,type:e,normalized:n}},t}(),ve=function(){function t(i,a,r,e,n){n===void 0&&(n=0),this._glElementInfo=void 0,this._semantic=void 0,this._offset=void 0,this._format=void 0,this._bindingIndex=void 0,this._instanceStepRate=void 0,this._semantic=i,this._offset=a,this._format=r,this._bindingIndex=e,this._glElementInfo=Ds._getElementInfo(this.format),this._instanceStepRate=Math.floor(n)}return $(t,[{key:"semantic",get:function(){return this._semantic}},{key:"offset",get:function(){return this._offset}},{key:"format",get:function(){return this._format}},{key:"bindingIndex",get:function(){return this._bindingIndex}},{key:"instanceStepRate",get:function(){return this._instanceStepRate}}]),t}(),Or;(function(t){t[t.VertexBuffer=0]="VertexBuffer",t[t.IndexBuffer=1]="IndexBuffer"})(Or||(Or={}));var Fs;(function(t){t[t.None=0]="None",t[t.Discard=1]="Discard"})(Fs||(Fs={}));var Ni=function(t){Y(i,t);function i(r,e,n,o){var s;o===void 0&&(o=jt.Static),s=t.call(this,r)||this,s._glBindTarget=void 0,s._glBufferUsage=void 0,s._nativeBuffer=void 0,s._hardwareRenderer=void 0,s._type=void 0,s._byteLength=void 0,s._bufferUsage=void 0,s._engine=r,s._type=e,s._bufferUsage=o;var l=r._hardwareRenderer,u=l.gl,c=Ds._getGLBufferUsage(u,o),f=e===Or.VertexBuffer?u.ARRAY_BUFFER:u.ELEMENT_ARRAY_BUFFER;return s._nativeBuffer=u.createBuffer(),s._hardwareRenderer=l,s._glBufferUsage=c,s._glBindTarget=f,s.bind(),typeof n=="number"?(s._byteLength=n,u.bufferData(f,n,c)):(s._byteLength=n.byteLength,u.bufferData(f,n,c)),u.bindBuffer(f,null),s}var a=i.prototype;return a.bind=function(){var e=this._hardwareRenderer.gl;e.bindBuffer(this._glBindTarget,this._nativeBuffer)},a.setData=function(e,n,o,s,l){n===void 0&&(n=0),o===void 0&&(o=0),l===void 0&&(l=Fs.None);var u=this._hardwareRenderer.gl,c=this._hardwareRenderer.isWebGL2,f=this._glBindTarget;this.bind(),l===Fs.Discard&&u.bufferData(f,this._byteLength,this._glBufferUsage);var d=e.BYTES_PER_ELEMENT||1,h=s?d*s:e.byteLength;if(o!==0||h<e.byteLength){var _=e.byteOffset!==void 0;if(c&&_)u.bufferSubData(f,n,e,o,h/d);else{var m=new Uint8Array(_?e.buffer:e,o*d,h);u.bufferSubData(f,n,m)}}else u.bufferSubData(f,n,e);u.bindBuffer(f,null)},a.getData=function(e,n,o,s){n===void 0&&(n=0),o===void 0&&(o=0);var l=this._hardwareRenderer.isWebGL2;if(l){var u=this._hardwareRenderer.gl;this.bind(),u.getBufferSubData(this._glBindTarget,n,e,o,s)}else throw"Buffer is write-only on WebGL1.0 platforms."},a._onDestroy=function(){var e=this._hardwareRenderer.gl;e.deleteBuffer(this._nativeBuffer),this._nativeBuffer=null,this._hardwareRenderer=null},a.resize=function(e){this.bind();var n=this._hardwareRenderer.gl;n.bufferData(this._glBindTarget,e,this._glBufferUsage),this._byteLength=e},$(i,[{key:"type",get:function(){return this._type}},{key:"byteLength",get:function(){return this._byteLength}},{key:"bufferUsage",get:function(){return this._bufferUsage}}]),i}(Di),qa;(function(t){t[t.Points=0]="Points",t[t.Lines=1]="Lines",t[t.LineLoop=2]="LineLoop",t[t.LineStrip=3]="LineStrip",t[t.Triangles=4]="Triangles",t[t.TriangleStrip=5]="TriangleStrip",t[t.TriangleFan=6]="TriangleFan"})(qa||(qa={}));var hc=function(){function t(i,a){this._buffer=void 0,this._format=void 0,this._buffer=i,this._format=a}return $(t,[{key:"buffer",get:function(){return this._buffer}},{key:"format",get:function(){return this._format}}]),t}(),$v=function(i,a,r){i===void 0&&(i=0),a===void 0&&(a=0),r===void 0&&(r=qa.Triangles),this.start=void 0,this.count=void 0,this.topology=void 0,this.start=i,this.count=a,this.topology=r},Zv=function(t){Y(i,t);function i(r,e){var n;return n=t.call(this,r)||this,n.name=void 0,n.bounds=new $t,n._vertexElementMap={},n._glIndexType=void 0,n._glIndexByteCount=void 0,n._platformPrimitive=void 0,n._instanceCount=0,n._vertexBufferBindings=[],n._indexBufferBinding=null,n._vertexElements=[],n._subMeshes=[],n._updateFlagManager=new zs,n.name=e,n._platformPrimitive=n._engine._hardwareRenderer.createPlatformPrimitive(L(n)),n}var a=i.prototype;return a.addSubMesh=function(e,n,o){return o===void 0&&(o=qa.Triangles),typeof e=="number"&&(e=new $v(e,n,o)),this._subMeshes.push(e),e},a.removeSubMesh=function(e){var n=this._subMeshes,o=n.indexOf(e);o!==-1&&n.splice(o,1)},a.clearSubMesh=function(){this._subMeshes.length=0},a.registerUpdateFlag=function(){return this._updateFlagManager.register()},a._draw=function(e,n){this._platformPrimitive.draw(e,n)},a._addRefCount=function(e){t.prototype._addRefCount.call(this,e);for(var n=this._vertexBufferBindings,o=0,s=n.length;o<s;o++)n[o]._buffer._addRefCount(e)},a._onDestroy=function(){this._vertexBufferBindings=null,this._indexBufferBinding=null,this._vertexElements=null,this._vertexElementMap=null,this._platformPrimitive.destroy()},a._setVertexElements=function(e){this._clearVertexElements();for(var n=0,o=e.length;n<o;n++)this._addVertexElement(e[n])},a._setVertexBufferBinding=function(e,n){if(this._getRefCount()>0){var o=this._vertexBufferBindings[e];o&&o._buffer._addRefCount(-1),n._buffer._addRefCount(1)}this._vertexBufferBindings[e]=n},a._setIndexBufferBinding=function(e){e?(this._indexBufferBinding=e,this._glIndexType=Ds._getGLIndexType(e.format),this._glIndexByteCount=Ds._getGLIndexByteCount(e.format)):(this._indexBufferBinding=null,this._glIndexType=void 0)},a._clearVertexElements=function(){this._vertexElements.length=0;var e=this._vertexElementMap;for(var n in e)delete e[n]},a._addVertexElement=function(e){var n=e.semantic;this._vertexElementMap[n]=e,this._vertexElements.push(e),this._updateFlagManager.distribute()},$(i,[{key:"subMesh",get:function(){return this._subMeshes[0]||null}},{key:"subMeshes",get:function(){return this._subMeshes}}]),i}(Di),Jv=function(){function t(i,a){this._buffer=void 0,this._stride=void 0,this._buffer=i,this._stride=a}return $(t,[{key:"buffer",get:function(){return this._buffer}},{key:"stride",get:function(){return this._stride}}]),t}(),mr;(function(t){t[t.Point=0]="Point",t[t.Bilinear=1]="Bilinear",t[t.Trilinear=2]="Trilinear"})(mr||(mr={}));var ee;(function(t){t[t.R8G8B8=0]="R8G8B8",t[t.R8G8B8A8=1]="R8G8B8A8",t[t.R4G4B4A4=2]="R4G4B4A4",t[t.R5G5B5A1=3]="R5G5B5A1",t[t.R5G6B5=4]="R5G6B5",t[t.Alpha8=5]="Alpha8",t[t.LuminanceAlpha=6]="LuminanceAlpha",t[t.R32G32B32A32=7]="R32G32B32A32",t[t.DXT1=8]="DXT1",t[t.DXT5=9]="DXT5",t[t.ETC1_RGB=10]="ETC1_RGB",t[t.ETC2_RGB=11]="ETC2_RGB",t[t.ETC2_RGBA5=12]="ETC2_RGBA5",t[t.ETC2_RGBA8=13]="ETC2_RGBA8",t[t.PVRTC_RGB2=14]="PVRTC_RGB2",t[t.PVRTC_RGBA2=15]="PVRTC_RGBA2",t[t.PVRTC_RGB4=16]="PVRTC_RGB4",t[t.PVRTC_RGBA4=17]="PVRTC_RGBA4",t[t.ASTC_4x4=18]="ASTC_4x4",t[t.ASTC_5x5=19]="ASTC_5x5",t[t.ASTC_6x6=20]="ASTC_6x6",t[t.ASTC_8x8=21]="ASTC_8x8",t[t.ASTC_10x10=22]="ASTC_10x10",t[t.ASTC_12x12=23]="ASTC_12x12"})(ee||(ee={}));var St;(function(t){t[t.Clamp=0]="Clamp",t[t.Repeat=1]="Repeat",t[t.Mirror=2]="Mirror"})(St||(St={}));var Ui=function(t){Y(i,t);function i(r,e,n,o,s){var l;return o===void 0&&(o=ee.R8G8B8A8),s===void 0&&(s=!0),l=t.call(this,r)||this,l._format=void 0,l._mipmap=s,l._width=e,l._height=n,l._format=o,l._mipmapCount=l._getMipmapCount(),l._platformTexture=r._hardwareRenderer.createPlatformTexture2D(L(l)),l.filterMode=mr.Bilinear,l.wrapModeU=l.wrapModeV=St.Repeat,l}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,u){n===void 0&&(n=0),this._platformTexture.setPixelBuffer(e,n,o,s,l,u)},a.setImageSource=function(e,n,o,s,l,u){n===void 0&&(n=0),o===void 0&&(o=!1),s===void 0&&(s=!1),this._platformTexture.setImageSource(e,n,o,s,l,u)},a.getPixelBuffer=function(e,n,o,s,l){this._platformTexture.getPixelBuffer(e,n,o,s,l)},$(i,[{key:"format",get:function(){return this._format}}]),i}(tr),Pt;(function(t){t[t.R8G8B8=0]="R8G8B8",t[t.R8G8B8A8=1]="R8G8B8A8",t[t.R4G4B4A4=2]="R4G4B4A4",t[t.R5G5B5A1=3]="R5G5B5A1",t[t.R5G6B5=4]="R5G6B5",t[t.Alpha8=5]="Alpha8",t[t.R16G16B16A16=6]="R16G16B16A16",t[t.R32G32B32A32=7]="R32G32B32A32"})(Pt||(Pt={}));var He;(function(t){t[t.Depth=0]="Depth",t[t.DepthStencil=1]="DepthStencil",t[t.Stencil=2]="Stencil",t[t.Depth16=3]="Depth16",t[t.Depth24=4]="Depth24",t[t.Depth32=5]="Depth32",t[t.Depth24Stencil8=6]="Depth24Stencil8",t[t.Depth32Stencil8=7]="Depth32Stencil8"})(He||(He={}));var yr;(function(t){t[t.PositiveX=0]="PositiveX",t[t.NegativeX=1]="NegativeX",t[t.PositiveY=2]="PositiveY",t[t.NegativeY=3]="NegativeY",t[t.PositiveZ=4]="PositiveZ",t[t.NegativeZ=5]="NegativeZ"})(yr||(yr={}));var vc=function(t){Y(i,t);function i(r,e,n,o){var s;return n===void 0&&(n=ee.R8G8B8A8),o===void 0&&(o=!0),s=t.call(this,r)||this,s._format=void 0,s._mipmap=o,s._width=e,s._height=e,s._format=n,s._mipmapCount=s._getMipmapCount(),s._platformTexture=r._hardwareRenderer.createPlatformTextureCubeMap(L(s)),s.filterMode=mr.Bilinear,s.wrapModeU=s.wrapModeV=St.Clamp,s}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,u,c){o===void 0&&(o=0),this._platformTexture.setPixelBuffer(e,n,o,s,l,u,c)},a.setImageSource=function(e,n,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),this._platformTexture.setImageSource(e,n,o,s,l,u,c)},a.getPixelBuffer=function(e,n,o,s,l,u){this._platformTexture.getPixelBuffer(e,n,o,s,l,u)},$(i,[{key:"format",get:function(){return this._format}}]),i}(tr),Qa=function(t){Y(i,t);function i(a,r,e,n,o,s){var l;return n===void 0&&(n=He.Depth),o===void 0&&(o=!1),s===void 0&&(s=!1),l=t.call(this,a)||this,l._autoMipmap=!1,l._format=void 0,l._isCube=!1,l._isCube=s,l._mipmap=o,l._width=r,l._height=e,l._format=n,l._mipmapCount=l._getMipmapCount(),l._platformTexture=a._hardwareRenderer.createPlatformRenderDepthTexture(L(l)),l.filterMode=mr.Bilinear,l.wrapModeU=l.wrapModeV=St.Clamp,l}return $(i,[{key:"format",get:function(){return this._format}},{key:"isCube",get:function(){return this._isCube}},{key:"autoGenerateMipmaps",get:function(){return this._autoMipmap},set:function(r){this._autoMipmap=r}}]),i}(tr),Ty=function(t){Y(i,t);function i(r,e,n,o,s,l){var u;return s===void 0&&(s=He.Depth),l===void 0&&(l=1),u=t.call(this,r)||this,u._platformRenderTarget=void 0,u._colorTextures=void 0,u._depth=void 0,u._antiAliasing=void 0,u._width=void 0,u._height=void 0,u._depthTexture=void 0,u._width=e,u._height=n,u._antiAliasing=l,u._depth=s,o?u._colorTextures=o instanceof Array?o.slice():[o]:u._colorTextures=[],s instanceof Qa&&(u._depthTexture=s),u._platformRenderTarget=r._hardwareRenderer.createPlatformRenderTarget(L(u)),u}var a=i.prototype;return a.getColorTexture=function(e){return e===void 0&&(e=0),this._colorTextures[e]},a.generateMipmaps=function(){var e,n=this.colorTextureCount;(e=this._depthTexture)!==null&&e!==void 0&&e.autoGenerateMipmaps&&this._depthTexture.generateMipmaps();for(var o=0;o<n;o++){var s=this._colorTextures[o];s.autoGenerateMipmaps&&s.generateMipmaps()}},a.destroy=function(){this._platformRenderTarget.destroy(),this._colorTextures.length=0,this._depthTexture=null,this._depth=null},a._setRenderTargetFace=function(e){this._platformRenderTarget.setRenderTargetFace(e)},a._blitRenderTarget=function(){this._platformRenderTarget.blitRenderTarget()},$(i,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"colorTextureCount",get:function(){return this._colorTextures.length}},{key:"depthTexture",get:function(){return this._depthTexture}},{key:"antiAliasing",get:function(){return this._antiAliasing}}]),i}(Br),My=function(t){Y(i,t);function i(r,e,n,o,s,l){var u;return o===void 0&&(o=Pt.R8G8B8A8),s===void 0&&(s=!1),l===void 0&&(l=!1),u=t.call(this,r)||this,u._autoMipmap=!1,u._format=void 0,u._isCube=!1,u._isCube=l,u._mipmap=s,u._width=e,u._height=n,u._format=o,u._mipmapCount=u._getMipmapCount(),u._platformTexture=r._hardwareRenderer.createPlatformRenderColorTexture(L(u)),u.filterMode=mr.Bilinear,u.wrapModeU=u.wrapModeV=St.Clamp,u}var a=i.prototype;return a.getPixelBuffer=function(e,n,o,s,l,u){this._platformTexture.getPixelBuffer(e,n,o,s,l,u)},$(i,[{key:"format",get:function(){return this._format}},{key:"isCube",get:function(){return this._isCube}},{key:"autoGenerateMipmaps",get:function(){return this._autoMipmap},set:function(e){this._autoMipmap=e}}]),i}(tr),jn=function(t){Y(i,t);function i(r,e){var n;return n=t.call(this,r)||this,n._hasBlendShape=!1,n._useBlendShapeNormal=!1,n._useBlendShapeTangent=!1,n._blendShapeTexture=void 0,n._vertexCount=0,n._accessible=!0,n._verticesFloat32=null,n._verticesUint8=null,n._indices=null,n._indicesFormat=null,n._vertexSlotChanged=!0,n._vertexChangeFlag=0,n._indicesChangeFlag=!1,n._elementCount=0,n._vertexElementsCache=[],n._positions=[],n._normals=null,n._colors=null,n._tangents=null,n._uv=null,n._uv1=null,n._uv2=null,n._uv3=null,n._uv4=null,n._uv5=null,n._uv6=null,n._uv7=null,n._boneWeights=null,n._boneIndices=null,n._blendShapes=[],n._blendShapeUpdateFlags=[],n.name=e,n}var a=i.prototype;return a.setPositions=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";var n=e.length;this._positions=e,this._vertexChangeFlag|=ce.Position,this._vertexCount!==n&&(this._vertexCount=n)},a.getPositions=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._positions},a.setNormals=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._normals!=!!e,this._vertexChangeFlag|=ce.Normal,this._normals=e},a.getNormals=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._normals},a.setColors=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._colors!=!!e,this._vertexChangeFlag|=ce.Color,this._colors=e},a.getColors=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._colors},a.setBoneWeights=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=e!=null,this._vertexChangeFlag|=ce.BoneWeight,this._boneWeights=e},a.getBoneWeights=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneWeights},a.setBoneIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._boneIndices!=!!e,this._vertexChangeFlag|=ce.BoneIndex,this._boneIndices=e},a.getBoneIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneIndices},a.setTangents=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._tangents!=!!e,this._vertexChangeFlag|=ce.Tangent,this._tangents=e},a.getTangents=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._tangents},a.setUVs=function(e,n){var o;if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";switch(n=(o=n)!=null?o:0,n){case 0:this._vertexSlotChanged=!!this._uv!=!!e,this._vertexChangeFlag|=ce.UV,this._uv=e;break;case 1:this._vertexSlotChanged=!!this._uv1!=!!e,this._vertexChangeFlag|=ce.UV1,this._uv1=e;break;case 2:this._vertexSlotChanged=!!this._uv2!=!!e,this._vertexChangeFlag|=ce.UV2,this._uv2=e;break;case 3:this._vertexSlotChanged=!!this._uv3!=!!e,this._vertexChangeFlag|=ce.UV3,this._uv3=e;break;case 4:this._vertexSlotChanged=!!this._uv4!=!!e,this._vertexChangeFlag|=ce.UV4,this._uv4=e;break;case 5:this._vertexSlotChanged=!!this._uv5!=!!e,this._vertexChangeFlag|=ce.UV5,this._uv5=e;break;case 6:this._vertexSlotChanged=!!this._uv6!=!!e,this._vertexChangeFlag|=ce.UV6,this._uv6=e;break;case 7:this._vertexSlotChanged=!!this._uv7!=!!e,this._vertexChangeFlag|=ce.UV7,this._uv7=e;break;default:throw"The index of channel needs to be in range [0 - 7]."}},a.getUVs=function(e){var n;if(!this._accessible)throw"Not allowed to access data while accessible is false.";switch(e=(n=e)!=null?n:0,e){case 0:return this._uv;case 1:return this._uv1;case 2:return this._uv2;case 3:return this._uv3;case 4:return this._uv4;case 5:return this._uv5;case 6:return this._uv6;case 7:return this._uv7}throw"The index of channel needs to be in range [0 - 7]."},a.setIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._indices!==e&&(this._indices=e,e instanceof Uint8Array?this._indicesFormat=Je.UInt8:e instanceof Uint16Array?this._indicesFormat=Je.UInt16:e instanceof Uint32Array&&(this._indicesFormat=Je.UInt32)),this._indicesChangeFlag=!0},a.getIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._indices},a.addBlendShape=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._vertexChangeFlag|=ce.BlendShape,this._useBlendShapeNormal=this._useBlendShapeNormal||e._useBlendShapeNormal,this._useBlendShapeTangent=this._useBlendShapeTangent||e._useBlendShapeTangent,this._blendShapes.push(e),this._blendShapeUpdateFlags.push(e._registerChangeFlag()),this._hasBlendShape=!0},a.clearBlendShapes=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._vertexChangeFlag|=ce.BlendShape,this._useBlendShapeNormal=!1,this._useBlendShapeTangent=!1,this._blendShapes.length=0;for(var e=this._blendShapeUpdateFlags,n=0,o=e.length;n<o;n++)e[n].destroy();e.length=0,this._hasBlendShape=!1},a.uploadData=function(e){var n,o;if(!this._accessible)throw"Not allowed to access data while accessible is false.";var s=this._indices;if(this._vertexSlotChanged){var l=this._updateVertexElements();this._setVertexElements(l),this._vertexChangeFlag=ce.All,this._vertexSlotChanged=!1}var u=this._vertexBufferBindings,c=this._elementCount,f=(n=u[0])===null||n===void 0?void 0:n._buffer,d=c*this._vertexCount;if(!f||this._verticesFloat32.length!==d){f==null||f.destroy();var h=new Float32Array(d);this._verticesFloat32=h,this._verticesUint8=new Uint8Array(h.buffer),this._vertexChangeFlag=ce.All,this._updateVertices(h);var _=new Ni(this._engine,Or.VertexBuffer,h,e?jt.Static:jt.Dynamic);this._setVertexBufferBinding(0,new Jv(_,c*4))}else if(this._vertexChangeFlag&ce.All){var m=this._verticesFloat32;this._updateVertices(m),f.setData(m)}var v=(o=this._indexBufferBinding)===null||o===void 0?void 0:o._buffer;if(s)if(!v||s.byteLength!=v.byteLength){v==null||v.destroy();var p=new Ni(this._engine,Or.IndexBuffer,s);this._setIndexBufferBinding(new hc(p,this._indicesFormat))}else this._indicesChangeFlag&&(this._indicesChangeFlag=!1,v.setData(s),this._indexBufferBinding._format!==this._indicesFormat&&this._setIndexBufferBinding(new hc(v,this._indicesFormat)));else v&&(v.destroy(),this._setIndexBufferBinding(null));e&&(this._accessible=!1,this._releaseCache())},a._onDestroy=function(){t.prototype._onDestroy.call(this),this._accessible&&this._releaseCache()},a._updateVertexElements=function(){var e=this._vertexElementsCache;e.length=1,e[0]=Ey;var n=12,o=3;this._normals&&(e.push(new ve("NORMAL",n,Q.Vector3,0)),n+=12,o+=3),this._colors&&(e.push(new ve("COLOR_0",n,Q.Vector4,0)),n+=16,o+=4),this._boneWeights&&(e.push(new ve("WEIGHTS_0",n,Q.Vector4,0)),n+=16,o+=4),this._boneIndices&&(e.push(new ve("JOINTS_0",n,Q.UByte4,0)),n+=4,o+=1),this._tangents&&(e.push(new ve("TANGENT",n,Q.Vector4,0)),n+=16,o+=4),this._uv&&(e.push(new ve("TEXCOORD_0",n,Q.Vector2,0)),n+=8,o+=2),this._uv1&&(e.push(new ve("TEXCOORD_1",n,Q.Vector2,0)),n+=8,o+=2),this._uv2&&(e.push(new ve("TEXCOORD_2",n,Q.Vector2,0)),n+=8,o+=2),this._uv3&&(e.push(new ve("TEXCOORD_3",n,Q.Vector2,0)),n+=8,o+=2),this._uv4&&(e.push(new ve("TEXCOORD_4",n,Q.Vector2,0)),n+=8,o+=2),this._uv5&&(e.push(new ve("TEXCOORD_5",n,Q.Vector2,0)),n+=8,o+=2),this._uv6&&(e.push(new ve("TEXCOORD_6",n,Q.Vector2,0)),n+=8,o+=2),this._uv7&&(e.push(new ve("TEXCOORD_7",n,Q.Vector2,0)),n+=8,o+=2);for(var s=Math.min(this._blendShapes.length,4),l=0,u=s;l<u;l++)e.push(new ve("POSITION_BS"+l,n,Q.Vector3,0)),n+=12,o+=3,this._useBlendShapeNormal&&(e.push(new ve("NORMAL_BS"+l,n,Q.Vector3,0)),n+=12,o+=3),this._useBlendShapeTangent&&(e.push(new ve("TANGENT_BS"+l,n,Q.Vector3,0)),n+=12,o+=3);return this._elementCount=o,e},a._updateVertices=function(e){var n=this._elementCount,o=this._vertexCount,s=this._positions,l=this._normals,u=this._colors,c=this._vertexChangeFlag,f=this._boneWeights,d=this._boneIndices,h=this._tangents,_=this._uv,m=this._uv1,v=this._uv2,p=this._uv3,g=this._uv4,y=this._uv5,x=this._uv6,T=this._uv7;if(c&ce.Position)for(var w=0;w<o;w++){var S=n*w,M=s[w];e[S]=M.x,e[S+1]=M.y,e[S+2]=M.z}var P=3;if(l){if(c&ce.Normal)for(var E=0;E<o;E++){var R=n*E+P,C=l[E];C&&(e[R]=C.x,e[R+1]=C.y,e[R+2]=C.z)}P+=3}if(u){if(c&ce.Color)for(var z=0;z<o;z++){var k=n*z+P,D=u[z];D&&(e[k]=D.r,e[k+1]=D.g,e[k+2]=D.b,e[k+3]=D.a)}P+=4}if(f){if(c&ce.BoneWeight)for(var H=0;H<o;H++){var W=n*H+P,K=f[H];K&&(e[W]=K.x,e[W+1]=K.y,e[W+2]=K.z,e[W+3]=K.w)}P+=4}if(d){if(c&ce.BoneIndex)for(var F=this._verticesUint8,te=0;te<o;te++){var B=n*te+P,V=d[te];if(V){var j=B*4;F[j]=V.x,F[j+1]=V.y,F[j+2]=V.z,F[j+3]=V.w}}P+=1}if(h){if(c&ce.Tangent)for(var re=0;re<o;re++){var se=n*re+P,_e=h[re];_e&&(e[se]=_e.x,e[se+1]=_e.y,e[se+2]=_e.z)}P+=4}if(_){if(c&ce.UV)for(var de=0;de<o;de++){var Ae=n*de+P,Te=_[de];Te&&(e[Ae]=Te.x,e[Ae+1]=Te.y)}P+=2}if(m){if(c&ce.UV1)for(var Ke=0;Ke<o;Ke++){var Et=n*Ke+P,et=m[Ke];et&&(e[Et]=et.x,e[Et+1]=et.y)}P+=2}if(v){if(c&ce.UV2)for(var ut=0;ut<o;ut++){var qe=n*ut+P,pt=v[ut];pt&&(e[qe]=pt.x,e[qe+1]=pt.y)}P+=2}if(p){if(c&ce.UV3)for(var ct=0;ct<o;ct++){var gt=n*ct+P,tt=p[ct];tt&&(e[gt]=tt.x,e[gt+1]=tt.y)}P+=2}if(g){if(c&ce.UV4)for(var Be=0;Be<o;Be++){var Me=n*Be+P,Sr=g[Be];Sr&&(e[Me]=Sr.x,e[Me+1]=Sr.y)}P+=2}if(y){if(c&ce.UV5)for(var Sn=0;Sn<o;Sn++){var ho=n*Sn+P,Pn=y[Sn];Pn&&(e[ho]=Pn.x,e[ho+1]=Pn.y)}P+=2}if(x){if(c&ce.UV6)for(var An=0;An<o;An++){var Tn=n*An+P,Mn=x[An];Mn&&(e[Tn]=Mn.x,e[Tn+1]=Mn.y)}P+=2}if(T){if(c&ce.UV7)for(var En=0;En<o;En++){var Ki=n*En+P,Gr=T[En];Gr&&(e[Ki]=Gr.x,e[Ki+1]=Gr.y)}P+=2}if(c&ce.BlendShape){var Bc=this._blendShapes,L0=this._blendShapeUpdateFlags,O0=Math.min(Bc.length,4);this.engine._hardwareRenderer;for(var vo=0;vo<O0;vo++){var Lc=L0[vo];if(Lc.flag){var D0=Bc[vo],Oc=D0.frames,Dc=Oc.length,_o=Oc[Dc-1];if(Dc>0&&_o.deltaPositions.length!==this._vertexCount)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";for(var F0=_o.deltaPositions,po=0;po<o;po++){var Ys=n*po+P,go=F0[po];go&&(e[Ys]=go.x,e[Ys+1]=go.y,e[Ys+2]=go.z)}if(P+=3,this._useBlendShapeNormal){var Fc=_o.deltaNormals;if(Fc)for(var mo=0;mo<o;mo++){var $s=n*mo+P,yo=Fc[mo];yo&&(e[$s]=yo.x,e[$s+1]=yo.y,e[$s+2]=yo.z)}P+=3}if(this._useBlendShapeTangent){var Ic=_o.deltaTangents;if(Ic)for(var xo=0;xo<o;xo++){var Zs=n*xo+P,wo=Ic[xo];wo&&(e[Zs]=wo.x,e[Zs+1]=wo.y,e[Zs+2]=wo.z)}P+=3}Lc.flag=!1}}}this._vertexChangeFlag=0},a._releaseCache=function(){for(var e=this._blendShapeUpdateFlags,n=0,o=e.length;n<o;n++)e[n].destroy();this._verticesUint8=null,this._indices=null,this._verticesFloat32=null,this._positions.length=0,this._tangents=null,this._normals=null,this._colors=null,this._uv=null,this._uv1=null,this._uv2=null,this._uv3=null,this._uv4=null,this._uv5=null,this._uv6=null,this._uv7=null,this._blendShapes=null,this._blendShapeUpdateFlags=null},$(i,[{key:"accessible",get:function(){return this._accessible}},{key:"vertexCount",get:function(){return this._vertexCount}},{key:"blendShapes",get:function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._blendShapes}}]),i}(Zv),Ey=new ve("POSITION",0,Q.Vector3,0),ce;(function(t){t[t.Position=1]="Position",t[t.Normal=2]="Normal",t[t.Color=4]="Color",t[t.Tangent=8]="Tangent",t[t.BoneWeight=16]="BoneWeight",t[t.BoneIndex=32]="BoneIndex",t[t.UV=64]="UV",t[t.UV1=128]="UV1",t[t.UV2=256]="UV2",t[t.UV3=512]="UV3",t[t.UV4=1024]="UV4",t[t.UV5=2048]="UV5",t[t.UV6=4096]="UV6",t[t.UV7=8192]="UV7",t[t.BlendShape=16384]="BlendShape",t[t.All=65535]="All"})(ce||(ce={}));var by=function(t){Y(i,t);function i(a){var r;return r=t.call(this,null)||this,r.name=a,r.inverseBindMatrices=void 0,r.joints=void 0,r.skeleton=void 0,r.inverseBindMatrices=[],r.joints=[],r.skeleton="none",r}return i}(Br),Is,e_,t_,Ya,r_,$a=(Is=(r_=Ya=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,I(e,"_mesh",e_,L(e)),I(e,"_meshUpdateFlag",t_,L(e)),e}var a=i.prototype;return a._render=function(e){var n=this._mesh;if(n){if(this._meshUpdateFlag.flag){var o=this.shaderData,s=n._vertexElements;o.disableMacro(i._uvMacro),o.disableMacro(i._normalMacro),o.disableMacro(i._tangentMacro),o.disableMacro(i._vertexColorMacro);for(var l=0,u=s.length;l<u;l++){var c=s[l].semantic;switch(c){case"TEXCOORD_0":o.enableMacro(i._uvMacro);break;case"NORMAL":o.enableMacro(i._normalMacro);break;case"TANGENT":o.enableMacro(i._tangentMacro);break;case"COLOR_0":o.enableMacro(i._vertexColorMacro);break}}this._meshUpdateFlag.flag=!1}for(var f=n.subMeshes,d=e._renderPipeline,h=this._engine._renderElementPool,_=0,m=f.length;_<m;_++){var v=this._materials[_];if(v){var p=h.getFromPool();p.setValue(this,n,f[_],v),d.pushPrimitive(p)}}}},a._onDestroy=function(){t.prototype._onDestroy.call(this);var e=this._mesh;e&&!e.destroyed&&(e._addRefCount(-1),this._mesh=null)},a._cloneTo=function(e){e.mesh=this._mesh},a._updateBounds=function(e){var n=this._mesh;if(n){var o=n.bounds,s=this._entity.transform.worldMatrix;$t.transform(o,s,e)}else e.min.setValue(0,0,0),e.max.setValue(0,0,0)},$(i,[{key:"mesh",get:function(){return this._mesh},set:function(e){var n=this._mesh;n!==e&&(n&&(n._addRefCount(-1),this._meshUpdateFlag.destroy()),e&&(e._addRefCount(1),this._meshUpdateFlag=e.registerUpdateFlag()),this._mesh=e)}}]),i}(fc),Ya._uvMacro=b.getMacroByName("O3_HAS_UV"),Ya._normalMacro=b.getMacroByName("O3_HAS_NORMAL"),Ya._tangentMacro=b.getMacroByName("O3_HAS_TANGENT"),Ya._vertexColorMacro=b.getMacroByName("O3_HAS_VERTEXCOLOR"),r_),e_=N(Is.prototype,"_mesh",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=N(Is.prototype,"_meshUpdateFlag",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is),pn,n_,i_,a_,o_,s_,l_,Dr,u_,Ns=(pn=(u_=Dr=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,I(e,"matrixPalette",n_,L(e)),I(e,"jointNodes",i_,L(e)),I(e,"jointTexture",a_,L(e)),I(e,"_hasInitJoints",o_,L(e)),I(e,"_mat",s_,L(e)),I(e,"_useJointTexture",l_,L(e)),e._skin=void 0,e._blendShapeWeights=void 0,e._mat=new Z,e._skin=null,e}var a=i.prototype;return a._updateShaderData=function(e){t.prototype._updateShaderData.call(this,e);var n=this.shaderData;!this._useJointTexture&&this.matrixPalette&&n.setFloatArray(i._jointMatrixProperty,this.matrixPalette);var o=this.mesh;o._hasBlendShape?(n.setFloatArray(i._blendShapeWeightsProperty,this._blendShapeWeights),n.enableMacro(i._blendShapeMacro),o._useBlendShapeNormal?n.enableMacro(i._blendShapeNormalMacro):n.disableMacro(i._blendShapeNormalMacro),o._useBlendShapeTangent?n.enableMacro(i._blendShapeTangentMacro):n.disableMacro(i._blendShapeTangentMacro)):n.disableMacro(i._blendShapeMacro)},a._initJoints=function(){var e;if(!!this._skin){for(var n=this._skin,o=n.joints,s=[],l=o.length-1;l>=0;l--)s[l]=this.findByNodeName(this.entity,o[l]);this.matrixPalette=new Float32Array(s.length*16),this.jointNodes=s;var u=this.entity.engine._hardwareRenderer;if(!!u){var c=u.renderStates.getParameter(u.gl.MAX_VERTEX_UNIFORM_VECTORS),f=Math.floor((c-20)/4),d=this.shaderData,h=(e=this.jointNodes)===null||e===void 0?void 0:e.length;if(h)if(d.enableMacro("O3_HAS_SKIN"),d.setInt(i._jointCountProperty,h),o.length>f)u.canIUseMoreJoints&&(this._useJointTexture=!0);else{var _=Math.max(i._maxJoints,o.length);i._maxJoints=_,d.disableMacro("O3_USE_JOINT_TEXTURE"),d.enableMacro("O3_JOINTS_NUM",_.toString())}else d.disableMacro("O3_HAS_SKIN")}}},a.findByNodeName=function(e,n){if(!e)return null;var o=e.findByName(n);return o||this.findByNodeName(e.parent,n)},a.update=function(){if(this._hasInitJoints||(this._initJoints(),this._hasInitJoints=!0),this._skin){for(var e=this.jointNodes,n=this._skin.inverseBindMatrices,o=this.matrixPalette,s=this.entity.getInvModelMatrix(),l=this._mat,u=e.length-1;u>=0;u--)l.identity(),e[u]?Z.multiply(e[u].transform.worldMatrix,n[u],l):n[u].cloneTo(l),Z.multiply(s,l,l),o.set(l.elements,u*16);this._useJointTexture&&this.createJointTexture()}},a.createJointTexture=function(){if(!this.jointTexture){var e=this.engine,n=e._hardwareRenderer;if(!n)return;this.jointTexture=new Ui(e,4,this.jointNodes.length,ee.R32G32B32A32,!1),this.jointTexture.filterMode=mr.Point,this.shaderData.enableMacro("O3_USE_JOINT_TEXTURE"),this.shaderData.setTexture(i._jointSamplerProperty,this.jointTexture)}this.jointTexture.setPixelBuffer(this.matrixPalette)},$(i,[{key:"blendShapeWeights",get:function(){return this._blendShapeWeights},set:function(e){this._blendShapeWeights=e}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin=e}}]),i}($a),Dr._blendShapeMacro=b.getMacroByName("OASIS_BLENDSHAPE"),Dr._blendShapeNormalMacro=b.getMacroByName("OASIS_BLENDSHAPE_NORMAL"),Dr._blendShapeTangentMacro=b.getMacroByName("OASIS_BLENDSHAPE_TANGENT"),Dr._jointCountProperty=b.getPropertyByName("u_jointCount"),Dr._jointSamplerProperty=b.getPropertyByName("u_jointSampler"),Dr._jointMatrixProperty=b.getPropertyByName("u_jointMatrix"),Dr._blendShapeWeightsProperty=b.getPropertyByName("u_blendShapeWeights"),Dr._maxJoints=0,u_),n_=N(pn.prototype,"matrixPalette",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_=N(pn.prototype,"jointNodes",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a_=N(pn.prototype,"jointTexture",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o_=N(pn.prototype,"_hasInitJoints",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s_=N(pn.prototype,"_mat",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l_=N(pn.prototype,"_useJointTexture",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pn),ki=function(){function t(){}return t.createSphere=function(a,r,e,n){r===void 0&&(r=.5),e===void 0&&(e=18),n===void 0&&(n=!0);var o=new jn(a);e=Math.max(2,Math.floor(e));for(var s=e+1,l=s*s,u=e*e,c=t._generateIndices(a,l,u*6),f=Math.PI,d=f*2,h=1/s,_=1/e,m=new Array(l),v=new Array(l),p=new Array(l),g=0;g<l;++g){var y=g%s,x=g*h|0,T=y*_,w=x*_,S=T*d,M=w*f,P=Math.sin(M),E=-r*Math.cos(S)*P,R=r*Math.cos(M),C=r*Math.sin(S)*P;m[g]=new A(E,R,C),v[g]=new A(E,R,C),p[g]=new G(T,w)}for(var z=0,k=0;k<u;++k){var D=k%e,H=k*_|0,W=H*s+D,K=W+1,F=W+s,te=F+1;c[z++]=K,c[z++]=W,c[z++]=te,c[z++]=W,c[z++]=F,c[z++]=te}var B=o.bounds;return B.min.setValue(-r,-r,-r),B.max.setValue(r,r,r),t._initialize(o,m,v,p,c,n),o},t.createCuboid=function(a,r,e,n,o){r===void 0&&(r=1),e===void 0&&(e=1),n===void 0&&(n=1),o===void 0&&(o=!0);var s=new jn(a),l=r/2,u=e/2,c=n/2,f=new Array(24),d=new Array(24),h=new Array(24);f[0]=new A(-l,u,-c),f[1]=new A(l,u,-c),f[2]=new A(l,u,c),f[3]=new A(-l,u,c),d[0]=new A(0,1,0),d[1]=new A(0,1,0),d[2]=new A(0,1,0),d[3]=new A(0,1,0),h[0]=new G(0,0),h[1]=new G(1,0),h[2]=new G(1,1),h[3]=new G(0,1),f[4]=new A(-l,-u,-c),f[5]=new A(l,-u,-c),f[6]=new A(l,-u,c),f[7]=new A(-l,-u,c),d[4]=new A(0,-1,0),d[5]=new A(0,-1,0),d[6]=new A(0,-1,0),d[7]=new A(0,-1,0),h[4]=new G(0,1),h[5]=new G(1,1),h[6]=new G(1,0),h[7]=new G(0,0),f[8]=new A(-l,u,-c),f[9]=new A(-l,u,c),f[10]=new A(-l,-u,c),f[11]=new A(-l,-u,-c),d[8]=new A(-1,0,0),d[9]=new A(-1,0,0),d[10]=new A(-1,0,0),d[11]=new A(-1,0,0),h[8]=new G(0,0),h[9]=new G(1,0),h[10]=new G(1,1),h[11]=new G(0,1),f[12]=new A(l,u,-c),f[13]=new A(l,u,c),f[14]=new A(l,-u,c),f[15]=new A(l,-u,-c),d[12]=new A(1,0,0),d[13]=new A(1,0,0),d[14]=new A(1,0,0),d[15]=new A(1,0,0),h[12]=new G(1,0),h[13]=new G(0,0),h[14]=new G(0,1),h[15]=new G(1,1),f[16]=new A(-l,u,c),f[17]=new A(l,u,c),f[18]=new A(l,-u,c),f[19]=new A(-l,-u,c),d[16]=new A(0,0,1),d[17]=new A(0,0,1),d[18]=new A(0,0,1),d[19]=new A(0,0,1),h[16]=new G(0,0),h[17]=new G(1,0),h[18]=new G(1,1),h[19]=new G(0,1),f[20]=new A(-l,u,-c),f[21]=new A(l,u,-c),f[22]=new A(l,-u,-c),f[23]=new A(-l,-u,-c),d[20]=new A(0,0,-1),d[21]=new A(0,0,-1),d[22]=new A(0,0,-1),d[23]=new A(0,0,-1),h[20]=new G(1,0),h[21]=new G(0,0),h[22]=new G(0,1),h[23]=new G(1,1);var _=new Uint16Array(36);_[0]=0,_[1]=2,_[2]=1,_[3]=2,_[4]=0,_[5]=3,_[6]=4,_[7]=6,_[8]=7,_[9]=6,_[10]=4,_[11]=5,_[12]=8,_[13]=10,_[14]=9,_[15]=10,_[16]=8,_[17]=11,_[18]=12,_[19]=14,_[20]=15,_[21]=14,_[22]=12,_[23]=13,_[24]=16,_[25]=18,_[26]=17,_[27]=18,_[28]=16,_[29]=19,_[30]=20,_[31]=22,_[32]=23,_[33]=22,_[34]=20,_[35]=21;var m=s.bounds;return m.min.setValue(-l,-u,-c),m.max.setValue(l,u,c),t._initialize(s,f,d,h,_,o),s},t.createPlane=function(a,r,e,n,o,s){r===void 0&&(r=1),e===void 0&&(e=1),n===void 0&&(n=1),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new jn(a);n=Math.max(1,Math.floor(n)),o=Math.max(1,Math.floor(o));for(var u=n+1,c=o+1,f=r/2,d=e/2,h=r/n,_=e/o,m=u*c,v=o*n,p=t._generateIndices(a,m,v*6),g=1/u,y=1/n,x=1/o,T=new Array(m),w=new Array(m),S=new Array(m),M=0;M<m;++M){var P=M%u,E=M*g|0;T[M]=new A(P*h-f,E*_-d,0),w[M]=new A(0,0,1),S[M]=new G(P*y,1-E*x)}for(var R=0,C=0;C<v;++C){var z=C%n,k=C*y|0,D=k*u+z,H=D+1,W=D+u,K=W+1;p[R++]=H,p[R++]=W,p[R++]=D,p[R++]=H,p[R++]=K,p[R++]=W}var F=l.bounds;return F.min.setValue(-f,-d,0),F.max.setValue(f,d,0),t._initialize(l,T,w,S,p,s),l},t.createCylinder=function(a,r,e,n,o,s,l){r===void 0&&(r=.5),e===void 0&&(e=.5),n===void 0&&(n=2),o===void 0&&(o=20),s===void 0&&(s=1),l===void 0&&(l=!0);var u=new jn(a);o=Math.floor(o),s=Math.floor(s);for(var c=o+1,f=s+1,d=n*.5,h=n/s,_=c*f,m=o*s,v=o*2,p=_+2+v,g=t._generateIndices(a,p,m*6+v*3),y=1/c,x=1/o,T=1/s,w=new Array(p),S=new Array(p),M=new Array(p),P=0,E=Math.PI,R=Math.PI*2,C=e-r,z=C/n,k=C/s,D=0;D<_;++D){var H=D%c,W=D*y|0,K=H*x,F=W*T,te=E+K*R,B=Math.sin(te),V=Math.cos(te),j=e-W*k,re=j*B,se=W*h-d,_e=j*V;w[D]=new A(re,se,_e),S[D]=new A(B,z,V),M[D]=new G(K,1-F)}for(var de=0;de<m;++de){var Ae=de%o,Te=de*x|0,Ke=Te*c+Ae,Et=Ke+1,et=Ke+c,ut=et+1;g[P++]=Et,g[P++]=et,g[P++]=Ke,g[P++]=Et,g[P++]=ut,g[P++]=et}w[_]=new A(0,-d,0),S[_]=new A(0,-1,0),M[_]=new G(.5,.5),w[_+1]=new A(0,d,0),S[_+1]=new A(0,1,0),M[_+1]=new G(.5,.5);for(var qe=_+2,pt=1/(r*2),ct=1/(e*2),gt=c*s,tt=0;tt<o;++tt){var Be=w[tt],Me=Be.x,Sr=Be.z;w[qe]=new A(Me,-d,Sr),S[qe]=new A(0,-1,0),M[qe++]=new G(Me*ct+.5,.5-Sr*ct);var Sn=w[tt+gt];Me=Sn.x,Sr=Sn.z,w[qe]=new A(Me,d,Sr),S[qe]=new A(0,1,0),M[qe++]=new G(Me*pt+.5,Sr*pt+.5)}for(var ho=_+1,Pn=_+2,An=Pn+1,Tn=0;Tn<o;++Tn){var Mn=Tn*2,En=Tn===o-1?0:Mn+2;g[P++]=_,g[P++]=Pn+En,g[P++]=Pn+Mn,g[P++]=ho,g[P++]=An+Mn,g[P++]=An+En}var Ki=u.bounds,Gr=Math.max(r,e);return Ki.min.setValue(-Gr,-d,-Gr),Ki.max.setValue(Gr,d,Gr),t._initialize(u,w,S,M,g,l),u},t.createTorus=function(a,r,e,n,o,s,l){r===void 0&&(r=.5),e===void 0&&(e=.1),n===void 0&&(n=30),o===void 0&&(o=30),s===void 0&&(s=360),l===void 0&&(l=!0);var u=new jn(a);n=Math.floor(n),o=Math.floor(o);var c=(n+1)*(o+1),f=n*o,d=t._generateIndices(a,c,f*6),h=new Array(c),_=new Array(c),m=new Array(c);s=s/180*Math.PI;for(var v=0,p=0;p<=n;p++)for(var g=0;g<=o;g++){var y=g/o*s,x=p/n*Math.PI*2,T=Math.cos(x),w=Math.sin(x),S=Math.cos(y),M=Math.sin(y),P=new A((r+e*T)*S,(r+e*T)*M,e*w);h[v]=P;var E=r*S,R=r*M;_[v]=new A(P.x-E,P.y-R,P.z).normalize(),m[v++]=new G(g/o,p/n)}v=0;for(var C=1;C<=n;C++)for(var z=1;z<=o;z++){var k=(o+1)*C+z-1,D=(o+1)*(C-1)+z-1,H=(o+1)*(C-1)+z,W=(o+1)*C+z;d[v++]=k,d[v++]=D,d[v++]=W,d[v++]=D,d[v++]=H,d[v++]=W}var K=u.bounds,F=r+e;return K.min.setValue(-F,-F,-e),K.max.setValue(F,F,e),t._initialize(u,h,_,m,d,l),u},t.createCone=function(a,r,e,n,o,s){r===void 0&&(r=.5),e===void 0&&(e=2),n===void 0&&(n=20),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new jn(a);n=Math.floor(n),o=Math.floor(o);for(var u=n+1,c=o+1,f=e*.5,d=e/o,h=u*c,_=n*o,m=h+1+n,v=t._generateIndices(a,m,_*6+n*3),p=1/u,g=1/n,y=1/o,x=new Array(m),T=new Array(m),w=new Array(m),S=0,M=Math.PI,P=Math.PI*2,E=r/e,R=0;R<h;++R){var C=R%u,z=R*p|0,k=C*g,D=z*y,H=M+k*P,W=Math.sin(H),K=Math.cos(H),F=r-z*r,te=F*W,B=z*d-f,V=F*K;x[R]=new A(te,B,V),T[R]=new A(W,E,K),w[R]=new G(k,1-D)}for(var j=0;j<_;++j){var re=j%n,se=j*g|0,_e=se*u+re,de=_e+1,Ae=_e+u,Te=Ae+1;v[S++]=de,v[S++]=Ae,v[S++]=_e,v[S++]=de,v[S++]=Te,v[S++]=Ae}x[h]=new A(0,-f,0),T[h]=new A(0,-1,0),w[h]=new G(.5,.5);for(var Ke=h+1,Et=1/(r*2),et=0;et<n;++et){var ut=x[et],qe=ut.x,pt=ut.z;x[Ke]=new A(qe,-f,pt),T[Ke]=new A(0,-1,0),w[Ke++]=new G(qe*Et+.5,.5-pt*Et)}for(var ct=h+1,gt=0;gt<n;++gt){var tt=gt,Be=gt===n-1?0:tt+1;v[S++]=h,v[S++]=ct+Be,v[S++]=ct+tt}var Me=l.bounds;return Me.min.setValue(-r,-f,-r),Me.max.setValue(r,f,r),t._initialize(l,x,T,w,v,s),l},t._initialize=function(a,r,e,n,o,s){a.setPositions(r),a.setNormals(e),a.setUVs(n),a.setIndices(o),a.uploadData(s),a.addSubMesh(0,o.length)},t._generateIndices=function(a,r,e){var n=null;if(r>65535)if(a._hardwareRenderer.canIUse(X.elementIndexUint))n=new Uint32Array(e);else throw Error("The vertex count is over limit.");else n=new Uint16Array(e);return n},t}(),c_=function(t){Y(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.setVertexElements=function(e){this._setVertexElements(e)},a.setVertexBufferBinding=function(e,n,o){n===void 0&&(n=0),o===void 0&&(o=0);var s=e,l=s.buffer!==void 0;l||(s=new Jv(e,n));var u=this._vertexBufferBindings;u.length<=o&&(u.length=o+1),this._setVertexBufferBinding(l?n:o,s)},a.setVertexBufferBindings=function(e,n){n===void 0&&(n=0);var o=this._vertexBufferBindings,s=e.length,l=n+s;o.length<l&&(o.length=l);for(var u=0;u<s;u++)this._setVertexBufferBinding(n+u,e[u])},a.setIndexBufferBinding=function(e,n){var o=e;if(o){var s=o.buffer!==void 0;s||(o=new hc(e,n))}this._setIndexBufferBinding(o)},$(i,[{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"vertexBufferBindings",get:function(){return this._vertexBufferBindings}},{key:"indexBufferBinding",get:function(){return this._indexBufferBinding}},{key:"vertexElements",get:function(){return this._vertexElements}}]),i}(Zv),Cy=function(i,a,r,e){if(r===void 0&&(r=null),e===void 0&&(e=null),this.weight=void 0,this.deltaPositions=void 0,this.deltaNormals=void 0,this.deltaTangents=void 0,r&&r.length!==a.length)throw"deltaNormals length must same with deltaPositions length.";if(e&&e.length!==a.length)throw"deltaTangents length must same with deltaPositions length.";this.weight=i,this.deltaPositions=a,this.deltaNormals=r,this.deltaTangents=e},Ry=function(){function t(a){this.name=void 0,this._useBlendShapeNormal=!1,this._useBlendShapeTangent=!1,this._frames=[],this._updateFlagManager=new zs,this.name=a}var i=t.prototype;return i.addFrame=function(r,e,n,o){if(typeof r=="number"){var s=new Cy(r,e,n,o);return this._addFrame(s),s}else this._addFrame(r);this._updateFlagManager.distribute()},i.clearFrames=function(){this._frames.length=0,this._updateFlagManager.distribute(),this._useBlendShapeNormal=!1,this._useBlendShapeTangent=!1},i._registerChangeFlag=function(){return this._updateFlagManager.register()},i._addFrame=function(r){var e=this._frames,n=e.length;if(n>0&&r.deltaPositions.length!==e[n-1].deltaPositions.length)throw"Frame's deltaPositions length must same with before frame deltaPositions length.";this._useBlendShapeNormal=this._useBlendShapeNormal||r.deltaNormals!==null,this._useBlendShapeTangent=this._useBlendShapeTangent||r.deltaTangents!==null,this._frames.push(r)},$(t,[{key:"frames",get:function(){return this._frames}}]),t}(),Us=function(){function t(a){this._subMeshPool=new Ii($v),this._batchedQueue=[],this._meshes=[],this._meshCount=1,this._vertexBuffers=[],this._indiceBuffers=[],this._vertices=void 0,this._indices=void 0,this._flushId=0,this._vertexCount=0,this._elementCount=0;var r=t.MAX_VERTEX_COUNT;this._vertices=new Float32Array(r*9),this._indices=new Uint16Array(r*3);for(var e=this._meshes,n=this._meshCount,o=0;o<n;o++)e[o]=this._createMesh(a,o)}var i=t.prototype;return i.drawElement=function(r){var e=r.positions.length;this._vertexCount+e>t.MAX_VERTEX_COUNT&&this.flush(r.camera.engine),this._vertexCount+=e,this._batchedQueue[this._elementCount++]=r},i.flush=function(r){var e=this._batchedQueue;e.length!==0&&(this._updateData(r),this.drawBatches(r),t._canUploadSameBuffer||this._flushId++,e.length=0,this._subMeshPool.resetPool(),this._vertexCount=0,this._elementCount=0)},i.clear=function(){this._flushId=0,this._vertexCount=0,this._elementCount=0,this._batchedQueue.length=0},i.destroy=function(){this._batchedQueue=null;for(var r=this._meshes,e=this._vertexBuffers,n=this._indiceBuffers,o=0,s=r.length;o<s;++o)r[o].destroy();this._meshes=null;for(var l=0,u=e.length;l<u;++l)e[l].destroy();this._vertexBuffers=null;for(var c=0,f=n.length;c<f;++c)n[c].destroy();this._indiceBuffers=null},i._createMesh=function(r,e){var n=t.MAX_VERTEX_COUNT,o=new c_(r,"BufferMesh"+e),s=[],l=this.createVertexElements(s);return this._vertexBuffers[e]=new Ni(r,Or.VertexBuffer,n*4*l,jt.Dynamic),this._indiceBuffers[e]=new Ni(r,Or.IndexBuffer,n*3,jt.Dynamic),o.setVertexBufferBinding(this._vertexBuffers[e],l),o.setIndexBufferBinding(this._indiceBuffers[e],Je.UInt16),o.setVertexElements(s),o},i._updateData=function(r){var e=this._meshes,n=this._flushId;!t._canUploadSameBuffer&&this._meshCount<=n&&(this._meshCount++,e[n]=this._createMesh(r,n));var o=this._batchedQueue,s=this._vertices,l=this._indices,u=e[n];u.clearSubMesh();for(var c=0,f=0,d=0,h=0,_=0,m=0,v=null,p=0,g=o.length;p<g;p++){var y=o[p];c=this.updateVertices(y,s,c);for(var x=y.triangles,T=x.length,w=0;w<T;w++)l[f++]=x[w]+_;_+=y.positions.length,v===null||this.canBatch(v,y)?h+=T:(u.addSubMesh(this._getSubMeshFromPool(d,h)),d+=h,h=T,o[m++]=v),v=y}u.addSubMesh(this._getSubMeshFromPool(d,h)),o[m]=v,this._vertexBuffers[n].setData(s,0,0,c),this._indiceBuffers[n].setData(l,0,0,f)},i._getSubMeshFromPool=function(r,e){var n=this._subMeshPool.getFromPool();return n.start=r,n.count=e,n.topology=qa.Triangles,n},t}();Us.MAX_VERTEX_COUNT=4096;Us._canUploadSameBuffer=!0;var zy=function(t){Y(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.createVertexElements=function(e){return e[0]=new ve("POSITION",0,Q.Vector3,0),e[1]=new ve("TEXCOORD_0",12,Q.Vector2,0),20},a.canBatch=function(e,n){if(e.isAdd!==n.isAdd)return!1;var o=e.component.shaderData,s=n.component.shaderData,l=dc._textureProperty,u=dc._alphaCutoffProperty;return o.getTexture(l)===s.getTexture(l)&&o.getTexture(u)===s.getTexture(u)},a.updateVertices=function(e,n,o){for(var s=e.positions,l=e.uv,u=s.length,c=0;c<u;c++){var f=s[c],d=l[c];n[o++]=f.x,n[o++]=f.y,n[o++]=f.z,n[o++]=d.x,n[o++]=d.y}return o},a.drawBatches=function(e){for(var n=this._meshes[this._flushId],o=n.subMeshes,s=this._batchedQueue,l=0,u=o.length;l<u;l++){var c=o[l],f=s[l];if(!c||!f)return;var d=f.component,h=f.material,_=b._compileMacros;vr.unionCollection(d._globalShaderMacro,h.shaderData._macroCollection,_);var m=h.renderState.stencilState,v=f.isAdd?Ve.IncrementSaturate:Ve.DecrementSaturate;m.passOperationFront=v,m.passOperationBack=v;var p=h.shader._getShaderProgram(e,_);if(!p.isValid)return;var g=f.camera;p.bind(),p.groupingOtherUniformBlock(),p.uploadAll(p.sceneUniformBlock,g.scene.shaderData),p.uploadAll(p.cameraUniformBlock,g.shaderData),p.uploadAll(p.rendererUniformBlock,d.shaderData),p.uploadAll(p.materialUniformBlock,h.shaderData),h.renderState._apply(e),e._hardwareRenderer.drawPrimitive(n,c,p)}},i}(Us),By=function(){function t(a){this._batcher=void 0,this._preMaskLayer=0,this._batcher=new zy(a)}var i=t.prototype;return i.clear=function(){this._preMaskLayer=0,this._batcher.clear()},i.preRender=function(r,e){e.maskInteraction!==vn.None&&(this._batcher.clear(),this._processMasksDiff(r,e),this._batcher.flush(r.engine))},i.postRender=function(r){r.maskInteraction!==vn.None&&(this._preMaskLayer=r.maskLayer)},i.destroy=function(){this._batcher.destroy(),this._batcher=null},i._processMasksDiff=function(r,e){var n=this._preMaskLayer,o=e.maskLayer;if(n!==o)for(var s=r._renderPipeline._allSpriteMasks,l=n&o,u=o&~n,c=n&~o,f=s._elements,d=0,h=s.length;d<h;d++){var _=f[d],m=_.influenceLayers;if(!(m&l)){if(m&u){var v=_._maskElement;v.isAdd=!0,this._batcher.drawElement(v);continue}if(m&c){var p=_._maskElement;p.isAdd=!1,this._batcher.drawElement(p)}}}},t}(),Za;(function(t){t[t.SolidColor=0]="SolidColor",t[t.Sky=1]="Sky",t[t.Texture=2]="Texture"})(Za||(Za={}));var Xn;(function(t){t[t.AspectFitWidth=0]="AspectFitWidth",t[t.AspectFitHeight=1]="AspectFitHeight",t[t.Fill=2]="Fill"})(Xn||(Xn={}));var Ly=function(){this.material=void 0,this.mesh=void 0,this._matrix=new Z},Oy=function(){function t(a){this._engine=a,this.mode=Za.SolidColor,this.solidColor=new ge(.25,.25,.25,1),this.sky=new Ly,this._textureFillMode=Xn.AspectFitHeight,this._texture=null}var i=t.prototype;return i._resizeBackgroundTexture=function(){if(!!this._texture){var r=this._engine.canvas,e=r.width,n=r.height,o=this._engine._backgroundTextureMesh,s=o.getPositions();switch(this._textureFillMode){case Xn.Fill:s[0].setValue(-1,-1,1),s[1].setValue(1,-1,1),s[2].setValue(-1,1,1),s[3].setValue(1,1,1);break;case Xn.AspectFitWidth:var l=this._texture.height*e/this.texture.width/n;s[0].setValue(-1,-l,1),s[1].setValue(1,-l,1),s[2].setValue(-1,l,1),s[3].setValue(1,l,1);break;case Xn.AspectFitHeight:var u=this._texture.width*n/this.texture.height/e;s[0].setValue(-u,-1,1),s[1].setValue(u,-1,1),s[2].setValue(-u,1,1),s[3].setValue(u,1,1);break}o.setPositions(s),o.uploadData(!1)}},$(t,[{key:"texture",get:function(){return this._texture},set:function(r){this._texture!==r&&(this._texture=r,this._engine._backgroundTextureMaterial.shaderData.setTexture("u_baseTexture",r))}},{key:"textureFillMode",get:function(){return this._textureFillMode},set:function(r){r!==this._textureFillMode&&(this._textureFillMode=r,this._resizeBackgroundTexture())}}]),t}(),ks;(function(t){t[t.SolidColor=0]="SolidColor",t[t.SphericalHarmonics=1]="SphericalHarmonics"})(ks||(ks={}));var rr=function(){function t(a){this._scene=void 0,this._diffuseSphericalHarmonics=void 0,this._diffuseSolidColor=new ge(.212,.227,.259),this._diffuseIntensity=1,this._specularReflection=void 0,this._specularIntensity=1,this._diffuseMode=ks.SolidColor,this._shArray=new Float32Array(27),this._scene=a;var r=this._scene.shaderData;r.setColor(t._diffuseColorProperty,this._diffuseSolidColor),r.setFloat(t._diffuseIntensityProperty,this._diffuseIntensity),r.setFloat(t._specularIntensityProperty,this._specularIntensity)}var i=t.prototype;return i._preComputeSH=function(r,e){var n=r.coefficients;return e[0]=n[0]*.886227,e[1]=n[1]*.886227,e[2]=n[2]*.886227,e[3]=n[3]*-1.023327,e[4]=n[4]*-1.023327,e[5]=n[5]*-1.023327,e[6]=n[6]*1.023327,e[7]=n[7]*1.023327,e[8]=n[8]*1.023327,e[9]=n[9]*-1.023327,e[10]=n[10]*-1.023327,e[11]=n[11]*-1.023327,e[12]=n[12]*.858086,e[13]=n[13]*.858086,e[14]=n[14]*.858086,e[15]=n[15]*-.858086,e[16]=n[16]*-.858086,e[17]=n[17]*-.858086,e[18]=n[18]*.247708,e[19]=n[19]*.247708,e[20]=n[20]*.247708,e[21]=n[21]*-.858086,e[22]=n[22]*-.858086,e[23]=n[23]*-.858086,e[24]=n[24]*.429042,e[25]=n[25]*.429042,e[26]=n[26]*.429042,e},$(t,[{key:"diffuseMode",get:function(){return this._diffuseMode},set:function(r){this._diffuseMode=r,r===ks.SphericalHarmonics?this._scene.shaderData.enableMacro(t._shMacro):this._scene.shaderData.disableMacro(t._shMacro)}},{key:"diffuseSolidColor",get:function(){return this._diffuseSolidColor},set:function(r){r!==this._diffuseSolidColor&&r.cloneTo(this._diffuseSolidColor)}},{key:"diffuseSphericalHarmonics",get:function(){return this._diffuseSphericalHarmonics},set:function(r){this._diffuseSphericalHarmonics=r;var e=this._scene.shaderData;r&&e.setFloatArray(t._diffuseSHProperty,this._preComputeSH(r,this._shArray))}},{key:"diffuseIntensity",get:function(){return this._diffuseIntensity},set:function(r){this._diffuseIntensity=r,this._scene.shaderData.setFloat(t._diffuseIntensityProperty,r)}},{key:"specularTexture",get:function(){return this._specularReflection},set:function(r){this._specularReflection=r;var e=this._scene.shaderData;r?(e.setTexture(t._specularTextureProperty,r),e.setFloat(t._mipLevelProperty,this._specularReflection.mipmapCount),e.enableMacro(t._specularMacro)):e.disableMacro(t._specularMacro)}},{key:"specularIntensity",get:function(){return this._specularIntensity},set:function(r){this._specularIntensity=r,this._scene.shaderData.setFloat(t._specularIntensityProperty,r)}}]),t}();rr._shMacro=b.getMacroByName("O3_USE_SH");rr._specularMacro=b.getMacroByName("O3_USE_SPECULAR_ENV");rr._diffuseColorProperty=b.getPropertyByName("u_envMapLight.diffuse");rr._diffuseSHProperty=b.getPropertyByName("u_env_sh");rr._diffuseIntensityProperty=b.getPropertyByName("u_envMapLight.diffuseIntensity");rr._specularTextureProperty=b.getPropertyByName("u_env_specularSampler");rr._specularIntensityProperty=b.getPropertyByName("u_envMapLight.specularIntensity");rr._mipLevelProperty=b.getPropertyByName("u_envMapLight.mipMapLevel");var _c=function(){function t(){}var i=t.prototype;return i.preUpdate=function(r){},i.postUpdate=function(r){},i.preRender=function(r,e){},i.postRender=function(r,e){},i.destroy=function(r){},t}(),ot=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r._viewMat=void 0,r._inverseViewMat=void 0,r}var a=i.prototype;return a._onEnable=function(){this.scene.findFeature(Kn).attachRenderLight(this)},a._onDisable=function(){this.scene.findFeature(Kn).detachRenderLight(this)},$(i,[{key:"viewMatrix",get:function(){return this._viewMat||(this._viewMat=new Z),Z.invert(this.entity.transform.worldMatrix,this._viewMat),this._viewMat}},{key:"inverseViewMatrix",get:function(){return this._inverseViewMat||(this._inverseViewMat=new Z),Z.invert(this.viewMatrix,this._inverseViewMat),this._inverseViewMat}}]),i}(Jt);ot._maxLight=10;var Fr=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.color=new ge(1,1,1,1),r.intensity=1,r._forward=new A,r._lightColor=new ge(1,1,1,1),r._reverseDirection=new A,r}i._updateShaderData=function(e){var n=i._combinedData;e.setFloatArray(i._colorProperty,n.color),e.setFloatArray(i._directionProperty,n.direction)};var a=i.prototype;return a._appendData=function(e){var n=e*3,o=e*3,s=this.lightColor,l=this.direction,u=i._combinedData;u.color[n]=s.r,u.color[n+1]=s.g,u.color[n+2]=s.b,u.direction[o]=l.x,u.direction[o+1]=l.y,u.direction[o+2]=l.z},$(i,[{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}},{key:"reverseDirection",get:function(){return A.scale(this.direction,-1,this._reverseDirection),this._reverseDirection}}]),i}(ot);Fr._colorProperty=b.getPropertyByName("u_directLightColor");Fr._directionProperty=b.getPropertyByName("u_directLightDirection");Fr._combinedData={color:new Float32Array(3*ot._maxLight),direction:new Float32Array(3*ot._maxLight)};var Ir=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.color=new ge(1,1,1,1),r.intensity=1,r.distance=100,r._lightColor=new ge(1,1,1,1),r}i._updateShaderData=function(e){var n=i._combinedData;e.setFloatArray(i._colorProperty,n.color),e.setFloatArray(i._positionProperty,n.position),e.setFloatArray(i._distanceProperty,n.distance)};var a=i.prototype;return a._appendData=function(e){var n=e*3,o=e*3,s=e,l=this.lightColor,u=this.position,c=i._combinedData;c.color[n]=l.r,c.color[n+1]=l.g,c.color[n+2]=l.b,c.position[o]=u.x,c.position[o+1]=u.y,c.position[o+2]=u.z,c.distance[s]=this.distance},$(i,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}}]),i}(ot);Ir._colorProperty=b.getPropertyByName("u_pointLightColor");Ir._positionProperty=b.getPropertyByName("u_pointLightPosition");Ir._distanceProperty=b.getPropertyByName("u_pointLightDistance");Ir._combinedData={color:new Float32Array(3*ot._maxLight),position:new Float32Array(3*ot._maxLight),distance:new Float32Array(ot._maxLight)};var Xt=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.color=new ge(1,1,1,1),r.intensity=1,r.distance=100,r.angle=Math.PI/6,r.penumbra=Math.PI/12,r._forward=new A,r._lightColor=new ge(1,1,1,1),r._inverseDirection=new A,r}i._updateShaderData=function(e){var n=i._combinedData;e.setFloatArray(i._colorProperty,n.color),e.setFloatArray(i._positionProperty,n.position),e.setFloatArray(i._directionProperty,n.direction),e.setFloatArray(i._distanceProperty,n.distance),e.setFloatArray(i._angleCosProperty,n.angleCos),e.setFloatArray(i._penumbraCosProperty,n.penumbraCos)};var a=i.prototype;return a._appendData=function(e){var n=e*3,o=e*3,s=e*3,l=e,u=e,c=e,f=this.lightColor,d=this.position,h=this.direction,_=i._combinedData;_.color[n]=f.r,_.color[n+1]=f.g,_.color[n+2]=f.b,_.position[o]=d.x,_.position[o+1]=d.y,_.position[o+2]=d.z,_.direction[s]=h.x,_.direction[s+1]=h.y,_.direction[s+2]=h.z,_.distance[l]=this.distance,_.angleCos[c]=Math.cos(this.angle),_.penumbraCos[u]=Math.cos(this.angle+this.penumbra)},$(i,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"reverseDirection",get:function(){return A.scale(this.direction,-1,this._inverseDirection),this._inverseDirection}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}}]),i}(ot);Xt._colorProperty=b.getPropertyByName("u_spotLightColor");Xt._positionProperty=b.getPropertyByName("u_spotLightPosition");Xt._directionProperty=b.getPropertyByName("u_spotLightDirection");Xt._distanceProperty=b.getPropertyByName("u_spotLightDistance");Xt._angleCosProperty=b.getPropertyByName("u_spotLightAngleCos");Xt._penumbraCosProperty=b.getPropertyByName("u_spotLightPenumbraCos");Xt._combinedData={color:new Float32Array(3*ot._maxLight),position:new Float32Array(3*ot._maxLight),direction:new Float32Array(3*ot._maxLight),distance:new Float32Array(ot._maxLight),angleCos:new Float32Array(ot._maxLight),penumbraCos:new Float32Array(ot._maxLight)};function Dy(){return this.findFeature(Kn).visibleLights.length>0}var Kn=function(t){Y(i,t);function i(){var r;return r=t.call(this)||this,r.visibleLights=void 0,r.visibleLights=[],r}var a=i.prototype;return a.attachRenderLight=function(e){var n=this.visibleLights.indexOf(e);n==-1&&this.visibleLights.push(e)},a.detachRenderLight=function(e){var n=this.visibleLights.indexOf(e);n!=-1&&this.visibleLights.splice(n,1)},a._updateShaderData=function(e){for(var n=0,o=0,s=0,l=this.visibleLights,u=0,c=l.length;u<c;u++){var f=l[u];f instanceof Fr?f._appendData(n++):f instanceof Ir?f._appendData(o++):f instanceof Xt&&f._appendData(s++)}n?(Fr._updateShaderData(e),e.enableMacro("O3_DIRECT_LIGHT_COUNT",n.toString())):e.disableMacro("O3_DIRECT_LIGHT_COUNT"),o?(Ir._updateShaderData(e),e.enableMacro("O3_POINT_LIGHT_COUNT",o.toString())):e.disableMacro("O3_POINT_LIGHT_COUNT"),s?(Xt._updateShaderData(e),e.enableMacro("O3_SPOT_LIGHT_COUNT",s.toString())):e.disableMacro("O3_SPOT_LIGHT_COUNT")},i}(_c),gn=function(t){Y(i,t);function i(r,e){var n;n=t.call(this,r)||this,n.name=void 0,n.background=new Oy(n._engine),n.ambientLight=void 0,n.shaderData=new Bs(er.Scene),n._activeCameras=[],n._isActiveInEngine=!1,n._destroyed=!1,n._rootEntities=[],n.features=[],n.name=e||"";var o=n.shaderData;return i.sceneFeatureManager.addObject(L(n)),o._addRefCount(1),n.ambientLight=new rr(L(n)),n}var a=i.prototype;return a.createRootEntity=function(e){var n=new Lr(this._engine,e);return this.addRootEntity(n),n},a.addRootEntity=function(e){var n=e._isRoot;n||(e._isRoot=!0,e._removeFromParent());var o=e._scene;o!==this?(o&&n&&o._removeEntity(e),this._rootEntities.push(e),Lr._traverseSetOwnerScene(e,this)):n||this._rootEntities.push(e),this._isActiveInEngine?!e._isActiveInHierarchy&&e._isActive&&e._processActive():e._isActiveInHierarchy&&e._processInActive()},a.removeRootEntity=function(e){e._isRoot&&e._scene==this&&(this._removeEntity(e),this._isActiveInEngine&&e._processInActive(),Lr._traverseSetOwnerScene(e,null))},a.getRootEntity=function(e){return e===void 0&&(e=0),this._rootEntities[e]},a.findEntityByName=function(e){for(var n=this._rootEntities,o=n.length-1;o>=0;o--){var s=n[o];if(s.name===e)return s}for(var l=n.length-1;l>=0;l--){var u=n[l],c=u.findByName(e);if(c)return c}return null},a.findEntityByPath=function(e){for(var n=e.split("/").filter(Boolean),o=0,s=this.rootEntitiesCount;o<s;o++){var l=this.getRootEntity(o);if(l.name==n[0]){for(var u=1,c=n.length;u<c&&(l=Lr._findChildByName(l,n[u]),!!l);++u);return l}}return null},a.destroy=function(){if(!this._destroyed){this._isActiveInEngine&&(this._engine.sceneManager.activeScene=null),i.sceneFeatureManager.callFeatureMethod(this,"destroy",[this]);for(var e=0,n=this.rootEntitiesCount;e<n;e++)this._rootEntities[e].destroy();this._rootEntities.length=0,this._activeCameras.length=0,i.sceneFeatureManager._objects=[],this.shaderData._addRefCount(-1),this._destroyed=!0}},a._attachRenderCamera=function(e){var n=this._activeCameras.indexOf(e);n===-1&&this._activeCameras.push(e)},a._detachRenderCamera=function(e){var n=this._activeCameras.indexOf(e);n!==-1&&this._activeCameras.splice(n,1)},a._processActive=function(e){this._isActiveInEngine=e;for(var n=this._rootEntities,o=n.length-1;o>=0;o--){var s=n[o];s._isActive&&(e?s._processActive():s._processInActive())}},a._updateShaderData=function(){var e=this.findFeature(Kn);e._updateShaderData(this.shaderData)},a._removeEntity=function(e){var n=this._rootEntities;n.splice(n.indexOf(e),1)},i.registerFeature=function(e){i.sceneFeatureManager.registerFeature(e)},a.findFeature=function(e){return i.sceneFeatureManager.findFeature(this,e)},$(i,[{key:"rootEntitiesCount",get:function(){return this._rootEntities.length}},{key:"rootEntities",get:function(){return this._rootEntities}},{key:"destroyed",get:function(){return this._destroyed}}]),i}(Br);gn.sceneFeatureManager=new Pv;var Fy=function(){function t(a){this.engine=a,this._activeScene=void 0}var i=t.prototype;return i.loadScene=function(r,e){var n=this;e===void 0&&(e=!0);var o=this.engine.resourceManager.load(r);return o.then(function(s){var l=n._activeScene;n.activeScene=s,l&&e&&l.destroy()}),o},i.mergeScenes=function(r,e){for(var n=r.rootEntities,o=0,s=n.length;o<s;o++)e.addRootEntity(n[o])},$(t,[{key:"activeScene",get:function(){return this._activeScene},set:function(r){var e=this._activeScene;e!==r&&(e&&e._processActive(!1),r&&r._processActive(!0),this._activeScene=r)}}]),t}(),Iy=`#define GLSLIFY 1
#include <common>
#include <common_frag>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <pbr_envmap_light_frag_define>
#include <direct_light_frag>
#include <point_light_frag>
#include <spot_light_frag>
#include <mobile_material_frag>
#include <fog_share>
#include <normal_get>
void main(){
#include <begin_mobile_frag>
#include <begin_viewdir_frag>
#include <mobile_blinnphong_frag>
gl_FragColor=emission+ambient+diffuse+specular;gl_FragColor.a=diffuse.a;
#include <fog_frag>
}`,Ny=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <shadow_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <shadow_vert>
#include <position_vert>
#include <fog_vert>
}`,Uy=`#define GLSLIFY 1
varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;uniform sampler2D u_texture;void main(){if(v_lifeLeft==1.0){discard;}float alphaFactor=1.0;
#ifdef fadeIn
float fadeInFactor=step(0.5,v_lifeLeft);alphaFactor=2.0*fadeInFactor*(1.0-v_lifeLeft)+(1.0-fadeInFactor);
#endif
#ifdef fadeOut
float fadeOutFactor=step(0.5,v_lifeLeft);alphaFactor=alphaFactor*2.0*(1.0-fadeOutFactor)*v_lifeLeft+alphaFactor*fadeOutFactor;
#endif
#ifdef particleTexture
vec4 tex=texture2D(u_texture,v_uv);
#ifdef useOriginColor
gl_FragColor=vec4(tex.rgb,alphaFactor*tex.a*v_color.w);
#else
gl_FragColor=vec4(v_color.xyz*tex.rgb,alphaFactor*tex.a*v_color.w);
#endif
#else
gl_FragColor=vec4(v_color.xyz,alphaFactor*v_color.w);
#endif
}`,ky=`#define GLSLIFY 1
attribute vec3 a_position;attribute vec3 a_velocity;attribute vec3 a_acceleration;attribute vec4 a_color;attribute vec4 a_lifeAndSize;attribute vec2 a_rotation;attribute vec3 a_uv;attribute vec2 a_normalizedUv;uniform float u_time;uniform bool u_once;uniform mat4 u_MVPMat;varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;
#ifdef is2d
uniform mat4 u_viewInvMat;uniform mat4 u_projMat;uniform mat4 u_viewMat;uniform mat4 u_modelMat;
#endif
mat2 rotation2d(float angle){float s=sin(angle);float c=cos(angle);return mat2(c,-s,s,c);}void main(){v_color=a_color;v_uv=a_uv.xy;float life=a_lifeAndSize.y;float startTime=a_lifeAndSize.x;float deltaTime=max(mod(u_time-startTime,life),0.0);if((u_once&&u_time>life+startTime)){deltaTime=0.0;}v_lifeLeft=1.0-deltaTime/life;float scale=a_lifeAndSize.z;vec3 position=a_position+(a_velocity+a_acceleration*deltaTime*0.5)*deltaTime;
#ifdef isScaleByLifetime
scale*=v_lifeLeft;
#else
scale*=pow(a_lifeAndSize.w,deltaTime);
#endif
#ifdef rotateToVelocity
vec3 v=a_velocity+a_acceleration*deltaTime;float angle=atan(v.z,v.x)*2.0;
#else
float deltaAngle=deltaTime*a_rotation.y;float angle=a_rotation.x+deltaAngle;
#endif
#ifdef is2d
vec2 rotatedPoint=rotation2d(angle)*vec2(a_normalizedUv.x,a_normalizedUv.y*a_uv.z);vec3 basisX=u_viewInvMat[0].xyz;vec3 basisZ=u_viewInvMat[1].xyz;vec3 localPosition=vec3(basisX*rotatedPoint.x+basisZ*rotatedPoint.y)*scale+position;gl_Position=u_projMat*u_viewMat*vec4(localPosition+u_modelMat[3].xyz,1.);
#else
#ifdef rotateToVelocity
float s=sin(angle);float c=cos(angle);
#else
float s=sin(angle);float c=cos(angle);
#endif
vec4 rotatedPoint=vec4((a_normalizedUv.x*c+a_normalizedUv.y*a_uv.z*s)*scale,0.,(a_normalizedUv.x*s-a_normalizedUv.y*a_uv.z*c)*scale,1.);vec4 orientation=vec4(0,0,0,1);vec4 q2=orientation+orientation;vec4 qx=orientation.xxxw*q2.xyzx;vec4 qy=orientation.xyyw*q2.xyzy;vec4 qz=orientation.xxzw*q2.xxzz;mat4 localMatrix=mat4((1.0-qy.y)-qz.z,qx.y+qz.w,qx.z-qy.w,0,qx.y-qz.w,(1.0-qx.x)-qz.z,qy.z+qx.w,0,qx.z+qy.w,qy.z-qx.w,(1.0-qx.x)-qy.y,0,position.x,position.y,position.z,1);rotatedPoint=localMatrix*rotatedPoint;gl_Position=u_MVPMat*rotatedPoint;
#endif
}`,Vy=`#define GLSLIFY 1
#include <common>
#include <common_frag>
#include <pbr_common_frag_define>
#include <pbr_util_frag_define>
#include <fog_share>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <direct_light_frag>
#include <point_light_frag>
#include <spot_light_frag>
#include <pbr_envmap_light_frag_define>
#include <pbr_base_frag_define>
#include <pbr_texture_frag_define>
#include <pbr_runtime_frag_define>
#include <normal_get>
#include <pbr_brdf_cook_torrance_frag_define>
#include <pbr_direct_irradiance_frag_define>
#include <pbr_ibl_diffuse_frag_define>
#include <pbr_ibl_specular_frag_define>
void main(){
#include <pbr_begin_frag>
#include <pbr_direct_irradiance_frag>
#include <pbr_ibl_diffuse_frag>
#include <pbr_ibl_specular_frag>
#include <pbr_end_frag>
#include <gamma_frag>
#include <fog_frag>
}`,Gy=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <shadow_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <shadow_vert>
#include <position_vert>
#include <fog_vert>
}`,Hy=`#define GLSLIFY 1
vec4 pack(float depth){const vec4 bitShift=vec4(1.0,256.0,256.0*256.0,256.0*256.0*256.0);const vec4 bitMask=vec4(1.0/256.0,1.0/256.0,1.0/256.0,0.0);vec4 rgbaDepth=fract(depth*bitShift);rgbaDepth-=rgbaDepth.gbaa*bitMask;return rgbaDepth;}void main(){gl_FragColor=pack(gl_FragCoord.z);}`,f_=`#define GLSLIFY 1
#include <common_vert>
#include <blendShape_input>
#include <normal_share>
#include <shadow_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <shadow_vert>
#include <position_vert>
}`,Wy=`#define GLSLIFY 1
#ifdef O3_SHADOW_MAP_COUNT
uniform float u_shadowBias[O3_SHADOW_MAP_COUNT];uniform float u_shadowIntensity[O3_SHADOW_MAP_COUNT];uniform float u_shadowRadius[O3_SHADOW_MAP_COUNT];uniform vec2 u_shadowMapSize[O3_SHADOW_MAP_COUNT];uniform sampler2D u_shadowMaps[O3_SHADOW_MAP_COUNT];varying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];const vec4 bitShift=vec4(1.0,1.0/256.0,1.0/(256.0*256.0),1.0/(256.0*256.0*256.0));float unpack(const in vec4 rgbaDepth){return dot(rgbaDepth,bitShift);}float getVisibility(vec4 positionFromLight,const in sampler2D shadowMap,vec2 mapSize,float intensity,float bias,float radius){vec3 shadowCoord=(positionFromLight.xyz/positionFromLight.w)/2.0+0.5;float filterX=step(0.0,shadowCoord.x)*(1.0-step(1.0,shadowCoord.x));float filterY=step(0.0,shadowCoord.y)*(1.0-step(1.0,shadowCoord.y));shadowCoord.z-=bias;vec2 texelSize=vec2(1.0)/mapSize;float visibility=0.0;for(float y=-1.0;y<=1.0;y+=1.0){for(float x=-1.0;x<=1.0;x+=1.0){vec2 uv=shadowCoord.xy+texelSize*vec2(x,y)*radius;vec4 rgbaDepth=texture2D(shadowMap,uv);float depth=unpack(rgbaDepth);visibility+=step(depth,shadowCoord.z)*intensity;}}visibility*=(1.0/9.0);return visibility*filterX*filterY;}
#endif
void main(){vec4 shadowColor=vec4(1.0,1.0,1.0,1.0);
#ifdef O3_SHADOW_MAP_COUNT
float visibility=1.0;
#if (O3_SHADOW_MAP_COUNT == 1)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);
#elif (O3_SHADOW_MAP_COUNT == 2)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);visibility-=getVisibility(v_PositionFromLight[1],u_shadowMaps[1],u_shadowMapSize[1],u_shadowIntensity[1],u_shadowBias[1],u_shadowRadius[1]);
#elif (O3_SHADOW_MAP_COUNT == 3)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);visibility-=getVisibility(v_PositionFromLight[1],u_shadowMaps[1],u_shadowMapSize[1],u_shadowIntensity[1],u_shadowBias[1],u_shadowRadius[1]);visibility-=getVisibility(v_PositionFromLight[2],u_shadowMaps[2],u_shadowMapSize[2],u_shadowIntensity[2],u_shadowBias[2],u_shadowRadius[2]);
#endif
visibility=clamp(visibility,0.0,1.0);shadowColor=vec4(visibility,visibility,visibility,1.0);
#endif
gl_FragColor=shadowColor;}`,jy=`#define GLSLIFY 1
uniform samplerCube u_cube;varying vec3 v_cubeUV;void main(){gl_FragColor=textureCube(u_cube,v_cubeUV);}`,Xy=`#define GLSLIFY 1
#include <common_vert>
uniform mat4 u_mvpNoscale;varying vec3 v_cubeUV;void main(){v_cubeUV=POSITION.xyz;gl_Position=u_mvpNoscale*vec4(POSITION,1.0);gl_Position.z=gl_Position.w;}`,Ky=`precision mediump float;precision mediump int;
#define GLSLIFY 1
uniform sampler2D u_maskTexture;uniform float u_maskAlphaCutoff;varying vec2 v_uv;void main(){vec4 color=texture2D(u_maskTexture,v_uv);if(color.a<u_maskAlphaCutoff){discard;}gl_FragColor=color;}`,qy=`precision highp float;
#define GLSLIFY 1
uniform mat4 u_VPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=u_VPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,Qy=`precision mediump float;precision mediump int;
#define GLSLIFY 1
#ifdef USE_CUSTOM_TEXTURE
uniform sampler2D u_cusTomTexture;
#else
uniform sampler2D u_spriteTexture;
#endif
varying vec2 v_uv;varying vec4 v_color;void main(){
#ifdef USE_CUSTOM_TEXTURE
vec4 baseColor=texture2D(u_cusTomTexture,v_uv);
#else
vec4 baseColor=texture2D(u_spriteTexture,v_uv);
#endif
gl_FragColor=baseColor*v_color;}`,Yy=`precision highp float;
#define GLSLIFY 1
#ifdef USE_MODEL_MATRIX
uniform mat4 u_MVPMat;
#else
uniform mat4 u_VPMat;
#endif
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;attribute vec4 COLOR_0;varying vec2 v_uv;varying vec4 v_color;void main(){
#ifdef USE_MODEL_MATRIX
gl_Position=u_MVPMat*vec4(POSITION,1.0);
#else
gl_Position=u_VPMat*vec4(POSITION,1.0);
#endif
v_uv=TEXCOORD_0;v_color=COLOR_0;}`,$y=`#define GLSLIFY 1
#include <uv_share>
#include <fog_share>
uniform vec4 u_baseColor;uniform float u_alphaCutoff;
#ifdef O3_BASE_TEXTURE
uniform sampler2D u_baseTexture;
#endif
void main(){vec4 baseColor=u_baseColor;
#ifdef O3_BASE_TEXTURE
baseColor*=texture2D(u_baseTexture,v_uv);
#endif
#ifdef ALPHA_CUTOFF
if(baseColor.a<u_alphaCutoff){discard;}
#endif
gl_FragColor=baseColor;
#include <fog_frag>
}`,Zy=`#define GLSLIFY 1
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <position_vert>
#include <fog_vert>
}`,Jy=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,ex=`#define GLSLIFY 1
uniform sampler2D u_baseTexture;varying vec2 v_uv;void main(){gl_FragColor=texture2D(u_baseTexture,v_uv);}`,tx=function(){function t(){}return t.init=function(){b.create("blinn-phong",Ny,Iy),b.create("pbr",Gy,Vy),b.create("unlit",Zy,$y),b.create("shadow-map",f_,Hy),b.create("shadow",f_,Wy),b.create("skybox",Xy,jy),b.create("particle-shader",ky,Uy),b.create("SpriteMask",qy,Ky),b.create("Sprite",Yy,Qy),b.create("background-texture",Jy,ex)},t}(),rx=function(){function t(){this._cacheHierarchy=1,this._cacheMap=Object.create(null),this._lastQueryMap=void 0,this._lastQueryKey=void 0}var i=t.prototype;return i.get=function(r){var e=this._cacheMap,n=r._length;n>this._cacheHierarchy&&this._resizeCacheMapHierarchy(e,0,n);for(var o=r._mask,s=r._length-1,l=this._cacheHierarchy-1,u=0;u<l;u++){var c=s<u?0:o[u],f=e[c];f||(e[c]=f=Object.create(null)),e=f}var d=s<l?0:o[l],h=e[d];return h||(this._lastQueryKey=d,this._lastQueryMap=e),h},i.cache=function(r){this._lastQueryMap[this._lastQueryKey]=r},i._resizeCacheMapHierarchy=function(r,e,n){var o=this._cacheHierarchy-1;if(e==o){for(var s in r)for(var l=r[s],u=0,c=n-o;u<c;u++)u==c-1?r[0]=l:r=r[u==0?s:0]=Object.create(null);this._cacheHierarchy=n}else for(var f in r)this._resizeCacheMapHierarchy(r[f],++e,n)},t}(),Vs=function(t){Y(i,t);function i(){var r;return r=t.call(this)||this,r.colliders=void 0,r.colliders=[],r}var a=i.prototype;return a.attachCollider=function(e){this.colliders.push(e)},a.detachCollider=function(e){var n=this.colliders.indexOf(e);n!=-1&&this.colliders.splice(n,1)},i}(_c),pc=function(t){Y(i,t);function i(r){return t.call(this,r)||this}var a=i.prototype;return a._onEnable=function(){this.scene.findFeature(Vs).attachCollider(this)},a._onDisable=function(){this.scene.findFeature(Vs).detachCollider(this)},a._updateHitResult=function(e,n,o,s,l){l===void 0&&(l=!1),e.getPoint(n,o.point),l||A.transformCoordinate(o.point,this.entity.transform.worldMatrix,o.point),o.distance=A.distance(s,o.point),o.collider=this},a._getLocalRay=function(e){var n=this.entity.getInvModelMatrix(),o=i._ray;return A.transformCoordinate(e.origin,n,o.origin),A.transformNormal(e.direction,n,o.direction),o.direction.normalize(),o},a._raycast=function(e,n){throw"Error: use concrete type instead!"},i}(Jt);pc._ray=new Vm;var gc=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,e.boxMin=void 0,e.boxMax=void 0,e._corners=[],e._cornerFlag=!1,e.boxMin=new A(-.5,-.5,-.5),e.boxMax=new A(.5,.5,.5),e}var a=i.prototype;return a.setBoxMinMax=function(e,n){this.boxMin=e,this.boxMax=n,this._cornerFlag=!0},a.setBoxCenterSize=function(e,n){var o=i._tempVec3;A.scale(n,.5,o),A.add(e,o,this.boxMax),A.subtract(e,o,this.boxMin),this._cornerFlag=!0},a.getCorners=function(){if(this._cornerFlag){var e=this.boxMin.x,n=this.boxMin.y,o=this.boxMin.z,s=this.boxMax.x-e,l=this.boxMax.y-n,u=this.boxMax.z-o;if(this._corners.length===0)for(var c=0;c<8;++c)this._corners.push(new A);this._corners[0].setValue(e+s,n+l,o+u),this._corners[1].setValue(e,n+l,o+u),this._corners[2].setValue(e,n,o+u),this._corners[3].setValue(e+s,n,o+u),this._corners[4].setValue(e+s,n+l,o),this._corners[5].setValue(e,n+l,o),this._corners[6].setValue(e,n,o),this._corners[7].setValue(e+s,n,o),this._cornerFlag=!1}return this._corners},a._raycast=function(e,n){var o=this._getLocalRay(e),s=i._tempBox;this.boxMin.cloneTo(s.min),this.boxMax.cloneTo(s.max);var l=o.intersectBox(s);return l!==-1?(this._updateHitResult(o,l,n,e.origin),!0):!1},i}(pc);gc._tempVec3=new A;gc._tempBox=new $t;new Hn;var d_=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,e.center=void 0,e.radius=void 0,e.center=new A,e.radius=1,e}var a=i.prototype;return a.setSphere=function(e,n){this.center=e,this.radius=n},a._raycast=function(e,n){var o=this.entity.transform,s=i._tempSphere;A.transformCoordinate(this.center,o.worldMatrix,s.center);var l=o.lossyWorldScale;s.radius=this.radius*Math.max(l.x,l.y,l.z);var u=e.intersectSphere(s);return u!==-1?(this._updateHitResult(e,u,n,e.origin,!0),!0):!1},i}(pc);d_._tempSphere=new Kh;var nx=function(t){Y(i,t);function i(a){var r;return r=t.call(this,a)||this,r._center=new A,r._size=new A,r.isShowCollider=!0,r.center=r.center,r.size=r.size,r.isShowCollider=r.isShowCollider,r}return $(i,[{key:"center",get:function(){return this._center},set:function(r){this._center=r,this.setBoxCenterSize(this._center,this._size)}},{key:"size",get:function(){return this._size},set:function(r){this._size=r,this.setBoxCenterSize(this._center,this._size)}}]),i}(gc),ix=function(t){Y(i,t);function i(a){var r;return r=t.call(this,a)||this,r.__center=new A,r.__radius=1,r.isShowCollider=!0,r._center=r._center,r._radius=r._radius,r.isShowCollider=r.isShowCollider,r}return $(i,[{key:"_center",get:function(){return this.__center},set:function(r){this.__center=r,this.setSphere(this.__center,this.__radius)}},{key:"_radius",get:function(){return this.__radius},set:function(r){this.__radius=r,this.setSphere(this.__center,this.__radius)}}]),i}(d_);gn.registerFeature(Vs);var ax=function(){this.collider=null,this.distance=0,this.point=new A,this.normal=new A},h_=function(){function t(a){this._engine=void 0,this._engine=a}var i=t.prototype;return i.raycast=function(r,e,n,o){var s=this._engine.sceneManager.activeScene.findFeature(Vs),l=s.colliders,u,c=Number.MAX_VALUE;typeof e=="number"?c=e:e!=null&&(u=e);var f=Gt.Everything;typeof n=="number"?f=n:n!=null&&(u=n),o&&(u=o);for(var d=!1,h=t._currentHit,_=0,m=l.length;_<m;_++){var v=l[_];if(!!(v.entity.layer&f)&&v._raycast(r,h)&&(d=!0,h.distance<c)){if(u)h.normal.cloneTo(u.normal),h.point.cloneTo(u.point),u.distance=h.distance,u.collider=h.collider;else return!0;c=h.distance}}return!d&&u&&(u.collider=null,u.distance=0,u.point.setValue(0,0,0),u.normal.setValue(0,0,0)),d},t}();h_._currentHit=new ax;var mn=new Pv;tx.init();var ox=function(t){Y(i,t);function i(r,e){var n;n=t.call(this,null)||this,n.physicsManager=new h_(L(n)),n._componentsManager=new cc,n._hardwareRenderer=void 0,n._lastRenderState=new Mv,n._renderElementPool=new Ii(Sy),n._spriteElementPool=new Ii(Py),n._spriteMaskElementPool=new Ii(Ay),n._spriteDefaultMaterial=void 0,n._spriteMaskDefaultMaterial=void 0,n._renderContext=new wy,n._whiteTexture2D=void 0,n._whiteTextureCube=void 0,n._backgroundTextureMaterial=void 0,n._backgroundTextureMesh=void 0,n._renderCount=0,n._shaderProgramPools=[],n._spriteMaskManager=void 0,n._canvas=void 0,n._resourceManager=new Cs(L(n)),n._sceneManager=new Fy(L(n)),n._vSyncCount=1,n._targetFrameRate=60,n._time=new e1,n._isPaused=!0,n._requestId=void 0,n._timeoutId=void 0,n._vSyncCounter=1,n._targetFrameInterval=1e3/60,n._animate=function(){n._vSyncCount?(n._requestId=requestAnimationFrame(n._animate),n._vSyncCounter++%n._vSyncCount==0&&(n.update(),n._vSyncCounter=1)):(n._timeoutId=window.setTimeout(n._animate,n._targetFrameInterval),n.update())},n.features=[],n._hardwareRenderer=e,n._hardwareRenderer.init(r),n._canvas=r,mn.addObject(L(n)),n._sceneManager.activeScene=new gn(L(n),"DefaultScene"),n._spriteMaskManager=new By(L(n)),n._spriteDefaultMaterial=n._createSpriteMaterial(),n._spriteMaskDefaultMaterial=n._createSpriteMaskMaterial();var o=new Uint8Array([255,255,255,255]),s=new Ui(L(n),1,1,ee.R8G8B8A8,!1);s.setPixelBuffer(o),s.isGCIgnored=!0;var l=new vc(L(n),1,ee.R8G8B8A8,!1);return l.setPixelBuffer(yr.PositiveX,o),l.setPixelBuffer(yr.NegativeX,o),l.setPixelBuffer(yr.PositiveY,o),l.setPixelBuffer(yr.NegativeY,o),l.setPixelBuffer(yr.PositiveZ,o),l.setPixelBuffer(yr.NegativeZ,o),l.isGCIgnored=!0,n._whiteTexture2D=s,n._whiteTextureCube=l,n._backgroundTextureMaterial=new hn(L(n),b.find("background-texture")),n._backgroundTextureMaterial.isGCIgnored=!0,n._backgroundTextureMaterial.renderState.depthState.compareFunction=me.LessEqual,n._backgroundTextureMesh=ki.createPlane(L(n),2,2,1,1,!1),n._backgroundTextureMesh.isGCIgnored=!0,n}var a=i.prototype;return a.createEntity=function(e){return new Lr(this,e)},a.pause=function(){this._isPaused=!0,cancelAnimationFrame(this._requestId),clearTimeout(this._timeoutId)},a.resume=function(){!this._isPaused||(this._isPaused=!1,this.time.reset(),requestAnimationFrame(this._animate))},a.update=function(){var e=this._time,n=e.deltaTime;e.tick(),this._renderElementPool.resetPool(),this._spriteElementPool.resetPool(),this._spriteMaskElementPool.resetPool(),mn.callFeatureMethod(this,"preTick",[this,this._sceneManager._activeScene]);var o=this._sceneManager._activeScene,s=this._componentsManager;o&&(s.callScriptOnStart(),s.callScriptOnUpdate(n),s.callAnimationUpdate(n),s.callScriptOnLateUpdate(n),this._render(o)),this._componentsManager.callComponentDestroy(),mn.callFeatureMethod(this,"postTick",[this,this._sceneManager._activeScene])},a.run=function(){mn.callFeatureMethod(this,"preLoad",[this]),this.resume(),this.trigger(new Zh("run",this))},a.destroy=function(){this._sceneManager&&(this._whiteTexture2D.destroy(!0),this._whiteTextureCube.destroy(!0),this.trigger(new Zh("shutdown",this)),mn.callFeatureMethod(this,"shutdown",[this]),this.pause(),this._animate=null,this._sceneManager._activeScene.destroy(),this._resourceManager.gc(),this._componentsManager.callComponentDestroy(),this._sceneManager=null,this._resourceManager=null,this._canvas=null,this.features=[],this._time=null,this._spriteMaskManager.destroy(),mn._objects=[],this.removeAllEventListeners())},a._getShaderProgramPool=function(e){var n=e._shaderId,o=this._shaderProgramPools,s=o[n];if(!s){var l=n+1;l<o.length&&(o.length=l),o[n]=s=new rx}return s},a._render=function(e){var n=e._activeCameras,o=this._componentsManager,s=this.time.deltaTime;if(o.callRendererOnUpdate(s),e._updateShaderData(),n.length>0){n.sort(function(d,h){return d.priority-h.priority});for(var l=0,u=n.length;l<u;l++){var c=n[l],f=c.entity;c.enabled&&f.isActiveInHierarchy&&(o.callCameraOnBeginRender(c),gn.sceneFeatureManager.callFeatureMethod(e,"preRender",[e,c]),c.render(),gn.sceneFeatureManager.callFeatureMethod(e,"postRender",[e,c]),o.callCameraOnEndRender(c))}}},a._createSpriteMaterial=function(){var e=new hn(this,b.find("Sprite")),n=e.renderState,o=n.blendState.targetBlendState;return o.enabled=!0,o.sourceColorBlendFactor=oe.SourceAlpha,o.destinationColorBlendFactor=oe.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=oe.One,o.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha,o.colorBlendOperation=o.alphaBlendOperation=Ht.Add,n.depthState.writeEnabled=!1,n.rasterState.cullMode=Wt.Off,e.renderQueueType=Ze.Transparent,e.isGCIgnored=!0,e},a._createSpriteMaskMaterial=function(){var e=new hn(this,b.find("SpriteMask")),n=e.renderState;return n.blendState.targetBlendState.colorWriteMask=gr.None,n.rasterState.cullMode=Wt.Off,n.stencilState.enabled=!0,n.depthState.enabled=!1,e.isGCIgnored=!0,e},a.findFeature=function(e){return mn.findFeature(this,e)},i.registerFeature=function(e){mn.registerFeature(e)},$(i,[{key:"canvas",get:function(){return this._canvas}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"time",get:function(){return this._time}},{key:"isPaused",get:function(){return this._isPaused}},{key:"vSyncCount",get:function(){return this._vSyncCount},set:function(e){this._vSyncCount=Math.max(0,Math.floor(e))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){e=Math.max(1e-6,e),this._targetFrameRate=e,this._targetFrameInterval=1e3/e}}]),i}(iv),Nr,v_,__,p_,g_,m_,y_,x_,sx=(Nr=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,I(r,"_started",v_,L(r)),I(r,"_onStartIndex",__,L(r)),I(r,"_onUpdateIndex",p_,L(r)),I(r,"_onLateUpdateIndex",g_,L(r)),I(r,"_onPreRenderIndex",m_,L(r)),I(r,"_onPostRenderIndex",y_,L(r)),I(r,"_entityCacheIndex",x_,L(r)),r}var a=i.prototype;return a.onAwake=function(){},a.onEnable=function(){},a.onStart=function(){},a.onUpdate=function(e){},a.onLateUpdate=function(e){},a.onBeginRender=function(e){},a.onEndRender=function(e){},a.onTriggerEnter=function(e){},a.onTriggerStay=function(e){},a.onTriggerExit=function(e){},a.onPointerDown=function(){},a.onPointerUp=function(){},a.onPointerClick=function(){},a.onPointerEnter=function(){},a.onPointerExit=function(){},a.onPointerDrag=function(){},a.onDisable=function(){},a.onDestroy=function(){},a._onAwake=function(){this.onAwake()},a._onEnable=function(){var e=this.engine._componentsManager,n=i.prototype;this._started||e.addOnStartScript(this),this.onUpdate!==n.onUpdate&&e.addOnUpdateScript(this),this.onLateUpdate!==n.onLateUpdate&&e.addOnLateUpdateScript(this),this._entity._addScript(this),this.onEnable()},a._onDisable=function(){var e=this.engine._componentsManager;this._onStartIndex!==-1&&e.removeOnStartScript(this),this._onUpdateIndex!==-1&&e.removeOnUpdateScript(this),this._onLateUpdateIndex!==-1&&e.removeOnLateUpdateScript(this),this._entityCacheIndex!==-1&&this._entity._removeScript(this),this.onDisable()},a._onDestroy=function(){this.engine._componentsManager.addDestroyComponent(this)},i}(Jt),v_=N(Nr.prototype,"_started",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),__=N(Nr.prototype,"_onStartIndex",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),p_=N(Nr.prototype,"_onUpdateIndex",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),g_=N(Nr.prototype,"_onLateUpdateIndex",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),m_=N(Nr.prototype,"_onPreRenderIndex",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),y_=N(Nr.prototype,"_onPostRenderIndex",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),x_=N(Nr.prototype,"_entityCacheIndex",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Nr),Vi;(function(t){t[t.DepthColor=0]="DepthColor",t[t.Depth=1]="Depth",t[t.None=2]="None"})(Vi||(Vi={}));var lx=0,Gi=function(){function t(a,r,e,n,o){a===void 0&&(a="RENDER_PASS"+lx++),r===void 0&&(r=0),e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),this.name=void 0,this.enabled=void 0,this.priority=void 0,this.renderTarget=void 0,this.replaceMaterial=void 0,this.mask=void 0,this.renderOverride=void 0,this.clearFlags=void 0,this.clearColor=void 0,this.name=a,this.enabled=!0,this.priority=r,this.renderTarget=e,this.replaceMaterial=n,this.mask=o||Gt.Everything,this.renderOverride=!1}var i=t.prototype;return i.render=function(r,e,n,o){},i.preRender=function(r,e,n,o){},i.postRender=function(r,e,n,o){},t}(),w_=function(t){Y(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.createVertexElements=function(e){return e[0]=new ve("POSITION",0,Q.Vector3,0),e[1]=new ve("TEXCOORD_0",12,Q.Vector2,0),e[2]=new ve("COLOR_0",20,Q.Vector4,0),36},a.canBatch=function(e,n){var o=e.component,s=n.component;if(!this.checkBatchWithMask(o,s))return!1;var l=i._textureProperty;return o.shaderData.getTexture(l)!==s.shaderData.getTexture(l)?!1:e.material===n.material},a.checkBatchWithMask=function(e,n){var o=e.maskInteraction;return o!==n.maskInteraction?!1:o===vn.None?!0:e.maskLayer===n.maskLayer},a.updateVertices=function(e,n,o){for(var s=e.positions,l=e.uv,u=e.color,c=s.length,f=0;f<c;f++){var d=s[f],h=l[f];n[o++]=d.x,n[o++]=d.y,n[o++]=d.z,n[o++]=h.x,n[o++]=h.y,n[o++]=u.r,n[o++]=u.g,n[o++]=u.b,n[o++]=u.a}return o},a.drawBatches=function(e){for(var n=this._meshes[this._flushId],o=n.subMeshes,s=this._batchedQueue,l=e._spriteMaskManager,u=0,c=o.length;u<c;u++){var f=o[u],d=s[u];if(!f||!d)return;var h=d.component,_=d.camera,m=d.material;l.preRender(_,h);var v=b._compileMacros;vr.unionCollection(h._globalShaderMacro,m.shaderData._macroCollection,v);var p=m.shader._getShaderProgram(e,v);if(!p.isValid)return;p.bind(),p.groupingOtherUniformBlock(),p.uploadAll(p.sceneUniformBlock,_.scene.shaderData),p.uploadAll(p.cameraUniformBlock,_.shaderData),p.uploadAll(p.rendererUniformBlock,h.shaderData),p.uploadAll(p.materialUniformBlock,m.shaderData),m.renderState._apply(e),e._hardwareRenderer.drawPrimitive(n,f,p),l.postRender(h)}},a.destroy=function(){this._batchedQueue=null;for(var e=this._meshes,n=this._vertexBuffers,o=this._indiceBuffers,s=0,l=e.length;s<l;++s)e[s].destroy();this._meshes=null;for(var u=0,c=n.length;u<c;++u)n[u].destroy();this._vertexBuffers=null;for(var f=0,d=o.length;f<d;++f)o[f].destroy();this._indiceBuffers=null},i}(Us);w_._textureProperty=b.getPropertyByName("u_spriteTexture");var Hi=function(){t._compareFromNearToFar=function(r,e){return r.material.renderQueueType-e.material.renderQueueType||r.component._distanceForSort-e.component._distanceForSort||e.component._renderSortId-r.component._renderSortId},t._compareFromFarToNear=function(r,e){return r.material.renderQueueType-e.material.renderQueueType||e.component._distanceForSort-r.component._distanceForSort||e.component._renderSortId-r.component._renderSortId};function t(a){this.items=[],this._spriteBatcher=void 0,this._spriteBatcher=new w_(a)}var i=t.prototype;return i.pushPrimitive=function(r){this.items.push(r)},i.render=function(r,e,n){var o=this.items;if(o.length!==0){for(var s=r.engine,l=r.scene,u=s._renderCount,c=s._hardwareRenderer,f=l.shaderData,d=r.shaderData,h=0,_=o.length;h<_;h++){var m=o[h],v=m.component.entity.layer;if(!!(v&n))if(m.mesh){this._spriteBatcher.flush(s);var p=b._compileMacros,g=m,y=g.component,x=e||g.material,T=y.shaderData,w=x.shaderData;x._preRender(g),vr.unionCollection(y._globalShaderMacro,w._macroCollection,p);var S=x.shader._getShaderProgram(s,p);if(!S.isValid)continue;var M=S.bind(),P=u!==S._uploadRenderCount;P?(S.groupingOtherUniformBlock(),S.uploadAll(S.sceneUniformBlock,f),S.uploadAll(S.cameraUniformBlock,d),S.uploadAll(S.rendererUniformBlock,T),S.uploadAll(S.materialUniformBlock,w),S.uploadUngroupTextures(),S._uploadCamera=r,S._uploadRenderer=y,S._uploadMaterial=x,S._uploadRenderCount=u):(S._uploadCamera!==r?(S.uploadAll(S.cameraUniformBlock,d),S._uploadCamera=r):M&&S.uploadTextures(S.cameraUniformBlock,d),S._uploadRenderer!==y?(S.uploadAll(S.rendererUniformBlock,T),S._uploadRenderer=y):M&&S.uploadTextures(S.rendererUniformBlock,T),S._uploadMaterial!==x?(S.uploadAll(S.materialUniformBlock,w),S._uploadMaterial=x):M&&S.uploadTextures(S.materialUniformBlock,w),M&&S.uploadUngroupTextures()),x.renderState._apply(r.engine),c.drawPrimitive(g.mesh,g.subMesh,S)}else{var E=m;this._spriteBatcher.drawElement(E)}}this._spriteBatcher.flush(s)}},i.clear=function(){this.items.length=0,this._spriteBatcher.clear()},i.destroy=function(){this._spriteBatcher.destroy(),this._spriteBatcher=null},i.sort=function(r){this._quickSort(this.items,0,this.items.length,r)},i._quickSort=function(r,e,n,o){for(;;){if(n-e<=10){this._insertionSort(r,e,n,o);return}var s=e+n>>1,l=r[e],u=r[n-1],c=r[s],f=o(l,u);if(f>0){var d=l;l=u,u=d}var h=o(l,c);if(h>=0){var _=l;l=c,c=u,u=_}else{var m=o(u,c);if(m>0){var v=u;u=c,c=v}}r[e]=l,r[n-1]=c;var p=u,g=e+1,y=n-1;r[s]=r[g],r[g]=p;e:for(var x=g+1;x<y;x++){var T=r[x],w=o(T,p);if(w<0)r[x]=r[g],r[g]=T,g++;else if(w>0){do{if(y--,y==x)break e;var S=r[y];w=o(S,p)}while(w>0);r[x]=r[y],r[y]=T,w<0&&(T=r[x],r[x]=r[g],r[g]=T,g++)}}n-y<g-e?(this._quickSort(r,y,n,o),n=g):(this._quickSort(r,e,g,o),e=y)}},i._insertionSort=function(r,e,n,o){for(var s=e+1;s<n;s++){var l=void 0,u=r[s];for(l=s-1;l>=e;l--){var c=r[l],f=o(c,u);if(f>0)r[l+1]=c;else break}r[l+1]=u}},t}(),ux=function(){function t(a){this._opaqueQueue=void 0,this._transparentQueue=void 0,this._alphaTestQueue=void 0,this._allSpriteMasks=new dn,this._camera=void 0,this._defaultPass=void 0,this._renderPassArray=void 0,this._lastCanvasSize=new G,this._camera=a;var r=a.engine;this._opaqueQueue=new Hi(r),this._alphaTestQueue=new Hi(r),this._transparentQueue=new Hi(r),this._renderPassArray=[],this._defaultPass=new Gi("default",0,null,null,0),this.addRenderPass(this._defaultPass)}var i=t.prototype;return i.addRenderPass=function(r,e,n,o,s){if(e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),s===void 0&&(s=null),typeof r=="string"){var l=new Gi(r,e,n,o,s);this._renderPassArray.push(l)}else r instanceof Gi&&this._renderPassArray.push(r);this._renderPassArray.sort(function(u,c){return u.priority-c.priority})},i.removeRenderPass=function(r){var e;if(typeof r=="string"?e=this.getRenderPass(r):r instanceof Gi&&(e=r),e){var n=this._renderPassArray.indexOf(e);this._renderPassArray.splice(n,1)}},i.getRenderPass=function(r){for(var e=0,n=this._renderPassArray.length;e<n;e++){var o=this._renderPassArray[e];if(o.name===r)return o}return null},i.destroy=function(){this._opaqueQueue.destroy(),this._alphaTestQueue.destroy(),this._transparentQueue.destroy(),this._allSpriteMasks=null,this._renderPassArray=null,this._defaultPass=null,this._camera=null},i.render=function(r,e){var n=this._camera,o=this._opaqueQueue,s=this._alphaTestQueue,l=this._transparentQueue;n.engine._spriteMaskManager.clear(),o.clear(),s.clear(),l.clear(),this._allSpriteMasks.length=0,n.engine._componentsManager.callRender(r),o.sort(Hi._compareFromNearToFar),s.sort(Hi._compareFromNearToFar),l.sort(Hi._compareFromFarToNear);for(var u=0,c=this._renderPassArray.length;u<c;u++)this._drawRenderPass(this._renderPassArray[u],n,e)},i._drawRenderPass=function(r,e,n){if(r.preRender(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue),r.enabled){var o,s,l=e.engine,u=e.scene,c=u.background,f=l._hardwareRenderer,d=e.renderTarget||r.renderTarget;f.activeRenderTarget(d,e),d==null||d._setRenderTargetFace(n);var h=(o=r.clearFlags)!=null?o:e.clearFlags,_=(s=r.clearColor)!=null?s:c.solidColor;h!==Vi.None&&f.clearRenderTarget(e.engine,h,_),r.renderOverride?r.render(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue):(this._opaqueQueue.render(e,r.replaceMaterial,r.mask),this._alphaTestQueue.render(e,r.replaceMaterial,r.mask),c.mode===Za.Sky?this._drawSky(l,e,c.sky):c.mode===Za.Texture&&c.texture&&this._drawBackgroundTexture(l,c),this._transparentQueue.render(e,r.replaceMaterial,r.mask)),d==null||d._blitRenderTarget(),d==null||d.generateMipmaps()}r.postRender(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue)},i.pushPrimitive=function(r){var e=r.material.renderQueueType;e>Ze.Transparent+Ze.AlphaTest>>1?this._transparentQueue.pushPrimitive(r):e>Ze.AlphaTest+Ze.Opaque>>1?this._alphaTestQueue.pushPrimitive(r):this._opaqueQueue.pushPrimitive(r)},i._drawBackgroundTexture=function(r,e){var n=r._hardwareRenderer,o=r._backgroundTextureMaterial,s=r._backgroundTextureMesh,l=r.canvas;(this._lastCanvasSize.x!==l.width||this._lastCanvasSize.y!==l.height)&&e._textureFillMode!==Xn.Fill&&(this._lastCanvasSize.setValue(l.width,l.height),e._resizeBackgroundTexture());var u=o.shader._getShaderProgram(r,b._compileMacros);u.bind(),u.uploadAll(u.materialUniformBlock,o.shaderData),u.uploadUngroupTextures(),o.renderState._apply(r),n.drawPrimitive(s,s.subMesh,u)},i._drawSky=function(r,e,n){var o=n.material,s=n.mesh,l=n._matrix;if(!!o&&!!s){var u=r._hardwareRenderer,c=o.shaderData,f=o.shader,d=o.renderState,h=b._compileMacros;vr.unionCollection(e._globalShaderMacro,c._macroCollection,h);var _=e.viewMatrix,m=e.projectionMatrix;_.cloneTo(l);var v=l.elements;v[12]=v[13]=v[14]=0,Z.multiply(m,l,l),c.setMatrix("u_mvpNoscale",l);var p=f._getShaderProgram(r,h);p.bind(),p.groupingOtherUniformBlock(),p.uploadAll(p.materialUniformBlock,c),p.uploadUngroupTextures(),d._apply(r),u.drawPrimitive(s,s.subMesh,p)}},$(t,[{key:"defaultRenderPass",get:function(){return this._defaultPass}}]),t}(),S_,P_,At,A_,T_,M_,E_,b_,C_,R_,z_,B_,L_,O_,D_,qn,F_,st=function(){};st.tempMat4=new Z;st.tempVec4=new Ee;st.tempVec3=new A;st.tempVec2=new G;var I_=(S_=r1(pr),S_(P_=(At=(F_=qn=function(t){Y(i,t);function i(r){var e;e=t.call(this,r)||this,e.shaderData=new Bs(er.Camera),e.priority=0,e.enableFrustumCulling=!0,e.clearFlags=Vi.DepthColor,e.cullingMask=Gt.Everything,e._globalShaderMacro=new vr,I(e,"_frustum",A_,L(e)),I(e,"_renderPipeline",T_,L(e)),e._isOrthographic=!1,e._isProjMatSetting=!1,e._nearClipPlane=.1,e._farClipPlane=100,e._fieldOfView=45,e._orthographicSize=10,e._isProjectionDirty=!0,e._isInvProjMatDirty=!0,e._isFrustumProjectDirty=!0,e._customAspectRatio=void 0,e._renderTarget=null,I(e,"_frustumViewChangeFlag",M_,L(e)),I(e,"_transform",E_,L(e)),I(e,"_isViewMatrixDirty",b_,L(e)),I(e,"_isInvViewProjDirty",C_,L(e)),I(e,"_projectionMatrix",R_,L(e)),I(e,"_viewMatrix",z_,L(e)),I(e,"_viewport",B_,L(e)),I(e,"_inverseProjectionMatrix",L_,L(e)),I(e,"_lastAspectSize",O_,L(e)),I(e,"_invViewProjMat",D_,L(e));var n=e.entity.transform;return e._transform=n,e._isViewMatrixDirty=n.registerWorldChangeFlag(),e._isInvViewProjDirty=n.registerWorldChangeFlag(),e._frustumViewChangeFlag=n.registerWorldChangeFlag(),e._renderPipeline=new ux(L(e)),e.shaderData._addRefCount(1),e}var a=i.prototype;return a.resetProjectionMatrix=function(){this._isProjMatSetting=!1,this._projMatChange()},a.resetAspectRatio=function(){this._customAspectRatio=void 0,this._projMatChange()},a.worldToViewportPoint=function(e,n){Z.multiply(this.projectionMatrix,this.viewMatrix,st.tempMat4),st.tempVec4.setValue(e.x,e.y,e.z,1),Ee.transform(st.tempVec4,st.tempMat4,st.tempVec4);var o=st.tempVec4.w,s=st.tempVec4.x/o,l=st.tempVec4.y/o,u=st.tempVec4.z/o;return n.x=(s+1)*.5,n.y=(1-l)*.5,n.z=u,n.w=o,n},a.viewportToWorldPoint=function(e,n){var o=this.invViewProjMat;return this._innerViewportToWorldPoint(e,o,n)},a.viewportPointToRay=function(e,n){var o=st.tempVec3;o.setValue(e.x,e.y,0);var s=this.viewportToWorldPoint(o,n.origin);o.z=1;var l=this._innerViewportToWorldPoint(o,this._invViewProjMat,o);return A.subtract(l,s,n.direction),n.direction.normalize(),n},a.screenToViewportPoint=function(e,n){var o=this.engine.canvas,s=this.viewport;return n.x=(e.x/o.width-s.x)/s.z,n.y=(e.y/o.height-s.y)/s.w,n},a.viewportToScreenPoint=function(e,n){var o=this.engine.canvas,s=this.viewport;return n.x=(s.x+e.x*s.z)*o.width,n.y=(s.y+e.y*s.w)*o.height,n},a.worldToScreenPoint=function(e,n){return this.worldToViewportPoint(e,n),this.viewportToScreenPoint(n,n)},a.screenToWorldPoint=function(e,n){return this.screenToViewportPoint(e,n),this.viewportToWorldPoint(n,n)},a.screenPointToRay=function(e,n){var o=st.tempVec2;return this.screenToViewportPoint(e,o),this.viewportPointToRay(o,n)},a.render=function(e){var n=this.engine._renderContext;n._setContext(this),this.enableFrustumCulling&&(this._frustumViewChangeFlag.flag||this._isFrustumProjectDirty)&&(this._frustum.calculateFromMatrix(n._viewProjectMatrix),this._frustumViewChangeFlag.flag=!1,this._isFrustumProjectDirty=!1),this._updateShaderData(n),vr.unionCollection(this.scene.shaderData._macroCollection,this.shaderData._macroCollection,this._globalShaderMacro),this._renderPipeline.render(n,e),this._engine._renderCount++},a._onActive=function(){this.entity.scene._attachRenderCamera(this)},a._onInActive=function(){this.entity.scene._detachRenderCamera(this)},a._onDestroy=function(){var e;(e=this._renderPipeline)===null||e===void 0||e.destroy(),this._isInvViewProjDirty.destroy(),this._isViewMatrixDirty.destroy(),this.shaderData._addRefCount(-1)},a._projMatChange=function(){this._isFrustumProjectDirty=!0,this._isProjectionDirty=!0,this._isInvProjMatDirty=!0,this._isInvViewProjDirty.flag=!0},a._innerViewportToWorldPoint=function(e,n,o){var s=e.z*2-1,l=st.tempVec4;l.setValue(e.x*2-1,1-e.y*2,s,1),Ee.transform(l,n,l);var u=1/l.w;return o.x=l.x*u,o.y=l.y*u,o.z=l.z*u,o},a._updateShaderData=function(e){var n=this.shaderData;n.setMatrix(i._viewMatrixProperty,this.viewMatrix),n.setMatrix(i._projectionMatrixProperty,this.projectionMatrix),n.setMatrix(i._vpMatrixProperty,e._viewProjectMatrix),n.setMatrix(i._inverseViewMatrixProperty,this._transform.worldMatrix),n.setMatrix(i._inverseProjectionMatrixProperty,this.inverseProjectionMatrix),n.setVector3(i._cameraPositionProperty,this._transform.worldPosition)},$(i,[{key:"nearClipPlane",get:function(){return this._nearClipPlane},set:function(e){this._nearClipPlane=e,this._projMatChange()}},{key:"farClipPlane",get:function(){return this._farClipPlane},set:function(e){this._farClipPlane=e,this._projMatChange()}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._projMatChange()}},{key:"aspectRatio",get:function(){var e,n=this._entity.engine.canvas;return(e=this._customAspectRatio)!=null?e:n.width*this._viewport.z/(n.height*this._viewport.w)},set:function(e){this._customAspectRatio=e,this._projMatChange()}},{key:"viewport",get:function(){return this._viewport},set:function(e){e!==this._viewport&&e.cloneTo(this._viewport),this._projMatChange()}},{key:"isOrthographic",get:function(){return this._isOrthographic},set:function(e){this._isOrthographic=e,this._projMatChange()}},{key:"orthographicSize",get:function(){return this._orthographicSize},set:function(e){this._orthographicSize=e,this._projMatChange()}},{key:"viewMatrix",get:function(){return this._isViewMatrixDirty.flag&&(this._isViewMatrixDirty.flag=!1,Z.invert(this._transform.worldMatrix,this._viewMatrix)),this._viewMatrix}},{key:"projectionMatrix",get:function(){var e=this._entity.engine.canvas;if((!this._isProjectionDirty||this._isProjMatSetting)&&this._lastAspectSize.x===e.width&&this._lastAspectSize.y===e.height)return this._projectionMatrix;this._isProjectionDirty=!1,this._lastAspectSize.x=e.width,this._lastAspectSize.y=e.height;var n=this.aspectRatio;if(!this._isOrthographic)Z.perspective(O.degreeToRadian(this._fieldOfView),n,this._nearClipPlane,this._farClipPlane,this._projectionMatrix);else{var o=this._orthographicSize*n,s=this._orthographicSize;Z.ortho(-o,o,-s,s,this._nearClipPlane,this._farClipPlane,this._projectionMatrix)}return this._projectionMatrix},set:function(e){this._projectionMatrix=e,this._isProjMatSetting=!0,this._projMatChange()}},{key:"enableHDR",get:function(){return console.log("not implementation"),!1},set:function(e){console.log("not implementation")}},{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){this._renderTarget=e}},{key:"invViewProjMat",get:function(){return this._isInvViewProjDirty.flag&&(this._isInvViewProjDirty.flag=!1,Z.multiply(this._transform.worldMatrix,this.inverseProjectionMatrix,this._invViewProjMat)),this._invViewProjMat}},{key:"inverseProjectionMatrix",get:function(){return this._isInvProjMatDirty&&(this._isInvProjMatDirty=!1,Z.invert(this.projectionMatrix,this._inverseProjectionMatrix)),this._inverseProjectionMatrix}}]),i}(Jt),qn._viewMatrixProperty=b.getPropertyByName("u_viewMat"),qn._projectionMatrixProperty=b.getPropertyByName("u_projMat"),qn._vpMatrixProperty=b.getPropertyByName("u_VPMat"),qn._inverseViewMatrixProperty=b.getPropertyByName("u_viewInvMat"),qn._inverseProjectionMatrixProperty=b.getPropertyByName("u_projInvMat"),qn._cameraPositionProperty=b.getPropertyByName("u_cameraPos"),F_),A_=N(At.prototype,"_frustum",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new km}}),T_=N(At.prototype,"_renderPipeline",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=N(At.prototype,"_frustumViewChangeFlag",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E_=N(At.prototype,"_transform",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b_=N(At.prototype,"_isViewMatrixDirty",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C_=N(At.prototype,"_isInvViewProjDirty",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=N(At.prototype,"_projectionMatrix",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),z_=N(At.prototype,"_viewMatrix",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),B_=N(At.prototype,"_viewport",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ee(0,0,1,1)}}),L_=N(At.prototype,"_inverseProjectionMatrix",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),O_=N(At.prototype,"_lastAspectSize",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new G(0,0)}}),D_=N(At.prototype,"_invViewProjMat",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z}}),At))||P_),cx={json:"json",gltf:"json",mtl:"json",prefab:"json",txt:"text",bin:"arraybuffer",png:"image",webp:"image",jpg:"image"},fx=4,dx=15e3,hx=500;function Gs(t,i){return i===void 0&&(i={}),new Ut(function(a,r,e){var n,o,s,l,u=(n=i.retryCount)!=null?n:fx,c=(o=i.retryInterval)!=null?o:hx;i.timeout=(s=i.timeout)!=null?s:dx,i.type=(l=i.type)!=null?l:px(t);var f=i.type==="image"?vx:_x,d,h=new gx(function(){return f(t,i).onProgress(e).then(function(_){a(_),h.stop()}).catch(function(_){return d=_})},u,c);h.start(function(){r(d)})})}function vx(t,i){return new Ut(function(a,r){var e=i.timeout,n=new Image,o=function(){r(new Error("request "+t+" fail"))};n.onerror=o,n.onabort=o;var s=setTimeout(function(){r(new Error("request "+t+" timeout"))},e);n.onload=function(l){return function(){requestAnimationFrame(function(){a(n),n.onload=null,n.onerror=null,n.onabort=null}),clearTimeout(l)}}(s),n.crossOrigin="anonymous",n.src=t})}function _x(t,i){return new Ut(function(a,r,e){var n,o=new XMLHttpRequest;o.timeout=i.timeout,i.method=(n=i.method)!=null?n:"get",o.onload=function(){var l;if(o.status<200||o.status>=300){r(new Error("request failed from: "+t));return}var u=(l=o.response)!=null?l:o.responseText;a(u)},o.onerror=function(){r(new Error("request failed from: "+t))},o.ontimeout=function(){r(new Error("request timeout from: "+t))},o.onprogress=function(l){e(l.loaded/l.total)},o.open(i.method,t,!0),o.withCredentials=i.credentials==="include",o.responseType=i.type;var s=i.headers;s&&Object.keys(s).forEach(function(l){o.setRequestHeader(l,s[l])}),o.send(i.body)})}function px(t){var i=t.substring(t.lastIndexOf(".")+1);return cx[i]}var gx=function(){function t(a,r,e){this.execFunc=a,this.totalCount=r,this.interval=e,this._timeoutId=-100,this._currentCount=0,this.done=void 0,this.exec=this.exec.bind(this)}var i=t.prototype;return i.start=function(r){this.done=r,this.exec()},i.stop=function(){clearTimeout(this._timeoutId)},i.exec=function(){var r=this;if(this._currentCount>=this.totalCount){this.done&&this.done();return}this._currentCount++,this.execFunc(this._currentCount).then(function(){r._timeoutId=setTimeout(r.exec,r.interval)})},t}(),yn=function(i){this.useCache=i,this.request=Gs},De;(function(t){t.Text="text",t.JSON="json",t.Buffer="buffer",t.Texture2D="texture2d",t.TextureCube="texture-cube",t.Material="material",t.Mesh="mesh",t.AnimationClip="animation-clip",t.Prefab="prefab",t.KTX="ktx",t.KTXCube="ktx-cube",t.SpriteAtlas="sprite-atlas"})(De||(De={}));var xn;(function(t){t[t.Front=0]="Front",t[t.Back=1]="Back",t[t.Double=2]="Double"})(xn||(xn={}));var Ja;(function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive"})(Ja||(Ja={}));var eo=function(t){Y(i,t);function i(r,e){var n;return n=t.call(this,r,e)||this,n._renderFace=xn.Front,n._isTransparent=!1,n._blendMode=void 0,n.blendMode=Ja.Normal,n.shaderData.setFloat(i._alphaCutoffProp,0),n}var a=i.prototype;return a.clone=function(){var e=new i(this._engine,this.shader);return this.cloneTo(e),e},a.cloneTo=function(e){t.prototype.cloneTo.call(this,e),e._renderFace=this._renderFace,e._isTransparent=this._isTransparent,e._blendMode=this._blendMode},$(i,[{key:"isTransparent",get:function(){return this._isTransparent},set:function(e){if(e!==this._isTransparent){this._isTransparent=e;var n=this.renderState,o=n.depthState,s=n.blendState.targetBlendState;e?(s.enabled=!0,o.writeEnabled=!1,this.renderQueueType=Ze.Transparent):(s.enabled=!1,o.writeEnabled=!0,this.renderQueueType=this.shaderData.getFloat(i._alphaCutoffProp)?Ze.AlphaTest:Ze.Opaque)}}},{key:"alphaCutoff",get:function(){return this.shaderData.getFloat(i._alphaCutoffProp)},set:function(e){this.shaderData.setFloat(i._alphaCutoffProp,e),e>0?(this.shaderData.enableMacro(i._alphaCutoffMacro),this.renderQueueType=this._isTransparent?Ze.Transparent:Ze.AlphaTest):(this.shaderData.disableMacro(i._alphaCutoffMacro),this.renderQueueType=this._isTransparent?Ze.Transparent:Ze.Opaque)}},{key:"renderFace",get:function(){return this._renderFace},set:function(e){if(e!==this._renderFace)switch(this._renderFace=e,e){case xn.Front:this.renderState.rasterState.cullMode=Wt.Back;break;case xn.Back:this.renderState.rasterState.cullMode=Wt.Front;break;case xn.Double:this.renderState.rasterState.cullMode=Wt.Off;break}}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){if(e!==this._blendMode){this._blendMode=e;var n=this.renderState.blendState.targetBlendState;switch(e){case Ja.Normal:n.sourceColorBlendFactor=oe.SourceAlpha,n.destinationColorBlendFactor=oe.OneMinusSourceAlpha,n.sourceAlphaBlendFactor=oe.One,n.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha,n.colorBlendOperation=n.alphaBlendOperation=Ht.Add;break;case Ja.Additive:n.sourceColorBlendFactor=oe.SourceAlpha,n.destinationColorBlendFactor=oe.One,n.sourceAlphaBlendFactor=oe.One,n.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha,n.colorBlendOperation=n.alphaBlendOperation=Ht.Add;break}}}}]),i}(hn);eo._alphaCutoffMacro=b.getMacroByName("ALPHA_CUTOFF");eo._alphaCutoffProp=b.getPropertyByName("u_alphaCutoff");var Tt=function(t){Y(i,t);function i(r){var e;e=t.call(this,r,b.find("blinn-phong"))||this;var n=e.shaderData;return n.enableMacro("O3_NEED_WORLDPOS"),n.enableMacro("O3_NEED_TILINGOFFSET"),n.setColor(i._diffuseColorProp,new ge(1,1,1,1)),n.setColor(i._specularColorProp,new ge(1,1,1,1)),n.setColor(i._emissiveColorProp,new ge(0,0,0,1)),n.setVector4(i._tilingOffsetProp,new Ee(1,1,0,0)),n.setFloat(i._shininessProp,16),n.setFloat(i._normalIntensityProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},$(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._diffuseColorProp)},set:function(e){var n=this.shaderData.getColor(i._diffuseColorProp);e!==n&&e.cloneTo(n)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(e){this.shaderData.setTexture(i._baseTextureProp,e),e?this.shaderData.enableMacro("O3_DIFFUSE_TEXTURE"):this.shaderData.disableMacro("O3_DIFFUSE_TEXTURE")}},{key:"specularColor",get:function(){return this.shaderData.getColor(i._specularColorProp)},set:function(e){var n=this.shaderData.getColor(i._specularColorProp);e!==n&&e.cloneTo(n)}},{key:"specularTexture",get:function(){return this.shaderData.getTexture(i._specularTextureProp)},set:function(e){this.shaderData.setTexture(i._specularTextureProp,e),e?this.shaderData.enableMacro("O3_SPECULAR_TEXTURE"):this.shaderData.disableMacro("O3_SPECULAR_TEXTURE")}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(i._emissiveColorProp)},set:function(e){var n=this.shaderData.getColor(i._emissiveColorProp);e!==n&&e.cloneTo(n)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(i._emissiveTextureProp)},set:function(e){this.shaderData.setTexture(i._emissiveTextureProp,e),e?this.shaderData.enableMacro("O3_EMISSIVE_TEXTURE"):this.shaderData.disableMacro("O3_EMISSIVE_TEXTURE")}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(i._normalTextureProp)},set:function(e){this.shaderData.setTexture(i._normalTextureProp,e),e?this.shaderData.enableMacro("O3_NORMAL_TEXTURE"):this.shaderData.disableMacro("O3_NORMAL_TEXTURE")}},{key:"normalIntensity",get:function(){return this.shaderData.getFloat(i._normalIntensityProp)},set:function(e){this.shaderData.setFloat(i._normalIntensityProp,e)}},{key:"shininess",get:function(){return this.shaderData.getFloat(i._shininessProp)},set:function(e){this.shaderData.setFloat(i._shininessProp,e)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(i._tilingOffsetProp);e!==n&&e.cloneTo(n)}}]),i}(eo);Tt._diffuseColorProp=b.getPropertyByName("u_diffuseColor");Tt._specularColorProp=b.getPropertyByName("u_specularColor");Tt._emissiveColorProp=b.getPropertyByName("u_emissiveColor");Tt._tilingOffsetProp=b.getPropertyByName("u_tilingOffset");Tt._shininessProp=b.getPropertyByName("u_shininess");Tt._normalIntensityProp=b.getPropertyByName("u_normalIntensity");Tt._baseTextureProp=b.getPropertyByName("u_diffuseTexture");Tt._specularTextureProp=b.getPropertyByName("u_specularTexture");Tt._emissiveTextureProp=b.getPropertyByName("u_emissiveTexture");Tt._normalTextureProp=b.getPropertyByName("u_normalTexture");var nr=function(t){Y(i,t);function i(a){var r;r=t.call(this,a,b.find("pbr"))||this;var e=r.shaderData;return e.enableMacro("O3_NEED_WORLDPOS"),e.enableMacro("O3_NEED_TILINGOFFSET"),e.setColor(i._baseColorProp,new ge(1,1,1,1)),e.setColor(i._emissiveColorProp,new ge(0,0,0,1)),e.setVector4(i._tilingOffsetProp,new Ee(1,1,0,0)),e.setFloat(i._normalTextureIntensityProp,1),e.setFloat(i._occlusionTextureIntensityProp,1),r}return $(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(r){var e=this.shaderData.getColor(i._baseColorProp);r!==e&&r.cloneTo(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(r){this.shaderData.setTexture(i._baseTextureProp,r),r?this.shaderData.enableMacro("HAS_BASECOLORMAP"):this.shaderData.disableMacro("HAS_BASECOLORMAP")}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(i._normalTextureProp)},set:function(r){this.shaderData.setTexture(i._normalTextureProp,r),r?this.shaderData.enableMacro("O3_NORMAL_TEXTURE"):this.shaderData.disableMacro("O3_NORMAL_TEXTURE")}},{key:"normalTextureIntensity",get:function(){return this.shaderData.getFloat(i._normalTextureIntensityProp)},set:function(r){this.shaderData.setFloat(i._normalTextureIntensityProp,r),this.shaderData.setFloat("u_normalIntensity",r)}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(i._emissiveColorProp)},set:function(r){var e=this.shaderData.getColor(i._emissiveColorProp);r!==e&&r.cloneTo(e)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(i._emissiveTextureProp)},set:function(r){this.shaderData.setTexture(i._emissiveTextureProp,r),r?this.shaderData.enableMacro("HAS_EMISSIVEMAP"):this.shaderData.disableMacro("HAS_EMISSIVEMAP")}},{key:"occlusionTexture",get:function(){return this.shaderData.getTexture(i._occlusionTextureProp)},set:function(r){this.shaderData.setTexture(i._occlusionTextureProp,r),r?this.shaderData.enableMacro("HAS_OCCLUSIONMAP"):this.shaderData.disableMacro("HAS_OCCLUSIONMAP")}},{key:"occlusionTextureIntensity",get:function(){return this.shaderData.getFloat(i._occlusionTextureIntensityProp)},set:function(r){this.shaderData.setFloat(i._occlusionTextureIntensityProp,r)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(r){var e=this.shaderData.getVector4(i._tilingOffsetProp);r!==e&&r.cloneTo(e)}}]),i}(eo);nr._baseColorProp=b.getPropertyByName("u_baseColor");nr._emissiveColorProp=b.getPropertyByName("u_emissiveColor");nr._tilingOffsetProp=b.getPropertyByName("u_tilingOffset");nr._baseTextureProp=b.getPropertyByName("u_baseColorSampler");nr._normalTextureProp=b.getPropertyByName("u_normalTexture");nr._normalTextureIntensityProp=b.getPropertyByName("u_normalIntensity");nr._occlusionTextureIntensityProp=b.getPropertyByName("u_occlusionStrength");nr._emissiveTextureProp=b.getPropertyByName("u_emissiveSampler");nr._occlusionTextureProp=b.getPropertyByName("u_occlusionSampler");var Qn=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,e.shaderData.enableMacro("IS_METALLIC_WORKFLOW"),e.shaderData.setFloat(i._metallicProp,1),e.shaderData.setFloat(i._roughnessProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},$(i,[{key:"metallic",get:function(){return this.shaderData.getFloat(i._metallicProp)},set:function(e){this.shaderData.setFloat(i._metallicProp,e)}},{key:"roughness",get:function(){return this.shaderData.getFloat(i._roughnessProp)},set:function(e){this.shaderData.setFloat(i._roughnessProp,e)}},{key:"roughnessMetallicTexture",get:function(){return this.shaderData.getTexture(i._metallicRoughnessTextureProp)},set:function(e){this.shaderData.setTexture(i._metallicRoughnessTextureProp,e),e?this.shaderData.enableMacro("HAS_METALROUGHNESSMAP"):this.shaderData.disableMacro("HAS_METALROUGHNESSMAP")}}]),i}(nr);Qn._metallicProp=b.getPropertyByName("u_metal");Qn._roughnessProp=b.getPropertyByName("u_roughness");Qn._metallicRoughnessTextureProp=b.getPropertyByName("u_metallicRoughnessSampler");var Yn=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,e.shaderData.setColor(i._specularColorProp,new ge(1,1,1,1)),e.shaderData.setFloat(i._glossinessProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},$(i,[{key:"specularColor",get:function(){return this.shaderData.getColor(i._specularColorProp)},set:function(e){var n=this.shaderData.getColor(i._specularColorProp);e!==n&&e.cloneTo(n)}},{key:"glossiness",get:function(){return this.shaderData.getFloat(i._glossinessProp)},set:function(e){this.shaderData.setFloat(i._glossinessProp,e)}},{key:"specularGlossinessTexture",get:function(){return this.shaderData.getTexture(i._specularGlossinessTextureProp)},set:function(e){this.shaderData.setTexture(i._specularGlossinessTextureProp,e),e?this.shaderData.enableMacro("HAS_SPECULARGLOSSINESSMAP"):this.shaderData.disableMacro("HAS_SPECULARGLOSSINESSMAP")}}]),i}(nr);Yn._specularColorProp=b.getPropertyByName("u_specularColor");Yn._glossinessProp=b.getPropertyByName("u_glossinessFactor");Yn._specularGlossinessTextureProp=b.getPropertyByName("u_specularGlossinessSampler");var $n=function(t){Y(i,t);function i(r){var e;e=t.call(this,r,b.find("unlit"))||this;var n=e.shaderData;return n.enableMacro("OMIT_NORMAL"),n.enableMacro("O3_NEED_TILINGOFFSET"),n.setColor(i._baseColorProp,new ge(1,1,1,1)),n.setVector4(i._tilingOffsetProp,new Ee(1,1,0,0)),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},$(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(e){var n=this.shaderData.getColor(i._baseColorProp);e!==n&&e.cloneTo(n)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(e){this.shaderData.setTexture(i._baseTextureProp,e),e?this.shaderData.enableMacro("O3_BASE_TEXTURE"):this.shaderData.disableMacro("O3_BASE_TEXTURE")}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(i._tilingOffsetProp);e!==n&&e.cloneTo(n)}}]),i}(eo);$n._baseColorProp=b.getPropertyByName("u_baseColor");$n._baseTextureProp=b.getPropertyByName("u_baseTexture");$n._tilingOffsetProp=b.getPropertyByName("u_tilingOffset");var N_=function(t){Y(a,t);var i=a.prototype;i.getSprite=function(e){var n=this._sprites[this._spriteNamesToIndex[e]];return n||console.warn("There is no sprite named "+e+" in the atlas."),n},i.getSprites=function(e,n){n.length=0;var o=this._spriteNamesToIndex[e];if(o!==void 0)for(var s=this._sprites;o>=0;o--){var l=s[o];l.name===e&&n.push(l)}else console.warn("The name of the sprite you want to find is not exit in SpriteAtlas.");return n};function a(r){var e;return e=t.call(this,r)||this,e._sprites=new Array,e._spriteNamesToIndex={},e}return i._addSprite=function(e){this._spriteNamesToIndex[e.name]=this._sprites.push(e)-1},i._onDestroy=function(){this._sprites=null,this._spriteNamesToIndex=null},$(a,[{key:"sprites",get:function(){return this._sprites}}]),a}(Di),mc=function(t){Y(i,t);function i(r,e,n,o,s,l){var u;return e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),s===void 0&&(s=128),l===void 0&&(l=null),u=t.call(this,r)||this,u.name=void 0,u._uv=[new G,new G,new G,new G],u._positions=[new G,new G,new G,new G],u._bounds=new $t,u._triangles=void 0,u._assetID=void 0,u._pixelsPerUnit=void 0,u._texture=null,u._atlasRotated=!1,u._region=new oc(0,0,1,1),u._pivot=new G(.5,.5),u._atlasRegion=new oc(0,0,1,1),u._atlasRegionOffset=new Ee(0,0,0,0),u._dirtyFlag=Fe.all,u.name=l,u._texture=e,u._pixelsPerUnit=s,n&&n.cloneTo(u._region),o&&o.cloneTo(u._pivot),u._triangles=i._rectangleTriangles,u}var a=i.prototype;return a._onDestroy=function(){this._texture&&(this._texture=null)},a._updatePositionsAndBounds=function(){var e=this._texture,n=this._bounds;if(e){var o=this._atlasRegion,s=this._pivot,l=this._atlasRegionOffset,u=this._region,c=u.x,f=u.y,d=u.width,h=u.height,_=1/this._pixelsPerUnit,m,v,p,g,y,x;if(this._atlasRotated?(y=e.height*o.height*_,x=e.width*o.width*_):(y=e.width*o.width*_,x=e.height*o.height*_),l.x==0&&l.y==0&&l.z==0&&l.w==0){var T=y*d,w=x*h;m=-s.x*T,g=-s.y*w,p=T+m,v=w+g}else{var S=l.x,M=l.y,P=l.z,E=l.w,R=y/(1-P-S),C=x/(1-E-M);m=(-s.x*d+Math.max(S,c)-c)*R,v=(s.y*h-Math.max(M,f)+f)*C,p=(-s.x*d+Math.min(1-P,c+d)-c)*R,g=(s.y*h-Math.min(1-E,f+h)+f)*C}var z=this._positions;z[0].setValue(m,v),z[1].setValue(p,v),z[2].setValue(p,g),z[3].setValue(m,g),n.min.setValue(m,g,0),n.max.setValue(p,v,0)}else n.min.setValue(0,0,0),n.max.setValue(0,0,0)},a._updateMesh=function(){if(this._isContainDirtyFlag(Fe.positions)&&this._updatePositionsAndBounds(),this._isContainDirtyFlag(Fe.uv)){var e=this._atlasRegion,n=this._uv,o=this._region,s=this._atlasRotated,l=this._atlasRegionOffset,u,c,f,d;if(l.x==0&&l.y==0&&l.z==0&&l.w==0){var h=e.width,_=e.height;s?(u=h*(1-o.y-o.height)+e.x,c=_*o.x+e.y,f=h*o.height+u,d=_*o.width+c):(u=h*o.x+e.x,c=_*o.y+e.y,f=h*o.width+u,d=_*o.height+c)}else{var m=o.x,v=o.y,p=e.x,g=e.y,y=l.x,x=l.y,T=l.z,w=l.w;if(s){var S=e.width/(1-w-x),M=e.height/(1-T-y);u=(Math.max(w,1-v-o.height)-w)*S+p,c=(Math.max(y,m)-y)*M+g,f=(Math.min(1-x,1-v)-w)*S+p,d=(Math.min(1-T,m+o.width)-y)*M+g}else{var P=e.width/(1-T-y),E=e.height/(1-w-x);u=(Math.max(y,m)-y)*P+p,c=(Math.max(x,v)-x)*E+g,f=(Math.min(1-T,m+o.width)-y)*P+p,d=(Math.min(1-w,v+o.height)-x)*E+g}}s?(n[0].setValue(f,c),n[1].setValue(f,d),n[2].setValue(u,d),n[3].setValue(u,c)):(n[0].setValue(u,c),n[1].setValue(f,c),n[2].setValue(f,d),n[3].setValue(u,d))}},a._updateMeshData=function(){return this._isContainDirtyFlag(Fe.all)?(this._updateMesh(),this._setDirtyFlagFalse(Fe.all),!0):!1},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},$(i,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._setDirtyFlagTrue(Fe.positions))}},{key:"bounds",get:function(){return this._isContainDirtyFlag(Fe.positions)&&this._texture&&(this._updatePositionsAndBounds(),this._setDirtyFlagFalse(Fe.positions)),this._bounds}},{key:"atlasRotated",get:function(){return this._atlasRotated},set:function(e){this._atlasRotated!=e&&(this._atlasRotated=e,this._setDirtyFlagTrue(Fe.positions|Fe.uv))}},{key:"atlasRegion",get:function(){return this._atlasRegion},set:function(e){var n=O.clamp(e.x,0,1),o=O.clamp(e.y,0,1);this._atlasRegion.setValue(n,o,O.clamp(e.width,0,1-n),O.clamp(e.height,0,1-o)),this._setDirtyFlagTrue(Fe.positions|Fe.uv)}},{key:"atlasRegionOffset",get:function(){return this._atlasRegionOffset},set:function(e){var n=O.clamp(e.x,0,1),o=O.clamp(e.y,0,1);this._atlasRegionOffset.setValue(n,o,O.clamp(e.z,0,1-n),O.clamp(e.w,0,1-o)),this._setDirtyFlagTrue(Fe.positions|Fe.uv)}},{key:"pivot",get:function(){return this._pivot},set:function(e){this._pivot.setValue(O.clamp(e.x,0,1),O.clamp(e.y,0,1)),this._setDirtyFlagTrue(Fe.positions)}},{key:"region",get:function(){return this._region},set:function(e){var n=this._region,o=O.clamp(e.x,0,1),s=O.clamp(e.y,0,1);n.setValue(o,s,O.clamp(e.width,0,1-o),O.clamp(e.height,0,1-s)),this._setDirtyFlagTrue(Fe.positions|Fe.uv)}},{key:"pixelsPerUnit",get:function(){return this._pixelsPerUnit},set:function(e){this._pixelsPerUnit!==e&&(this._pixelsPerUnit=e,this._setDirtyFlagTrue(Fe.positions))}}]),i}(Di);mc._rectangleTriangles=[0,2,1,2,0,3];var Fe;(function(t){t[t.positions=1]="positions",t[t.uv=2]="uv",t[t.all=3]="all"})(Fe||(Fe={}));var _t,U_,k_,V_,G_,H_,W_,j_,X_,K_,q_,Q_,Y_,$_,yc,Z_,mx=(_t=(Z_=yc=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,I(e,"_customLocalBounds",U_,L(e)),I(e,"_customRootEntity",k_,L(e)),I(e,"_positions",V_,L(e)),I(e,"_sprite",G_,L(e)),I(e,"_color",H_,L(e)),I(e,"_flipX",W_,L(e)),I(e,"_flipY",j_,L(e)),I(e,"_cacheFlipX",X_,L(e)),I(e,"_cacheFlipY",K_,L(e)),I(e,"_dirtyFlag",q_,L(e)),I(e,"_isWorldMatrixDirty",Q_,L(e)),I(e,"_maskInteraction",Y_,L(e)),I(e,"_maskLayer",$_,L(e)),e._isWorldMatrixDirty=r.transform.registerWorldChangeFlag(),e.setMaterial(e._engine._spriteDefaultMaterial),e}var a=i.prototype;return a._render=function(e){var n=this.sprite;if(!!n){var o=n.texture;if(!!o){var s=this._positions,l=this.entity.transform,u=n._updateMeshData();if(this._isWorldMatrixDirty.flag||u||this._isContainDirtyFlag(Mt.Sprite)){for(var c=n._positions,f=i._tempVec3,d=l.worldMatrix,h=this.flipX,_=this.flipY,m=0,v=s.length;m<v;m++){var p=c[m];f.setValue(h?-p.x:p.x,_?-p.y:p.y,0),A.transformToVec3(f,d,s[m])}this._setDirtyFlagFalse(Mt.Flip),this._setDirtyFlagFalse(Mt.Sprite),this._isWorldMatrixDirty.flag=!1,this._cacheFlipX=h,this._cacheFlipY=_}else if(this._isContainDirtyFlag(Mt.Flip)){var g=this.flipX,y=this.flipY,x=this._cacheFlipX!==g,T=this._cacheFlipY!==y;if(x||T)for(var w=l.worldPosition,S=w.x,M=w.y,P=0,E=s.length;P<E;P++){var R=s[P];x&&(R.x=S*2-R.x),T&&(R.y=M*2-R.y)}this._setDirtyFlagFalse(Mt.Flip),this._cacheFlipX=g,this._cacheFlipY=y}this._isContainDirtyFlag(Mt.MaskInteraction)&&(this._updateStencilState(),this._setDirtyFlagFalse(Mt.MaskInteraction)),this.shaderData.setTexture(i._textureProperty,o);var C=this.getMaterial(),z=this._engine._spriteElementPool,k=z.getFromPool();k.setValue(this,s,n._uv,n._triangles,this.color,C,e),e._renderPipeline.pushPrimitive(k)}}},a._onDestroy=function(){this._isWorldMatrixDirty.destroy(),t.prototype._onDestroy.call(this)},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},a._updateBounds=function(e){var n=this._sprite;if(n)if(this._customLocalBounds&&this._customRootEntity){var o=this._customRootEntity.transform.worldMatrix;$t.transform(this._customLocalBounds,o,e)}else{var s=n.bounds,l=this._entity.transform.worldMatrix;$t.transform(s,l,e)}else e.min.setValue(0,0,0),e.max.setValue(0,0,0)},a._updateStencilState=function(){var e=this.getInstanceMaterial(),n=e.renderState.stencilState,o=this._maskInteraction;if(o===vn.None)n.enabled=!1,n.writeMask=255,n.referenceValue=0,n.compareFunctionFront=n.compareFunctionBack=me.Always;else{n.enabled=!0,n.writeMask=0,n.referenceValue=1;var s=o===vn.VisibleInsideMask?me.LessEqual:me.Greater;n.compareFunctionFront=s,n.compareFunctionBack=s}},$(i,[{key:"sprite",get:function(){return this._sprite},set:function(e){this._sprite!==e&&(this._sprite=e,this._setDirtyFlagTrue(Mt.Sprite))}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&e.cloneTo(this._color)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._setDirtyFlagTrue(Mt.Flip))}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._setDirtyFlagTrue(Mt.Flip))}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._setDirtyFlagTrue(Mt.MaskInteraction))}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}}]),i}(fc),yc._textureProperty=b.getPropertyByName("u_spriteTexture"),yc._tempVec3=new A,Z_),U_=N(_t.prototype,"_customLocalBounds",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k_=N(_t.prototype,"_customRootEntity",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V_=N(_t.prototype,"_positions",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new A,new A,new A,new A]}}),G_=N(_t.prototype,"_sprite",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H_=N(_t.prototype,"_color",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge(1,1,1,1)}}),W_=N(_t.prototype,"_flipX",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),j_=N(_t.prototype,"_flipY",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),X_=N(_t.prototype,"_cacheFlipX",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),K_=N(_t.prototype,"_cacheFlipY",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),q_=N(_t.prototype,"_dirtyFlag",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Mt.All}}),Q_=N(_t.prototype,"_isWorldMatrixDirty",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_=N(_t.prototype,"_maskInteraction",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vn.None}}),$_=N(_t.prototype,"_maskLayer",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ls.Layer0}}),_t),Mt;(function(t){t[t.Flip=1]="Flip",t[t.Sprite=2]="Sprite",t[t.All=3]="All",t[t.MaskInteraction=4]="MaskInteraction"})(Mt||(Mt={}));var yx=function(){this.relativePath=void 0,this.type=void 0,this.property=void 0,this.curve=void 0},fe;(function(t){t[t.Position=0]="Position",t[t.Rotation=1]="Rotation",t[t.Scale=2]="Scale",t[t.BlendShapeWeights=3]="BlendShapeWeights"})(fe||(fe={}));var xx=function(){},wx=function(t){Y(i,t);function i(r){var e;return e=t.call(this)||this,e.name=r,e._curveBindings=[],e._length=0,e._events=[],e}var a=i.prototype;return a.addEvent=function(e){this._events.push(e),this._events.sort(function(n,o){return n.time-o.time})},a.clearEvents=function(){this._events.length=0},a.addCurveBinding=function(e,n,o,s){var l;switch(o){case"position":l=fe.Position;break;case"rotation":l=fe.Rotation;break;case"scale":l=fe.Scale;break;case"blendShapeWeights":l=fe.BlendShapeWeights;break}var u=new yx;u.relativePath=e,u.type=n,u.property=l,u.curve=s,s.length>this._length&&(this._length=s.length),this._curveBindings.push(u)},a.clearCurveBindings=function(){this._curveBindings.length=0,this._length=0},a._sampleAnimation=function(e,n){for(var o=this._curveBindings.length,s=o-1;s>=0;s--){var l=this._curveBindings[s],u=l.curve,c=l.property,f=l.relativePath,d=l.type,h=u.evaluate(n),_=e.findByName(f),m=_.transform;if(d===pr)switch(c){case fe.Position:m.position=h;break;case fe.Rotation:m.rotationQuaternion=h;break;case fe.Scale:m.scale=h;break}}},$(i,[{key:"events",get:function(){return this._events}},{key:"curveBindings",get:function(){return this._curveBindings}},{key:"length",get:function(){return this._length}}]),i}(xx),Hs=function(){function t(){}return t.scaleWeight=function(a,r,e){var n=a.x,o=a.y,s=a.z;e.x=n>0?Math.pow(Math.abs(n),r):-Math.pow(Math.abs(n),r),e.y=o>0?Math.pow(Math.abs(o),r):-Math.pow(Math.abs(o),r),e.z=s>0?Math.pow(Math.abs(s),r):-Math.pow(Math.abs(s),r)},t.scaleBlend=function(a,r,e,n){var o=t._tempVector30,s=t._tempVector31;t.scaleWeight(a,1-e,o),t.scaleWeight(r,e,s);var l=e>.5?r:a;n.x=l.x>0?Math.abs(o.x*s.x):-Math.abs(o.x*s.x),n.y=l.y>0?Math.abs(o.y*s.y):-Math.abs(o.y*s.y),n.z=l.z>0?Math.abs(o.z*s.z):-Math.abs(o.z*s.z)},t.quaternionWeight=function(a,r,e){e.x=a.x*r,e.y=a.y*r,e.z=a.z*r,e.w=a.w},t}();Hs._tempVector30=new A;Hs._tempVector31=new A;var Ws;(function(t){t[t.Override=0]="Override",t[t.Additive=1]="Additive"})(Ws||(Ws={}));var We;(function(t){t[t.Standby=0]="Standby",t[t.Playing=1]="Playing",t[t.CrossFading=2]="CrossFading",t[t.FixedCrossFading=3]="FixedCrossFading"})(We||(We={}));var Sx=function(){function t(a,r,e){switch(this.crossCurveMark=0,this.crossCurveIndex=void 0,this.target=void 0,this.type=void 0,this.property=void 0,this.component=void 0,this.defaultValue=void 0,this.fixedPoseValue=void 0,this.target=a,this.type=r,this.property=e,e){case fe.Position:this.defaultValue=new A,this.fixedPoseValue=new A,this.component=a.transform;break;case fe.Rotation:this.defaultValue=new pe,this.fixedPoseValue=new pe,this.component=a.transform;break;case fe.Scale:this.defaultValue=new A,this.fixedPoseValue=new A,this.component=a.transform;break;case fe.BlendShapeWeights:this.defaultValue=new Float32Array(4),this.fixedPoseValue=new Float32Array(4),this.component=a.getComponent(Ns);break}}var i=t.prototype;return i.saveDefaultValue=function(){switch(this.property){case fe.Position:this.target.transform.position.cloneTo(this.defaultValue);break;case fe.Rotation:this.target.transform.rotationQuaternion.cloneTo(this.defaultValue);break;case fe.Scale:this.target.transform.scale.cloneTo(this.defaultValue);break}},i.saveFixedPoseValue=function(){switch(this.property){case fe.Position:this.target.transform.position.cloneTo(this.fixedPoseValue);break;case fe.Rotation:this.target.transform.rotationQuaternion.cloneTo(this.fixedPoseValue);break;case fe.Scale:this.target.transform.scale.cloneTo(this.fixedPoseValue);break}},t}(),Px=function(){this.event=void 0,this.handlers=[]},J_=function(){this.duration=0,this.offset=0,this.exitTime=1,this.destinationState=void 0},js;(function(t){t[t.Once=0]="Once",t[t.Loop=1]="Loop"})(js||(js={}));var ep=function(){function t(){this.state=void 0,this.stateData=void 0,this.frameTime=void 0,this.finished=void 0,this.clipTime=void 0,this.currentEventIndex=void 0}var i=t.prototype;return i.reset=function(r,e,n){this.state=r,this.frameTime=n,this.stateData=e,this.finished=!1,this.clipTime=this.state.clipStartTime,this.currentEventIndex=0},i.update=function(){var r=this.state,e=this.frameTime,n=r.clipEndTime-r.clipStartTime;e>n&&(r.wrapMode===js.Loop?e=e%n:(e=n,this.finished=!0)),this.clipTime=e+this.state.clipStartTime},t}(),Ax=function(){function t(){this.animatorStateDataMap={},this.srcPlayData=new ep,this.destPlayData=new ep,this.layerState=We.Standby,this.crossCurveMark=0,this.manuallyTransition=new J_,this.crossFadeTransition=void 0}var i=t.prototype;return i.switchPlayData=function(){var r=this.destPlayData,e=this.srcPlayData;this.srcPlayData=r,this.destPlayData=e},t}(),Tx=function(){this.curveOwners=[],this.eventHandlers=[]},Mx=function(){this.layerIndex=void 0,this.state=void 0},Ex=function(){this.curveOwner=void 0,this.srcCurveIndex=void 0,this.destCurveIndex=void 0},Ur,tp,rp,np,ip,ap,op,sp,Xs,lp,xc=(Ur=(lp=Xs=function(t){Y(i,t);function i(r){var e;return e=t.call(this,r)||this,e._animatorController=void 0,I(e,"_speed",tp,L(e)),I(e,"_controllerUpdateFlag",rp,L(e)),I(e,"_animatorLayersData",np,L(e)),I(e,"_crossCurveDataCollection",ip,L(e)),I(e,"_animationCurveOwners",ap,L(e)),I(e,"_crossCurveDataPool",op,L(e)),I(e,"_animationEventHandlerPool",sp,L(e)),e}var a=i.prototype;return a.play=function(e,n,o){var s;n===void 0&&(n=-1),o===void 0&&(o=0),(s=this._controllerUpdateFlag)!==null&&s!==void 0&&s.flag&&this._clearPlayData();var l=this._getAnimatorStateInfo(e,n,i._animatorInfo),u=l.state;if(!!u){if(!u.clip){console.warn("The state named "+e+" has no AnimationClip data.");return}var c=this._getAnimatorLayerData(l.layerIndex),f=c.srcPlayData,d=f.state;d&&d!==u&&this._revertDefaultValue(f);var h=this._getAnimatorStateData(e,u,c);c.layerState=We.Playing,f.reset(u,h,u._getDuration()*o),this._saveDefaultValues(h)}},a.crossFade=function(e,n,o,s){var l;o===void 0&&(o=-1),s===void 0&&(s=0),(l=this._controllerUpdateFlag)!==null&&l!==void 0&&l.flag&&this._clearPlayData();var u=this._getAnimatorStateInfo(e,o,i._animatorInfo),c=u.state,f=this._getAnimatorLayerData(o),d=f.manuallyTransition;d.duration=n,d.offset=s,d.destinationState=c,this._crossFadeByTransition(d,o)},a.update=function(e){var n;if(this.speed!==0){var o=this._animatorController;if(!!o&&!((n=this._controllerUpdateFlag)!==null&&n!==void 0&&n.flag)){e*=this.speed;for(var s=0,l=o.layers.length;s<l;s++){var u=this._getAnimatorLayerData(s);u.layerState!==We.Standby&&this._updateLayer(s,s===0,e/1e3)}}}},a._onEnable=function(){this.engine._componentsManager.addOnUpdateAnimations(this)},a._onDisable=function(){this.engine._componentsManager.removeOnUpdateAnimations(this)},a._getAnimatorStateInfo=function(e,n,o){var s=null,l=this._animatorController;if(l){var u=l.layers;if(n===-1){for(var c=0,f=u.length;c<f;c++)if(s=u[c].stateMachine.findStateByName(e),s){n=c;break}}else s=u[n].stateMachine.findStateByName(e)}return o.layerIndex=n,o.state=s,o},a._saveDefaultValues=function(e){for(var n=e.curveOwners,o=n.length-1;o>=0;o--)n[o].saveDefaultValue()},a._getAnimatorStateData=function(e,n,o){var s=o.animatorStateDataMap,l=s[e];return l||(l=new Tx,s[e]=l,this._saveAnimatorStateData(n,l),this._saveAnimatorEventHandlers(n,l)),l},a._saveAnimatorStateData=function(e,n){for(var o=this.entity,s=this._animationCurveOwners,l=n.curveOwners,u=e.clip._curveBindings,c=u.length-1;c>=0;c--){var f=u[c],d=f.relativePath===""?o:o.findByPath(f.relativePath),h=f.property,_=d.instanceId,m=s[_]||(s[_]=[]);l[c]=m[h]||(m[h]=new Sx(d,f.type,h))}},a._saveAnimatorEventHandlers=function(e,n){var o=this._animationEventHandlerPool,s=this._entity._scripts,l=s.length,u=n.eventHandlers,c=e.clip.events;o.resetPool(),u.length=0;for(var f=0,d=c.length;f<d;f++){var h=c[f],_=o.getFromPool(),m=h.functionName,v=_.handlers;_.event=h,v.length=0;for(var p=l-1;p>=0;p--){var g=s.get(p)[m];g&&v.push(g)}u.push(_)}},a._clearCrossData=function(e){e.crossCurveMark++,this._crossCurveDataCollection.length=0,this._crossCurveDataPool.resetPool()},a._addCrossCurveData=function(e,n,o,s){var l=this._crossCurveDataPool.getFromPool();l.curveOwner=n,l.srcCurveIndex=o,l.destCurveIndex=s,e.push(l)},a._prepareCrossFading=function(e){var n=this._crossCurveDataCollection,o=e.crossCurveMark;this._prepareSrcCrossData(n,e.srcPlayData,o,!1),this._prepareDestCrossData(n,e.destPlayData,o,!1)},a._prepareStandbyCrossFading=function(e){var n=this._crossCurveDataCollection,o=e.srcPlayData,s=e.crossCurveMark;o&&this._prepareSrcCrossData(n,o,s,!0),this._prepareDestCrossData(n,e.destPlayData,s,!0)},a._prepareFixedPoseCrossFading=function(e){for(var n=this._crossCurveDataCollection,o=n.length-1;o>=0;o--){var s=n[o];s.curveOwner.saveFixedPoseValue(),s.destCurveIndex=-1}this._prepareDestCrossData(n,e.destPlayData,e.crossCurveMark,!0)},a._prepareSrcCrossData=function(e,n,o,s){for(var l=n.stateData.curveOwners,u=l.length-1;u>=0;u--){var c=l[u];c.crossCurveMark=o,c.crossCurveIndex=e.length,s&&c.saveFixedPoseValue(),this._addCrossCurveData(e,c,u,-1)}},a._prepareDestCrossData=function(e,n,o,s){for(var l=n.stateData.curveOwners,u=l.length-1;u>=0;u--){var c=l[u];c.crossCurveMark===o?e[c.crossCurveIndex].destCurveIndex=u:(s&&c.saveFixedPoseValue(),c.crossCurveMark=o,c.crossCurveIndex=e.length,this._addCrossCurveData(e,c,-1,u))}},a._evaluateCurve=function(e,n,o,s){var l=n.evaluate(o);if(s){var u=n.keys[0].value;switch(e){case fe.Position:var c=i._tempVector3;return A.subtract(l,u,c),c;case fe.Rotation:var f=i._tempQuaternion;return pe.conjugate(u,f),pe.multiply(f,l,f),f;case fe.Scale:var d=i._tempVector3;return A.divide(l,u,d),d}}return l},a._getAnimatorLayerData=function(e){var n=this._animatorLayersData[e];return n||(this._animatorLayersData[e]=n=new Ax),n},a._updateLayer=function(e,n,o){var s=this._animatorController.layers[e],l=s.blendingMode,u=s.weight,c=this._animatorLayersData[e],f=c.srcPlayData,d=c.destPlayData,h=c.crossFadeTransition,_=l===Ws.Additive,m=n?1:u;switch(this._checkTransition(f,h,e),c.layerState){case We.Playing:this._updatePlayingState(f,c,m,o,_);break;case We.FixedCrossFading:this._updateCrossFadeFromPose(d,c,m,o,_);break;case We.CrossFading:this._updateCrossFade(f,d,c,m,o,_);break}},a._updatePlayingState=function(e,n,o,s,l){var u=e.stateData,c=u.curveOwners,f=u.eventHandlers,d=e.state,h=d.clip._curveBindings,_=e.clipTime;e.update();var m=e.clipTime;f.length&&this._fireAnimationEvents(e,f,_,m);for(var v=h.length-1;v>=0;v--){var p=c[v],g=this._evaluateCurve(p.property,h[v].curve,m,l);l?this._applyClipValueAdditive(p,g,o):this._applyClipValue(p,g,o)}e.frameTime+=d.speed*s,e.finished&&(n.layerState=We.Standby)},a._updateCrossFade=function(e,n,o,s,l,u){var c=this._crossCurveDataCollection,f=e.state.clip._curveBindings,d=n.state,h=d.clip._curveBindings,_=n.frameTime/(d._getDuration()*o.crossFadeTransition.duration);_>=1&&(_=1),e.update(),n.update();for(var m=e.clipTime,v=n.clipTime,p=c.length-1;p>=0;p--){var g=c[p],y=g.curveOwner,x=g.srcCurveIndex,T=g.destCurveIndex,w=y.property,S=y.defaultValue,M=x>=0?this._evaluateCurve(w,f[x].curve,m,u):S,P=T>=0?this._evaluateCurve(w,h[T].curve,v,u):S;this._applyCrossClipValue(y,M,P,_,s,u)}this._updateCrossFadeData(o,_,l,!1)},a._updateCrossFadeFromPose=function(e,n,o,s,l){var u=this._crossCurveDataCollection,c=e.state,f=c.clip._curveBindings,d=e.frameTime/(c._getDuration()*n.crossFadeTransition.duration);d>=1&&(d=1),e.update();for(var h=e.clipTime,_=u.length-1;_>=0;_--){var m=u[_],v=m.curveOwner,p=m.destCurveIndex,g=p>=0?this._evaluateCurve(v.property,f[p].curve,h,l):v.defaultValue;this._applyCrossClipValue(v,v.fixedPoseValue,g,d,o,l)}this._updateCrossFadeData(n,d,s,!0)},a._updateCrossFadeData=function(e,n,o,s){var l=e.destPlayData;l.frameTime+=l.state.speed*o,n===1?(l.finished?e.layerState=We.Standby:e.layerState=We.Playing,e.switchPlayData()):s||(e.srcPlayData.frameTime+=e.srcPlayData.state.speed*o)},a._applyCrossClipValue=function(e,n,o,s,l,u){var c;if(e.type===pr){var f=e.target.transform;switch(e.property){case fe.Position:A.lerp(n,o,s,i._tempVector3),c=i._tempVector3;break;case fe.Rotation:pe.slerp(n,o,s,i._tempQuaternion),c=i._tempQuaternion;break;case fe.Scale:{var d=f.scale;A.lerp(n,o,s,i._tempVector3),f.scale=d,c=i._tempVector3;break}}}u?this._applyClipValueAdditive(e,c,l):this._applyClipValue(e,c,l)},a._applyClipValue=function(e,n,o){if(e.type===pr){var s=e.target.transform;switch(e.property){case fe.Position:if(o===1)s.position=n;else{var l=s.position;A.lerp(l,n,o,l),s.position=l}break;case fe.Rotation:if(o===1)s.rotationQuaternion=n;else{var u=s.rotationQuaternion;pe.slerp(u,n,o,u),s.rotationQuaternion=u}break;case fe.Scale:if(o===1)s.scale=n;else{var c=s.scale;A.lerp(c,n,o,c),s.scale=c}break}}else if(e.type===Ns)switch(e.property){case fe.BlendShapeWeights:e.component.blendShapeWeights=n;break}},a._applyClipValueAdditive=function(e,n,o){if(e.type===pr){var s=e.target.transform;switch(e.property){case fe.Position:var l=s.position;l.x+=n.x*o,l.y+=n.y*o,l.z+=n.z*o,s.position=l;break;case fe.Rotation:var u=s.rotationQuaternion;Hs.quaternionWeight(n,o,n),n.normalize(),u.multiply(n),s.rotationQuaternion=u;break;case fe.Scale:var c=s.scale;Hs.scaleWeight(c,o,c),A.multiply(c,n,c),s.scale=c;break}}},a._revertDefaultValue=function(e){var n=e.state.clip;if(n)for(var o=n._curveBindings,s=e.stateData.curveOwners,l=o.length-1;l>=0;l--){var u=s[l],c=u.target.transform;switch(u.property){case fe.Position:c.position=u.defaultValue;break;case fe.Rotation:c.rotationQuaternion=u.defaultValue;break;case fe.Scale:c.scale=u.defaultValue;break}}},a._checkTransition=function(e,n,o){for(var s=e.state,l=e.clipTime,u=s._getDuration(),c=s.transitions,f=0,d=c.length;f<d;++f){var h=c[f];u*h.exitTime<=l&&n!==h&&this._crossFadeByTransition(h,o)}},a._crossFadeByTransition=function(e,n){var o=e.destinationState.name,s=this._getAnimatorStateInfo(o,n,i._animatorInfo),l=s.state;if(!!l){if(!l.clip){console.warn("The state named "+o+" has no AnimationClip data.");return}var u=this._getAnimatorLayerData(s.layerIndex),c=u.layerState,f=u.destPlayData,d=this._getAnimatorStateData(o,l,u),h=l._getDuration(),_=h*e.offset;switch(f.reset(l,d,_),this._saveDefaultValues(d),c){case We.Standby:u.layerState=We.FixedCrossFading,this._clearCrossData(u),this._prepareStandbyCrossFading(u);break;case We.Playing:u.layerState=We.CrossFading,this._clearCrossData(u),this._prepareCrossFading(u);break;case We.CrossFading:u.layerState=We.FixedCrossFading,this._prepareFixedPoseCrossFading(u);break;case We.FixedCrossFading:this._prepareFixedPoseCrossFading(u);break}u.crossFadeTransition=e}},a._fireAnimationEvents=function(e,n,o,s){s<o?(this._fireSubAnimationEvents(e,n,o,e.state.clipEndTime),e.currentEventIndex=0,this._fireSubAnimationEvents(e,n,e.state.clipStartTime,s)):this._fireSubAnimationEvents(e,n,o,s)},a._fireSubAnimationEvents=function(e,n,o,s){for(var l=e.currentEventIndex,u=n.length;l<u;l++){var c=n[l],f=c.event,d=f.time,h=f.parameter;if(d>s)break;var _=c.handlers;if(d>=o){for(var m=_.length-1;m>=0;m--)_[m](h);e.currentEventIndex=l+1}}},a._clearPlayData=function(){this._animatorLayersData.length=0,this._crossCurveDataCollection.length=0,this._animationCurveOwners.length=0,this._controllerUpdateFlag.flag=!1},$(i,[{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e}},{key:"animatorController",get:function(){return this._animatorController},set:function(e){e!==this._animatorController&&(this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e)}}]),i}(Jt),Xs._tempVector3=new A,Xs._tempQuaternion=new pe,Xs._animatorInfo=new Mx,lp),tp=N(Ur.prototype,"_speed",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rp=N(Ur.prototype,"_controllerUpdateFlag",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),np=N(Ur.prototype,"_animatorLayersData",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ip=N(Ur.prototype,"_crossCurveDataCollection",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ap=N(Ur.prototype,"_animationCurveOwners",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),op=N(Ur.prototype,"_crossCurveDataPool",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(Ex)}}),sp=N(Ur.prototype,"_animationEventHandlerPool",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(Px)}}),Ur),up=function(){function t(){this._updateFlagManager=new zs,this._layers=[],this._layersMap={}}var i=t.prototype;return i.findLayerByName=function(r){return this._layersMap[r]},i.addLayer=function(r){this._layers.push(r),this._layersMap[r.name]=r,this._distributeUpdateFlag()},i.removeLayer=function(r){var e=this.layers[r];this._layers.splice(r,1),delete this._layersMap[e.name],this._distributeUpdateFlag()},i.clearLayers=function(){this._layers.length=0;for(var r in this._layersMap)delete this._layersMap[r];this._distributeUpdateFlag()},i._registerChangeFlag=function(){return this._updateFlagManager.register()},i._distributeUpdateFlag=function(){this._updateFlagManager.distribute()},$(t,[{key:"layers",get:function(){return this._layers}}]),t}(),wc=function(i){this.name=i,this.weight=1,this.blendingMode=Ws.Override,this.stateMachine=void 0},bx=function(){function t(a){this.name=a,this.speed=1,this.wrapMode=js.Loop,this._clipStartTime=0,this._clipEndTime=1/0,this._clip=void 0,this._transitions=[]}var i=t.prototype;return i.addTransition=function(r){this._transitions.push(r)},i.removeTransition=function(r){var e=this._transitions.indexOf(r);e!==-1&&this._transitions.splice(e,1)},i.clearTransitions=function(){this._transitions.length=0},i._getDuration=function(){return this._clipEndTime-this._clipStartTime},$(t,[{key:"transitions",get:function(){return this._transitions}},{key:"clip",get:function(){return this._clip},set:function(r){this._clip=r,this._clipEndTime=Math.min(this._clipEndTime,r.length)}},{key:"clipStartTime",get:function(){return this._clipStartTime},set:function(r){this._clipStartTime=r<0?0:r}},{key:"clipEndTime",get:function(){return this._clipEndTime},set:function(r){var e=this._clip;e&&(this._clipEndTime=Math.min(r,e.length))}}]),t}(),Sc=function(){function t(){this.states=[],this._statesMap={}}var i=t.prototype;return i.addState=function(r){var e=this.findStateByName(r);return e?console.warn("The state named "+r+" has existed."):(e=new bx(r),this.states.push(e),this._statesMap[r]=e),e},i.removeState=function(r){var e=r.name,n=this.states.indexOf(r);n>-1&&this.states.splice(n,1),delete this._statesMap[e]},i.findStateByName=function(r){return this._statesMap[r]},i.makeUniqueStateName=function(r){for(var e=this._statesMap,n=r,o=0;e[r];)r=n+" "+o,o++;return r},t}(),Rt;(function(t){t[t.Float=0]="Float",t[t.FloatArray=1]="FloatArray",t[t.Vector2=2]="Vector2",t[t.Vector3=3]="Vector3",t[t.Vector4=4]="Vector4",t[t.Quaternion=5]="Quaternion"})(Rt||(Rt={}));var kr;(function(t){t[t.Linear=0]="Linear",t[t.CubicSpine=1]="CubicSpine",t[t.Step=2]="Step",t[t.Hermite=3]="Hermite"})(kr||(kr={}));var Cx=function(){function t(){this.keys=[],this.interpolation=void 0,this._valueSize=void 0,this._valueType=void 0,this._currentValue=void 0,this._length=0,this._currentIndex=0}var i=t.prototype;return i.addKey=function(r){var e=r.time;if(this.keys.push(r),e>this._length&&(this._length=e),!this._valueSize&&(typeof r.value=="number"&&(this._valueSize=1,this._valueType=Rt.Float,this._currentValue=0),r.value instanceof G&&(this._valueSize=2,this._valueType=Rt.Vector2,this._currentValue=new G),r.value instanceof A&&(this._valueSize=3,this._valueType=Rt.Vector3,this._currentValue=new A),r.value instanceof Ee&&(this._valueSize=4,this._valueType=Rt.Vector4,this._currentValue=new Ee),r.value instanceof pe&&(this._valueSize=4,this._valueType=Rt.Quaternion,this._currentValue=new pe),r.value instanceof Float32Array)){var n=r.value.length;this._valueSize=n,this._valueType=Rt.FloatArray,this._currentValue=new Float32Array(n)}this.keys.sort(function(o,s){return o.time-s.time})},i.evaluate=function(r){var e=this.keys,n=this.interpolation,o=this.keys.length,s=this._currentIndex;s!==-1&&r<e[s].time&&(s=-1);for(var l=s+1;l<o&&!(r<e[l].time);)s++,l++;this._currentIndex=s;var u;if(s===-1)u=e[0].value;else if(l===o)u=e[s].value;else{var c=e[s].time,f=e[l].time-c,d=(r-c)/f,h=f;switch(n){case kr.Linear:u=this._evaluateLinear(s,l,d);break;case kr.Step:u=this._evaluateStep(l);break;case kr.CubicSpine:case kr.Hermite:u=this._evaluateHermite(s,l,d,h)}}return u},i.moveKey=function(r,e){this.keys[r]=e},i.removeKey=function(r){this.keys.splice(r,1);for(var e=this.keys,n=this.keys.length,o=0,s=n-1;s>=0;s--)e[s].time>length&&(o=e[s].time);this._length=o},i._evaluateLinear=function(r,e,n){var o=this._valueType,s=this.keys;switch(o){case Rt.Float:return s[r].value*(1-n)+s[e].value*n;case Rt.FloatArray:for(var l=this._currentValue,u=s[r].value,c=s[e].value,f=0,d=u.length;f<d;f++)l[f]=u[f]*(1-n)+c[f]*n;return l;case Rt.Vector2:return G.lerp(s[r].value,s[e].value,n,this._currentValue),this._currentValue;case Rt.Vector3:return A.lerp(s[r].value,s[e].value,n,this._currentValue),this._currentValue;case Rt.Quaternion:return pe.slerp(s[r].value,s[e].value,n,this._currentValue),this._currentValue}},i._evaluateStep=function(r){var e=this._valueSize,n=this.keys;return n[r].value},i._evaluateHermite=function(r,e,n,o){var s=this._valueSize,l=this.keys,u=l[r],c=l[e];switch(s){case 1:{var f=u.outTangent,d=c.inTangent,h=u.value,_=c.value;if(Number.isFinite(f)&&Number.isFinite(d)){var m=n*n,v=m*n,p=2*v-3*m+1,g=v-2*m+n,y=v-m,x=-2*v+3*m;return p*h+g*f*o+y*d*o+x*_}else return u.value}case 2:{var T=u.value,w=u.outTangent,S=c.value,M=c.inTangent,P=n*n,E=P*n,R=2*E-3*P+1,C=E-2*P+n,z=E-P,k=-2*E+3*P,D=w.x,H=M.x;return Number.isFinite(D)&&Number.isFinite(H)?this._currentValue.x=R*T.x+C*D*o+z*H*o+k*S.x:this._currentValue.x=T.x,D=w.y,H=M.y,Number.isFinite(D)&&Number.isFinite(H)?this._currentValue.y=R*T.y+C*D*o+z*H*o+k*S.y:this._currentValue.y=T.y,this._currentValue}case 3:{var W=u.value,K=u.outTangent,F=c.value,te=c.inTangent,B=n*n,V=B*n,j=2*V-3*B+1,re=V-2*B+n,se=V-B,_e=-2*V+3*B,de=K.x,Ae=te.x;return Number.isFinite(de)&&Number.isFinite(Ae)?this._currentValue.x=j*W.x+re*de*o+se*Ae*o+_e*F.x:this._currentValue.x=W.x,de=K.y,Ae=te.y,Number.isFinite(de)&&Number.isFinite(Ae)?this._currentValue.y=j*W.y+re*de*o+se*Ae*o+_e*F.y:this._currentValue.y=W.y,de=K.z,Ae=te.z,Number.isFinite(de)&&Number.isFinite(Ae)?this._currentValue.z=j*W.z+re*de*o+se*Ae*o+_e*F.z:this._currentValue.z=W.z,this._currentValue}case 4:{var Te=u.value,Ke=u.outTangent,Et=c.value,et=c.inTangent,ut=n*n,qe=ut*n,pt=2*qe-3*ut+1,ct=qe-2*ut+n,gt=qe-ut,tt=-2*qe+3*ut,Be=Ke.x,Me=et.x;return Number.isFinite(Be)&&Number.isFinite(Me)?this._currentValue.x=pt*Te.x+ct*Be*o+gt*Me*o+tt*Et.x:this._currentValue.x=Te.x,Be=Ke.y,Me=et.y,Number.isFinite(Be)&&Number.isFinite(Me)?this._currentValue.y=pt*Te.y+ct*Be*o+gt*Me*o+tt*Et.y:this._currentValue.y=Te.y,Be=Ke.z,Me=et.z,Number.isFinite(Be)&&Number.isFinite(Me)?this._currentValue.z=pt*Te.z+ct*Be*o+gt*Me*o+tt*Et.z:this._currentValue.z=Te.z,Be=Ke.w,Me=et.w,Number.isFinite(Be)&&Number.isFinite(Me)?this._currentValue.w=pt*Te.w+ct*Be*o+gt*Me*o+tt*Et.w:this._currentValue.w=Te.w,this._currentValue}}},$(t,[{key:"length",get:function(){return this._length}}]),t}(),Rx=function(){this.time=void 0,this.value=void 0},to=function(t){Y(i,t);function i(){for(var a,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return a=t.call.apply(t,[this].concat(e))||this,a.inTangent=void 0,a.outTangent=void 0,a}return i}(Rx),cp;(function(t){t[t.If=0]="If",t[t.IfNot=1]="IfNot",t[t.Greater=2]="Greater",t[t.Less=3]="Less",t[t.Equals=4]="Equals",t[t.NotEquals=5]="NotEquals"})(cp||(cp={}));var zx=function(t){Y(i,t);function i(a){var r;return r=t.call(this,a,b.find("skybox"))||this,r.renderState.rasterState.cullMode=Wt.Off,r.renderState.depthState.compareFunction=me.LessEqual,r}return $(i,[{key:"textureCubeMap",get:function(){return this.shaderData.getTexture("u_cube")},set:function(r){this.shaderData.setTexture("u_cube",r)}}]),i}(hn),ue;(function(t){t[t.Position=1]="Position",t[t.Velocity=2]="Velocity",t[t.Acceleration=4]="Acceleration",t[t.Color=8]="Color",t[t.Alpha=16]="Alpha",t[t.Size=32]="Size",t[t.StartAngle=64]="StartAngle",t[t.StartTime=128]="StartTime",t[t.LifeTime=256]="LifeTime",t[t.RotateVelocity=512]="RotateVelocity",t[t.Scale=1024]="Scale",t[t.Everything=4294967295]="Everything"})(ue||(ue={}));var ro;(function(t){t[t.Transparent=0]="Transparent",t[t.Additive=1]="Additive"})(ro||(ro={}));var fp=function(t){Y(i,t),i._getRandom=function(){return Math.random()-.5};function i(r){var e;return e=t.call(this,r)||this,e._vertexStride=void 0,e._vertices=void 0,e._vertexBuffer=void 0,e._maxCount=1e3,e._position=new A,e._positionRandomness=new A,e._positionArray=void 0,e._velocity=new A,e._velocityRandomness=new A,e._acceleration=new A,e._accelerationRandomness=new A,e._color=new ge(1,1,1,1),e._colorRandomness=0,e._size=1,e._sizeRandomness=0,e._alpha=1,e._alphaRandomness=0,e._startAngle=0,e._startAngleRandomness=0,e._rotateVelocity=0,e._rotateVelocityRandomness=0,e._lifetime=5,e._startTimeRandomness=0,e._scale=1,e._isOnce=!1,e._onceTime=0,e._time=0,e._isInit=!1,e._isStart=!1,e._updateDirtyFlag=ue.Everything,e._isRotateToVelocity=!1,e._isUseOriginColor=!1,e._isScaleByLifetime=!1,e._is2d=!0,e._isFadeIn=!1,e._isFadeOut=!1,e._playOnEnable=!0,e._blendMode=ro.Transparent,e.spriteSheet=void 0,e.setMaterial(e._createMaterial()),e}var a=i.prototype;return a.update=function(e){if(!(!this._isInit||!this._isStart)){if(this._isOnce&&this._time>this._onceTime)return this.stop();this._updateDirtyFlag&&(this._updateBuffer(),this._updateDirtyFlag=0),this._time+=e/1e3,this.shaderData.setFloat("u_time",this._time)}},a._onEnable=function(){t.prototype._onEnable.call(this),this._playOnEnable&&this.start()},a.start=function(){this._isStart=!0,this._time=0},a.stop=function(){this._isStart=!1},a._createMaterial=function(){var e=new hn(this.engine,b.find("particle-shader")),n=e.renderState,o=n.blendState.targetBlendState;return o.enabled=!0,o.sourceColorBlendFactor=oe.SourceAlpha,o.destinationColorBlendFactor=oe.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=oe.One,o.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha,n.depthState.writeEnabled=!1,e.renderQueueType=Ze.Transparent,this.isUseOriginColor=!0,this.is2d=!0,this.isFadeOut=!0,e},a._createMesh=function(){var e=new c_(this._entity.engine,"particleMesh"),n=96,o=this._maxCount*4,s=o*n,l=new Float32Array(s),u=null,c=!1;if(o>i._uint16VertexLimit)if(this.engine._hardwareRenderer.canIUse(X.elementIndexUint))c=!0,u=new Uint32Array(6*this._maxCount);else throw Error("The vertex count is over limit.");else u=new Uint16Array(6*this._maxCount);for(var f=0,d=0;f<this._maxCount;++f){var h=f*4;u[d++]=h,u[d++]=h+1,u[d++]=h+2,u[d++]=h,u[d++]=h+2,u[d++]=h+3}var _=[new ve("a_position",0,Q.Vector3,0),new ve("a_velocity",12,Q.Vector3,0),new ve("a_acceleration",24,Q.Vector3,0),new ve("a_color",36,Q.Vector4,0),new ve("a_lifeAndSize",52,Q.Vector4,0),new ve("a_rotation",68,Q.Vector2,0),new ve("a_uv",76,Q.Vector3,0),new ve("a_normalizedUv",88,Q.Vector2,0)],m=new Ni(this.engine,Or.VertexBuffer,s*4,jt.Dynamic),v=new Ni(this.engine,Or.IndexBuffer,u,jt.Dynamic);return e.setVertexBufferBinding(m,n),e.setIndexBufferBinding(v,c?Je.UInt32:Je.UInt16),e.setVertexElements(_),e.addSubMesh(0,u.length),this._vertexBuffer=m,this._vertexStride=n/4,this._vertices=l,e},a._updateBuffer=function(){for(var e=0;e<this._maxCount;e++)this._updateSingleBuffer(e);this._vertexBuffer.setData(this._vertices)},a._updateSingleBuffer=function(e){var n=this._updateDirtyFlag,o=this._vertices,s=this._vertexStride,l=i._getRandom,u=e*4,c=u*s,f=(u+1)*s,d=(u+2)*s,h=(u+3)*s;if(n&ue.Position){var _=this._position,m=_.x,v=_.y,p=_.z,g=this._positionArray,y=this._positionRandomness;if(g){if(g.length!==this._maxCount)throw Error("The length of positionArray must be equal to maxCount.");var x=g[e];m+=x.x,v+=x.y,p+=x.z}else m+=l()*y.x,v+=l()*y.y,p+=l()*y.z;o[c]=o[f]=o[d]=o[h]=m,o[c+1]=o[f+1]=o[d+1]=o[h+1]=v,o[c+2]=o[f+2]=o[d+2]=o[h+2]=p}if(n&ue.Velocity){var T=this._velocity,w=this._velocityRandomness;o[c+3]=o[f+3]=o[d+3]=o[h+3]=T.x+l()*w.x,o[c+4]=o[f+4]=o[d+4]=o[h+4]=T.y+l()*w.y,o[c+5]=o[f+5]=o[d+5]=o[h+5]=T.z+l()*w.z}if(n&ue.Acceleration){var S=this._acceleration,M=this._accelerationRandomness;o[c+6]=o[f+6]=o[d+6]=o[h+6]=S.x+l()*M.x,o[c+7]=o[f+7]=o[d+7]=o[h+7]=S.y+l()*M.y,o[c+8]=o[f+8]=o[d+8]=o[h+8]=S.z+l()*M.z}if(n&ue.Color){var P=this._color,E=this._colorRandomness;o[c+9]=o[f+9]=o[d+9]=o[h+9]=O.clamp(P.r+l()*E,0,1),o[c+10]=o[f+10]=o[d+10]=o[h+10]=O.clamp(P.g+l()*E,0,1),o[c+11]=o[f+11]=o[d+11]=o[h+11]=O.clamp(P.b+l()*E,0,1)}if(n&ue.Alpha&&(o[c+12]=o[f+12]=o[d+12]=o[h+12]=O.clamp(this._alpha+l()*this._alphaRandomness,0,1)),n&ue.StartTime&&(o[c+13]=o[f+13]=o[d+13]=o[h+13]=Math.random()*this._startTimeRandomness),n&ue.LifeTime){var R=this._lifetime;o[c+14]=o[f+14]=o[d+14]=o[h+14]=R+l()*R}if((n&ue.StartTime||n&ue.LifeTime)&&(this._onceTime=Math.max(this._onceTime,o[c+13]+o[c+14])),n&ue.Size){var C=this._size;o[c+15]=o[f+15]=o[d+15]=o[h+15]=Math.max(C+l()*this._sizeRandomness*C*2,0)}n&ue.Scale&&(o[c+16]=o[f+16]=o[d+16]=o[h+16]=this._scale),n&ue.StartAngle&&(o[c+17]=o[f+17]=o[d+17]=o[h+17]=this._startAngle+l()*Math.PI*this._startAngleRandomness*2),n&ue.RotateVelocity&&(o[c+18]=o[f+18]=o[d+18]=o[h+18]=this._rotateVelocity+l()*this._rotateVelocityRandomness),this._updateSingleUv(e,c,f,d,h)},a._updateSingleUv=function(e,n,o,s,l){var u=this.spriteSheet,c=this.getMaterial().shaderData.getTexture("u_texture"),f=this._vertices;if(c){var d=c.width,h=c.height;if(u){var _=u[e%u.length],m=_.x,v=_.y,p=_.w,g=_.h,y=m/d,x=v/h,T=y+p/d,w=x+g/h,S=g/p;f[n+19]=y,f[n+20]=w,f[n+21]=S,f[o+19]=T,f[o+20]=w,f[o+21]=S,f[s+19]=T,f[s+20]=x,f[s+21]=S,f[l+19]=y,f[l+20]=x,f[l+21]=S}else{var M=h/d;f[n+19]=0,f[n+20]=1,f[n+21]=M,f[o+19]=1,f[o+20]=1,f[o+21]=M,f[s+19]=1,f[s+20]=0,f[s+21]=M,f[l+19]=0,f[l+20]=0,f[l+21]=M}}else f[n+19]=0,f[n+20]=0,f[n+21]=1,f[o+19]=1,f[o+20]=0,f[o+21]=1,f[s+19]=1,f[s+20]=1,f[s+21]=1,f[l+19]=0,f[l+20]=1,f[l+21]=1;f[n+22]=-.5,f[n+23]=-.5,f[o+22]=.5,f[o+23]=-.5,f[s+22]=.5,f[s+23]=.5,f[l+22]=-.5,f[l+23]=.5},$(i,[{key:"texture",get:function(){return this.getMaterial().shaderData.getTexture("u_texture")},set:function(e){e?(this.shaderData.enableMacro("particleTexture"),this.getMaterial().shaderData.setTexture("u_texture",e)):this.shaderData.disableMacro("particleTexture")}},{key:"position",get:function(){return this._position},set:function(e){this._updateDirtyFlag|=ue.Position,this._position=e}},{key:"positionRandomness",get:function(){return this._positionRandomness},set:function(e){this._updateDirtyFlag|=ue.Position,this._positionRandomness=e}},{key:"positionArray",get:function(){return this._positionArray},set:function(e){this._updateDirtyFlag|=ue.Position,this._positionArray=e}},{key:"velocity",get:function(){return this._velocity},set:function(e){this._updateDirtyFlag|=ue.Velocity,this._velocity=e}},{key:"velocityRandomness",get:function(){return this._velocityRandomness},set:function(e){this._updateDirtyFlag|=ue.Velocity,this._velocityRandomness=e}},{key:"acceleration",get:function(){return this._acceleration},set:function(e){this._updateDirtyFlag|=ue.Acceleration,this._acceleration=e}},{key:"accelerationRandomness",get:function(){return this._accelerationRandomness},set:function(e){this._updateDirtyFlag|=ue.Acceleration,this._accelerationRandomness=e}},{key:"color",get:function(){return this._color},set:function(e){this._updateDirtyFlag|=ue.Color,this._color=e}},{key:"colorRandomness",get:function(){return this._colorRandomness},set:function(e){this._updateDirtyFlag|=ue.Color,this._colorRandomness=e}},{key:"size",get:function(){return this._size},set:function(e){this._updateDirtyFlag|=ue.Size,this._size=e}},{key:"sizeRandomness",get:function(){return this._sizeRandomness},set:function(e){this._updateDirtyFlag|=ue.Size,this._sizeRandomness=e}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._updateDirtyFlag|=ue.Alpha,this._alpha=e}},{key:"alphaRandomness",get:function(){return this._alphaRandomness},set:function(e){this._updateDirtyFlag|=ue.Alpha,this._alphaRandomness=e}},{key:"angle",get:function(){return this._startAngle},set:function(e){this._updateDirtyFlag|=ue.StartAngle,this._startAngle=e}},{key:"angleRandomness",get:function(){return this._startAngleRandomness},set:function(e){this._updateDirtyFlag|=ue.StartAngle,this._startAngleRandomness=e}},{key:"rotateVelocity",get:function(){return this._rotateVelocity},set:function(e){this._updateDirtyFlag|=ue.RotateVelocity,this._rotateVelocity=e}},{key:"rotateVelocityRandomness",get:function(){return this._rotateVelocityRandomness},set:function(e){this._updateDirtyFlag|=ue.RotateVelocity,this._rotateVelocityRandomness=e}},{key:"lifetime",get:function(){return this._lifetime},set:function(e){this._updateDirtyFlag|=ue.LifeTime,this._lifetime=e,this._onceTime=0}},{key:"startTimeRandomness",get:function(){return this._startTimeRandomness},set:function(e){this._updateDirtyFlag|=ue.StartTime,this._startTimeRandomness=e,this._onceTime=0}},{key:"scale",get:function(){return this._scale},set:function(e){this._updateDirtyFlag|=ue.Scale,this._scale=e}},{key:"maxCount",get:function(){return this._maxCount},set:function(e){this._isStart=!1,this._isInit=!1,this._maxCount=e,this._updateDirtyFlag=ue.Everything,this.mesh=this._createMesh(),this._updateBuffer(),this._isInit=!0,this.shaderData.setFloat("u_time",0)}},{key:"isOnce",get:function(){return this._isOnce},set:function(e){this._time=0,this.shaderData.setInt("u_once",e?1:0),this._isOnce=e}},{key:"isRotateToVelocity",get:function(){return this._isRotateToVelocity},set:function(e){e?this.shaderData.enableMacro("rotateToVelocity"):this.shaderData.disableMacro("rotateToVelocity"),this._isRotateToVelocity=e}},{key:"isUseOriginColor",get:function(){return this._isUseOriginColor},set:function(e){e?this.shaderData.enableMacro("useOriginColor"):this.shaderData.disableMacro("useOriginColor"),this._isUseOriginColor=e}},{key:"isScaleByLifetime",get:function(){return this._isScaleByLifetime},set:function(e){e?this.shaderData.enableMacro("isScaleByLifetime"):this.shaderData.disableMacro("isScaleByLifetime"),this._isScaleByLifetime=e}},{key:"is2d",get:function(){return this._is2d},set:function(e){e?this.shaderData.enableMacro("is2d"):(this.shaderData.disableMacro("is2d"),this.getMaterial().renderState.rasterState.cullMode=Wt.Off),this._is2d=e}},{key:"isFadeIn",get:function(){return this._isFadeIn},set:function(e){e?this.shaderData.enableMacro("fadeIn"):this.shaderData.disableMacro("fadeIn"),this._isFadeIn=e}},{key:"isFadeOut",get:function(){return this._isFadeOut},set:function(e){e?this.shaderData.enableMacro("fadeOut"):this.shaderData.disableMacro("fadeOut"),this._isFadeOut=e}},{key:"playOnEnable",get:function(){return this._playOnEnable},set:function(e){this._playOnEnable=e,e?this.start():this.stop()}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){var n=this.getMaterial().renderState.blendState,o=n.targetBlendState;e===ro.Transparent?(o.enabled=!0,o.sourceColorBlendFactor=oe.SourceAlpha,o.destinationColorBlendFactor=oe.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=oe.One,o.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha):e===ro.Additive&&(o.enabled=!0,o.sourceColorBlendFactor=oe.SourceAlpha,o.destinationColorBlendFactor=oe.One,o.sourceAlphaBlendFactor=oe.One,o.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha),this._blendMode=e}}]),i}($a);fp._uint16VertexLimit=65535;var Bx=`#define GLSLIFY 1
varying vec2 v_uv;uniform sampler2D u_texture;void main(void){gl_FragColor=texture2D(u_texture,v_uv);}`,Lx=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;uniform mat4 u_projMat;uniform mat4 u_viewMat;void main(){gl_Position=u_projMat*u_viewMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`;b.create("trail",Lx,Bx);new A;new $t;new $t;b.getPropertyByName("u_fogColor");b.getPropertyByName("u_fogDensity");b.getPropertyByName("u_fogNear");b.getPropertyByName("u_fogFar");new A;new A;new A;var je=function(){t._updateShaderData=function(r){var e=t._combinedData;r.setFloatArray(t._viewMatFromLightProperty,e.viewMatrix),r.setFloatArray(t._projMatFromLightProperty,e.projectionMatrix),r.setFloatArray(t._shadowBiasProperty,e.bias),r.setFloatArray(t._shadowIntensityProperty,e.intensity),r.setFloatArray(t._shadowRadiusProperty,e.radius),r.setFloatArray(t._shadowMapSizeProperty,e.mapSize),r.setTextureArray(t._shadowMapsProperty,e.map)},t.clearMap=function(){t._combinedData.map.length=0};function t(a,r){r===void 0&&(r={engine:null,width:512,height:512}),this._mapSize=void 0,this._renderTarget=void 0,this.light=void 0,this.bias=.005,this.intensity=.2,this.radius=1,this.projectionMatrix=new Z,this.light=a;var e=r,n=e.engine,o=e.width,s=e.height;this._mapSize=new G(o,s),this._renderTarget=new Ty(n,o,s,new My(n,o,s))}var i=t.prototype;return i.initShadowProjectionMatrix=function(r){if(r instanceof Fr&&Z.ortho(-5,5,-5,5,.1,50,this.projectionMatrix),r instanceof Ir&&Z.perspective(O.degreeToRadian(50),1,.5,50,this.projectionMatrix),r instanceof Xt){var e=Math.min(Math.PI/2,r.angle*2*Math.sqrt(2));Z.perspective(e,1,.1,r.distance+5,this.projectionMatrix)}},i.appendData=function(r){var e=r*16,n=r*16,o=r,s=r,l=r,u=r*2,c=r,f=t._combinedData;f.viewMatrix.set(this.light.viewMatrix.elements,e),f.projectionMatrix.set(this.projectionMatrix.elements,n),f.bias[o]=this.bias,f.intensity[s]=this.intensity,f.radius[l]=this.radius,f.mapSize[u]=this.mapSize.x,f.mapSize[u+1]=this.mapSize.y,f.map[c]=this.map},$(t,[{key:"renderTarget",get:function(){return this._renderTarget}},{key:"map",get:function(){return this._renderTarget.getColorTexture()}},{key:"mapSize",get:function(){return this._mapSize}}]),t}();je._viewMatFromLightProperty=b.getPropertyByName("u_viewMatFromLight");je._projMatFromLightProperty=b.getPropertyByName("u_projMatFromLight");je._shadowBiasProperty=b.getPropertyByName("u_shadowBias");je._shadowIntensityProperty=b.getPropertyByName("u_shadowIntensity");je._shadowRadiusProperty=b.getPropertyByName("u_shadowRadius");je._shadowMapSizeProperty=b.getPropertyByName("u_shadowMapSize");je._shadowMapsProperty=b.getPropertyByName("u_shadowMaps");je._maxLight=3;je._combinedData={viewMatrix:new Float32Array(16*je._maxLight),projectionMatrix:new Float32Array(16*je._maxLight),bias:new Float32Array(je._maxLight),intensity:new Float32Array(je._maxLight),radius:new Float32Array(je._maxLight),mapSize:new Float32Array(2*je._maxLight),map:[]};Object.defineProperty(ot.prototype,"enableShadow",{get:function(){return this._enableShadow},set:function(i){if(this._enableShadow=i,this._enableShadow){if(this instanceof rr){this._enableShadow=!1;return}this.shadow=this.shadow||new je(this,{engine:this.engine,width:512,height:512}),this.shadow.initShadowProjectionMatrix(this)}}});Object.defineProperty(Jt.prototype,"receiveShadow",{get:function(){return this._recieveShadow},set:function(i){this._recieveShadow=i}});Object.defineProperty(Jt.prototype,"castShadow",{get:function(){return this._castShadow},set:function(i){this._castShadow=i}});var Ox=function(t){Y(i,t);function i(a){var r;return r=t.call(this,a,b.find("shadow-map"))||this,r.shaderData.enableMacro("O3_GENERATE_SHADOW_MAP"),r}return i}(hn),Pc=function(t){Y(i,t);function i(r,e,n,o,s,l){var u;return u=t.call(this,r,e,n,o,s)||this,u.light=void 0,u.light=l,u.clearColor=new ge(1,1,1,1),u}var a=i.prototype;return a.preRender=function(e,n){var o=this.replaceMaterial.shaderData;o.setMatrix(i._viewMatFromLightProperty,this.light.viewMatrix),o.setMatrix(i._projMatFromLightProperty,this.light.shadow.projectionMatrix)},i}(Gi);Pc._viewMatFromLightProperty=b.getPropertyByName("u_viewMatFromLight");Pc._projMatFromLightProperty=b.getPropertyByName("u_projMatFromLight");var Dx=function(t){Y(i,t);function i(a){var r;r=t.call(this,a,b.find("shadow"))||this;var e=r.renderState.blendState.targetBlendState;return e.enabled=!0,e.sourceColorBlendFactor=e.sourceAlphaBlendFactor=oe.DestinationColor,e.destinationColorBlendFactor=e.destinationAlphaBlendFactor=oe.Zero,r.renderState.depthState.compareFunction=me.LessEqual,r.renderQueueType=Ze.Transparent,r}return i}(hn),Fx=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.clearFlags=Vi.None,r}var a=i.prototype;return a.preRender=function(e,n){this.enabled=!1;var o=e.scene.findFeature(Kn),s=o.visibleLights,l=this.replaceMaterial.shaderData,u=e._renderPipeline.defaultRenderPass;this.renderTarget=u.renderTarget;var c=0;je.clearMap();for(var f=0,d=s.length;f<d;f++){var h=s[f];h.enableShadow&&h.shadow.appendData(c++)}c?(this.enabled=!0,je._updateShaderData(l),l.enableMacro("O3_SHADOW_MAP_COUNT",c.toString())):l.disableMacro("O3_SHADOW_MAP_COUNT")},i}(Gi),Ix=function(t){Y(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r._shadowPass=void 0,r._shadowMapMaterial=void 0,r}var a=i.prototype;return a.preRender=function(e,n){var o=e.findFeature(Kn).visibleLights;if(o.length>0){this._shadowPass||this.addShadowPass(n);for(var s=n._renderPipeline,l=0,u=o.length;l<u;l++){var c=o[l];c.enableShadow&&!c.shadowMapPass?c.shadowMapPass=this.addShadowMapPass(n,c):!c.enableShadow&&c.shadowMapPass&&(s.removeRenderPass(c.shadowMapPass),c.shadowMapPass=null)}this.updatePassRenderFlag(s._opaqueQueue),this.updatePassRenderFlag(s._alphaTestQueue),this.updatePassRenderFlag(s._transparentQueue)}},a.addShadowPass=function(e){var n=new Dx(e.engine);this._shadowPass=new Fx("ShadowPass",1,null,n,Gt.Layer30);var o=e._renderPipeline;o.addRenderPass(this._shadowPass)},a.addShadowMapPass=function(e,n){this._shadowMapMaterial=this._shadowMapMaterial||new Ox(e.engine);var o=new Pc("ShadowMapPass",-1,n.shadow.renderTarget,this._shadowMapMaterial,Gt.Layer31,n),s=e._renderPipeline;return s.addRenderPass(o),o},a.updatePassRenderFlag=function(e){for(var n=e.items,o=0,s=n.length;o<s;o++){var l=n[o],u=l.component,c=u.recieveShadow,f=u.castShadow;c===!0?u.entity.layer|=Gt.Layer30:c===!1&&(u.entity.layer&=~Gt.Layer30),f===!0?u.entity.layer|=Gt.Layer31:f===!1&&(u.entity.layer&=~Gt.Layer31)}},i}(_c);gn.registerFeature(Ix);gn.registerFeature(Kn);gn.prototype.hasLight=Dy;var ie;(function(t){t[t.RGBA_ASTC_4X4_KHR=37808]="RGBA_ASTC_4X4_KHR",t[t.RGBA_ASTC_5X4_KHR=37809]="RGBA_ASTC_5X4_KHR",t[t.RGBA_ASTC_5X5_KHR=37810]="RGBA_ASTC_5X5_KHR",t[t.RGBA_ASTC_6X5_KHR=37811]="RGBA_ASTC_6X5_KHR",t[t.RGBA_ASTC_6X6_KHR=37812]="RGBA_ASTC_6X6_KHR",t[t.RGBA_ASTC_8X5_KHR=37813]="RGBA_ASTC_8X5_KHR",t[t.RGBA_ASTC_8X6_KHR=37814]="RGBA_ASTC_8X6_KHR",t[t.RGBA_ASTC_8X8_KHR=37815]="RGBA_ASTC_8X8_KHR",t[t.RGBA_ASTC_10X5_KHR=37816]="RGBA_ASTC_10X5_KHR",t[t.RGBA_ASTC_10X6_KHR=37817]="RGBA_ASTC_10X6_KHR",t[t.RGBA_ASTC_10X8_KHR=37818]="RGBA_ASTC_10X8_KHR",t[t.RGBA_ASTC_10X10_KHR=37819]="RGBA_ASTC_10X10_KHR",t[t.RGBA_ASTC_12X10_KHR=37820]="RGBA_ASTC_12X10_KHR",t[t.RGBA_ASTC_12X12_KHR=37821]="RGBA_ASTC_12X12_KHR",t[t.SRGB8_ALPHA8_ASTC_4X4_KHR=37840]="SRGB8_ALPHA8_ASTC_4X4_KHR",t[t.SRGB8_ALPHA8_ASTC_5X4_KHR=37841]="SRGB8_ALPHA8_ASTC_5X4_KHR",t[t.SRGB8_ALPHA8_ASTC_5X5_KHR=37842]="SRGB8_ALPHA8_ASTC_5X5_KHR",t[t.SRGB8_ALPHA8_ASTC_6X5_KHR=37843]="SRGB8_ALPHA8_ASTC_6X5_KHR",t[t.SRGB8_ALPHA8_ASTC_6X6_KHR=37844]="SRGB8_ALPHA8_ASTC_6X6_KHR",t[t.SRGB8_ALPHA8_ASTC_8X5_KHR=37845]="SRGB8_ALPHA8_ASTC_8X5_KHR",t[t.SRGB8_ALPHA8_ASTC_8X6_KHR=37846]="SRGB8_ALPHA8_ASTC_8X6_KHR",t[t.SRGB8_ALPHA8_ASTC_8X8_KHR=37847]="SRGB8_ALPHA8_ASTC_8X8_KHR",t[t.SRGB8_ALPHA8_ASTC_10X5_KHR=37848]="SRGB8_ALPHA8_ASTC_10X5_KHR",t[t.SRGB8_ALPHA8_ASTC_10X6_KHR=37849]="SRGB8_ALPHA8_ASTC_10X6_KHR",t[t.SRGB8_ALPHA8_ASTC_10X8_KHR=37850]="SRGB8_ALPHA8_ASTC_10X8_KHR",t[t.SRGB8_ALPHA8_ASTC_10X10_KHR=37851]="SRGB8_ALPHA8_ASTC_10X10_KHR",t[t.SRGB8_ALPHA8_ASTC_12X10_KHR=37852]="SRGB8_ALPHA8_ASTC_12X10_KHR",t[t.SRGB8_ALPHA8_ASTC_12X12_KHR=37853]="SRGB8_ALPHA8_ASTC_12X12_KHR",t[t.RGB_ETC1_WEBGL=36196]="RGB_ETC1_WEBGL",t[t.R11_EAC=37488]="R11_EAC",t[t.SIGNED_R11_EAC=37489]="SIGNED_R11_EAC",t[t.RG11_EAC=37490]="RG11_EAC",t[t.SIGNED_RG11_EAC=37491]="SIGNED_RG11_EAC",t[t.RGB8_ETC2=37492]="RGB8_ETC2",t[t.SRGB8_ETC2=37493]="SRGB8_ETC2",t[t.RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.RGBA8_ETC2_EAC=37496]="RGBA8_ETC2_EAC",t[t.SRGB8_ALPHA8_ETC2_EAC=37497]="SRGB8_ALPHA8_ETC2_EAC",t[t.RGB_PVRTC_4BPPV1_IMG=35840]="RGB_PVRTC_4BPPV1_IMG",t[t.RGB_PVRTC_2BPPV1_IMG=35841]="RGB_PVRTC_2BPPV1_IMG",t[t.RGBA_PVRTC_4BPPV1_IMG=35842]="RGBA_PVRTC_4BPPV1_IMG",t[t.RGBA_PVRTC_2BPPV1_IMG=35843]="RGBA_PVRTC_2BPPV1_IMG",t[t.RGB_S3TC_DXT1_EXT=33776]="RGB_S3TC_DXT1_EXT",t[t.RGBA_S3TC_DXT1_EXT=33777]="RGBA_S3TC_DXT1_EXT",t[t.RGBA_S3TC_DXT3_EXT=33778]="RGBA_S3TC_DXT3_EXT",t[t.RGBA_S3TC_DXT5_EXT=33779]="RGBA_S3TC_DXT5_EXT"})(ie||(ie={}));function dp(t,i){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);i&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function Nx(t){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?dp(Object(a),!0).forEach(function(r){Ux(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):dp(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function hp(t,i){for(var a=0;a<i.length;a++){var r=i[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function no(t,i,a){return i&&hp(t.prototype,i),a&&hp(t,a),t}function Ux(t,i,a){return i in t?Object.defineProperty(t,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[i]=a,t}function io(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,Ac(t,i)}function Ac(t,i){return Ac=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},Ac(t,i)}var kx=function(){var t=i.prototype;t.resizeByClientSize=function(r){r===void 0&&(r=window.devicePixelRatio);var e=this._webCanvas;if(e instanceof HTMLCanvasElement){var n=e.clientWidth,o=e.clientHeight;this.width=n*r,this.height=o*r}};function i(a){this._webCanvas=void 0,this._width=void 0,this._height=void 0,this._scale=new G;var r=a.width,e=a.height;this._webCanvas=a,this._width=r,this._height=e}return t.setScale=function(r,e){this._scale.setValue(r,e),this.scale=this._scale},no(i,[{key:"width",get:function(){return this._width},set:function(r){this._width!==r&&(this._webCanvas.width=r,this._width=r)}},{key:"height",get:function(){return this._height},set:function(r){this._height!==r&&(this._webCanvas.height=r,this._height=r)}},{key:"scale",get:function(){var r=this._webCanvas;return r instanceof HTMLCanvasElement&&this._scale.setValue(r.clientWidth*devicePixelRatio/r.width,r.clientHeight*devicePixelRatio/r.height),this._scale},set:function(r){var e=this._webCanvas;e instanceof HTMLCanvasElement&&(e.style.transformOrigin="left top",e.style.transform="scale("+r.x+", "+r.y+")")}}]),i}(),Vx=function(){function t(a){this._maxDrawBuffers=void 0,this._maxAnisoLevel=void 0,this._maxAntiAliasing=void 0,this._rhi=void 0,this.capabilityList=void 0,this._rhi=a,this.capabilityList=new Map,this._init(),this._compatibleAllInterface()}var i=t.prototype;return i.canIUse=function(r){return this.capabilityList.get(r)},i.canIUseCompressedTextureInternalFormat=function(r){var e=ie.RGBA_ASTC_4X4_KHR,n=ie.RGBA_ASTC_12X12_KHR,o=ie.SRGB8_ALPHA8_ASTC_4X4_KHR,s=ie.SRGB8_ALPHA8_ASTC_12X12_KHR,l=ie.RGB_ETC1_WEBGL,u=ie.R11_EAC,c=ie.SRGB8_ALPHA8_ETC2_EAC,f=ie.RGB_PVRTC_4BPPV1_IMG,d=ie.RGBA_PVRTC_2BPPV1_IMG,h=ie.RGB_S3TC_DXT1_EXT,_=ie.RGBA_S3TC_DXT5_EXT;return r>=e&&n<=n||r>=o&&r<=s?this.canIUse(X.astc):r===l?this.canIUse(X.etc1):r>=u&&r<=c?this.canIUse(X.etc):r>=f&&r<=d?this.canIUse(X.pvrtc):r>=h&&r<=_?this.canIUse(X.s3tc):!1},i._init=function(){var r=this.capabilityList,e=this.rhi.isWebGL2,n=this.rhi.requireExtension.bind(this.rhi),o=X.shaderVertexID,s=X.standardDerivatives,l=X.shaderTextureLod,u=X.elementIndexUint,c=X.depthTexture,f=X.vertexArrayObject,d=X.instancedArrays,h=X.multipleSample,_=X.drawBuffers,m=X.astc,v=X.astc_webkit,p=X.etc,g=X.etc_webkit,y=X.etc1,x=X.etc1_webkit,T=X.pvrtc,w=X.pvrtc_webkit,S=X.s3tc,M=X.s3tc_webkit,P=X.textureFloat,E=X.textureHalfFloat,R=X.textureFloatLinear,C=X.textureHalfFloatLinear,z=X.WEBGL_colorBufferFloat,k=X.colorBufferFloat,D=X.colorBufferHalfFloat,H=X.textureFilterAnisotropic;r.set(o,e),r.set(s,e||!!n(s)),r.set(l,e||!!n(l)),r.set(u,e||!!n(u)),r.set(c,e||!!n(c)),r.set(f,e||!!n(f)),r.set(d,e||!!n(d)),r.set(h,e),r.set(_,e||!!n(_)),r.set(P,e||!!n(P)),r.set(E,e||!!n(E)),r.set(R,!!n(R)),r.set(C,e||!!n(C)),r.set(k,e&&!!n(k)||!!n(z)),r.set(D,e&&!!n(k)||!!n(D)),r.set(H,!!n(H)),r.set(m,!!(n(m)||n(v))),r.set(p,!!(n(p)||n(g))),r.set(y,!!(n(y)||n(x))),r.set(T,!!(n(T)||n(w))),r.set(S,!!(n(S)||n(M)))},i._compatibleInterface=function(r,e){var n=this.rhi,o=n.gl,s=null;if(s=n.requireExtension(r))for(var l in e){var u=e[l],c=s[u];c!=null&&c.bind?o[l]=c.bind(s):o[l]=c}},i._compatibleAllInterface=function(){var r=X.depthTexture,e=X.vertexArrayObject,n=X.instancedArrays,o=X.drawBuffers,s=X.textureFilterAnisotropic,l=X.textureHalfFloat,u=X.colorBufferHalfFloat,c=X.WEBGL_colorBufferFloat,f=this.rhi.isWebGL2;if(!f){this._compatibleInterface(r,{UNSIGNED_INT_24_8:"UNSIGNED_INT_24_8_WEBGL"}),this._compatibleInterface(e,{createVertexArray:"createVertexArrayOES",deleteVertexArray:"deleteVertexArrayOES",isVertexArray:"isVertexArrayOES",bindVertexArray:"bindVertexArrayOES"}),this._compatibleInterface(n,{drawArraysInstanced:"drawArraysInstancedANGLE",drawElementsInstanced:"drawElementsInstancedANGLE",vertexAttribDivisor:"vertexAttribDivisorANGLE"}),this._compatibleInterface(o,{MAX_DRAW_BUFFERS:"MAX_DRAW_BUFFERS_WEBGL"});var d={};if(this.canIUse(X.drawBuffers)){for(var h=this.maxDrawBuffers,_=0;_<h;_++)_!=0&&(d["COLOR_ATTACHMENT"+_]="COLOR_ATTACHMENT"+_+"_WEBGL"),d["DRAW_BUFFER"+_]="DRAW_BUFFER"+_+"_WEBGL";this._compatibleInterface(o,Nx({drawBuffers:"drawBuffersWEBGL"},d))}this._compatibleInterface(l,{HAFL_FLOAT:"HALF_FLOAT_OES"}),this._compatibleInterface(u,{RGBA16F:"RBGA16F_EXT"}),this._compatibleInterface(c,{RGBA32F:"RBGA32F_EXT"})}this._compatibleInterface(s,{TEXTURE_MAX_ANISOTROPY_EXT:"TEXTURE_MAX_ANISOTROPY_EXT"})},no(t,[{key:"canUseFloatTextureBlendShape",get:function(){return this.canIUse(X.shaderVertexID)&&this.canIUse(X.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"canIUseMoreJoints",get:function(){return this.canIUse(X.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"maxDrawBuffers",get:function(){return this._maxDrawBuffers||(this.canIUse(X.drawBuffers)?this._maxDrawBuffers=this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS):this._maxDrawBuffers=1),this._maxDrawBuffers}},{key:"maxAnisoLevel",get:function(){if(!this._maxAnisoLevel){var r=this._rhi.requireExtension(X.textureFilterAnisotropic);this._maxAnisoLevel=r?this._rhi.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}return this._maxAnisoLevel}},{key:"maxAntiAliasing",get:function(){if(!this._maxAntiAliasing){var r=this._rhi.gl,e=this.canIUse(X.multipleSample);this._maxAntiAliasing=e?r.getParameter(r.MAX_SAMPLES):1}return this._maxAntiAliasing}},{key:"rhi",get:function(){return this._rhi}}]),t}(),Gx=function(){function t(a){this.rhi=void 0,this._requireResult=void 0,this.rhi=a,this._requireResult={}}var i=t.prototype;return i.requireExtension=function(r){return this._requireResult[r]!==void 0?this._requireResult[r]:(this._requireResult[r]=this.rhi.gl.getExtension(r),this._requireResult[r])},t}(),Hx=function(){function t(a,r){this.attribLocArray=void 0,this._primitive=void 0,this.canUseInstancedArrays=void 0,this.gl=void 0,this.vao=new Map,this._useVao=void 0,this._primitive=r,this.canUseInstancedArrays=a.canIUse(X.instancedArrays),this._useVao=a.canIUse(X.vertexArrayObject),this.gl=a.gl}var i=t.prototype;return i.draw=function(r,e){var n=this.gl,o=this._primitive;if(this._useVao){this.vao.has(r.id)||this.registerVAO(r);var s=this.vao.get(r.id);n.bindVertexArray(s)}else this.bindBufferAndAttrib(r);var l=o._indexBufferBinding,u=o._instanceCount,c=o._glIndexType,f=o._glIndexByteCount,d=e.topology,h=e.start,_=e.count;if(u){if(this.canUseInstancedArrays)if(l)if(this._useVao)n.drawElementsInstanced(d,_,c,h*f,u);else{var v=l.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v),n.drawElementsInstanced(d,_,c,h*f,u),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArraysInstanced(d,h,_,u)}else if(l)if(this._useVao)n.drawElements(d,_,c,h*f);else{var m=l.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,m),n.drawElements(d,_,c,h*f),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArrays(d,h,_);this._useVao?n.bindVertexArray(null):this.disableAttrib()},i.destroy=function(){if(this._useVao){var r=this.gl;this.vao.forEach(function(e){r.deleteVertexArray(e)}),this.vao.clear()}},i.bindBufferAndAttrib=function(r){var e=this.gl,n=this._primitive,o=n._vertexBufferBindings;this.attribLocArray=[];var s=r.attributeLocation,l=n._vertexElementMap,u,c;for(var f in s){var d=s[f];if(d!==-1){var h=l[f];if(h){var _=o[h.bindingIndex],m=_.buffer,v=_.stride;u=m._nativeBuffer,c!==u&&(c=u,e.bindBuffer(e.ARRAY_BUFFER,u)),e.enableVertexAttribArray(d);var p=h._glElementInfo,g=p.size,y=p.type,x=p.normalized;e.vertexAttribPointer(d,g,y,x,v,h.offset),this.canUseInstancedArrays&&e.vertexAttribDivisor(d,h.instanceStepRate),this.attribLocArray.push(d)}}}e.bindBuffer(e.ARRAY_BUFFER,null)},i.disableAttrib=function(){for(var r=this.gl,e=0,n=this.attribLocArray.length;e<n;e++)r.disableVertexAttribArray(this.attribLocArray[e])},i.registerVAO=function(r){var e=this.gl,n=e.createVertexArray();e.bindVertexArray(n);var o=this._primitive._indexBufferBinding;o&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.buffer._nativeBuffer),this.bindBufferAndAttrib(r),e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.disableAttrib(),this.vao.set(r.id,n)},t}(),be=function(){t._isPowerOf2=function(r){return(r&r-1)==0},t._getFormatDetail=function(r,e,n){switch(r){case ee.R8G8B8:return{internalFormat:n?e.RGB8:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case ee.R8G8B8A8:return{internalFormat:n?e.RGBA8:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case ee.R4G4B4A4:return{internalFormat:n?e.RGBA4:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case ee.R5G5B5A1:return{internalFormat:n?e.RGB5_A1:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case ee.R5G6B5:return{internalFormat:n?e.RGB565:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case ee.Alpha8:return{internalFormat:e.ALPHA,baseFormat:e.ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case ee.LuminanceAlpha:return{internalFormat:e.LUMINANCE_ALPHA,baseFormat:e.LUMINANCE_ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case ee.R32G32B32A32:return{internalFormat:e.RGBA32F,baseFormat:e.RGBA,dataType:e.FLOAT,isCompressed:!1};case ee.DXT1:return{internalFormat:ie.RGB_S3TC_DXT1_EXT,isCompressed:!0};case ee.DXT5:return{internalFormat:ie.RGBA_S3TC_DXT5_EXT,isCompressed:!0};case ee.ETC1_RGB:return{internalFormat:ie.RGB_ETC1_WEBGL,isCompressed:!0};case ee.ETC2_RGB:return{internalFormat:ie.RGB8_ETC2,isCompressed:!0};case ee.ETC2_RGBA5:return{internalFormat:ie.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,isCompressed:!0};case ee.ETC2_RGBA8:return{internalFormat:ie.RGBA8_ETC2_EAC,isCompressed:!0};case ee.PVRTC_RGB2:return{internalFormat:ie.RGB_PVRTC_2BPPV1_IMG,isCompressed:!0};case ee.PVRTC_RGBA2:return{internalFormat:ie.RGBA_PVRTC_2BPPV1_IMG,isCompressed:!0};case ee.PVRTC_RGB4:return{internalFormat:ie.RGB_PVRTC_4BPPV1_IMG,isCompressed:!0};case ee.PVRTC_RGBA4:return{internalFormat:ie.RGBA_PVRTC_4BPPV1_IMG,isCompressed:!0};case ee.ASTC_4x4:return{internalFormat:ie.RGBA_ASTC_4X4_KHR,isCompressed:!0};case ee.ASTC_5x5:return{internalFormat:ie.RGBA_ASTC_5X5_KHR,isCompressed:!0};case ee.ASTC_6x6:return{internalFormat:ie.RGBA_ASTC_6X6_KHR,isCompressed:!0};case ee.ASTC_8x8:return{internalFormat:ie.RGBA_ASTC_8X8_KHR,isCompressed:!0};case ee.ASTC_10x10:return{internalFormat:ie.RGBA_ASTC_10X10_KHR,isCompressed:!0};case ee.ASTC_12x12:return{internalFormat:ie.RGBA_ASTC_12X12_KHR,isCompressed:!0};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+r)}},t._getRenderBufferColorFormatDetail=function(r,e,n){switch(r){case Pt.R8G8B8:return{internalFormat:n?e.RGB8:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case Pt.R8G8B8A8:return{internalFormat:n?e.RGBA8:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case Pt.R4G4B4A4:return{internalFormat:n?e.RGBA4:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case Pt.R5G5B5A1:return{internalFormat:n?e.RGB5_A1:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case Pt.R5G6B5:return{internalFormat:n?e.RGB565:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case Pt.Alpha8:return{internalFormat:e.ALPHA,baseFormat:e.ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case Pt.R16G16B16A16:return{internalFormat:e.RGBA16F,baseFormat:e.RGBA,dataType:e.HALF_FLOAT,isCompressed:!1};case Pt.R32G32B32A32:return{internalFormat:e.RGBA32F,baseFormat:e.RGBA,dataType:e.FLOAT,isCompressed:!1};default:throw new Error("this RenderBufferColorFormat is not supported in Oasis Engine: "+r)}},t._getRenderBufferDepthFormatDetail=function(r,e,n){switch(r){case He.Depth:return{internalFormat:n?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:n?e.FLOAT:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case He.DepthStencil:return{internalFormat:n?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case He.Stencil:return{internalFormat:e.STENCIL_INDEX8,baseFormat:e.STENCIL_ATTACHMENT,dataType:e.UNSIGNED_BYTE,isCompressed:!1,attachment:e.STENCIL_ATTACHMENT};case He.Depth16:return{internalFormat:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case He.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case He.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case He.Depth24Stencil8:return{internalFormat:n?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case He.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this RenderBufferDepthFormat is not supported in Oasis Engine: "+r)}},t._supportTextureFormat=function(r,e){var n=!0;switch(r){case ee.R32G32B32A32:e.canIUse(X.textureFloat)||(n=!1);break}return n},t._supportRenderBufferColorFormat=function(r,e){var n=!0;switch(r){case Pt.R32G32B32A32:(!e.canIUse(X.colorBufferFloat)||!e.canIUse(X.textureFloat))&&(n=!1);break;case Pt.R16G16B16A16:(!e.canIUse(X.colorBufferHalfFloat)||!e.canIUse(X.textureHalfFloat))&&(n=!1);break}return n},t._supportRenderBufferDepthFormat=function(r,e,n){var o=e.isWebGL2,s=!0;if(n&&!e.canIUse(X.depthTexture))return!1;switch(r){case He.Stencil:s=!1;break;case He.Depth24:case He.Depth32:case He.Depth32Stencil8:o||(s=!1);break}return s};function t(a,r,e){this._texture=void 0,this._glTexture=void 0,this._rhi=void 0,this._gl=void 0,this._isWebGL2=void 0,this._target=void 0,this._formatDetail=void 0,this._texture=r,this._rhi=a,this._gl=a.gl,this._isWebGL2=a.isWebGL2,this._target=e,this._glTexture=this._gl.createTexture()}var i=t.prototype;return i.destroy=function(){this._gl.deleteTexture(this._glTexture),this._texture=null,this._glTexture=null,this._formatDetail=null},i.generateMipmaps=function(){this._bind(),this._gl.generateMipmap(this._target)},i._bind=function(){this._rhi.bindTexture(this)},i._initMipmap=function(r){var e=this._gl,n=this._isWebGL2,o=this._formatDetail,s=o.internalFormat,l=o.baseFormat,u=o.dataType,c=this._texture,f=c.mipmapCount,d=c.width,h=c.height;if(this._bind(),n&&!(l===e.LUMINANCE_ALPHA||l===e.ALPHA))e.texStorage2D(this._target,f,s,d,h);else if(l!==s&&(s=l),r)for(var p=0;p<f;p++)for(var g=Math.max(1,d>>p),y=0;y<6;y++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+y,p,s,g,g,0,l,u,null);else for(var _=0;_<f;_++){var m=Math.max(1,d>>_),v=Math.max(1,h>>_);e.texImage2D(this._target,_,s,m,v,0,l,u,null)}},i._getPixelBuffer=function(r,e,n,o,s,l){var u=this._gl,c=this._formatDetail,f=c.baseFormat,d=c.dataType;t._readFrameBuffer||(t._readFrameBuffer=u.createFramebuffer()),u.bindFramebuffer(u.FRAMEBUFFER,t._readFrameBuffer),r!=null?u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+r,this._glTexture,0):u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,this._glTexture,0),u.readPixels(e,n,o,s,f,d,l),u.bindFramebuffer(u.FRAMEBUFFER,null)},i._setWrapMode=function(r,e){var n=this._gl,o=this._isWebGL2,s=this._target,l=this._texture,u=l.width,c=l.height;switch(!o&&r!==St.Clamp&&(!t._isPowerOf2(u)||!t._isPowerOf2(c))&&(r=St.Clamp),r){case St.Clamp:n.texParameteri(s,e,n.CLAMP_TO_EDGE);break;case St.Repeat:n.texParameteri(s,e,n.REPEAT);break;case St.Mirror:n.texParameteri(s,e,n.MIRRORED_REPEAT);break}},no(t,[{key:"wrapModeU",set:function(r){this._bind(),this._setWrapMode(r,this._gl.TEXTURE_WRAP_S)}},{key:"wrapModeV",set:function(r){this._bind(),this._setWrapMode(r,this._gl.TEXTURE_WRAP_T)}},{key:"filterMode",set:function(r){var e=this._gl,n=this._target,o=this._texture._mipmap;switch(this._bind(),r){case mr.Point:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.NEAREST_MIPMAP_NEAREST:e.NEAREST);break;case mr.Bilinear:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_NEAREST:e.LINEAR);break;case mr.Trilinear:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_LINEAR:e.LINEAR);break}}},{key:"anisoLevel",set:function(r){var e=this._gl;this._bind(),e.texParameterf(this._target,e.TEXTURE_MAX_ANISOTROPY_EXT,r)}}]),t}();be._readFrameBuffer=null;var Wx=function(t){io(i,t);function i(r,e){var n;n=t.call(this,r,e,e.isCube?r.gl.TEXTURE_CUBE_MAP:r.gl.TEXTURE_2D)||this;var o=e.format,s=e._mipmap,l=e.width,u=e.height,c=e.isCube,f=n._isWebGL2;if(!be._supportRenderBufferColorFormat(o,r))throw new Error("RenderBufferColorFormat is not supported:"+Pt[o]);if(c&&l!==u)throw new Error("The cube texture must have the same width and height");return s&&!f&&(!be._isPowerOf2(l)||!be._isPowerOf2(u))&&(e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=be._getRenderBufferColorFormatDetail(o,n._gl,f),n._initMipmap(c),n}var a=i.prototype;return a.getPixelBuffer=function(e,n,o,s,l,u){t.prototype._getPixelBuffer.call(this,e,n,o,s,l,u)},i}(be),jx=function(t){io(i,t);function i(a,r){var e;e=t.call(this,a,r,r.isCube?a.gl.TEXTURE_CUBE_MAP:a.gl.TEXTURE_2D)||this;var n=r.format,o=r._mipmap,s=r.width,l=r.height,u=r.isCube,c=e._isWebGL2;if(!be._supportRenderBufferDepthFormat(n,a,!0))throw new Error("RenderBufferDepthFormat is not supported:"+He[n]);if(u&&s!==l)throw new Error("The cube texture must have the same width and height");return o&&!c&&(!be._isPowerOf2(s)||!be._isPowerOf2(l))&&(r._mipmap=!1,r._mipmapCount=r._getMipmapCount()),e._formatDetail=be._getRenderBufferDepthFormatDetail(n,e._gl,c),e._initMipmap(u),e}return i}(be),Xx=function(){function t(a){this._gl=void 0,this._parameters={},this._gl=a,this._parameters={},this._parameters[a.MAX_COMBINED_TEXTURE_IMAGE_UNITS]=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._parameters[a.MAX_VERTEX_UNIFORM_VECTORS]=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),this._parameters[a.MAX_VERTEX_ATTRIBS]=a.getParameter(a.MAX_VERTEX_ATTRIBS),this._parameters[a.MAX_VERTEX_TEXTURE_IMAGE_UNITS]=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._parameters[a.MAX_TEXTURE_SIZE]=a.getParameter(a.MAX_TEXTURE_SIZE),a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.colorMask(!0,!0,!0,!0),a.blendColor(0,0,0,0),a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),a.enable(a.DEPTH_TEST),a.depthFunc(a.LESS),a.depthMask(!0),a.disable(a.STENCIL_TEST),a.stencilFuncSeparate(a.FRONT,a.ALWAYS,0,255),a.stencilFuncSeparate(a.BACK,a.ALWAYS,0,255),a.stencilOpSeparate(a.FRONT,a.KEEP,a.KEEP,a.KEEP),a.stencilOpSeparate(a.BACK,a.KEEP,a.KEEP,a.KEEP),a.stencilMask(255),a.enable(a.CULL_FACE),a.cullFace(a.BACK),a.disable(a.POLYGON_OFFSET_FILL),a.polygonOffset(0,0)}var i=t.prototype;return i.getParameter=function(r){return this._parameters[r]},t}(),Kx=function(){function t(a,r){this._gl=void 0,this._isWebGL2=void 0,this._target=void 0,this._frameBuffer=void 0,this._MSAAFrameBuffer=void 0,this._depthRenderBuffer=void 0,this._MSAAColorRenderBuffers=[],this._MSAADepthRenderBuffer=void 0,this._oriDrawBuffers=void 0,this._blitDrawBuffers=void 0,this._gl=a.gl,this._isWebGL2=a.isWebGL2,this._target=r;var e=r._colorTextures,n=r._depth,o=r.width,s=r.height;if(!(n instanceof Qa)&&!be._supportRenderBufferDepthFormat(n,a,!1))throw new Error("RenderBufferDepthFormat is not supported:"+He[n]);if(e.length>1&&!a.canIUse(X.drawBuffers))throw new Error("MRT is not supported");if(e.some(function(u){return u.width!==o||u.height!==s}))throw new Error("RenderColorTexture's size must as same as RenderTarget");if(n instanceof Qa&&(n.width!==o||n.height!==s))throw new Error("RenderDepthTexture's size must as same as RenderTarget");if(e.length>1&&e.some(function(u){return u.isCube}))throw new Error("MRT+Cube+[,MSAA] is not supported");var l=a.capability.maxAntiAliasing;r.antiAliasing>l&&(r._antiAliasing=l),this._frameBuffer=this._gl.createFramebuffer(),this._bindMainFBO(),r.antiAliasing>1&&(this._MSAAFrameBuffer=this._gl.createFramebuffer(),this._bindMSAAFBO())}var i=t.prototype;return i.setRenderTargetFace=function(r){var e=this._gl,n=this._target.getColorTexture(0),o=this._target.depthTexture;e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),n!=null&&n.isCube&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,n._platformTexture._glTexture,0),o!=null&&o.isCube&&e.framebufferTexture2D(e.FRAMEBUFFER,o._platformTexture._formatDetail.attachment,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,o._platformTexture._glTexture,0),this._activeRenderTarget()},i.blitRenderTarget=function(){if(!!this._MSAAFrameBuffer){var r=this._gl,e=r.COLOR_BUFFER_BIT|(this._target.depthTexture?r.DEPTH_BUFFER_BIT:0),n=this._target,o=n.colorTextureCount,s=n.width,l=n.height;r.bindFramebuffer(r.READ_FRAMEBUFFER,this._MSAAFrameBuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this._frameBuffer);for(var u=0;u<o;u++){var c=r.COLOR_ATTACHMENT0+u;this._blitDrawBuffers[u]=c,r.readBuffer(c),r.drawBuffers(this._blitDrawBuffers),r.blitFramebuffer(0,0,s,l,0,0,s,l,e,r.NEAREST),this._blitDrawBuffers[u]=r.NONE}r.bindFramebuffer(r.FRAMEBUFFER,null)}},i.destroy=function(){var r=this._gl;this._frameBuffer&&r.deleteFramebuffer(this._frameBuffer),this._depthRenderBuffer&&r.deleteRenderbuffer(this._depthRenderBuffer),this._MSAAFrameBuffer&&r.deleteFramebuffer(this._MSAAFrameBuffer),this._MSAADepthRenderBuffer&&r.deleteRenderbuffer(this._MSAADepthRenderBuffer);for(var e=0;e<this._MSAAColorRenderBuffers.length;e++)r.deleteRenderbuffer(this._MSAAColorRenderBuffers[e]);this._frameBuffer=null,this._depthRenderBuffer=null,this._MSAAFrameBuffer=null,this._MSAAColorRenderBuffers.length=0,this._MSAADepthRenderBuffer=null},i._activeRenderTarget=function(){var r=this._gl;this._MSAAFrameBuffer?r.bindFramebuffer(r.FRAMEBUFFER,this._MSAAFrameBuffer):r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer)},i._bindMainFBO=function(){var r=this._gl,e=this._isWebGL2,n=this._target,o=n._depth,s=n.colorTextureCount,l=n.width,u=n.height,c=new Array(s);r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer);for(var f=0;f<s;f++){var d=this._target.getColorTexture(f),h=r.COLOR_ATTACHMENT0+f;c[f]=h,d.isCube||r.framebufferTexture2D(r.FRAMEBUFFER,h,r.TEXTURE_2D,d._platformTexture._glTexture,0)}if(s>1&&r.drawBuffers(c),this._oriDrawBuffers=c,o!==null){if(o instanceof Qa)o.isCube||r.framebufferTexture2D(r.FRAMEBUFFER,o._platformTexture._formatDetail.attachment,r.TEXTURE_2D,o._platformTexture._glTexture,0);else if(this._target.antiAliasing<=1){var _=be._getRenderBufferDepthFormatDetail(o,r,e),m=_.internalFormat,v=_.attachment,p=r.createRenderbuffer();this._depthRenderBuffer=p,r.bindRenderbuffer(r.RENDERBUFFER,p),r.renderbufferStorage(r.RENDERBUFFER,m,l,u),r.framebufferRenderbuffer(r.FRAMEBUFFER,v,r.RENDERBUFFER,p)}}r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindRenderbuffer(r.RENDERBUFFER,null)},i._bindMSAAFBO=function(){var r=this._gl,e=this._isWebGL2,n=r.createRenderbuffer(),o=this._target,s=o._depth,l=o.colorTextureCount,u=o.antiAliasing,c=o.width,f=o.height;this._blitDrawBuffers=new Array(l),this._MSAADepthRenderBuffer=n,r.bindFramebuffer(r.FRAMEBUFFER,this._MSAAFrameBuffer);for(var d=0;d<l;d++){var h=r.createRenderbuffer();this._MSAAColorRenderBuffers[d]=h,this._blitDrawBuffers[d]=r.NONE,r.bindRenderbuffer(r.RENDERBUFFER,h),r.renderbufferStorageMultisample(r.RENDERBUFFER,u,this._target.getColorTexture(d)._platformTexture._formatDetail.internalFormat,c,f),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+d,r.RENDERBUFFER,h)}if(r.drawBuffers(this._oriDrawBuffers),s!==null){var _=s instanceof Qa?s._platformTexture._formatDetail:be._getRenderBufferDepthFormatDetail(s,r,e),m=_.internalFormat,v=_.attachment;r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorageMultisample(r.RENDERBUFFER,u,m,c,f),r.framebufferRenderbuffer(r.FRAMEBUFFER,v,r.RENDERBUFFER,n)}this._checkFrameBuffer(),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindRenderbuffer(r.RENDERBUFFER,null)},i._checkFrameBuffer=function(){var r=this._gl,e=this._isWebGL2,n=r.checkFramebufferStatus(r.FRAMEBUFFER);switch(n){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case r.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}if(e&&n===r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.")},t}(),qx=function(t){io(i,t);function i(r,e){var n;n=t.call(this,r,e,r.gl.TEXTURE_2D)||this,n._compressedMipFilled=0;var o=e.format,s=e._mipmap,l=e.width,u=e.height,c=n._isWebGL2;if(!be._supportTextureFormat(o,r))throw new Error("Texture format is not supported:"+ee[o]);return s&&!c&&(!be._isPowerOf2(l)||!be._isPowerOf2(u))&&(e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=be._getFormatDetail(o,n._gl,c),n._formatDetail.isCompressed&&!c||n._initMipmap(!1),n}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,u){n===void 0&&(n=0);var c=this._gl,f=this._isWebGL2,d=this._formatDetail,h=d.internalFormat,_=d.baseFormat,m=d.dataType,v=d.isCompressed,p=Math.max(1,this._texture.width>>n),g=Math.max(1,this._texture.height>>n);if(o=o||0,s=s||0,l=l||p-o,u=u||g-s,this._bind(),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,0),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),v){var y=1<<n;f||this._compressedMipFilled&y?c.compressedTexSubImage2D(this._target,n,o,s,l,u,h,e):(c.compressedTexImage2D(this._target,n,h,l,u,0,e),this._compressedMipFilled|=y)}else c.texSubImage2D(this._target,n,o,s,l,u,_,m,e)},a.setImageSource=function(e,n,o,s,l,u){n===void 0&&(n=0),o===void 0&&(o=!1),s===void 0&&(s=!1);var c=this._gl,f=this._formatDetail,d=f.baseFormat,h=f.dataType;this._bind(),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,+o),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+s),c.texSubImage2D(this._target,n,l||0,u||0,d,h,e)},a.getPixelBuffer=function(e,n,o,s,l){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");t.prototype._getPixelBuffer.call(this,null,e,n,o,s,l)},i}(be),Qx=function(t){io(i,t);function i(r,e){var n;n=t.call(this,r,e,r.gl.TEXTURE_CUBE_MAP)||this,n._compressedFaceFilled=[0,0,0,0,0,0];var o=e.format,s=e._mipmap,l=e.width,u=n._isWebGL2;if(!be._supportTextureFormat(o,r))throw new Error("Texture format is not supported:"+ee[o]);return s&&!u&&!be._isPowerOf2(l)&&(e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=be._getFormatDetail(o,n._gl,u),n._formatDetail.isCompressed&&!u||n._initMipmap(!0),n}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,u,c){o===void 0&&(o=0);var f=this._gl,d=this._isWebGL2,h=this._formatDetail,_=h.internalFormat,m=h.baseFormat,v=h.dataType,p=h.isCompressed,g=Math.max(1,this._texture.width>>o);if(s=s||0,l=l||0,u=u||g-s,c=c||g-l,this._bind(),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,0),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),p){var y=1<<o;d||this._compressedFaceFilled[e]&y?f.compressedTexSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,u,c,_,n):(f.compressedTexImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,_,u,c,0,n),this._compressedFaceFilled[e]|=y)}else f.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,u,c,m,v,n)},a.setImageSource=function(e,n,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1);var f=this._gl,d=this._formatDetail,h=d.baseFormat,_=d.dataType;this._bind(),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,+s),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),f.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,u||0,c||0,h,_,n)},a.getPixelBuffer=function(e,n,o,s,l,u){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");t.prototype._getPixelBuffer.call(this,e,n,o,s,l,u)},i}(be),Zn;(function(t){t[t.Auto=0]="Auto",t[t.WebGL2=1]="WebGL2",t[t.WebGL1=2]="WebGL1"})(Zn||(Zn={}));var Yx=function(){function t(a){a===void 0&&(a={}),this._currentBind=void 0,this._options=void 0,this._gl=void 0,this._renderStates=void 0,this._extensions=void 0,this._capability=void 0,this._isWebGL2=void 0,this._activeTextureID=WebGLRenderingContext.TEXTURE0,this._activeTextures=new Array(32),this._lastViewport=new Ee(void 0,void 0,void 0,void 0),this._lastClearColor=new ge(void 0,void 0,void 0,void 0),this._options=a}var i=t.prototype;return i.init=function(r){var e=this._options;e.alpha===void 0&&(e.alpha=!1),e.stencil===void 0&&(e.stencil=!0);var n=r._webCanvas,o=e.webGLMode||Zn.Auto,s;if((o==Zn.Auto||o==Zn.WebGL2)&&(s=n.getContext("webgl2",e),!s&&n instanceof HTMLCanvasElement&&(s=n.getContext("experimental-webgl2",e)),this._isWebGL2=!0,s&&!s.deleteQuery&&(this._isWebGL2=!1)),s||(o==Zn.Auto||o==Zn.WebGL1)&&(s=n.getContext("webgl",e),!s&&n instanceof HTMLCanvasElement&&(s=n.getContext("experimental-webgl",e)),this._isWebGL2=!1),!s)throw new Error("Get GL Context FAILED.");this._gl=s,this._renderStates=new Xx(s),this._extensions=new Gx(this),this._capability=new Vx(this),s.activeTexture(WebGLRenderingContext.TEXTURE0),this._options=null},i.createPlatformPrimitive=function(r){return new Hx(this,r)},i.createPlatformTexture2D=function(r){return new qx(this,r)},i.createPlatformTextureCubeMap=function(r){return new Qx(this,r)},i.createPlatformRenderColorTexture=function(r){return new Wx(this,r)},i.createPlatformRenderDepthTexture=function(r){return new jx(this,r)},i.createPlatformRenderTarget=function(r){return new Kx(this,r)},i.requireExtension=function(r){return this._extensions.requireExtension(r)},i.canIUse=function(r){return this.capability.canIUse(r)},i.canIUseCompressedTextureInternalFormat=function(r){return this.capability.canIUseCompressedTextureInternalFormat(r)},i.viewport=function(r,e,n,o){var s=this._gl,l=this._lastViewport;(r!==l.x||e!==l.y||n!==l.z||o!==l.w)&&(s.viewport(r,e,n,o),l.setValue(r,e,n,o))},i.colorMask=function(r,e,n,o){this._gl.colorMask(r,e,n,o)},i.clearRenderTarget=function(r,e,n){var o=this._gl,s=r._lastRenderState,l=s.blendState.targetBlendState,u=s.depthState,c=s.stencilState,f=o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT;if(e===Vi.DepthColor){f|=o.COLOR_BUFFER_BIT;var d=this._lastClearColor,h=n.r,_=n.g,m=n.b,v=n.a;n&&(h!==d.r||_!==d.g||m!==d.b||v!==d.a)&&(o.clearColor(h,_,m,v),d.setValue(h,_,m,v)),l.colorWriteMask!==gr.All&&(o.colorMask(!0,!0,!0,!0),l.colorWriteMask=gr.All)}u.writeEnabled!==!0&&(o.depthMask(!0),u.writeEnabled=!0),c.writeMask!==255&&(o.stencilMask(255),c.writeMask=255),o.clear(f)},i.drawPrimitive=function(r,e,n){r&&r._draw(n,e)},i.activeRenderTarget=function(r,e){var n=this._gl;if(r){var o;(o=r._platformRenderTarget)===null||o===void 0||o._activeRenderTarget();var s=r.width,l=r.height;this.viewport(0,0,s,l)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);var u=e.viewport,c=n.drawingBufferWidth,f=n.drawingBufferHeight,d=c*u.z,h=f*u.w,_=u.x*c,m=f-u.y*f-h;this.viewport(_,m,d,h)}},i.destroy=function(){},i.activeTexture=function(r){this._activeTextureID!==r&&(this._gl.activeTexture(r),this._activeTextureID=r)},i.bindTexture=function(r){var e=this._activeTextureID-this._gl.TEXTURE0;this._activeTextures[e]!==r&&(this._gl.bindTexture(r._target,r._glTexture),this._activeTextures[e]=r)},no(t,[{key:"isWebGL2",get:function(){return this._isWebGL2}},{key:"gl",get:function(){return this._gl}},{key:"renderStates",get:function(){return this._renderStates}},{key:"capability",get:function(){return this._capability}},{key:"canIUseMoreJoints",get:function(){return this.capability.canIUseMoreJoints}}]),t}(),Vw=function(t){io(i,t);function i(a,r){var e=new kx(typeof a=="string"?document.getElementById(a):a),n=new Yx(r);return t.call(this,e,n)||this}return no(i,[{key:"canvas",get:function(){return this._canvas}}]),i}(ox);function vp(t,i){for(var a=0;a<i.length;a++){var r=i[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $x(t,i,a){return i&&vp(t.prototype,i),a&&vp(t,a),t}var Zx=function(){function t(a,r){var e=this;this._worker=void 0,this._costs={},this._currentLoad=0,this._callbacks={},this._worker=new Worker(a),this._worker.onmessage=function(n){var o=n.data;switch(o.type){case"decode":e._callbacks[o.id].resolve(o.geometry);break;case"error":e._callbacks[o.id].reject(o);break;default:Vt.error('DRACOWorker: Unexpected message, "'+o.type+'"')}},r?this._worker.postMessage({type:"init",decoderConfig:{wasmBinary:r}}):this._worker.postMessage({type:"init",decoderConfig:{}})}var i=t.prototype;return i.setCosts=function(r,e){this._costs[r]=e},i.addCurrentLoad=function(r){this._currentLoad+=r},i.setCallback=function(r,e,n){this._callbacks[r]={resolve:e,reject:n}},i.decode=function(r,e,n){this._worker.postMessage({type:"decode",id:r,taskConfig:e,buffer:n},[n])},i.releaseTask=function(r){this._currentLoad-=this._costs[r],delete this._callbacks[r],delete this._costs[r]},$x(t,[{key:"currentLoad",get:function(){return this._currentLoad}}]),t}(),_p=`let decoderPending;
let decoderConfig;

onmessage = function(e) {
  const message = e.data;

  switch (message.type) {
    case "init":
      decoderConfig = message.decoderConfig;
      decoderPending = new Promise(function(resolve /*, reject*/) {
        decoderConfig.onModuleLoaded = function(draco) {
          // Module is Promise-like. Wrap before resolving to avoid loop.
          resolve({ draco: draco });
        };
        DracoDecoderModule(decoderConfig);
      });
      break;

    case "decode":
      const buffer = message.buffer;
      const taskConfig = message.taskConfig;
      decoderPending.then(module => {
        const draco = module.draco;
        const decoder = new draco.Decoder();
        const decoderBuffer = new draco.DecoderBuffer();
        decoderBuffer.Init(new Int8Array(buffer), buffer.byteLength);
        try {
          const geometry = decodeGeometry(draco, decoder, decoderBuffer, taskConfig);
          const buffers = geometry.attributes.map(attr => attr.array.buffer);
          if (geometry.index) buffers.push(geometry.index.array.buffer);
          self.postMessage({ type: "decode", id: message.id, geometry }, buffers);
        } catch (error) {
          console.error(error);
          self.postMessage({ type: "error", id: message.id, error: error.message });
        } finally {
          draco.destroy(decoderBuffer);
          draco.destroy(decoder);
        }
      });
      break;
  }
};

function decodeGeometry(draco, decoder, decoderBuffer, taskConfig) {
  const attributeIDs = taskConfig.attributeIDs;
  const attributeTypes = taskConfig.attributeTypes;

  let dracoGeometry;
  let decodingStatus;

  const geometryType = decoder.GetEncodedGeometryType(decoderBuffer);
  if (geometryType === draco.TRIANGULAR_MESH) {
    dracoGeometry = new draco.Mesh();
    decodingStatus = decoder.DecodeBufferToMesh(decoderBuffer, dracoGeometry);
  } else {
    throw new Error("DRACODecoder worker: Unexpected geometry type.");
  }

  if (!decodingStatus.ok() || dracoGeometry.ptr === 0) {
    throw new Error("DRACODecoder worker: Decoding failed: " + decodingStatus.error_msg());
  }

  const geometry = { index: null, attributes: [] };

  // Gather all vertex attributes.
  for (let attributeName in attributeIDs) {
    const attributeType = self[attributeTypes[attributeName]];

    let attribute;
    let attributeID;

    // A Draco file may be created with default vertex attributes, whose attribute IDs
    // are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
    // a Draco file may contain a custom set of attributes, identified by known unique
    // IDs. glTF files always do the latter, and .drc files typically do the former.
    if (taskConfig.useUniqueIDs) {
      attributeID = attributeIDs[attributeName];
      attribute = decoder.GetAttributeByUniqueId(dracoGeometry, attributeID);
    } else {
      attributeID = decoder.GetAttributeId(dracoGeometry, draco[attributeIDs[attributeName]]);
      if (attributeID === -1) continue;
      attribute = decoder.GetAttribute(dracoGeometry, attributeID);
    }
    geometry.attributes.push(decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute));
  }
  // Add index.
  if (geometryType === draco.TRIANGULAR_MESH) {
    // Generate mesh faces.
    const numFaces = dracoGeometry.num_faces();
    const numIndices = numFaces * 3;
    let dataSize;
    let ptr;
    let index;
    const indexType = self[taskConfig.indexType];

    switch (indexType) {
      case Uint16Array:
        dataSize = numIndices * 2;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt16Array(dracoGeometry, dataSize, ptr);
        index = new Uint16Array(draco.HEAPU16.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      case Uint32Array:
        dataSize = numIndices * 4;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt32Array(dracoGeometry, dataSize, ptr);
        index = new Uint32Array(draco.HEAPU32.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      default:
        throw new Error("DRACODecoder: Unexpected index type.");
    }
    geometry.index = { array: index, itemSize: 1 };
  }
  draco.destroy(dracoGeometry);
  return geometry;
}

function decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute) {
  const numComponents = attribute.num_components();
  const numPoints = dracoGeometry.num_points();
  const numValues = numPoints * numComponents;
  let ptr;
  let array;
  let dataSize;
  switch (attributeType) {
    case Float32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_FLOAT32, dataSize, ptr);
      array = new Float32Array(draco.HEAPF32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT8, numValues, ptr);
      array = new Int8Array(draco.HEAP8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT16, dataSize, ptr);
      array = new Int16Array(draco.HEAP16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT32, dataSize, ptr);
      array = new Int32Array(draco.HEAP32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT8, numValues, ptr);
      array = new Uint8Array(draco.HEAPU8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT16, dataSize, ptr);
      array = new Uint16Array(draco.HEAPU16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT32, dataSize, ptr);
      array = new Uint32Array(draco.HEAPU32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    default:
      throw new Error("DRACODecoder: Unexpected attribute type.");
  }

  return {
    name: attributeName,
    array: array,
    itemSize: numComponents
  };
}
`,Tc="https://gw.alipayobjects.com/os/lib/alipay/draco-javascript/1.3.6/lib/",Jx="draco_decoder_gltf.js",ew="draco_decoder_gltf.r3bin",tw="draco_wasm_wrapper_gltf.js",rw=function(){function t(a){if(a===void 0&&(a={type:"wasm",workerLimit:4}),this.pool=[],this.workerLimit=Math.min(navigator.hardwareConcurrency||4,4),this.useJS=void 0,this.currentTaskId=1,this.taskCache=new WeakMap,this.loadLibPromise=void 0,a.workerLimit>this.workerLimit)Vt.warn("DRACOWorkerPool: Can not initialize worker pool with limit:"+a.workerLimit);else{var r;this.workerLimit=(r=a.workerLimit)!=null?r:4}this.useJS=typeof WebAssembly!="object"||a.type==="js",this.loadLibPromise=this.preloadLib()}var i=t.prototype;return i.preloadLib=function(){var r=this;return this.loadLibPromise?this.loadLibPromise:new Promise(function(e,n){r.useJS?Gs(""+Tc+Jx,{type:"text"}).then(function(o){var s=[o,_p].join(`
`),l=URL.createObjectURL(new Blob([s]));e({workerSourceURL:l,decoderWASMBinary:null})}).catch(function(o){n(o)}):Promise.all([Gs(""+Tc+tw,{type:"text"}),Gs(""+Tc+ew,{type:"arraybuffer"})]).then(function(o){var s=o[0],l=o[1],u=[s,_p].join(`
`),c=URL.createObjectURL(new Blob([u]));e({workerSourceURL:c,decoderWASMBinary:l})}).catch(function(o){n(o)})})},i.getWorker=function(){var r=this;return this.preloadLib().then(function(e){if(r.pool.length<r.workerLimit){var n=new Zx(e.workerSourceURL,e.decoderWASMBinary);r.pool.push(n)}else r.pool.sort(function(o,s){return o.currentLoad>s.currentLoad?-1:1});return r.pool[r.pool.length-1]})},i.decode=function(r,e){var n=this,o=JSON.stringify(e);if(this.taskCache.has(r)){var s=this.taskCache.get(r);if(s.key===o)return s.promise;if(r.byteLength===0)throw new Error("DRACODecoder: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var l=this.currentTaskId++,u=r.byteLength,c,f=new Promise(function(d,h){n.getWorker().then(function(_){c=_,_.setCosts(l,u),_.addCurrentLoad(u),_.setCallback(l,d,h),_.decode(l,e,r)}).catch(function(_){h(_)})});return f.finally(function(){c&&l&&c.releaseTask(l)}),this.taskCache.set(r,{key:o,promise:f}),f},t}();function pp(t,i){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);i&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function Xe(t){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?pp(Object(a),!0).forEach(function(r){nw(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):pp(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function gp(t,i){for(var a=0;a<i.length;a++){var r=i[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ao(t,i,a){return i&&gp(t.prototype,i),a&&gp(t,a),t}function nw(t,i,a){return i in t?Object.defineProperty(t,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[i]=a,t}function Mc(){return Mc=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},Mc.apply(this,arguments)}function le(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,Ks(t,i)}function Ks(t,i){return Ks=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},Ks(t,i)}function iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Jn(t,i,a){return iw()?Jn=Reflect.construct:Jn=function(e,n,o){var s=[null];s.push.apply(s,n);var l=Function.bind.apply(e,s),u=new l;return o&&Ks(u,o.prototype),u},Jn.apply(null,arguments)}function oo(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function aw(t,i){if(!!t){if(typeof t=="string")return mp(t,i);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mp(t,i)}}function mp(t,i){(i==null||i>t.length)&&(i=t.length);for(var a=0,r=new Array(i);a<i;a++)r[a]=t[a];return r}function ow(t,i){var a=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(a)return(a=a.call(t)).next.bind(a);if(Array.isArray(t)||(a=aw(t))||i&&t&&typeof t.length=="number"){a&&(t=a);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xr(t,i,a,r,e){var n={};return Object.keys(r).forEach(function(o){n[o]=r[o]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(o,s){return s(t,i,o)||o},n),e&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(e):void 0,n.initializer=void 0),n.initializer===void 0&&(Object.defineProperty(t,i,n),n=null),n}var yp,xp;function sw(t){return/^data:(.+?);base64,/.test(t)}yp=cn(De.Buffer,["bin","r3bin"],!1),yp(xp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e){var n=e.url;return sw(n)?new Ut(function(o){var s=n.slice(13+RegExp.$1.length),l=Uint8Array.from(atob(s),function(u){return u.charCodeAt(0)});o(l.buffer)}):this.request(n,Xe(Xe({},e),{},{type:"arraybuffer"}))},i}(yn));var lt;(function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"})(lt||(lt={}));var zt;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(zt||(zt={}));var Wi;(function(t){t.TRANSLATION="translation",t.ROTATION="rotation",t.SCALE="scale",t.WEIGHTS="weights"})(Wi||(Wi={}));var ji;(function(t){t.Linear="LINEAR",t.Step="STEP",t.CubicSpine="CUBICSPLINE"})(ji||(ji={}));var qs;(function(t){t.PERSPECTIVE="perspective",t.ORTHOGRAPHIC="orthographic"})(qs||(qs={}));var wp;(function(t){t.JPEG="image/jpeg",t.PNG="image/png"})(wp||(wp={}));var so;(function(t){t.OPAQUE="OPAQUE",t.MASK="MASK",t.BLEND="BLEND"})(so||(so={}));var Sp;(function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR"})(Sp||(Sp={}));var Pp;(function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(Pp||(Pp={}));var Ap;(function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.REPEAT=10497]="REPEAT"})(Ap||(Ap={}));var Pe=function(){function t(){}return t.floatBufferToVector2Array=function(a){for(var r=a.length,e=new Array(r/2),n=0;n<r;n+=2)e[n/2]=new G(a[n],a[n+1]);return e},t.floatBufferToVector3Array=function(a){for(var r=a.length,e=new Array(r/3),n=0;n<r;n+=3)e[n/3]=new A(a[n],a[n+1],a[n+2]);return e},t.floatBufferToVector4Array=function(a){for(var r=a.length,e=new Array(r/4),n=0;n<r;n+=4)e[n/4]=new Ee(a[n],a[n+1],a[n+2],a[n+3]);return e},t.decodeText=function(a){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(a);for(var r="",e=0,n=a.length;e<n;e++)r+=String.fromCharCode(a[e]);return decodeURIComponent(encodeURIComponent(r))},t.getAccessorTypeSize=function(a){switch(a){case zt.SCALAR:return 1;case zt.VEC2:return 2;case zt.VEC3:return 3;case zt.VEC4:return 4;case zt.MAT2:return 4;case zt.MAT3:return 9;case zt.MAT4:return 16}},t.getComponentType=function(a){switch(a){case lt.BYTE:return Int8Array;case lt.UNSIGNED_BYTE:return Uint8Array;case lt.SHORT:return Int16Array;case lt.UNSIGNED_SHORT:return Uint16Array;case lt.UNSIGNED_INT:return Uint32Array;case lt.FLOAT:return Float32Array}},t.getAccessorData=function(a,r,e){var n,o=a.bufferViews,s=o[r.bufferView],l=e[s.buffer],u=r.hasOwnProperty("byteOffset")?r.byteOffset:0,c=s.hasOwnProperty("byteOffset")?s.byteOffset:0,f=u+c,d=t.getAccessorTypeSize(r.type),h=d*r.count,_=(n=s.byteStride)!=null?n:0,m=t.getComponentType(r.componentType),v;if(_){var p=d*m.BYTES_PER_ELEMENT;v=new Uint8Array(r.count*p);for(var g=new Uint8Array(l,c,s.byteLength),y=0;y<r.count;y++)for(var x=0;x<p;x++)v[y*p+x]=g[y*_+u+x]}else v=new Uint8Array(l.slice(f,f+h*m.BYTES_PER_ELEMENT));var T=new m(v.buffer);if(r.sparse)for(var w,S,M,P,E=r.sparse,R=E.count,C=E.indices,z=E.values,k=o[C.bufferView],D=o[z.bufferView],H=e[k.buffer],W=e[D.buffer],K=((w=C.byteOffset)!=null?w:0)+((S=k.byteOffset)!=null?S:0),F=k.byteLength,te=((M=z.byteOffset)!=null?M:0)+((P=D.byteOffset)!=null?P:0),B=D.byteLength,V=t.getComponentType(C.componentType),j=new V(H,K,F/V.BYTES_PER_ELEMENT),re=new m(W,te,B/m.BYTES_PER_ELEMENT),se=0;se<R;se++)for(var _e=j[se],de=0;de<d;de++)T[_e*d+de]=re[se*d+de];return T},t.getBufferViewData=function(a,r){var e=a.buffer,n=a.byteOffset,o=n===void 0?0:n,s=a.byteLength,l=r[e];return l.slice(o,o+s)},t.getVertexStride=function(a,r){var e,n=a.bufferViews[(e=r.bufferView)!=null?e:0].byteStride;if(n)return n;var o=t.getAccessorTypeSize(r.type),s=t.getComponentType(r.componentType);return o*s.BYTES_PER_ELEMENT},t.createVertexElement=function(a,r,e){var n=t.getAccessorTypeSize(r.type);return new ve(a,0,t.getElementFormat(r.componentType,n,r.normalized),e)},t.getIndexFormat=function(a){switch(a){case lt.UNSIGNED_BYTE:return Je.UInt8;case lt.UNSIGNED_SHORT:return Je.UInt16;case lt.UNSIGNED_INT:return Je.UInt32}},t.getElementFormat=function(a,r,e){if(e===void 0&&(e=!1),a==lt.FLOAT)switch(r){case 1:return Q.Float;case 2:return Q.Vector2;case 3:return Q.Vector3;case 4:return Q.Vector4}if(a==lt.SHORT)switch(r){case 2:return e?Q.NormalizedShort2:Q.Short2;case 3:case 4:return e?Q.NormalizedShort4:Q.Short4}if(a==lt.UNSIGNED_SHORT)switch(r){case 2:return e?Q.NormalizedUShort2:Q.UShort2;case 3:case 4:return e?Q.NormalizedUShort4:Q.UShort4}if(a==lt.BYTE)switch(r){case 2:case 3:case 4:return e?Q.NormalizedByte4:Q.Byte4}if(a==lt.UNSIGNED_BYTE)switch(r){case 2:case 3:case 4:return e?Q.NormalizedUByte4:Q.UByte4}},t.loadImageBuffer=function(a,r){return new Promise(function(e,n){var o=new window.Blob([a],{type:r}),s=new Image;s.src=URL.createObjectURL(o),s.crossOrigin="anonymous",s.onerror=function(){n(new Error("Failed to load image buffer"))},s.onload=function(){requestAnimationFrame(function(){e(s),s.onload=null,s.onerror=null,s.onabort=null})}})},t.isAbsoluteUrl=function(a){return/^(?:http|blob|data:|\/)/.test(a)},t.parseRelativeUrl=function(a,r){if(t.isAbsoluteUrl(r))return r;var e=r.charAt(0);return e==="."?t._formatRelativePath(r+r):a.substring(0,a.lastIndexOf("/")+1)+r},t.parseGLB=function(a){var r=4,e=1179937895,n=12,o={JSON:1313821514,BIN:5130562},s=new DataView(a),l={magic:s.getUint32(0,!0),version:s.getUint32(r,!0),length:s.getUint32(2*r,!0)};if(l.magic!==e)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+l.magic.toString(16)),null;var u=s.getUint32(n,!0),c=s.getUint32(n+r,!0);if(c!==o.JSON)return console.error("Invalid glb chunk type. Expected 0x4E4F534A, found 0x"+c.toString(16)),null;for(var f=new Uint8Array(a,n+2*r,u),d=JSON.parse(t.decodeText(f)),h=[],_=n+2*r+u;_<l.length;){if(u=s.getUint32(_,!0),c=s.getUint32(_+r,!0),c!==o.BIN)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+c.toString(16)),null;var m=_+2*r,v=a.slice(m,m+u);h.push(v),_+=u+2*r}return{gltf:d,buffers:h}},t._formatRelativePath=function(a){for(var r=a.split("/"),e=0,n=r.length;e<n;e++)r[e]==".."&&(r.splice(e-1,2),e-=2);return r.join("/")},t}(),Ie=function(){function t(){}return t.parseEngineResource=function(a,r,e,n){var o=t._extensionParsers[a];if(o!=null&&o.length){for(var s=arguments.length,l=new Array(s>4?s-4:0),u=4;u<s;u++)l[u-4]=arguments[u];for(var c=0;c<o.length;c++){var f;(f=o[c]).parseEngineResource.apply(f,[r,e,n].concat(l))}}},t.createEngineResource=function(a,r,e){var n=t._extensionParsers[a];if(n!=null&&n.length){for(var o,s=arguments.length,l=new Array(s>3?s-3:0),u=3;u<s;u++)l[u-3]=arguments[u];return(o=n[0]).createEngineResource.apply(o,[r,e].concat(l))}},t.hasExtensionParser=function(a){var r=t._extensionParsers[a];return!!(r!=null&&r.length)},t.initialize=function(a){var r=t._extensionParsers[a];if(r!=null&&r.length)for(var e=0;e<r.length;e++)r[e].initialize()},t._addExtensionParser=function(a,r){t._extensionParsers[a]||(t._extensionParsers[a]=[]),t._extensionParsers[a].push(r)},t}();Ie._extensionParsers={};function ei(t){return function(i){var a=new i;Ie._addExtensionParser(t,a)}}var lw=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parse=function(e){var n=e.gltf,o=e.buffers,s=e.entities,l=n.animations,u=n.accessors;if(!!l){for(var c=l.length,f=new Array(c),d=new Array(c),h=0;h<c;h++){for(var _=l[h],m=_.channels,v=_.samplers,p=_.name,g=p===void 0?"AnimationClip"+h:p,y=new wx(g),x=new Array,T=0;T<v.length;T++){var w,S=v[T],M=u[S.input],P=u[S.output],E=Pe.getAccessorData(n,M,o),R=Pe.getAccessorData(n,P,o),C=R.length/E.length,z=(w=S.interpolation)!=null?w:ji.Linear,k=void 0;switch(z){case ji.CubicSpine:k=kr.CubicSpine;break;case ji.Step:k=kr.Step;break;case ji.Linear:k=kr.Linear;break}E[E.length-1],x.push({type:P.type,interpolation:k,input:E,output:R,outputSize:C})}for(var D=0;D<m.length;D++){for(var H=m[D],W=H.target,K=s[W.node],F="",te=K;te.parent;)F=F===""?""+te.name:te.name+"/"+F,te=te.parent;var B=void 0,V=void 0;switch(W.path){case Wi.TRANSLATION:B=pr,V="position";break;case Wi.ROTATION:B=pr,V="rotation";break;case Wi.SCALE:B=pr,V="scale";break;case Wi.WEIGHTS:B=Ns,V="blendShapeWeights";break}var j=this._addCurve(H,x);y.addCurveBinding(F,B,V,j)}f[h]=y,d[h]={name:g,index:h}}e.animations=f,e._animationsIndices=d}},a._addCurve=function(e,n){var o=new Cx,s=n[e.sampler],l=s.type,u=s.input,c=s.output,f=s.outputSize;o.interpolation=s.interpolation;for(var d=0,h=u.length;d<h;d++){var _=d*f;if(l===zt.SCALAR){var m=f>1?new to:new to;m.time=u[d],m.inTangent=0,m.outTangent=0,m.value=f>1?c.subarray(_,_+f):c[_],o.addKey(m)}if(l===zt.VEC2){var v=new to;v.time=u[d],v.value=new G(c[_],c[_+1]),v.inTangent=new G,v.outTangent=new G,o.addKey(v)}if(l===zt.VEC3){var p=new to;p.time=u[d],p.value=new A(c[_],c[_+1],c[_+2]),p.inTangent=new A,p.outTangent=new A,o.addKey(p)}if(l===zt.VEC4){var g=new to;g.time=u[d],g.value=new pe(c[_],c[_+1],c[_+2],c[_+3]),g.inTangent=new Ee,g.outTangent=new Ee,o.addKey(g)}}return o},i}(Ie),uw=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parse=function(e){var n=e.url,o=e.engine;return this._isGLB(n)?o.resourceManager.load({url:n,type:De.Buffer}).then(Pe.parseGLB).then(function(s){var l=s.gltf,u=s.buffers;e.gltf=l,e.buffers=u}):o.resourceManager.load({url:n,type:De.JSON}).then(function(s){return e.gltf=s,Promise.all(s.buffers.map(function(l){return o.resourceManager.load({type:De.Buffer,url:Pe.parseRelativeUrl(n,l.uri)})})).then(function(l){e.buffers=l})})},a._isGLB=function(e){return e.substring(e.lastIndexOf(".")+1)==="glb"},i}(Ie),Tp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parse=function(e){var n=e.engine,o=e.gltf.nodes;if(!!o){for(var s=[],l=0;l<o.length;l++){var u=o[l],c=u.matrix,f=u.translation,d=u.rotation,h=u.scale,_=new Lr(n,u.name||""+i._defaultName+l),m=_.transform;if(c){var v=m.localMatrix;v.setValueByArray(c),m.localMatrix=v}else f&&m.setPosition(f[0],f[1],f[2]),d&&m.setRotationQuaternion(d[0],d[1],d[2],d[3]),h&&m.setScale(h[0],h[1],h[2]);s[l]=_}e.entities=s,this._buildEntityTree(e),this._createSceneRoots(e)}},a._buildEntityTree=function(e){for(var n=e.gltf.nodes,o=e.entities,s=0;s<n.length;s++){var l=n[s].children,u=o[s];if(l)for(var c=0;c<l.length;c++){var f=o[l[c]];u.addChild(f)}}},a._createSceneRoots=function(e){var n=e.engine,o=e.gltf,s=o.scene,l=s===void 0?0:s,u=o.scenes,c=e.entities;if(!!u){for(var f=[],d=0;d<u.length;d++){var h=u[d].nodes;if(!!h)if(h.length===1)f[d]=c[h[0]];else{for(var _=new Lr(n,"GLTF_ROOT"),m=0;m<h.length;m++)_.addChild(c[h[m]]);f[d]=_}}e.sceneRoots=f,e.defaultSceneRoot=f[l]}},i}(Ie);Tp._defaultName="_GLTF_ENTITY_";var Ec=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}i._parseTextureTransform=function(e,n,o){n===void 0&&(n={});var s=n.KHR_texture_transform;s&&Ie.parseEngineResource("KHR_texture_transform",s,e,o)};var a=i.prototype;return a.parse=function(e){var n=e.gltf,o=e.engine,s=e.textures;if(!!n.materials){for(var l=[],u=0;u<n.materials.length;u++){var c=n.materials[u],f=c.extensions,d=f===void 0?{}:f,h=c.pbrMetallicRoughness,_=c.normalTexture,m=c.occlusionTexture,v=c.emissiveTexture,p=c.emissiveFactor,g=c.alphaMode,y=c.alphaCutoff,x=c.doubleSided,T=c.name,w=T===void 0?"":T,S=d.KHR_materials_unlit,M=d.KHR_materials_pbrSpecularGlossiness,P=null;if(S?P=Ie.createEngineResource("KHR_materials_unlit",S,e):M?P=Ie.createEngineResource("KHR_materials_pbrSpecularGlossiness",M,e):P=new Qn(o),P.name=w,h){var E=h.baseColorFactor,R=h.baseColorTexture,C=h.metallicFactor,z=h.roughnessFactor,k=h.metallicRoughnessTexture;if(E&&(P.baseColor=Jn(ge,E)),R&&(P.baseTexture=s[R.index],i._parseTextureTransform(P,R.extensions,e)),!S&&!M){var D=P;D.metallic=C!=null?C:1,D.roughness=z!=null?z:1,k&&(D.roughnessMetallicTexture=s[k.index],i._parseTextureTransform(P,k.extensions,e))}}if(!S){var H=P;if(v&&(H.emissiveTexture=s[v.index],i._parseTextureTransform(P,v.extensions,e)),p&&(H.emissiveColor=Jn(ge,p)),_){var W=_.index,K=_.scale;H.normalTexture=s[W],i._parseTextureTransform(P,_.extensions,e),K!==void 0&&(H.normalTextureIntensity=K)}if(m){var F=m.index,te=m.strength;H.occlusionTexture=s[F],i._parseTextureTransform(P,m.extensions,e),te!==void 0&&(H.occlusionTextureIntensity=te)}}switch(x?P.renderFace=xn.Double:P.renderFace=xn.Front,g){case so.OPAQUE:P.isTransparent=!1;break;case so.BLEND:P.isTransparent=!0;break;case so.MASK:P.alphaCutoff=y!=null?y:.5;break}l[u]=P}e.materials=l}},i}(Ie),Mp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parse=function(e){var n=this,o=e.engine,s=e.gltf,l=e.buffers;if(!!s.meshes){for(var u=[],c=function(h){for(var _=s.meshes[h],m=[],v=function(y){var x=_.primitives[y],T=x.extensions,w=T===void 0?{}:T,S=w.KHR_draco_mesh_compression;m.push(new Promise(function(M){var P=new jn(o,_.name||y+"");S?Ie.createEngineResource("KHR_draco_mesh_compression",S,e,x).then(function(E){return n._parseMeshFromGLTFPrimitive(P,_,x,s,function(R){for(var C=0;C<E.attributes.length;C++)if(E.attributes[C].name===R)return E.attributes[C].array;return null},function(R,C){throw"BlendShape animation is not supported when using draco."},function(){return E.index.array},o)}).then(M):n._parseMeshFromGLTFPrimitive(P,_,x,s,function(E){var R=x.attributes[E],C=s.accessors[R];return Pe.getAccessorData(s,C,l)},function(E,R){var C=x.targets[R],z=C[E];if(z){var k=s.accessors[z];return Pe.getAccessorData(s,k,l)}else return null},function(){var E=s.accessors[x.indices];return Pe.getAccessorData(s,E,l)},o).then(M)}))},p=0;p<_.primitives.length;p++)v(p);u.push(Promise.all(m))},f=0;f<s.meshes.length;f++)c(f);return Promise.all(u).then(function(d){e.meshes=d})}},a._parseMeshFromGLTFPrimitive=function(e,n,o,s,l,u,c,f){var d=o.attributes,h=o.targets,_=o.indices,m=o.mode,v,p=s.accessors[d.POSITION],g=l("POSITION"),y=Pe.floatBufferToVector3Array(g);e.setPositions(y);var x=e.bounds;if(v=p.count,p.min&&p.max)x.min.setValueByArray(p.min),x.max.setValueByArray(p.max);else{var T=i._tempVector3,w=x.min,S=x.max;w.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var M=g.length/v,P=0;P<v;P++){var E=P*M;T.setValueByArray(g,E),A.min(w,T,w),A.max(S,T,S)}}for(var R in d)if(R!=="POSITION"){var C=l(R);switch(R){case"NORMAL":var z=Pe.floatBufferToVector3Array(C);e.setNormals(z);break;case"TANGENT":var k=Pe.floatBufferToVector4Array(C);e.setTangents(k);break;case"TEXCOORD_0":var D=Pe.floatBufferToVector2Array(C);e.setUVs(D,0);break;case"JOINTS_0":var H=Pe.floatBufferToVector4Array(C);e.setBoneIndices(H);break;case"WEIGHTS_0":var W=Pe.floatBufferToVector4Array(C);e.setBoneWeights(W);break}}if(_!==void 0){var K=s.accessors[_],F=c();e.setIndices(F),e.addSubMesh(0,K.count,m)}else e.addSubMesh(0,v,m);return h&&this._createBlendShape(e,n,h,u),e.uploadData(!0),Promise.resolve(e)},a._createBlendShape=function(e,n,o,s){for(var l=n.extras?n.extras.targetNames:null,u=0,c=o.length;u<c;u++){var f=l?l[u]:"blendShape"+u,d=s("POSITION",u),h=s("NORMAL",u),_=s("TANGENT",u),m=d?Pe.floatBufferToVector3Array(d):null,v=h?Pe.floatBufferToVector3Array(h):null,p=_?Pe.floatBufferToVector3Array(_):null,g=new Ry(f);g.addFrame(1,m,v,p),e.addBlendShape(g)}},i}(Ie);Mp._tempVector3=new A;var Ep=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}i._getDefaultMaterial=function(e){return i._defaultMaterial||(i._defaultMaterial=new Tt(e)),i._defaultMaterial};var a=i.prototype;return a.parse=function(e){var n=e.gltf,o=n.nodes,s=n.cameras,l=e.entities;if(!!o){for(var u=0;u<o.length;u++){var c=o[u],f=c.camera,d=c.mesh,h=c.extensions,_=h===void 0?{}:h,m=_.KHR_lights_punctual,v=l[u];if(f!==void 0&&this._createCamera(e,s[f],v),d!==void 0&&this._createRenderer(e,c,v),m){var p=m.light,g=e.gltf.extensions.KHR_lights_punctual.lights;Ie.parseEngineResource("KHR_lights_punctual",g[p],v,e)}}e.defaultSceneRoot&&this._createAnimator(e)}},a._createCamera=function(e,n,o){var s=n.orthographic,l=n.perspective,u=n.type,c=o.addComponent(I_);if(u===qs.ORTHOGRAPHIC){var f=s.xmag,d=s.ymag,h=s.zfar,_=s.znear;c.isOrthographic=!0,_!==void 0&&(c.nearClipPlane=_),h!==void 0&&(c.farClipPlane=h),c.orthographicSize=Math.max(d!=null?d:0,f!=null?f:0)/2}else if(u===qs.PERSPECTIVE){var m=l.aspectRatio,v=l.yfov,p=l.zfar,g=l.znear;m!==void 0&&(c.aspectRatio=m),v!==void 0&&(c.fieldOfView=v*180/Math.PI),p!==void 0&&(c.farClipPlane=p),g!==void 0&&(c.nearClipPlane=g)}e.cameras||(e.cameras=[]),e.cameras.push(c),c.enabled=!1},a._createRenderer=function(e,n,o){for(var s=e.engine,l=e.gltf.meshes,u=e.meshes,c=e.materials,f=e.skins,d=n.mesh,h=n.skin,_=l[d],m=_.primitives,v=n.weights||_.weights,p=0;p<m.length;p++){var g=u[d][p],y=void 0;if(h!==void 0||v){var x=o.addComponent(Ns);x.mesh=g,h!==void 0&&(x.skin=f[h]),v&&(x.blendShapeWeights=new Float32Array(v)),y=x}else y=o.addComponent($a),y.mesh=g;var T=m[p].material,w=(c==null?void 0:c[T])||i._getDefaultMaterial(s);y.setMaterial(w);var S=m[p].extensions,M=S===void 0?{}:S,P=M.KHR_materials_variants;P&&Ie.parseEngineResource("KHR_materials_variants",P,y,e)}},a._createAnimator=function(e){var n=e.defaultSceneRoot,o=e.animations;if(!!o){var s=n.addComponent(xc),l=new up,u=new wc("layer"),c=new Sc;if(l.addLayer(u),s.animatorController=l,u.stateMachine=c,o)for(var f=0;f<o.length;f++){var d=o[f],h=d.name,_=c.makeUniqueStateName(h);_!==h&&console.warn("AnimatorState name is existed, name: "+h+" reset to "+_);var m=c.addState(_);m.clip=d}}},i}(Ie);Ep._defaultMaterial=void 0;var cw=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parse=function(e){var n=e.gltf,o=e.buffers,s=e.entities,l=e.defaultSceneRoot,u=n.skins;if(!!u){for(var c=[],f=0;f<u.length;f++){var d=u[f],h=d.inverseBindMatrices,_=d.skeleton,m=d.joints,v=d.name,p=v===void 0?"SKIN_"+f:v,g=m.length,y=new by(p);y.inverseBindMatrices.length=g;for(var x=n.accessors[h],T=Pe.getAccessorData(n,x,o),w=0;w<g;w++){var S=new Z;S.setValueByArray(T,w*16),y.inverseBindMatrices[w]=S}for(var M=0;M<g;M++)y.joints[M]=s[m[M]].name;_!==void 0?y.skeleton=s[_].name:y.skeleton=l.name,c[f]=y}e.skins=c}},i}(Ie),bp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parse=function(e){var n=this,o=e.gltf,s=e.buffers,l=e.engine,u=e.url;if(o.textures)return Promise.all(o.textures.map(function(c,f){var d=c.sampler,h=c.source,_=h===void 0?0:h,m=c.name,v=o.images[_],p=v.uri,g=v.bufferView,y=v.mimeType,x=v.name;if(p)return l.resourceManager.load({url:Pe.parseRelativeUrl(u,p),type:De.Texture2D}).then(function(S){return S.name||(S.name=m||x||"texture_"+f),d!==void 0&&n._parseSampler(S,o.samplers[d]),S});var T=o.bufferViews[g],w=Pe.getBufferViewData(T,s);return Pe.loadImageBuffer(w,y).then(function(S){var M=new Ui(l,S.width,S.height);return M.setImageSource(S),M.generateMipmaps(),M.name=m||x||"texture_"+f,d!==void 0&&n._parseSampler(M,o.samplers[d]),M})})).then(function(c){e.textures=c})},a._parseSampler=function(e,n){n.magFilter,n.minFilter;var o=n.wrapS,s=n.wrapT;o&&(e.wrapModeU=i._wrapMap[o]),s&&(e.wrapModeV=i._wrapMap[s])},i}(Ie);bp._wrapMap={33071:St.Clamp,33648:St.Mirror,10497:St.Repeat};var fw=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parse=function(e){var n=e.gltf,o=n.asset.version,s=n.extensionsUsed,l=n.extensionsRequired,u=Number(o);if(!(u>=2&&u<3))throw"Only support gltf 2.x.";if(s)for(var c=0;c<s.length;c++)Ie.hasExtensionParser(s[c])||Vt.warn("Extension "+s[c]+" is not implemented, you can customize this extension in gltf.");if(l)for(var f=0;f<l.length;f++){var d=l[f];Ie.hasExtensionParser(d)&&Ie.initialize(d)}},i}(Ie),bc=function(){function t(a){var r=this;this._pipes=[],a.forEach(function(e,n){r._pipes[n]=new e})}var i=t.prototype;return i.parse=function(r){var e=this,n;return new Promise(function(o,s){e._pipes.forEach(function(l){n?n=n.then(function(){return l.parse(r)}):n=l.parse(r)}),n?n.then(function(){o(r)}).catch(s):o(r)})},t}();bc.instance=new bc([uw,fw,bp,Ec,Mp,Tp,cw,lw,Ep]);var dw=function(t){le(i,t);function i(){for(var a,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return a=t.call.apply(t,[this].concat(e))||this,a.url=void 0,a.gltf=void 0,a.buffers=void 0,a.textures=void 0,a.materials=void 0,a.meshes=void 0,a.skins=void 0,a.animations=void 0,a.entities=void 0,a.cameras=void 0,a.lights=void 0,a.sceneRoots=void 0,a.defaultSceneRoot=void 0,a.variants=void 0,a}return i}(Br),Cp,Rp;Cp=cn(De.Prefab,["gltf","glb"]),Cp(Rp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=e.url;return new Ut(function(s,l){var u=new dw(n.engine);u.url=o,bc.instance.parse(u).then(s).catch(function(c){console.error(c),l("Error loading glTF model from "+o+" .")})})},i}(yn));var zp,Bp;zp=cn(De.JSON,["json"],!1),zp(Bp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e){return this.request(e.url,Xe(Xe({},e),{},{type:"json"}))},i}(yn));var hw=12+13*4,vw=0;function _w(t,i){for(var a=[],r=hw+t.bytesOfKeyValueData,e=t.pixelWidth,n=t.pixelHeight,o=i?t.numberOfMipmapLevels:1,s=0;s<o;s++){var l=new Int32Array(t.buffer,r,1)[0];r+=4;for(var u=0;u<t.numberOfFaces;u++){var c=new Uint8Array(t.buffer,r,l);a.push({data:c,width:e,height:n}),r+=l,r+=3-(l+3)%4}e=Math.max(1,e*.5),n=Math.max(1,n*.5)}return a}function pw(t){if(t.byteLength>=12){var i=new Uint8Array(t,0,12);if(i[0]===171&&i[1]===75&&i[2]===84&&i[3]===88&&i[4]===32&&i[5]===49&&i[6]===49&&i[7]===187&&i[8]===13&&i[9]===10&&i[10]===26&&i[11]===10)return!0}return!1}function gw(t){switch(t){case ie.RGB_S3TC_DXT1_EXT:return ee.DXT1;case ie.RGBA_S3TC_DXT5_EXT:return ee.DXT5;case ie.RGB_ETC1_WEBGL:return ee.ETC1_RGB;case ie.RGB8_ETC2:return ee.ETC2_RGB;case ie.RGB8_PUNCHTHROUGH_ALPHA1_ETC2:return ee.ETC2_RGBA5;case ie.RGBA8_ETC2_EAC:return ee.ETC2_RGBA8;case ie.RGB_PVRTC_2BPPV1_IMG:return ee.PVRTC_RGB2;case ie.RGBA_PVRTC_2BPPV1_IMG:return ee.PVRTC_RGBA2;case ie.RGB_PVRTC_4BPPV1_IMG:return ee.PVRTC_RGB4;case ie.RGBA_PVRTC_4BPPV1_IMG:return ee.PVRTC_RGBA4;case ie.RGBA_ASTC_4X4_KHR:return ee.ASTC_4x4;case ie.RGBA_ASTC_5X5_KHR:return ee.ASTC_5x5;case ie.RGBA_ASTC_6X6_KHR:return ee.ASTC_6x6;case ie.RGBA_ASTC_8X8_KHR:return ee.ASTC_8x8;case ie.RGBA_ASTC_10X10_KHR:return ee.ASTC_10x10;case ie.RGBA_ASTC_12X12_KHR:return ee.ASTC_12x12;default:var i=ie[t];throw new Error("this format is not supported in Oasis Engine: "+i)}}var Lp={parse:function(i,a,r,e){if(e===void 0&&(e=!1),!pw(i))throw new Error("khronosTextureContainerParser: invalid KTX file, texture missing KTX identifier");var n=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(i,12,13*n),s=o.getUint32(0,!0),l=s===67305985,u={buffer:i,glType:o.getUint32(1*n,l),glTypeSize:o.getUint32(2*n,l),glFormat:o.getUint32(3*n,l),glInternalFormat:o.getUint32(4*n,l),glBaseInternalFormat:o.getUint32(5*n,l),pixelWidth:o.getUint32(6*n,l),pixelHeight:o.getUint32(7*n,l),pixelDepth:o.getUint32(8*n,l),numberOfArrayElements:o.getUint32(9*n,l),numberOfFaces:o.getUint32(10*n,l),numberOfMipmapLevels:o.getUint32(11*n,l),bytesOfKeyValueData:o.getUint32(12*n,l),loadType:vw};if(u.glType!==0)throw new Error("only compressed formats currently supported");if(u.numberOfMipmapLevels=Math.max(1,u.numberOfMipmapLevels),u.pixelHeight===0||u.pixelDepth!==0)throw new Error("only 2D textures currently supported");if(u.numberOfArrayElements!==0)throw new Error("texture arrays not currently supported");if(u.numberOfFaces!==a)throw new Error("number of faces expected"+a+", but found "+u.numberOfFaces);return r&&(u.mipmaps=_w(u,!0)),e&&(u.engineFormat=gw(u.glInternalFormat)),u}};function mw(t){var i=Lp.parse(t,1,!0,!0);return{mipmaps:i.mipmaps,engineFormat:i.engineFormat,internalFormat:i.glInternalFormat,width:i.pixelWidth,height:i.pixelHeight}}function yw(t){for(var i=[],a,r,e,n,o=0;o<t.length;o++){var s=Lp.parse(t[o],1,!0,!0);i.push(s.mipmaps),o===0&&(e=s.pixelWidth,n=s.pixelHeight,a=s.glInternalFormat,r=s.engineFormat)}return{mipmapsFaces:i,engineFormat:r,internalFormat:a,width:e,height:n}}var Op,Dp;Op=cn(De.KTXCube,[]),Op(Dp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ut(function(s,l){Promise.all(e.urls.map(function(u){return o.request(u,Xe(Xe({},e),{},{type:"arraybuffer"}))})).then(function(u){for(var c=yw(u),f=c.width,d=c.mipmapsFaces,h=c.engineFormat,_=d[0].length>1,m=new vc(n.engine,f,h,_),v=0;v<6;v++)for(var p=d[v].length,g=0;g<p;g++){var y=d[v][g],x=y.data,T=y.width,w=y.height;m.setPixelBuffer(yr.PositiveX+v,x,g,0,0,T,w)}s(m)}).catch(function(u){l(u)})})},i}(yn));var Fp,Ip;Fp=cn(De.KTX,["ktx"]),Fp(Ip=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ut(function(s,l){o.request(e.url,Xe(Xe({},e),{},{type:"arraybuffer"})).then(function(u){for(var c=mw(u),f=c.width,d=c.height,h=c.mipmaps,_=c.engineFormat,m=h.length>1,v=new Ui(n.engine,f,d,_,m),p=0;p<h.length;p++){var g=h[p],y=g.width,x=g.height,T=g.data;v.setPixelBuffer(T,p,0,0,y,x)}s(v)}).catch(function(u){l(u)})})},i}(yn));var Np,Up;Np=cn(De.Texture2D,["png","jpg","webp","jpeg"]),Np(Up=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ut(function(s,l){o.request(e.url,Xe(Xe({},e),{},{type:"image"})).then(function(u){var c=new Ui(n.engine,u.width,u.height);if(!!c._platformTexture){if(c.setImageSource(u),c.generateMipmaps(),e.url.indexOf("data:")!==0){var f=e.url.split("/");c.name=f[f.length-1]}s(c)}}).catch(function(u){l(u)})})},i}(yn));var kp,Vp;kp=cn(De.TextureCube,[""]),kp(Vp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ut(function(s,l){Promise.all(e.urls.map(function(u){return o.request(u,Xe(Xe({},e),{},{type:"image"}))})).then(function(u){var c=u[0],f=c.width,d=c.height;if(f!==d){console.error("The cube texture must have the same width and height");return}var h=new vc(n.engine,f);if(!!h._platformTexture){for(var _=0;_<6;_++)h.setImageSource(yr.PositiveX+_,u[_],0);h.generateMipmaps(),s(h)}}).catch(function(u){l(u)})})},i}(yn));var Gp,Hp;Gp=cn(De.SpriteAtlas,["atlas"],!1),Gp(Hp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ut(function(s,l){o.request(e.url,Xe(Xe({},e),{},{type:"json"})).then(function(u){var c=u.atlasItems,f=u.format,d=c.length;Promise.all(c.map(function(h){var _=h.img;return o.request(Pe.parseRelativeUrl(e.url,_),Xe(Xe({},e),{},{type:"image"}))})).then(function(h){for(var _=n.engine,m=new oc,v=new G,p=new N_(_),g=0;g<d;g++){var y=h[g],x=y.width,T=y.height,w=new Ui(_,x,T,f);w.setImageSource(y),w.generateMipmaps();for(var S=c[g],M=S.sprites,P=1/x,E=1/T,R=M.length-1;R>=0;R--){var C=M[R],z=C.region,k=C.pivot,D=C.atlasRegionOffset,H=C.atlasRegion,W=C.id,K=new mc(_,w,z?m.setValue(z.x,z.y,z.w,z.h):void 0,k?v.setValue(k.x,k.y):void 0,C.pixelsPerUnit||void 0,C.name);if(K.atlasRegion.setValue(H.x*P,H.y*E,H.w*P,H.h*E),C.atlasRotated&&(K.atlasRotated=!0),D){var F=D.x,te=D.y,B=D.z,V=D.w,j=void 0,re=void 0;C.atlasRotated?(j=1/(F+H.h+B),re=1/(te+H.w+V)):(j=1/(F+H.w+B),re=1/(te+H.h+V)),K.atlasRegionOffset.setValue(F*j,te*re,B*j,V*re)}W!==void 0&&(K._assetID=W),p._addSprite(K)}}s(p)})}).catch(function(u){l(u)})})},i}(yn));var ti=function(){function t(){}var i=t.prototype;return i.initialize=function(){},i.parseEngineResource=function(r,e,n){},i.createEngineResource=function(r,e){return null},t}(),Wp,jp,Xp,Kp;Wp=ei("KHR_draco_mesh_compression"),Wp(jp=(Kp=Xp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.initialize=function(){i._decoder||(i._decoder=new rw)},a.createEngineResource=function(e,n,o){var s=n.gltf,l=n.buffers,u=s.bufferViews,c=s.accessors,f=e.bufferView,d=e.attributes,h={},_={};for(var m in d)h[m]=d[m];for(var v in o.attributes)if(d[v]!==void 0){var p=c[o.attributes[v]];_[v]=Pe.getComponentType(p.componentType).name}var g=c[o.indices],y=Pe.getComponentType(g.componentType).name,x={attributeIDs:h,attributeTypes:_,useUniqueIDs:!0,indexType:y},T=Pe.getBufferViewData(u[f],l);return i._decoder.decode(T,x).then(function(w){return w})},i}(ti),Xp._decoder=void 0,Kp));var qp,Qp;qp=ei("KHR_lights_punctual"),qp(Qp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parseEngineResource=function(e,n,o){var s=e.color,l=e.intensity,u=l===void 0?1:l,c=e.type,f=e.range,d=e.spot,h;if(c==="directional"?h=n.addComponent(Fr):c==="point"?h=n.addComponent(Ir):c==="spot"&&(h=n.addComponent(Xt)),s&&h.color.setValue(s[0],s[1],s[2],1),h.intensity=u,f&&!(h instanceof Fr)&&(h.distance=f),d&&h instanceof Xt){var _=d.innerConeAngle,m=_===void 0?0:_,v=d.outerConeAngle,p=v===void 0?Math.PI/4:v;h.angle=m,h.penumbra=p-m}o.lights||(o.lights=[]),o.lights.push(h)},i}(ti));var Yp,$p;Yp=ei("KHR_materials_pbrSpecularGlossiness"),Yp($p=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.createEngineResource=function(e,n){var o=n.engine,s=n.textures,l=new Yn(o),u=e.diffuseFactor,c=e.diffuseTexture,f=e.specularFactor,d=e.glossinessFactor,h=e.specularGlossinessTexture;return u&&(l.baseColor=Jn(ge,u)),c&&(l.baseTexture=s[c.index],Ec._parseTextureTransform(l,c.extensions,n)),f&&(l.specularColor=Jn(ge,f)),d!==void 0&&(l.glossiness=d),h&&(l.specularGlossinessTexture=s[h.index],Ec._parseTextureTransform(l,h.extensions,n)),l},i}(ti));var Zp,Jp;Zp=ei("KHR_materials_unlit"),Zp(Jp=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.createEngineResource=function(e,n){var o=n.engine,s=new $n(o);return s},i}(ti));var e0,t0;e0=ei("KHR_materials_variants"),e0(t0=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parseEngineResource=function(e,n,o){for(var s=o.gltf.extensions.KHR_materials_variants.variants,l=o.materials,u=e.mappings,c=0;c<u.length;c++){var f=u[c],d=f.material,h=f.variants;o.variants||(o.variants=[]),o.variants.push({renderer:n,material:l[d],variants:h.map(function(_){return s[_].name})})}},i}(ti));var r0,n0;r0=ei("KHR_mesh_quantization"),r0(n0=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}return i}(ti));var i0,a0;i0=ei("KHR_texture_transform"),i0(a0=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.parseEngineResource=function(e,n,o){var s=e.offset;e.rotation;var l=e.scale;e.texCoord,s&&(n.tilingOffset.z=s[0],n.tilingOffset.w=s[1]),l&&(n.tilingOffset.x=l[0],n.tilingOffset.y=l[1])},i}(ti));var xw=function(t){le(i,t);function i(r){var e;return e=t.call(this,r)||this,e._animatorController=void 0,e._speed=1,e._animator=void 0,e._asset=void 0,e._glTFEntity=void 0,e._clipPreview=void 0,e._hasBuiltNode=!1,e._controllerUpdateFlag=void 0,e}var a=i.prototype;return a.init=function(e){var n=e.asset,o=n===void 0?null:n,s=e.speed,l=e.animatorController,u=e.clipPreview,c=e.isClone;if(c){var f=e.gltfRootName;f&&(this._glTFEntity=this.entity.findByName(f))}if(this._glTFEntity)this._hasBuiltNode=!0;else{var d="GLTF-"+Date.now();e.gltfRootName=d,this._glTFEntity=this.entity.createChild(d),this._hasBuiltNode=!1}this.asset=o,this.animatorController=l,this.speed=s,this.clipPreview=u},a.update=function(){if(this._animator){var e;(e=this._controllerUpdateFlag)!==null&&e!==void 0&&e.flag&&this._playState()}},a._onEnable=function(){this._glTFEntity&&(this._glTFEntity.isActive=!0),this.engine._componentsManager.addOnUpdateAnimations(this)},a._onDisable=function(){this._glTFEntity&&(this._glTFEntity.isActive=!1),this.engine._componentsManager.removeOnUpdateAnimations(this)},a._playState=function(){var e=this._clipPreview;if(e){var n;this._animator.play(e,0),(n=this._controllerUpdateFlag)!==null&&n!==void 0&&n.flag&&(this._controllerUpdateFlag.flag=!1)}else this._playDefaultState()},a._playDefaultState=function(){var e=this._animatorController,n=this._animator;if(!!n&&e)for(var o=e.layers,s=0,l=o.length;s<l;++s){var u,c,f,d,h,_=(u=(c=o[s])===null||c===void 0||(f=c.stateMachine)===null||f===void 0?void 0:f._defaultState)!=null?u:(d=o[s])===null||d===void 0||(h=d.stateMachine)===null||h===void 0?void 0:h.states[0],m=_==null?void 0:_.name;if(m){var v;n.play(m,s),(v=this._controllerUpdateFlag)!==null&&v!==void 0&&v.flag&&(this._controllerUpdateFlag.flag=!1)}}},ao(i,[{key:"asset",get:function(){return this._asset},set:function(e){var n=this._animatorController,o=this._speed,s=this._glTFEntity;if(!(e&&e.defaultSceneRoot===this._glTFEntity)){if(!this._hasBuiltNode&&(s.clearChildren(),e!==null)){s==null||s.destroy();var l=e.defaultSceneRoot.clone();this._animator=l.getComponent(xc),this.entity.addChild(l),l.isActive=this.enabled,this._glTFEntity=l}n&&(this._animator.animatorController=n,this._animator.speed=o,this._playState()),this._asset=e}}},{key:"animatorController",get:function(){return this._animatorController},set:function(e){var n=this._animator;e!==this._animatorController&&(this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e,n&&(n.animatorController=e,this._playState()))}},{key:"speed",get:function(){return this._speed},set:function(e){var n=this._animator;this._speed=e,n&&(n.speed=e,this._playState())}},{key:"animator",get:function(){return this._animator}},{key:"clipPreview",get:function(){return this._clipPreview},set:function(e){this._animator&&(e?this._animator.play(e,0):this._playDefaultState()),this._clipPreview=e}}]),i}(Jt),o0=function(t){le(i,t);function i(r){var e;return e=t.call(this,r)||this,e._props=null,e.setMaterial(new Tt(e.engine)),e}var a=i.prototype;return a.setProps=function(e){switch(e===void 0&&(e={}),this._props!==e&&(this._props=e),e.geometryType){case"Sphere":this.mesh=ki.createSphere(this._engine,e.sphereRadius,e.sphereSegments);break;case"Cylinder":this.mesh=ki.createCylinder(this._engine,e.cylinderRadiusTop,e.cylinderRadiusBottom,e.cylinderHeight,e.cylinderRadialSegments,e.cylinderHeightSegments);break;case"Plane":this.mesh=ki.createPlane(this._engine,e.planeWidth,e.planeHeight,e.planeHorizontalSegments,e.planeVerticalSegments);break;case"Box":this.mesh=ki.createCuboid(this._engine,e.boxWidth,e.boxHeight,e.boxDepth);break}},a.updateProp=function(e,n){var o=this._props;o[e]=n,this.setProps(o)},ao(i,[{key:"material",get:function(){return this.getMaterial()},set:function(e){this.setMaterial(e)}}]),i}($a),ww=function(){function t(){this.registeredPlugins=new Set,this.plugins=[]}var i=t.prototype;return i.register=function(r){this.registeredPlugins.add(r)},i.boot=function(r){for(var e=ow(this.registeredPlugins.values()),n;!(n=e()).done;){var o=n.value;typeof o=="function"&&(o=o(r)),this.plugins.push(o)}},i.reset=function(){this.registeredPlugins.clear(),this.plugins=[]},i.nodeAdded=function(r){this.delegateMethod("nodeAdded",r)},i.delegateMethod=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.plugins.forEach(function(s){return s[r]&&s[r].apply(s,n)})},t}();function wr(t){return function(i,a,r){var e=r.value;r.value=function(){for(var n,o=this,s=arguments.length,l=new Array(s),u=0;u<s;u++)l[u]=arguments[u];return t.before&&(n=this.oasis.pluginManager).delegateMethod.apply(n,[t.before].concat(l)),Promise.resolve(e.apply(this,arguments)).then(function(c){return t.after&&o.oasis.pluginManager.delegateMethod(t.after,c),c})}}}function Sw(t){for(var i=t.abilities,a=i===void 0?{}:i,r=t.assets,e=r===void 0?{}:r,n=t.scene,o=n===void 0?{}:n,s=Object.keys(a),l=Object.keys(e),u=Object.keys(o||{}),c=0,f=s.length;c<f;++c)Pw(a[s[c]].props);for(var d=0,h=l.length;d<h;++d)Tw(e[l[d]].props);for(var _=0,m=u.length;_<m;++_)Aw(o[u[_]].props);return t}function Pw(t){for(var i=Object.keys(t),a=0,r=i.length;a<r;++a){var e=i[a],n=t[e];Array.isArray(n)&&typeof n[0]!="object"&&(["color","diffuseColor","specularColor"].indexOf(e)!==-1?t[e]=new ge(n[0],n[1],n[2],n[3]):n.length===4?t[e]=new Ee(n[0],n[1],n[2],n[3]):n.length===3?t[e]=new A(n[0],n[1],n[2]):n.length===2&&(t[e]=new G(n[0],n[1])))}}var s0=new Gm;function Aw(t){for(var i=Object.keys(t),a=0,r=i.length;a<r;++a){var e=i[a],n=t[e];Array.isArray(n)&&typeof n[0]!="object"?/color/i.test(e)?t[e]=new ge(n[0],n[1],n[2],n[3]):n.length===4?t[e]=new Ee(n[0],n[1],n[2],n[3]):n.length===3?t[e]=new A(n[0],n[1],n[2]):n.length===2&&(t[e]=new G(n[0],n[1])):n&&e==="diffuseSphericalHarmonics"&&(s0.setValueByArray(JSON.parse(n)),t[e]=s0)}}function Tw(t){if(t===void 0&&(t={}),!!t)for(var i=Object.keys(t),a=0,r=i.length;a<r;a++){var e=i[a],n=t[e];e==="newMaterial"||e==="scripts"||Array.isArray(n)&&typeof n[0]!="object"&&(["emissiveColor","diffuseColor","specularColor","baseColor"].indexOf(e)!==-1?t[e]=new ge(n[0],n[1],n[2],n[3]):n.length===4?t[e]=new Ee(n[0],n[1],n[2],n[3]):n.length===3?t[e]=new A(n[0],n[1],n[2]):n.length===2&&(t[e]=new G(n[0],n[1])))}}var l0=3,lo=function(){var t=i.prototype;t.parse=function(r){var e;if((r==null||(e=r.config)===null||e===void 0?void 0:e.version)!==l0){var n;console.warn('schema-parser: schema version "'+(r==null||(n=r.config)===null||n===void 0?void 0:n.version)+'" is out of date, please re-pull the latest version (version '+l0+") of the schema")}return Sw(r.config),Fw.create(r,this.pluginManager)},t.register=function(r){this.pluginManager.register(r)},t.resetPlugins=function(){this.pluginManager.reset()};function i(){this.pluginManager=new ww}return i.create=function(){var r=new i;return r},i.registerComponents=function(r,e){this._components[r]||(this._components[r]={}),Mc(this._components[r],e)},i}();lo._components={};lo.create();function u0(t,i,a){if(!(i===a||a===null||a===void 0)){var r=[t[a],t[i]];t[i]=r[0],t[a]=r[1]}}function ir(t){return t&&t.type==="asset"}function Xi(t){for(var i=[],a=Object.getPrototypeOf(t),r=Object.getOwnPropertyDescriptors(a),e=0,n=Object.entries(r);e<n.length;e++){var o=n[e],s=o[0],l=o[1];typeof l.get=="function"&&i.push(s)}return i}var Bt=function(){var t=i.prototype;t.setMeta=function(){};function i(a,r){this.resourceManager=a,this._resource=r,this._meta={},this._attachedResources=[],this.setMeta()}return t.loadWithAttachedResources=function(r,e,n){var o=this;return new Promise(function(s,l){o.load(r,e,n).then(function(){s({resources:[o],structure:{index:0,props:{}}})}).catch(function(u){l(u)})})},t.getProps=function(){return{}},t.bind=function(){},t.attach=function(){},t.update=function(r,e){if(ir(e)){var n=this.resourceManager.get(e.id);n?this._resource[r]=n.resource:Vt.warn("SchemaResource: "+this.meta.name+" can't find asset, which id is: "+e.id)}else this._resource[r]=e},t.updateMeta=function(r,e){this._meta[r]=e},t.onDestroy=function(){},ao(i,[{key:"resource",get:function(){return this._resource}},{key:"meta",get:function(){return this._meta}},{key:"attachedResources",get:function(){return this._attachedResources}}]),i}(),c0=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){o._resource=n.props||{},o.setMeta(),s(o)})},a.loadWithAttachedResources=function(e,n){var o=this;return new Promise(function(s,l){var u;n.props?u=o.load(e,n):l("Load AnimationClip Error"),u&&u.then(function(){var c={resources:[o],structure:{index:0,props:{}}};s(c)})})},a.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},a.getProps=function(){return this._resource},i}(Bt),f0=function(t){le(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.gltf=void 0,r.animatorControllerData=void 0,r.animationClipAssets=void 0,r.animationsIndices=void 0,r}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){var l=n.props||{},u=l.animatorController,c=l.animationClips,f=l.animationsIndices,d=l.gltf;o._resource=new up,o.animatorControllerData=u,o.animationsIndices=f||[],o.animationClipAssets=c||[],o.gltf=d,!u&&o._setDefaultDataByAnimationClip(),o.setMetaData("name",n.name),s(o)})},a.loadWithAttachedResources=function(e,n){var o=this;return new Promise(function(s,l){var u=[];o.load(e,n).then(function(){for(var c={resources:[o],structure:{index:0,props:{animationClips:[]}}},f=o.animationsIndices,d=0,h=f.length;d<h;++d){var _=f[d],m=new c0(o.resourceManager);o.attachedResources.push(m),u.push(m.loadWithAttachedResources(e,{type:"animationClip",name:_.name,props:_}))}Promise.all(u).then(function(v){var p=c.structure.props.animationClips;v.forEach(function(g){var y=g.structure,x=g.resources[y.index];c.resources.push(x),y.index=c.resources.length-1,p.push(y)}),s(c)})})})},a.setMetaData=function(e,n){this._meta[e]=n},a.update=function(e,n){this._initAnimatorController(n)},a.bind=function(){var e=this.animatorControllerData,n=this.animationClipAssets;this._bindClips(n),e?this._initAnimatorController(e):this._setDefaultDataByAnimationClipAsset()},a._initAnimatorController=function(e){var n=this.gltf||{},o=n.animations,s=e.layers;if(!(!o||!s)){this._resource.clearLayers();for(var l=0,u=s.length;l<u;++l){var c=s[l],f=c.name,d=c.blending,h=c.weight,_=c.stateMachine;if(!!_){var m=new wc(f);m.blendingMode=d,m.weight=h;for(var v=_.states,p=new Sc,g=[],y=0,x=v.length;y<x;++y){var T=v[y],w=T.name,S=T.transitions,M=T.clip,P=T.speed,E=T.wrapMode,R=T.clipStartNormalizedTime,C=T.clipEndNormalizedTime,z=T.isDefaultState,k=M||{},D=k.id;if(!!D){var H=p.makeUniqueStateName(w);H!==w&&console.warn("AnimatorState name is existed, name: "+w+" reset to "+H);var W=p.addState(H);W.speed=P,W.wrapMode=E;var K=this.resourceManager.get(D).resource,F=o[K.index];if(!!F){W.clip=F,W.clipStartTime=F.length*R,W.clipEndTime=F.length*C;for(var te=0,B=S.length;te<B;++te){var V=S[te];S[te].srcState=W,g.push(V)}z&&(p._defaultState=W)}}}for(var j=0,re=g.length;j<re;++j){var se=g[j],_e=new J_;_e.duration=se.duration,_e.offset=se.offset,_e.exitTime=se.exitTime,_e.destinationState=p.findStateByName(se.targetStateName),se.srcState.addTransition(_e),delete se.srcState}m.stateMachine=p,this._resource.addLayer(m)}}}},a._bindClips=function(e){for(var n=0,o=e.length;n<o;n++){var s=e[n],l=this.resourceManager.get(s.id);l?this._attachedResources.push(l):""+this.meta.name+s.id}},a._setDefaultDataByAnimationClipAsset=function(){var e=this.animationClipAssets;if(!!e.length){for(var n=[],o=0,s=e.length;o<s;o++){var l=this.resourceManager.get(e[o].id);n.push(l.resource)}this.animationsIndices=n,this._setDefaultDataByAnimationClip()}},a._setDefaultDataByAnimationClip=function(){var e=this.animationsIndices,n=this._resource,o=this.gltf;if(!(!e.length||!o)){var s=o.animations,l=new wc("layer"),u=new Sc;n.addLayer(l),l.stateMachine=u;for(var c=0,f=e.length;c<f;c++){var d=e[c],h=d.name,_=d.index,m=u.makeUniqueStateName(h);m!==h&&console.warn("AnimatorState name is existed, name: "+h+" reset to "+m);var v=u.addState(m);v.clip=s[_]}}},i}(Bt),ar=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n,o){var s=this;return new Promise(function(l,u){var c,f,d,h,_=De.Texture2D;if(s.resourceManager.useCompressedTexture&&n!==null&&n!==void 0&&(c=n.props)!==null&&c!==void 0&&(f=c.compression)!==null&&f!==void 0&&f.compressions.length)for(var m=o.engine._hardwareRenderer,v=n.props.compression.compressions,p=0;p<v.length;p++){var g=v[p];if(g.container==="ktx"&&m.canIUse(X[g.type])){h=g.url,_=De.KTX;break}}h=(d=h)!=null?d:n.url,e.load({url:h,type:_}).then(function(y){s._resource=y,l(s)}).catch(function(y){u(y)})})},a.setMeta=function(){this.resource&&(this._meta.name=this.resource.name)},i}(Bt),d0=function(t){le(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.configProps=void 0,r}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){var l=new Tt(e.engine);o.configProps=n.props,o._resource=l;for(var u in o.configProps)ir(o.configProps[u])||(l[u]=o.configProps[u]);o.setMeta(),s(o)})},a.loadWithAttachedResources=function(e,n){var o=this;return new Promise(function(s,l){var u;n.resource instanceof Tt?u=new Promise(function(c){o._resource=n.resource,o.setMeta(),c(o)}):n.props?u=o.load(e,n):l("Load BlinnPhongMaterial Error"),u&&u.then(function(){var c={resources:[o],structure:{index:0,props:{}}},f=o._resource;Xi(o._resource).forEach(function(d){if(f[d]instanceof tr){var h=new ar(o.resourceManager,f[d]);o.attachedResources.push(h),c.resources.push(h),c.structure.props[d]={index:c.resources.length-1}}}),s(c)})})},a.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},a.bind=function(){var e=this,n=this._resource;Object.keys(this.configProps).forEach(function(o){var s=e.configProps[o];if(ir(s)){var l=e.resourceManager.get(s.id);l&&l instanceof ar?(n[o]=l.resource,e._attachedResources.push(l)):(n[o]=null,Vt.warn("BlinnPhongMaterialResource: "+e.meta.name+` can't find asset "`+o+'", which id is: '+s.id))}else n[o]=s})},i}(Bt),h0=["metallic","roughness","roughnessMetallicTexture","tilingOffset","baseColor","normalTextureIntensity","emissiveColor","occlusionTextureIntensity","baseTexture","normalTexture","emissiveTexture","occlusionTexture","isTransparent","alphaCutoff","renderFace","blendMode"],v0=function(t){le(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.configProps=void 0,r}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){var l=new Qn(e.engine);o.configProps=n.props;for(var u in o.configProps)ir(o.configProps[u])||(l[u]=o.configProps[u]);o._resource=l,o.setMeta(),s(o)})},a.loadWithAttachedResources=function(e,n){var o=this;return new Promise(function(s,l){var u;n.resource instanceof Qn?u=new Promise(function(c){o._resource=n.resource,o.setMeta(),c(o)}):n.props?u=o.load(e,n):l("Load PBRMaterial Error"),u&&u.then(function(){var c={resources:[o],structure:{index:0,props:{}}},f=o._resource;h0.forEach(function(d){if(f[d]instanceof tr){var h=new ar(o.resourceManager,f[d]);o.attachedResources.push(h),c.resources.push(h),c.structure.props[d]={index:c.resources.length-1}}}),s(c)})})},a.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},a.getProps=function(){var e=this,n={};return h0.forEach(function(o){return n[o]=e.resource[o]}),n},a.bind=function(){var e=this,n=this._resource;Object.keys(this.configProps).forEach(function(o){var s=e.configProps[o];if(ir(s)){var l=e.resourceManager.get(s.id);l&&l instanceof ar?(n[o]=l.resource,e._attachedResources.push(l)):(n[o]=null,Vt.warn("PBRMaterialResource: "+e.meta.name+` can't find asset "`+o+'", which id is: '+s.id))}else n[o]=s})},i}(Bt),Mw=["specularColor","glossiness","specularGlossinessTexture","tilingOffset","baseColor","normalTextureIntensity","emissiveColor","occlusionTextureIntensity","baseTexture","normalTexture","emissiveTexture","occlusionTexture","isTransparent","alphaCutoff","renderFace","blendMode"],_0=function(t){le(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.configProps=void 0,r}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){var l=new Yn(e.engine);o.configProps=n.props,o._resource=l;for(var u in o.configProps)ir(o.configProps[u])||(l[u]=o.configProps[u]);o.setMeta(),s(o)})},a.loadWithAttachedResources=function(e,n){var o=this;return new Promise(function(s,l){var u;n.resource instanceof Yn?u=new Promise(function(c){o._resource=n.resource,o.setMeta(),c(o)}):n.props?u=o.load(e,n):l("Load PBRSpecularMaterial Error"),u&&u.then(function(){var c={resources:[o],structure:{index:0,props:{}}},f=o._resource;Object.keys(o._resource).forEach(function(d){if(f[d]instanceof tr){var h=new ar(o.resourceManager,f[d]);o.attachedResources.push(h),c.resources.push(h),c.structure.props[d]={index:c.resources.length-1}}}),s(c)})})},a.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},a.getProps=function(){var e=this,n={};return Mw.forEach(function(o){return n[o]=e.resource[o]}),n},a.bind=function(){var e=this,n=this._resource;Object.keys(this.configProps).forEach(function(o){var s=e.configProps[o];if(ir(s)){var l=e.resourceManager.get(s.id);l&&l instanceof ar?(n[o]=l.resource,e._attachedResources.push(l)):(n[o]=null,Vt.warn("PBRSpecularMaterialResource: "+e.meta.name+` can't find asset "`+o+'", which id is: '+s.id))}else n[o]=s})},i}(Bt),p0=function(t){le(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.configProps=void 0,r}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){var l=new $n(e.engine);o.configProps=n.props;for(var u in o.configProps)ir(o.configProps[u])||(l[u]=o.configProps[u]);o._resource=l,o.setMeta(),s(o)})},a.loadWithAttachedResources=function(e,n){var o=this;return new Promise(function(s,l){var u;n.resource instanceof $n?u=new Promise(function(c){o._resource=n.resource,o.setMeta(),c(o)}):n.props?u=o.load(e,n):l("Load PBRMaterial Error"),u&&u.then(function(){var c={resources:[o],structure:{index:0,props:{}}},f=o._resource;Xi(o._resource).forEach(function(d){if(f[d]instanceof tr){var h=new ar(o.resourceManager,f[d]);o.attachedResources.push(h),c.resources.push(h),c.structure.props[d]={index:c.resources.length-1}}}),s(c)})})},a.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},a.getProps=function(){var e=this,n={},o=Xi(this.resource);return o.forEach(function(s){return n[s]=e.resource[s]}),n},a.bind=function(){var e=this,n=this._resource;Object.keys(this.configProps).forEach(function(o){var s=e.configProps[o];if(ir(s)){var l=e.resourceManager.get(s.id);l&&l instanceof ar?(n[o]=l.resource,e._attachedResources.push(l)):(n[o]=null,Vt.warn("PBRMaterialResource: "+e.meta.name+` can't find asset "`+o+'", which id is: '+s.id))}else n[o]=s})},i}(Bt),Ew=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n,o){var s=this;return e.load({url:n.url,type:De.Prefab}).then(function(l){var u=l;n.props&&(u.newMaterial=n.props.newMaterial,u.animatorControllers=n.props.animatorControllers),s._resource=u})},a.loadWithAttachedResources=function(e,n,o){var s=this;return new Promise(function(l){s.load(e,n,o).then(function(){var u=s.resource,c=u.materials,f=c===void 0?[]:c,d=u._animationsIndices,h=d===void 0?[]:d,_=[],m,v={resources:[s],structure:{index:0,props:{newMaterial:[],animatorControllers:[]}}};if(f!=null&&f.length)for(var p=0;p<f.length;p++){var g=f[p],y=null,x="";g instanceof Qn?(y=new v0(s.resourceManager),x="PBRMaterial"):g instanceof $n?(y=new p0(s.resourceManager),x="UnlitMaterial"):g instanceof Yn?(y=new _0(s.resourceManager),x="PBRSpecularMaterial"):(y=new d0(s.resourceManager),x="BlinnPhongMaterial"),s._attachedResources.push(y),_.push(y.loadWithAttachedResources(e,{type:x,name:g.name,resource:g}))}if(h.length){var T=new f0(s.resourceManager);s._attachedResources.push(T),m=T.loadWithAttachedResources(e,{type:"animatorController",name:"AnimatorController",props:{animationsIndices:h,gltf:s._resource}})}var w=Promise.all(_).then(function(M){var P=v.structure.props.newMaterial;M.forEach(function(E){var R=E.structure,C=E.resources[R.index];v.resources.push(C),R.index=v.resources.length-1;for(var z in R.props)if(R.props.hasOwnProperty(z)){var k=R.props[z],D=E.resources[k.index];v.resources.push(D),k.index=v.resources.length-1}P.push(R)})}),S=m?m.then(function(M){var P=v.structure.props.animatorControllers,E=M.structure,R=M.resources[E.index];v.resources.push(R),E.index=v.resources.length-1;var C=E.props.animationClips;if(C)for(var z=0,k=C.length;z<k;++z){var D=C[z],H=M.resources[D.index];v.resources.push(H),D.index=v.resources.length-1}P.push(E)}):Promise.resolve();Promise.all([w,S]).then(function(){l(v)})})})},a.setMeta=function(e){e&&(this.meta.name=e.name)},a.bind=function(){var e=this._resource;this.bindMaterials(e.newMaterial),this.bindAnimatorControllers(e.animatorControllers)},a.update=function(e,n){e==="newMaterial"?this.bindMaterials(n):this._resource[e]=n},a.bindMaterials=function(e){var n=e.length;if(!(!e||!e.length)){var o=this._resource,s=new Array(n);o.newMaterial=s;for(var l=0;l<e.length;l++){var u=this.resourceManager.get(e[l].id);u?(this._attachedResources.push(u),s[l]=u.resource):Vt.warn("GLTFResource: "+this.meta.name+` can't find asset "material", which id is: `+e[l].id)}for(var c=o.defaultSceneRoot,f=o.materials,d=c.getComponentsIncludeChildren($a,[]),h=0;h<n;h++)for(var _=s[h],m=f[h],v=0;v<d.length;v++)for(var p=d[v],g=p.getMaterials(),y=0;y<g.length;y++)m===g[y]&&p.setMaterial(y,_)}},a.bindAnimatorControllers=function(e){for(var n=0,o=e.length;n<o;n++){var s=e[n],l=this.resourceManager.get(s.id);l.gltf=this._resource,l?this._attachedResources.push(l):""+this.meta.name+s.id}},i}(Bt),Qs={},bw=function(t){le(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.isInit=!1,r}var a=i.prototype;return a.initScriptContext=function(){this.isInit||(this.isInit=!0,window.__o3_script_context__={o3:lo._components.o3,script:function(n){return function(o){Qs[n]=o}}})},a.load=function(e,n,o){var s=this;return this.initScriptContext(),new Promise(function(l){var u=n,c=u.props.scripts;if(s.resourceManager.isLocal){for(var d=0;d<c.length;d++){var h,_=c[d].name;Qs[_]=(h=o.options)===null||h===void 0?void 0:h.scripts[_]}l(s)}else{var f=document.createElement("script");f.crossOrigin="anonymous",s.setMeta(n),f.onload=function(){for(var m=window.o3Scripts,v=0;v<c.length;v++){var p=c[v].name;s._resource=m&&m[p],Qs[p]=s._resource}l(s)},f.src=n.url,document.body.appendChild(f)}})},a.setMeta=function(e){e&&(this._meta.name=e.name,this._meta.url=e.url,this._meta.source=e.source)},i}(Bt),g0=function(t){le(i,t);function i(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.configProps=void 0,r}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){var l=new mc(e.engine);o.configProps=n.props;var u=o.configProps,c=u.pivotType,f=u.pivot;if(typeof f!="undefined"&&typeof c!="undefined"&&c!==Kt.Custom)switch(c){case Kt.Center:f.x=.5,f.y=.5;break;case Kt.TopLeft:f.x=0,f.y=1;break;case Kt.Top:f.x=.5,f.y=1;break;case Kt.TopRight:f.x=1,f.y=1;break;case Kt.Left:f.x=0,f.y=.5;break;case Kt.Right:f.x=1,f.y=.5;break;case Kt.BottomLeft:f.x=0,f.y=0;break;case Kt.Bottom:f.x=.5,f.y=0;break;case Kt.BottomRight:f.x=1,f.y=0;break}for(var d in u)!ir(u[d])&&typeof u[d]!="undefined"&&(l[d]=u[d]);o._resource=l,o.setMeta(),s(o)})},a.loadWithAttachedResources=function(e,n){var o=this;return new Promise(function(s,l){var u;n.resource instanceof i?u=new Promise(function(c){o._resource=n.resource,o.setMeta(),c(o)}):n.props?u=o.load(e,n):l("Load Sprite Error"),u&&u.then(function(){var c={resources:[o],structure:{index:0,props:{}}},f=o._resource;Xi(o._resource).forEach(function(d){if(f[d]instanceof tr){var h=new ar(o.resourceManager,f[d]);o.attachedResources.push(h),c.resources.push(h),c.structure.props[d]={index:c.resources.length-1}}}),s(c)})})},a.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},a.getProps=function(){var e=this,n={},o=Xi(this.resource);return o.forEach(function(s){return n[s]=e.resource[s]}),n},a.bind=function(){var e=this,n=this._resource;this.configProps&&Object.keys(this.configProps).forEach(function(o){var s=e.configProps[o];if(ir(s)){var l=e.resourceManager.get(s.id);l&&l instanceof ar?(n[o]=l.resource,e._attachedResources.push(l)):(n[o]=null,Vt.warn("SpriteResource: "+e.meta.name+` can't find asset "`+o+'", which id is: '+s.id))}else n[o]=s})},i}(Bt),Kt;(function(t){t[t.Center=0]="Center",t[t.TopLeft=1]="TopLeft",t[t.Top=2]="Top",t[t.TopRight=3]="TopRight",t[t.Left=4]="Left",t[t.Right=5]="Right",t[t.BottomLeft=6]="BottomLeft",t[t.Bottom=7]="Bottom",t[t.BottomRight=8]="BottomRight",t[t.Custom=9]="Custom"})(Kt||(Kt={}));var m0={px:0,nx:1,py:2,ny:3,pz:4,nz:5},Cw=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n,o){var s=this;return new Promise(function(l,u){var c,f,d=[],h=De.TextureCube;if(s.resourceManager.useCompressedTexture&&n!==null&&n!==void 0&&(c=n.props)!==null&&c!==void 0&&(f=c.compression)!==null&&f!==void 0&&f.compressions.length)for(var _=o.engine._hardwareRenderer,m=n.props.compression.compressions,v=0;v<m.length;v++){var p=m[v];if(p.container==="ktx"&&_.canIUse(X[p.type])){for(var g in p.files)if(p.files.hasOwnProperty(g)){var y=p.files[g];d[m0[g]]=y.url}console.warn(p.type),h=De.KTXCube;break}}if(h===De.TextureCube){for(var x in n.props.images)if(n.props.images.hasOwnProperty(x)){var T=n.props.images[x];d[m0[x]]=T.url}}e.load({urls:d,type:h}).then(function(w){s._resource=w,l(s)}).catch(function(w){u(w)})})},a.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},i}(Bt),Rw=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){o._resource=n,o.setMetaData("name",o.resource.name),o.setMetaData("url",o.resource.url),s(o)})},a.setMetaData=function(e,n){this._meta[e]=n},i}(Bt),y0,x0,w0,or,zw=(y0=wr({after:"abilityAdded",before:"beforeAbilityAdded"}),x0=wr({before:"beforeAbilityUpdated",after:"abilityUpdated"}),w0=wr({after:"abilityDeleted",before:"beforeAbilityDeleted"}),or=function(){function t(a){this.oasis=a,this.abilityMap={}}var i=t.prototype;return i.add=function(r){var e=r.type,n=r.node,o=r.props,s=r.id,l=r.index,u=this.oasis.nodeManager.get(n),c=this.getCompConstructor(e);if(!!c){var f=this.mixPropsToExplicitProps(o),d=u.addComponent(c),h=f.enabled;if(h!==void 0&&(d.enabled=h),e==="GLTFModel")d.init(f);else if(e==="Model")d.setProps(f),f.material&&(d.material=f.material);else for(var _ in f)f[_]!==null&&(d[_]=f[_]);var m=u._components,v=m.length-1;return u0(m,v,l),d.id=s,this.abilityMap[s]=d,d}},i.update=function(r,e,n){return n&&this.checkIsAsset(n)?this.get(r)[e]=this.oasis.resourceManager.get(n.id).resource:this.get(r).constructor===o0?this.get(r).updateProp(e,n):this.get(r)[e]=n,{id:r,key:e,value:n}},i.addRuntimeComponent=function(r,e){return e.id=r,this.abilityMap[r]=e,e},i.get=function(r){return this.abilityMap[r]},i.delete=function(r){var e=this.abilityMap[r];return e.destroy(),delete this.abilityMap[r],r},i.getCompConstructor=function(r){var e=r.split(".");if(e[0]==="script")return Qs[e[1]];var n=lo._components.o3[r];return n||console.warn(r+" is not defined"),n},i.mixPropsToExplicitProps=function(r){var e=Xe({},r);for(var n in r){var o=r[n];if(o&&this.checkIsAsset(o)){var s=this.oasis.resourceManager.get(o.id);s?e[n]=s.resource:(e[n]=null,Vt.warn(`AbilityManager: can't get asset "`+n+'", which id is '+o.id))}}return e},i.checkIsAsset=function(r){return r.type==="asset"},t}(),xr(or.prototype,"add",[y0],Object.getOwnPropertyDescriptor(or.prototype,"add"),or.prototype),xr(or.prototype,"update",[x0],Object.getOwnPropertyDescriptor(or.prototype,"update"),or.prototype),xr(or.prototype,"delete",[w0],Object.getOwnPropertyDescriptor(or.prototype,"delete"),or.prototype),or),S0,P0,A0,sr,Bw=(S0=wr({after:"nodeAdded"}),P0=wr({before:"beforeNodeUpdated",after:"nodeUpdated"}),A0=wr({before:"beforeNodeDeleted"}),sr=function(){function t(a){this.oasis=a,this.nodeMap={},this.root=void 0,this.root=new Lr(this.oasis.engine,"root")}var i=t.prototype;return i.addRootEntity=function(){this.oasis.engine.sceneManager.activeScene.addRootEntity(this.root)},i.add=function(r){return this.create(r),this.append(r.id,r.parent,r.index),this.get(r.id)},i.update=function(r,e,n){return this.get(r)[e]=n,{id:r,key:e,value:n}},i.get=function(r){return this.nodeMap[r]},i.reset=function(){this.nodeMap={}},i.delete=function(r){this.nodeMap[r].destroy(),delete this.nodeMap[r]},i.create=function(r){var e=r.isActive,n=r.position,o=r.rotation,s=r.scale,l=r.id,u=r.name,c=new Lr(this.oasis.engine,u);return c.isActive=e,c.transform.position=new A(n[0],n[1],n[2]),c.transform.rotation=new A(o[0],o[1],o[2]),c.transform.scale=new A(s[0],s[1],s[2]),c.id=l,this.nodeMap[l]=c,c},i.append=function(r,e,n){var o=this.nodeMap[r],s=this.nodeMap[e]||this.root;s.addChild(o);var l=s._children,u=l.length-1;u0(l,u,n)},t}(),xr(sr.prototype,"add",[S0],Object.getOwnPropertyDescriptor(sr.prototype,"add"),sr.prototype),xr(sr.prototype,"update",[P0],Object.getOwnPropertyDescriptor(sr.prototype,"update"),sr.prototype),xr(sr.prototype,"delete",[A0],Object.getOwnPropertyDescriptor(sr.prototype,"delete"),sr.prototype),sr),T0,uo,Lw=(T0=wr({before:"beforeSceneUpdated",after:"sceneUpdated"}),uo=function(){function t(a){this.oasis=a}var i=t.prototype;return i.init=function(){var r=this,e=this.oasis.options.config.scene;e&&Object.keys(e).forEach(function(n){var o=e[n];Object.keys(o.props).forEach(function(s){var l=o.props[s];r.setProp(n,s,l)})})},i.update=function(r,e,n){return this.setProp(r,e,n),{field:r,key:e,value:n}},i.setProp=function(r,e,n){var o=this.oasis.engine.sceneManager.activeScene;if(r==="background"&&e==="skyboxTexture"){var s=o.background.sky;if(n){s.mesh=ki.createCuboid(o.engine,2,2,2);var l=new zx(o.engine);l.textureCubeMap=this.oasis.resourceManager.get(n.id).resource,s.material=l}else s.mesh=null,s.material=null}else o[r]&&(n&&n.type==="asset"?o[r][e]=this.oasis.resourceManager.get(n.id).resource:o[r][e]=n)},t}(),xr(uo.prototype,"update",[T0],Object.getOwnPropertyDescriptor(uo.prototype,"update"),uo.prototype),uo),M0=function(t){le(i,t);function i(){return t.apply(this,arguments)||this}var a=i.prototype;return a.load=function(e,n){var o=this;return new Promise(function(s){o.setMeta(),n.source?e.load({url:n.source,type:De.SpriteAtlas}).then(function(l){o._resource=l;for(var u=l.sprites,c=o.resourceManager,f=u.length-1;f>=0;f--){var d=u[f],h=new g0(c,d),_=d._assetID;c.maxId=Math.max(_,c.maxId),c.resourceMap[_]=h,c.resourceIdMap.set(h,""+_)}s(o)}):(i.defaultAtlas||(i.defaultAtlas=new N_(e.engine)),o._resource=i.defaultAtlas,s(o))})},a.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},a.getProps=function(){var e=this,n={},o=Xi(this.resource);return o.forEach(function(s){return n[s]=e.resource[s]}),n},a.update=function(){},i}(Bt);M0.defaultAtlas=void 0;var E0,b0,wn,co={script:bw,gltf:Ew,texture:ar,cubeTexture:Cw,PBRMaterial:v0,PBRSpecularMaterial:_0,UnlitMaterial:p0,BlinnPhongMaterial:d0,base:Rw,sprite:g0,SpriteAtlas:M0,animatorController:f0,animationClip:c0},C0=new Map;for(var Cc in co)if(co.hasOwnProperty(Cc)){var Ow=co[Cc];C0.set(Ow,Cc)}var R0={createResource:function(i,a){return new co[a](i)}},Dw=(E0=wr({before:"beforeResourceRemove"}),b0=wr({after:"resourceUpdated",before:"beforeResourceUpdate"}),wn=function(){function t(a){this.oasis=a,this.resourceMap={},this.resourceIdMap=new WeakMap,this.maxId=0,this.engineResourceManager=void 0,this.engineResourceManager=this.oasis.engine.resourceManager}var i=t.prototype;return i.load=function(r){var e=this,n=R0.createResource(this,r.type),o=n.load(this.oasis.engine.resourceManager,r,this.oasis);return this.maxId=Math.max(+r.id,this.maxId),o.then(function(){e.resourceMap[r.id]=n,e.resourceIdMap.set(n,r.id)}),o},i.add=function(r){var e=this,n=R0.createResource(this,r.type);return new Promise(function(o){n.loadWithAttachedResources(e.oasis.engine.resourceManager,r,e.oasis).then(function(s){o(e.getAddResourceResult(s.resources,s.structure))})})},i.remove=function(r){var e=this;return new Promise(function(n){var o=e.resourceMap[r],s=[r],l=!1;if(delete e.resourceMap[r],o)for(var u=o.attachedResources,c=0;c<u.length;c++){var f=u[c],d=e.resourceIdMap.get(f);d&&(l=!0,e.remove(d).then(function(h){s.push.apply(s,h),n(s)}))}l||n(s)})},i.update=function(r,e,n){var o=this.get(r);return o&&o.update(e,n),{resource:o,id:r,key:e,value:n}},i.updateMeta=function(r,e,n){var o=this.get(r);o&&o.updateMeta(e,n)},i.get=function(r){return this.resourceMap[r]},i.getAll=function(){return ja(this.resourceMap)},i.getAddResourceResult=function(r,e){var n=this,o={},s=r[e.index],l=""+ ++this.maxId;this.resourceMap[l]=s,this.resourceIdMap.set(s,l),o.id=this.maxId,o.type=C0.get(s.constructor),o.meta=s.meta,o.props={};for(var u in e.props)if(e.props.hasOwnProperty(u)){var c=e.props[u];c&&(Array.isArray(c)?o.props[u]=c.map(function(f){return n.getAddResourceResult(r,f)}):o.props[u]=this.getAddResourceResult(r,c))}return o},ao(t,[{key:"isLocal",get:function(){return this.oasis.options.local}},{key:"useCompressedTexture",get:function(){var r;return(r=this.oasis.options.useCompressedTexture)!=null?r:!0}}]),t}(),xr(wn.prototype,"remove",[E0],Object.getOwnPropertyDescriptor(wn.prototype,"remove"),wn.prototype),xr(wn.prototype,"update",[b0],Object.getOwnPropertyDescriptor(wn.prototype,"update"),wn.prototype),wn),z0,fo,Fw=(z0=wr({after:"schemaParsed"}),fo=function(t){le(i,t);function i(r,e){var n,o;return o=t.call(this,r.engine)||this,o._options=r,o.pluginManager=e,o.nodeManager=void 0,o.abilityManager=void 0,o.sceneManager=void 0,o.resourceManager=void 0,o._canvas=void 0,o.schema=void 0,o.timeout=void 0,o.oasis=oo(o),o.schema=r.config,o.timeout=r.timeout,r.scripts=(n=r.scripts)!=null?n:{},o.nodeManager=new Bw(oo(o)),o.abilityManager=new zw(oo(o)),o.nodeManager.add=o.nodeManager.add.bind(o.nodeManager),o.abilityManager.add=o.abilityManager.add.bind(o.abilityManager),o.resourceManager=new Dw(oo(o)),o.sceneManager=new Lw(oo(o)),r.fps&&(o.engine.targetFrameRate=r.fps,o.engine.vSyncCount=0),o}var a=i.prototype;return a.updateConfig=function(e){this.schema=e,this.init()},a.init=function(){var e=this;return this.loadResources().then(function(){e.bindResources(),e.parseEntities(),e.attach(),e.nodeManager.addRootEntity(),e.sceneManager.init(),e.parseNodeAbilities(),e.pluginManager.boot(e)})},a.loadResources=function(){var e=this,n=this.schema.assets,o=n===void 0?{}:n,s=ja(o).filter(function(l){return co[l.type]?!0:(console.warn(l.type+" loader is not defined. the "+l.type+" type will be ignored."),!1)}).map(function(l){return e.resourceManager.load(l)});return Promise.all(s)},a.bindResources=function(){this.resourceManager.getAll().forEach(function(e){e.bind()})},a.parseEntities=function(){var e=this.schema.nodes,n=this.bfsNodes();n.map(function(o){return e[o]}).forEach(this.nodeManager.add)},a.parseNodeAbilities=function(){var e=this.schema.abilities;Object.keys(e).map(function(n){return Xe({id:n},e[n])}).forEach(this.abilityManager.add)},a.bfsNodes=function(){var e=this.schema.nodes,n=ja(e).filter(function(l){return!e[l.parent]}).map(function(l){return l.id}),o=[],s=function l(u){o=o.concat(u),u.forEach(function(c){var f=e[c].children;f&&l(f)})};return s(n),o},a.attach=function(){this.resourceManager.getAll().forEach(function(e){e.attach()})},i.create=function(e,n){var o=new i(e,n);return o.init().then(function(){return e.autoPlay&&o.engine.run(),o})},ao(i,[{key:"canvas",get:function(){return this._options.canvas}},{key:"options",get:function(){return this._options}}]),i}(iv),xr(fo.prototype,"init",[z0],Object.getOwnPropertyDescriptor(fo.prototype,"init"),fo.prototype),fo);lo.registerComponents("o3",{GLTFModel:xw,SpriteRenderer:mx,SpriteMask:dc,PointLight:Ir,AmbientLight:rr,DirectLight:Fr,ParticleRenderer:fp,BoxCollider:nx,Camera:I_,Model:o0,Component:Jt,SphereCollider:ix,Animator:xc});var Iw="0.5.6";console.log("oasis engine version: "+Iw);function Nw(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,Rc(t,i)}function Rc(t,i){return Rc=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},Rc(t,i)}function Vr(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var B0=O.zeroTolerance,zc=function(){function t(a,r,e){this.radius=void 0,this.phi=void 0,this.theta=void 0,this.radius=a!==void 0?a:1,this.phi=r!==void 0?r:0,this.theta=e!==void 0?e:0}var i=t.prototype;return i.set=function(r,e,n){return this.radius=r,this.phi=e,this.theta=n,this},i.makeSafe=function(){return this.phi=O.clamp(this.phi,B0,Math.PI-B0),this},i.setFromVec3=function(r){return this.radius=r.length(),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(r.x,r.z),this.phi=Math.acos(O.clamp(r.y/this.radius,-1,1))),this},i.setToVec3=function(r){var e=Math.sin(this.phi)*this.radius;return r.x=e*Math.sin(this.theta),r.y=Math.cos(this.phi)*this.radius,r.z=e*Math.cos(this.theta),this},t}(),Gw=function(t){Nw(i,t);function i(r){var e;return e=t.call(this,r)||this,e.camera=void 0,e.domElement=void 0,e.mainElement=void 0,e.fov=void 0,e.target=void 0,e.up=void 0,e.minDistance=void 0,e.maxDistance=void 0,e.minZoom=void 0,e.maxZoom=void 0,e.enableDamping=void 0,e.zoomFactor=void 0,e.enableRotate=void 0,e.keyPanSpeed=void 0,e.minPolarAngle=void 0,e.maxPolarAngle=void 0,e.minAzimuthAngle=void 0,e.maxAzimuthAngle=void 0,e.enableZoom=void 0,e.dampingFactor=void 0,e.zoomSpeed=void 0,e.enablePan=void 0,e.autoRotate=void 0,e.autoRotateSpeed=Math.PI,e.rotateSpeed=void 0,e.enableKeys=void 0,e.keys=void 0,e.mouseButtons=void 0,e.touchFingers=void 0,e.STATE=void 0,e.mouseUpEvents=void 0,e.constEvents=void 0,e._position=void 0,e._offset=void 0,e._spherical=void 0,e._sphericalDelta=void 0,e._sphericalDump=void 0,e._zoomFrag=void 0,e._scale=void 0,e._panOffset=void 0,e._isMouseUp=void 0,e._vPan=void 0,e._state=void 0,e._rotateStart=void 0,e._rotateEnd=void 0,e._rotateDelta=void 0,e._panStart=void 0,e._panEnd=void 0,e._panDelta=void 0,e._zoomStart=void 0,e._zoomEnd=void 0,e._zoomDelta=void 0,e.camera=r,e.mainElement=e.engine.canvas._webCanvas,e.domElement=document,e.fov=45,e.target=new A,e.up=new A(0,1,0),e.minDistance=.1,e.maxDistance=1/0,e.minZoom=0,e.maxZoom=1/0,e.minPolarAngle=0,e.maxPolarAngle=Math.PI,e.minAzimuthAngle=-1/0,e.maxAzimuthAngle=1/0,e.enableDamping=!0,e.dampingFactor=.1,e.zoomFactor=.2,e.enableZoom=!0,e.zoomSpeed=1,e.enableRotate=!0,e.rotateSpeed=1,e.enablePan=!0,e.keyPanSpeed=7,e.autoRotate=!1,e.enableKeys=!1,e.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},e.mouseButtons={ORBIT:0,ZOOM:1,PAN:2},e.touchFingers={ORBIT:1,ZOOM:2,PAN:3},e._position=new A,e._offset=new A,e._spherical=new zc,e._sphericalDelta=new zc,e._sphericalDump=new zc,e._zoomFrag=0,e._scale=1,e._panOffset=new A,e._isMouseUp=!0,e._vPan=new A,e._rotateStart=new G,e._rotateEnd=new G,e._rotateDelta=new G,e._panStart=new G,e._panEnd=new G,e._panDelta=new G,e._zoomStart=new G,e._zoomEnd=new G,e._zoomDelta=new G,e.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},e._state=e.STATE.NONE,e.constEvents=[{type:"mousedown",listener:e.onMouseDown.bind(Vr(e))},{type:"wheel",listener:e.onMouseWheel.bind(Vr(e))},{type:"keydown",listener:e.onKeyDown.bind(Vr(e)),element:window},{type:"touchstart",listener:e.onTouchStart.bind(Vr(e))},{type:"touchmove",listener:e.onTouchMove.bind(Vr(e))},{type:"touchend",listener:e.onTouchEnd.bind(Vr(e))},{type:"contextmenu",listener:e.onContextMenu.bind(Vr(e))}],e.mouseUpEvents=[{type:"mousemove",listener:e.onMouseMove.bind(Vr(e))},{type:"mouseup",listener:e.onMouseUp.bind(Vr(e))}],e.constEvents.forEach(function(n){n.element?n.element.addEventListener(n.type,n.listener,!1):e.mainElement.addEventListener(n.type,n.listener,!1)}),e}var a=i.prototype;return a.onDisable=function(){var e=this.domElement===document?this.domElement.body:this.domElement;this.mainElement.removeEventListener(this.mouseUpEvents[0].type,this.mouseUpEvents[0].listener,!1),e.removeEventListener(this.mouseUpEvents[1].type,this.mouseUpEvents[1].listener,!1)},a.onDestroy=function(){var e=this;this.constEvents.forEach(function(o){o.element?o.element.removeEventListener(o.type,o.listener,!1):e.mainElement.removeEventListener(o.type,o.listener,!1)});var n=this.domElement===document?this.domElement.body:this.domElement;this.mainElement.removeEventListener(this.mouseUpEvents[0].type,this.mouseUpEvents[0].listener,!1),n.removeEventListener(this.mouseUpEvents[1].type,this.mouseUpEvents[1].listener,!1)},a.onUpdate=function(e){if(!!this.enabled){var n=this.camera.transform.position;n.cloneTo(this._offset),this._offset.subtract(this.target),this._spherical.setFromVec3(this._offset),this.autoRotate&&this._state===this.STATE.NONE&&this.rotateLeft(this.getAutoRotationAngle(e)),this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi,this._spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this._scale!==1&&(this._zoomFrag=this._spherical.radius*(this._scale-1)),this._spherical.radius+=this._zoomFrag,this._spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this._spherical.radius)),this.target.add(this._panOffset),this._spherical.setToVec3(this._offset),this.target.cloneTo(this._position),this._position.add(this._offset),this.camera.transform.position=this._position,this.camera.transform.lookAt(this.target,this.up),this.enableDamping===!0?(this._sphericalDump.theta*=1-this.dampingFactor,this._sphericalDump.phi*=1-this.dampingFactor,this._zoomFrag*=1-this.zoomFactor,this._isMouseUp?(this._sphericalDelta.theta=this._sphericalDump.theta,this._sphericalDelta.phi=this._sphericalDump.phi):this._sphericalDelta.set(0,0,0)):(this._sphericalDelta.set(0,0,0),this._zoomFrag=0),this._scale=1,this._panOffset.setValue(0,0,0)}},a.getAutoRotationAngle=function(e){return this.autoRotateSpeed/1e3*e},a.getZoomScale=function(){return Math.pow(.95,this.zoomSpeed)},a.rotateLeft=function(e){this._sphericalDelta.theta-=e,this.enableDamping&&(this._sphericalDump.theta=-e)},a.rotateUp=function(e){this._sphericalDelta.phi-=e,this.enableDamping&&(this._sphericalDump.phi=-e)},a.panLeft=function(e,n){var o=n.elements;this._vPan.setValue(o[0],o[1],o[2]),this._vPan.scale(e),this._panOffset.add(this._vPan)},a.panUp=function(e,n){var o=n.elements;this._vPan.setValue(o[4],o[5],o[6]),this._vPan.scale(e),this._panOffset.add(this._vPan)},a.pan=function(e,n){var o=this.domElement===document?this.domElement.body:this.domElement,s=this.camera.position;s.cloneTo(this._vPan),this._vPan.subtract(this.target);var l=this._vPan.length();l*=this.fov/2*(Math.PI/180),this.panLeft(-2*e*(l/o.clientHeight),this.camera.transform.worldMatrix),this.panUp(2*n*(l/o.clientHeight),this.camera.transform.worldMatrix)},a.zoomIn=function(e){this._scale*=e},a.zoomOut=function(e){this._scale/=e},a.handleMouseDownRotate=function(e){this._rotateStart.setValue(e.clientX,e.clientY)},a.handleMouseDownZoom=function(e){this._zoomStart.setValue(e.clientX,e.clientY)},a.handleMouseDownPan=function(e){this._panStart.setValue(e.clientX,e.clientY)},a.handleMouseMoveRotate=function(e){this._rotateEnd.setValue(e.clientX,e.clientY),G.subtract(this._rotateEnd,this._rotateStart,this._rotateDelta);var n=this.domElement===document?document.body:this.domElement;this.rotateLeft(2*Math.PI*(this._rotateDelta.x/n.clientWidth)*this.rotateSpeed),this.rotateUp(2*Math.PI*(this._rotateDelta.y/n.clientHeight)*this.rotateSpeed),this._rotateEnd.cloneTo(this._rotateStart)},a.handleMouseMoveZoom=function(e){this._zoomEnd.setValue(e.clientX,e.clientY),G.subtract(this._zoomEnd,this._zoomStart,this._zoomDelta),this._zoomDelta.y>0?this.zoomOut(this.getZoomScale()):this._zoomDelta.y<0&&this.zoomIn(this.getZoomScale()),this._zoomEnd.cloneTo(this._zoomStart)},a.handleMouseMovePan=function(e){this._panEnd.setValue(e.clientX,e.clientY),G.subtract(this._panEnd,this._panStart,this._panDelta),this.pan(this._panDelta.x,this._panDelta.y),this._panEnd.cloneTo(this._panStart)},a.handleMouseWheel=function(e){e.deltaY<0?this.zoomIn(this.getZoomScale()):e.deltaY>0&&this.zoomOut(this.getZoomScale())},a.handleKeyDown=function(e){switch(e.keyCode){case this.keys.UP:this.pan(0,this.keyPanSpeed);break;case this.keys.BOTTOM:this.pan(0,-this.keyPanSpeed);break;case this.keys.LEFT:this.pan(this.keyPanSpeed,0);break;case this.keys.RIGHT:this.pan(-this.keyPanSpeed,0);break}},a.handleTouchStartRotate=function(e){this._rotateStart.setValue(e.touches[0].pageX,e.touches[0].pageY)},a.handleTouchStartZoom=function(e){var n=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(n*n+o*o);this._zoomStart.setValue(0,s)},a.handleTouchStartPan=function(e){this._panStart.setValue(e.touches[0].pageX,e.touches[0].pageY)},a.handleTouchMoveRotate=function(e){this._rotateEnd.setValue(e.touches[0].pageX,e.touches[0].pageY),G.subtract(this._rotateEnd,this._rotateStart,this._rotateDelta);var n=this.domElement===document?this.domElement.body:this.domElement;this.rotateLeft(2*Math.PI*this._rotateDelta.x/n.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this._rotateDelta.y/n.clientHeight*this.rotateSpeed),this._rotateEnd.cloneTo(this._rotateStart)},a.handleTouchMoveZoom=function(e){var n=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(n*n+o*o);this._zoomEnd.setValue(0,s),G.subtract(this._zoomEnd,this._zoomStart,this._zoomDelta),this._zoomDelta.y>0?this.zoomIn(this.getZoomScale()):this._zoomDelta.y<0&&this.zoomOut(this.getZoomScale()),this._zoomEnd.cloneTo(this._zoomStart)},a.handleTouchMovePan=function(e){this._panEnd.setValue(e.touches[0].pageX,e.touches[0].pageY),G.subtract(this._panEnd,this._panStart,this._panDelta),this.pan(this._panDelta.x,this._panDelta.y),this._panEnd.cloneTo(this._panStart)},a.onMouseDown=function(e){if(this.enabled!==!1){switch(e.preventDefault(),this._isMouseUp=!1,e.button){case this.mouseButtons.ORBIT:if(this.enableRotate===!1)return;this.handleMouseDownRotate(e),this._state=this.STATE.ROTATE;break;case this.mouseButtons.ZOOM:if(this.enableZoom===!1)return;this.handleMouseDownZoom(e),this._state=this.STATE.ZOOM;break;case this.mouseButtons.PAN:if(this.enablePan===!1)return;this.handleMouseDownPan(e),this._state=this.STATE.PAN;break}if(this._state!==this.STATE.NONE){var n=this.domElement===document?this.domElement.body:this.domElement;this.mainElement.addEventListener(this.mouseUpEvents[0].type,this.mouseUpEvents[0].listener,!1),n.addEventListener(this.mouseUpEvents[1].type,this.mouseUpEvents[1].listener,!1)}}},a.onMouseMove=function(e){if(this.enabled!==!1)switch(e.preventDefault(),this._state){case this.STATE.ROTATE:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(e);break;case this.STATE.ZOOM:if(this.enableZoom===!1)return;this.handleMouseMoveZoom(e);break;case this.STATE.PAN:if(this.enablePan===!1)return;this.handleMouseMovePan(e);break}},a.onMouseUp=function(){var e=this;this.enabled!==!1&&(this._isMouseUp=!0,this.mouseUpEvents.forEach(function(n){var o=e.domElement===document?e.domElement.body:e.domElement;o.removeEventListener(n.type,n.listener,!1),e.mainElement.removeEventListener(n.type,n.listener,!1)}),this._state=this.STATE.NONE)},a.onMouseWheel=function(e){this.enabled===!1||this.enableZoom===!1||this._state!==this.STATE.NONE&&this._state!==this.STATE.ROTATE||(e.preventDefault(),e.stopPropagation(),this.handleMouseWheel(e))},a.onKeyDown=function(e){this.enabled===!1||this.enableKeys===!1||this.enablePan===!1||this.handleKeyDown(e)},a.onTouchStart=function(e){if(this.enabled!==!1)switch(this._isMouseUp=!1,e.touches.length){case this.touchFingers.ORBIT:if(this.enableRotate===!1)return;this.handleTouchStartRotate(e),this._state=this.STATE.TOUCH_ROTATE;break;case this.touchFingers.ZOOM:if(this.enableZoom===!1)return;this.handleTouchStartZoom(e),this._state=this.STATE.TOUCH_ZOOM;break;case this.touchFingers.PAN:if(this.enablePan===!1)return;this.handleTouchStartPan(e),this._state=this.STATE.TOUCH_PAN;break;default:this._state=this.STATE.NONE}},a.onTouchMove=function(e){if(this.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case this.touchFingers.ORBIT:if(this.enableRotate===!1||this._state!==this.STATE.TOUCH_ROTATE)return;this.handleTouchMoveRotate(e);break;case this.touchFingers.ZOOM:if(this.enableZoom===!1||this._state!==this.STATE.TOUCH_ZOOM)return;this.handleTouchMoveZoom(e);break;case this.touchFingers.PAN:if(this.enablePan===!1||this._state!==this.STATE.TOUCH_PAN)return;this.handleTouchMovePan(e);break;default:this._state=this.STATE.NONE}},a.onTouchEnd=function(){this.enabled!==!1&&(this._isMouseUp=!0,this._state=this.STATE.NONE)},a.onContextMenu=function(e){this.enabled!==!1&&e.preventDefault()},i}(sx);export{c_ as B,ge as C,ax as H,Je as I,Gt as L,qa as M,Gw as O,pe as Q,Vm as R,sx as S,ve as V,Vw as W,Ni as a,Or as b,jt as c,Q as d,A as e,Z as f,I_ as g,nx as h,$a as i,Tt as j,G as k,Uw as l,kw as m};
